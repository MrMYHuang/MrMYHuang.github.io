(this.webpackJsonpcbetar2=this.webpackJsonpcbetar2||[]).push([[1],{101:function(t){t.exports=JSON.parse('{"name":"cbetar2","homepage":"/","productName":"\u96fb\u5b50\u4f5b\u5178","pwaVersion":"4.26.0","version":"13.2.2","license":"MIT","keywords":["CBETA","\u96fb\u5b50\u4f5b\u5178","\u4f5b\u5178","\u4f5b\u7d93","\u5927\u85cf\u7d93","Tripitaka","Buddhist Canon","Buddhist text"],"description":"CBETA\u96fb\u5b50\u4f5b\u5178\u95b1\u8b80\u56682(\u975e\u5b98\u65b9)\uff0c\u4f7f\u7528CBETA API\u5b58\u53d6\u96fb\u5b50\u4f5b\u7d93\u3002","repository":"https://github.com/MrMYHuang/cbetar2","author":{"name":"Meng-Yuan Huang","email":"myh@live.com"},"private":false,"files":["README.md"],"main":"buildElectron/main.js","scripts":{"postinstall":"electron-builder install-app-deps","start":"react-app-rewired start","build":"react-app-rewired build && powershell -file CopyBuild.ps1","build_linux":"react-app-rewired build && ./CopyBuild.sh","test":"react-app-rewired test","eject":"react-scripts eject","build-electron":"tsc -b tsconfigElectron.json","build-electron-store":"tsc -b tsconfigElectron.json && mv buildElectron/mainStore.js buildElectron/main.js","start-electron":"npm run build-electron && electron .","dist-win":"npm run build-electron && electron-builder -w -c electronBuilderConfigs/win.json","dist-deb":"npm run build-electron && electron-builder -l deb -c electronBuilderConfigs/deb.json","dist-rpm":"npm run build-electron && electron-builder -l rpm -c electronBuilderConfigs/rpm.json","dist-snap":"npm run build-electron && rm -f dist/*.snap && electron-builder -l snap -c electronBuilderConfigs/snap.json","dist-snap-arm64":"export SNAPCRAFT_BUILD_ENVIRONMENT=lxd && npm run build-electron-store && rm -f dist/*.snap && electron-builder -l snap -c electronBuilderConfigs/snap.json --arm64","publish-snap":"snapcraft upload --release=stable dist/*.snap","dist-mac":"npm run build-electron && electron-builder -m pkg -c electronBuilderConfigs/mac.json","icons-mas":"cd buildElectron && iconutil -c icns icon.iconset","dist-mas":"npm run build-electron-store && electron-builder -m mas --universal -c electronBuilderConfigs/mas.json","dist-mas-dev":"npm run build-electron-store && electron-builder -m mas-dev --arm64 -c electronBuilderConfigs/masDev.json"},"eslintConfig":{"extends":"react-app"},"dependencies":{"@types/semver":"^7.3.8","axios":"^0.21.4","electron-window-state":"^5.0.3","libxslt-myh":"^0.9.10","node-downloader-helper":"^1.0.18","semver":"^7.3.5"},"devDependencies":{"@ionic/react":"^5.8.0","@ionic/react-router":"^5.8.0","@testing-library/jest-dom":"^5.14.1","@testing-library/react":"^12.1.0","@testing-library/user-event":"^13.2.1","@types/jest":"^27.0.1","@types/libxmljs":"^0.18.7","@types/node":"^16.9.1","@types/qrcode":"^1.4.1","@types/react":"^17.0.21","@types/react-dom":"^17.0.9","@types/react-redux":"^7.1.18","@types/react-router":"^5.1.16","@types/react-router-dom":"^5.1.9","@types/uuid":"^8.3.1","axios":"^0.21.4","customize-cra":"^1.0.0","electron":"^14.0.1","electron-builder":"22.14.2","electron-builder-notarize-pkg":"^1.2.0","epubjs-myh":"^0.3.113","history":"^4.10.1","ionicons":"^5.5.3","memfs":"^3.2.4","nodepub":"^3.0.2","qrcode":"^1.4.4","query-string":"^7.0.1","react":"^17.0.2","react-app-rewired":"^2.1.8","react-dom":"^17.0.2","react-redux":"^7.2.5","react-router":"^5.2.1","react-router-dom":"^5.3.0","react-scripts":"^4.0.3","redux":"^4.1.1","swiped-events-myh":"^1.2.0","typescript":"^4.4.3","uuid":"^8.3.2","workbox-background-sync":"^5.1.4","workbox-broadcast-update":"^5.1.4","workbox-cacheable-response":"^5.1.4","workbox-core":"^5.1.4","workbox-expiration":"^5.1.4","workbox-google-analytics":"^5.1.4","workbox-navigation-preload":"^5.1.4","workbox-precaching":"^5.1.4","workbox-range-requests":"^5.1.4","workbox-routing":"^5.1.4","workbox-strategies":"^5.1.4","workbox-streams":"^5.1.4"},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]}}')},148:function(t,e,n){},239:function(t,e,n){var s={"./ion-action-sheet.entry.js":[468,5],"./ion-alert.entry.js":[469,6],"./ion-app_8.entry.js":[470,7],"./ion-avatar_3.entry.js":[471,17],"./ion-back-button.entry.js":[472,18],"./ion-backdrop.entry.js":[473,43],"./ion-button_2.entry.js":[474,19],"./ion-card_5.entry.js":[475,20],"./ion-checkbox.entry.js":[476,21],"./ion-chip.entry.js":[477,22],"./ion-col_3.entry.js":[478,44],"./ion-datetime_3.entry.js":[479,10],"./ion-fab_3.entry.js":[480,23],"./ion-img.entry.js":[481,45],"./ion-infinite-scroll_2.entry.js":[482,46],"./ion-input.entry.js":[483,24],"./ion-item-option_3.entry.js":[484,25],"./ion-item_8.entry.js":[485,26],"./ion-loading.entry.js":[486,27],"./ion-menu_3.entry.js":[487,28],"./ion-modal.entry.js":[488,8],"./ion-nav_2.entry.js":[489,14],"./ion-popover.entry.js":[490,9],"./ion-progress-bar.entry.js":[491,29],"./ion-radio_2.entry.js":[492,30],"./ion-range.entry.js":[493,31],"./ion-refresher_2.entry.js":[494,11],"./ion-reorder_2.entry.js":[495,16],"./ion-ripple-effect.entry.js":[496,47],"./ion-route_4.entry.js":[497,32],"./ion-searchbar.entry.js":[498,33],"./ion-segment_2.entry.js":[499,34],"./ion-select_3.entry.js":[500,35],"./ion-slide_2.entry.js":[501,48],"./ion-spinner.entry.js":[502,13],"./ion-split-pane.entry.js":[503,49],"./ion-tab-bar_2.entry.js":[504,36],"./ion-tab_2.entry.js":[505,15],"./ion-text.entry.js":[506,37],"./ion-textarea.entry.js":[507,38],"./ion-toast.entry.js":[508,39],"./ion-toggle.entry.js":[509,12],"./ion-virtual-scroll.entry.js":[510,50]};function o(t){if(!n.o(s,t))return Promise.resolve().then((function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}));var e=s[t],o=e[0];return n.e(e[1]).then((function(){return n(o)}))}o.keys=function(){return Object.keys(s)},o.id=239,t.exports=o},241:function(t,e,n){var s={"./ion-icon.entry.js":[511,57]};function o(t){if(!n.o(s,t))return Promise.resolve().then((function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}));var e=s[t],o=e[0];return n.e(e[1]).then((function(){return n(o)}))}o.keys=function(){return Object.keys(s)},o.id=241,t.exports=o},277:function(t,e,n){},278:function(t,e,n){},321:function(t,e){},323:function(t,e){},367:function(t,e){},369:function(t,e){},377:function(t,e){},379:function(t,e){},387:function(t,e){},389:function(t,e){},411:function(t,e){},413:function(t,e){},419:function(t,e){},421:function(t,e){},444:function(t,e,n){},445:function(t,e,n){},466:function(t,e,n){"use strict";n.r(e);var s,o=n(2),r=n.n(o),a=n(50),i=n.n(a),c=n(97),l=n(5),h=n.n(l),u=n(10),p=n(20),d=n(4),b=n(6),j=n(12),f=n(11),x=n(25),v=n(1),m=n(232),g=n(26),w=n(47),k=n.n(w),y=n(86),O=n(27),S=n(225),T=n.n(S);!function(t){t[t.BY_CHAPTER=0]="BY_CHAPTER",t[t.BY_JUAN=1]="BY_JUAN"}(s||(s={}));var C=function t(e){Object(d.a)(this,t),this.title=void 0,this.juan=void 0,this.title=e.title,this.juan=e.juan},A=function t(e){Object(d.a)(this,t),this.title=void 0,this.juan=void 0,this.juan_list=void 0,this.mulu=void 0,this.work=void 0,this.vol=void 0,this.title=e.title,this.juan=e.juan,this.juan_list=e.juan_list,this.mulu=e.mulu,this.work=e.work,this.vol=e.vol},I=n(0),E="v1.2",F="https://cbdata.dila.edu.tw/".concat(E),N="cbetardb",L="Settings.json",D="".concat("","/assets/TW-Kai-98_1.woff"),U="",P=T.a.create({baseURL:F,timeout:5e3});function B(t){switch(t){case 0:return 0;case 1:return 20;case 2:return 40}}function R(t,e){return"".concat(t,"_juan").concat(e,".html")}function _(t){return M.apply(this,arguments)}function M(){return(M=Object(u.a)(h.a.mark((function t(e){var n;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=indexedDB.open(N),t.abrupt("return",new Promise((function(t,s){n.onsuccess=function(){var o=Object(u.a)(h.a.mark((function o(r){var a,i,c;return h.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:a=n.result,i=a.transaction(["store"],"readwrite"),(c=i.objectStore("store").get(e)).onsuccess=function(){var n=Object(u.a)(h.a.mark((function n(o){var r;return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=c.result){n.next=5;break}return console.error("".concat(e," loading failed!")),console.error((new Error).stack),n.abrupt("return",s());case 5:return n.abrupt("return",t(r));case 6:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}();case 4:case"end":return o.stop()}}),o)})));return function(t){return o.apply(this,arguments)}}()})));case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function V(){return(V=Object(u.a)(h.a.mark((function t(e,n){var s;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=indexedDB.open(N),t.abrupt("return",new Promise((function(t,o){s.onsuccess=function(){var r=Object(u.a)(h.a.mark((function r(a){var i,c,l;return h.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:i=s.result,c=i.transaction(["store"],"readwrite"),(l=c.objectStore("store").put(n,e)).onsuccess=function(e){return t()},l.onerror=function(t){return o()};case 5:case"end":return r.stop()}}),r)})));return function(t){return r.apply(this,arguments)}}()})));case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function K(){return(K=Object(u.a)(h.a.mark((function t(e){var n;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=indexedDB.open(N),t.abrupt("return",new Promise((function(t,s){try{n.onsuccess=function(o){var r=n.result.transaction(["store"],"readwrite");try{var a=r.objectStore("store").delete(e);a.onsuccess=function(e){return t()},a.onerror=function(t){return s()}}catch(i){console.error(i)}}}catch(o){s(o)}})));case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function H(){return z.apply(this,arguments)}function z(){return(z=Object(u.a)(h.a.mark((function t(){var e;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=indexedDB.open(N),t.abrupt("return",new Promise((function(t,n){e.onsuccess=function(){var s=Object(u.a)(h.a.mark((function s(o){var r,a,i;return h.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:r=e.result,a=r.transaction(["store"],"readwrite"),(i=a.objectStore("store").clear()).onsuccess=function(e){return t()},i.onerror=function(t){return n()};case 5:case"end":return s.stop()}}),s)})));return function(t){return s.apply(this,arguments)}}()})));case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function J(){return(J=Object(u.a)(h.a.mark((function t(){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return localStorage.clear(),t.next=3,H();case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var W=window.electronBackendApi;function Y(){return(Y=Object(u.a)(h.a.mark((function t(e,n,s){var o,r,a,i,c,l,u,p,d,b,j,f,x,v,m=arguments;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=m.length>3&&void 0!==m[3]&&m[3],r=m.length>4&&void 0!==m[4]&&m[4],a=s||R(e,n),i=null,t.prev=4,t.next=7,_(a);case 7:i=t.sent,t.next=12;break;case 10:t.prev=10,t.t0=t.catch(4);case 12:if(c=localStorage.getItem(L),l=new A({}),c&&(p=JSON.parse(c).settings.bookmarks,u=p.find((function(t){return t.fileName===a||t.uuid===e}))),null===i||void 0===u||o){t.next=19;break}l=u.work,t.next=46;break;case 19:if(!s){t.next=28;break}return t.next=22,P.get("/".concat(s),{responseType:"arraybuffer"});case 22:d=t.sent,b=new TextDecoder,j=b.decode(d.data),i=j.includes("charset=big5")?new TextDecoder("big5").decode(d.data):j,t.next=41;break;case 28:if(!r){t.next=35;break}return null===W||void 0===W||W.send("toMain",{event:"fetchJuan",work:e,juan:n}),t.next=32,new Promise((function(t,e){null===W||void 0===W||W.receiveOnce("fromMain",(function(e){switch(e.event){case"fetchJuan":t(e)}}))}));case 32:f=t.sent,t.next=39;break;case 35:return t.next=37,P.get("/juans?edition=CBETA&work_info=1&work=".concat(e,"&juan=").concat(n),{responseType:"arraybuffer"});case 37:x=t.sent,f=JSON.parse((new TextDecoder).decode(x.data));case 39:i=f.results[0],l=f.work_info;case 41:(v=document.implementation.createHTMLDocument("")).body.innerHTML=i,i=(i=(i=(new XMLSerializer).serializeToString(v.body)).replace("<body","<div")).replace("/body>","/div>");case 46:return t.abrupt("return",{htmlStr:i,workInfo:l});case 47:case"end":return t.stop()}}),t,null,[[4,10]])})))).apply(this,arguments)}var G=console.log.bind(console),q=console.error.bind(console);function X(){return Object(v.S)("ios")&&"MacIntel"===navigator.platform}var $,Q={storeFile:L,fontSizeNorm:24,fontSizeLarge:48,getLog:function(){return U},enableAppLog:function(){console.log=function(){U+="----- Info ----\n",U+=Array.from(arguments)+"\n",G.apply(console,arguments)},console.error=function(){U+="----- Error ----\n",U+=Array.from(arguments)+"\n",arguments[0].isAxiosError&&(U+="URL: ".concat(arguments[0].config.url,"\n")),q.apply(console,arguments)}},disableAppLog:function(){U="",console.log=G,console.error=q},cbetardb:N,pwaUrl:"",bugReportApiUrl:"https://vh6ud1o56g.execute-api.ap-northeast-1.amazonaws.com/bugReportMailer",apiVersion:E,cbetaApiUrl:F,dilaDictApiUrl:"https://glossaries.dila.edu.tw/search.json",twKaiFontKey:"twKaiFont",twKaiFontPath:D,axiosInstance:P,topCatalogsByCat:{CBETA:"CBETA \u90e8\u985e","Cat-T":"\u5927\u6b63\u85cf","Cat-X":"\u534d\u7e8c\u85cf","Cat-N":"\u5357\u50b3\u5927\u85cf\u7d93",others:"\u6b77\u4ee3\u85cf\u7d93\u88dc\u8f2f",modern:"\u8fd1\u4ee3\u65b0\u7de8\u6587\u737b"},topCatalogsByVol:{"Vol-T":"T \u5927\u6b63\u85cf","Vol-X":"X \u534d\u7e8c\u85cf","Vol-A":"A \u8d99\u57ce\u91d1\u85cf","Vol-K":"K \u9ad8\u9e97\u5927\u85cf\u7d93-\u65b0\u6587\u8c50\u7248","Vol-S":"S \u5b8b\u85cf\u907a\u73cd-\u65b0\u6587\u8c50\u7248","Vol-F":"F \u623f\u5c71\u77f3\u7d93","Vol-C":"C \u4e2d\u83ef\u5927\u85cf\u7d93-\u4e2d\u83ef\u66f8\u5c40\u7248","Vol-U":"U \u6d2a\u6b66\u5357\u85cf","Vol-P":"P \u6c38\u6a02\u5317\u85cf","Vol-J":"J \u5609\u8208\u85cf","Vol-L":"L \u4e7e\u9686\u5927\u85cf\u7d93-\u65b0\u6587\u8c50\u7248","Vol-G":"G \u4f5b\u6559\u5927\u85cf\u7d93","Vol-M":"M \u534d\u6b63\u85cf\u7d93-\u65b0\u6587\u8c50\u7248","Vol-D":"D \u570b\u5716\u5584\u672c","Vol-N":"N \u5357\u50b3\u5927\u85cf\u7d93(\u518a\u5225)","Vol-ZS":"ZS \u6b63\u53f2\u4f5b\u6559\u8cc7\u6599\u985e\u7de8","Vol-I":"I \u5317\u671d\u4f5b\u6559\u77f3\u523b\u62d3\u7247\u767e\u54c1","Vol-ZW":"ZW \u85cf\u5916\u4f5b\u6559\u6587\u737b","Vol-B":"B \u5927\u85cf\u7d93\u88dc\u7de8","Vol-GA":"GA \u4e2d\u570b\u4f5b\u5bfa\u53f2\u5fd7\u5f59\u520a","Vol-GB":"GB \u4e2d\u570b\u4f5b\u5bfa\u5fd7\u53e2\u520a","Vol-Y":"Y \u5370\u9806\u6cd5\u5e2b\u4f5b\u5b78\u8457\u4f5c\u96c6","Vol-LC":"LC \u5442\u6f82\u4f5b\u5b78\u8457\u4f5c\u96c6"},appSettings:{theme:"\u4f48\u666f\u4e3b\u984c",rtlVerticalLayout:"\u7d93\u6587\u76f4\u6392\u3001\u53f3\u81f3\u5de6\u66f8\u5beb",paginated:"\u55ae\u9801/\u5206\u9801",showComments:"\u986f\u793a\u7d93\u6587\u8a3b\u89e3\u3001\u7248\u6b0a",useFontKai:"\u9ed1\u9ad4/\u6977\u66f8\u5b57\u9ad4",uiFontSize:"UI\u5b57\u578b\u5927\u5c0f",fontSize:"\u7d93\u6587\u5b57\u578b\u5927\u5c0f",printStyle:"\u7d93\u6587\u5217\u5370\u6a23\u5f0f"},fetchErrorContent:Object(I.jsx)("div",{className:"contentCenter",children:Object(I.jsx)(v.o,{children:Object(I.jsxs)("div",{children:[Object(I.jsx)("div",{children:"\u9023\u7dda\u5931\u6557!"}),Object(I.jsxs)("div",{style:{fontSize:"var(--ui-font-size)",paddingTop:24},children:["\u5982\u679c\u554f\u984c\u6301\u7e8c\u767c\u751f\uff0c\u8acb\u57f7\u884c",Object(I.jsx)("a",{href:"/settings",target:"_self",children:"\u8a2d\u5b9a\u9801"}),"\u7684app\u7570\u5e38\u56de\u5831\u529f\u80fd\u3002"]})]})})}),updateApp:function(){return new Promise(function(){var t=Object(u.a)(h.a.mark((function t(e){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:navigator.serviceWorker.getRegistrations().then(function(){var t=Object(u.a)(h.a.mark((function t(n){var s;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(n.map((function(t){return t.update().then((function(t){return null!==t.installing||null!==t.waiting}))})));case 2:s=t.sent,e(s.reduce((function(t,e){return t||e}),!1));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},scrollbarSizeIdToValue:B,updateCssVars:function(t){var e=B(t.scrollbarSize);document.documentElement.style.cssText="--ion-font-family: ".concat(t.useFontKai?"Times, HeitiScoped, Kai":"Times, Heiti TC, Noto Sans CJK TC","; --scrollbar-size: ").concat(e,"px; --ui-font-size: ").concat(t.uiFontSize,"px; --text-font-size: ").concat(t.fontSize,"px")},isMacCatalyst:X,isTouchDevice:function(){return Object(v.S)("ios")&&!X()||Object(v.S)("android")},isStoreApps:function(){return Object(v.S)("pwa")||Object(v.S)("electron")},fetchJuan:function(t,e,n){return Y.apply(this,arguments)},getFileName:R,getFileFromIndexedDB:_,saveFileToIndexedDB:function(t,e){return V.apply(this,arguments)},removeFileFromIndexedDB:function(t){return K.apply(this,arguments)},clearAppData:function(){return J.apply(this,arguments)},removeElementsByClassName:function(t,e){for(var n=t.getElementsByClassName(e);n.length>0;){var s;null===(s=n[0].parentNode)||void 0===s||s.removeChild(n[0])}},disableAndroidChromeCallout:function(t){return t.preventDefault(),t.stopPropagation(),!1},disableIosSafariCallout:function(t){var e=this.getSelection();if(((null===e||void 0===e?void 0:e.rangeCount)||0)>0){var n=null===e||void 0===e?void 0:e.getRangeAt(0);null===e||void 0===e||e.removeAllRanges(),setTimeout((function(){null===e||void 0===e||e.addRange(n)}),50)}},copyToClipboard:function(t){try{navigator.clipboard&&navigator.clipboard.writeText(t)}catch(e){console.error(e)}},zhVoices:function(){return speechSynthesis.getVoices().filter((function(t){return["zh-TW","zh_TW","zh-CN","zh_CN","zh-HK","zh_HK"].some((function(e){return t.localService&&t.lang.indexOf(e)>-1}))}))}};!function(t){t[t.CATALOG=0]="CATALOG",t[t.WORK=1]="WORK",t[t.JUAN=2]="JUAN",t[t.HTML=3]="HTML"}($||($={}));var Z=function t(e){Object(d.a)(this,t),this.type=$.CATALOG,this.uuid="",this.work=null,this.selectedText="",this.epubcfi="",this.fileName="",this.type=e.type,this.uuid=e.uuid,this.work=e.work,this.selectedText=e.selectedText,this.epubcfi=e.epubcfi,this.fileName=e.fileName},tt=function t(){Object(d.a)(this,t),this.version=1,this.hasAppLog=!0,this.theme=0,this.paginated=!0,this.rtlVerticalLayout=!0,this.scrollbarSize=0,this.useFontKai=!0,this.fontSize=32,this.uiFontSize=24,this.showComments=!1,this.printStyle=0,this.voiceURI="",this.speechRate=.8,this.bookmarks=[],this.dictionaryHistory=[],this.wordDictionaryHistory=[]};var et=function t(){Object(d.a)(this,t),this.shareTextModal=null,this.workListType=void 0,this.mainVersion=null,this.cbetaOfflineDbMode=!1};var nt=Object(y.a)({settings:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tt,e=arguments.length>1?arguments[1]:void 0,n=Object(p.a)({},t);switch(e.type){case"LOAD_SETTINGS":n=JSON.parse(localStorage.getItem(Q.storeFile)).settings;break;case"SET_KEY_VAL":var s=e.key,o=e.val;switch(s){case"theme":document.body.classList.forEach((function(t){/theme/.test(t)&&document.body.classList.remove(t)})),document.body.classList.toggle("theme".concat(o),!0);break;case"printStyle":document.body.classList.forEach((function(t){/print/.test(t)&&document.body.classList.remove(t)})),document.body.classList.toggle("print".concat(o),!0)}n[s]=o,localStorage.setItem(Q.storeFile,JSON.stringify({settings:n}));break;case"ADD_BOOKMARK":var r=n.bookmarks,a=e.bookmark.fileName;null===a||""===a||r.some((function(t){return t.fileName===a}))||Q.saveFileToIndexedDB(a,e.htmlStr),n.bookmarks=[].concat(Object(O.a)(n.bookmarks),[e.bookmark]),localStorage.setItem(Q.storeFile,JSON.stringify({settings:n}));break;case"DEL_BOOKMARK":var i=n.bookmarks,c=i.findIndex((function(t){return t.uuid===e.uuid}));if(-1!==c){var l=i.splice(c,1);if(1===l.length){var h=l[0],u=null==i.find((function(t){var e,n;return t.type===$.WORK&&(null===(e=t.work)||void 0===e?void 0:e.work)===(null===(n=h.work)||void 0===n?void 0:n.work)}));if(u)switch(h.type){case $.WORK:var d=h.work;if(null==d)break;for(var b=d.juan_list.split(","),j=function(t){var e=Q.getFileName(d.work,b[t]);if(null==i.find((function(t){return t.type===$.JUAN&&t.fileName===e})))try{Q.removeFileFromIndexedDB(e)}catch(n){console.error(n)}},f=0;f<b.length;f++)j(f);break;case $.JUAN:var x=h.fileName,v=null==i.find((function(t){return t.type===$.JUAN&&t.fileName===x}));if(v)try{Q.removeFileFromIndexedDB(x)}catch(m){console.error(m)}}}}n.bookmarks=Object(O.a)(i),localStorage.setItem(Q.storeFile,JSON.stringify({settings:n}));break;case"UPDATE_BOOKMARKS":n.bookmarks=e.bookmarks,localStorage.setItem(Q.storeFile,JSON.stringify({settings:n}));break;case"DEFAULT_SETTINGS":n=new tt;default:0===Object.keys(n).length&&(n=new tt)}return n},tmpSettings:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new et,e=arguments.length>1?arguments[1]:void 0,n=Object(p.a)({},t),s=e.key,o=e.val;switch(n[s]=o,e.type){case"TMP_SET_KEY_VAL":return n}return t}});var st,ot=n(7),rt=(n(277),function t(e){Object(d.a)(this,t),this.n=void 0,this.nodeType=void 0,this.label=void 0,this.work=void 0,this.file=void 0,this.n=e.n,this.nodeType=e.node_type,this.label=e.label,this.work=e.work,this.file=e.file}),at=function(t){Object(j.a)(n,t);var e=Object(f.a)(n);function n(){return Object(d.a)(this,n),e.apply(this,arguments)}return Object(b.a)(n,[{key:"render",value:function(){var t=this;return Object(I.jsx)(v.a,{cssClass:"uiFont",backdropDismiss:!1,isOpen:this.props.showSearchAlert,header:"\u641c\u5c0b\u7d93\u66f8",subHeader:"\u8f38\u5165\u641c\u5c0b",inputs:[{name:"name0",type:"search",placeholder:"\u4f8b:\u91d1\u525b\u822c\u82e5"}],buttons:[{text:"\u641c\u5c0b\u76ee\u9304",cssClass:"primary uiFont",handler:function(e){t.props.finish(),t.props.history.push("".concat(Q.pwaUrl,"/catalog/search/").concat(e.name0))}},{text:"\u5168\u6587\u6aa2\u7d22",cssClass:"primary uiFont",handler:function(e){t.props.finish(),t.props.history.push("".concat(Q.pwaUrl,"/catalog/fulltextsearch/").concat(e.name0))}},{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary uiFont",handler:function(){return t.props.finish()}}]})}}]),n}(r.a.Component),it=[{title:"\u822c\u82e5\u6ce2\u7f85\u871c\u591a\u5fc3\u7d93",url:"".concat(Q.pwaUrl,"/catalog/juan/T0251/1")},{title:"\u91d1\u525b\u822c\u82e5\u6ce2\u7f85\u871c\u7d93",url:"".concat(Q.pwaUrl,"/catalog/juan/T0235/1")},{title:"\u4f5b\u8aaa\u963f\u5f4c\u9640\u7d93",url:"".concat(Q.pwaUrl,"/catalog/juan/T0366/1")},{title:"\u4f5b\u8aaa\u7121\u91cf\u58fd\u7d93\u5377\u4e0a",url:"".concat(Q.pwaUrl,"/catalog/juan/T0360/1")},{title:"\u4f5b\u8aaa\u89c0\u7121\u91cf\u58fd\u4f5b\u7d93",url:"".concat(Q.pwaUrl,"/catalog/juan/T0365/1")},{title:"\u85e5\u5e2b\u7409\u7483\u5149\u5982\u4f86\u672c\u9858\u529f\u5fb7\u7d93",url:"".concat(Q.pwaUrl,"/catalog/juan/T0450/1")},{title:"\u4f5b\u8aaa\u89c0\u5f4c\u52d2\u83e9\u85a9\u4e0a\u751f\u515c\u7387\u5929\u7d93",url:"".concat(Q.pwaUrl,"/catalog/juan/T0452/1")},{title:"\u4f5b\u8aaa\u5f4c\u52d2\u4e0b\u751f\u6210\u4f5b\u7d93",url:"".concat(Q.pwaUrl,"/catalog/juan/T0454/1")},{title:"\u5730\u85cf\u83e9\u85a9\u672c\u9858\u7d93",url:"".concat(Q.pwaUrl,"/catalog/juan/T0412/1")},{title:"\u5999\u6cd5\u84ee\u83ef\u7d93\u89c0\u4e16\u97f3\u83e9\u85a9\u666e\u9580\u54c1\u7d93",url:"".concat(Q.pwaUrl,"/catalog/juan/T0262/7")},{title:"\u5927\u4f5b\u9802\u5982\u4f86\u5bc6\u56e0\u4fee\u8b49\u4e86\u7fa9\u8af8\u83e9\u85a9\u842c\u884c\u9996\u695e\u56b4\u7d93\u5377\u7b2c\u4e00",url:"".concat(Q.pwaUrl,"/catalog/juan/T0945/1")},{title:"\u4f5b\u8aaa\u6cd5\u6ec5\u76e1\u7d93",url:"".concat(Q.pwaUrl,"/catalog/juan/T0396/1")}],ct=window.electronBackendApi,lt=function(t){Object(j.a)(n,t);var e=Object(f.a)(n);function n(t){var s;return Object(d.a)(this,n),(s=e.call(this,t)).state={topCatalogsType:0,fetchError:!1,catalogs:[],pathLabel:"",showSearchAlert:!1,isLoading:!1},s}return Object(b.a)(n,[{key:"ionViewWillEnter",value:function(){console.log("".concat(this.props.match.url," will enter."));var t=-1;switch(this.props.match.url){case"".concat(Q.pwaUrl,"/catalog"):t=0;break;case"".concat(Q.pwaUrl,"/catalog/volumes"):t=1;break;case"".concat(Q.pwaUrl,"/catalog/famous"):t=2;break;default:t=-1}this.setState({topCatalogsType:t}),this.fetchData(this.props.match.params.path)}},{key:"fetchData",value:function(){var t=Object(u.a)(h.a.mark((function t(e){var n,s,o,r,a,i;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.setState({isLoading:!0}),n=new Array,s="",t.t0=this.state.topCatalogsType,t.next=0===t.t0||1===t.t0?6:-1===t.t0?7:2===t.t0?33:35;break;case 6:return t.abrupt("return",this.fetchTopCatalogs(this.state.topCatalogsType));case 7:if(t.prev=7,!this.props.tmpSettings.cbetaOfflineDbMode){t.next=15;break}return null===ct||void 0===ct||ct.send("toMain",{event:"fetchCatalog",path:e}),t.next=12,new Promise((function(t,e){null===ct||void 0===ct||ct.receiveOnce("fromMain",(function(e){switch(e.event){case"fetchCatalog":t(e)}}))}));case 12:o=t.sent,t.next=19;break;case 15:return t.next=17,Q.axiosInstance.get("/catalog_entry?q=".concat(e),{responseType:"arraybuffer"});case 17:r=t.sent,o=JSON.parse((new TextDecoder).decode(r.data));case 19:return a=o.results,n=a.map((function(t){return new rt(t)})),""!==this.parentPath(e)?s=o.label:(i=Q.topCatalogsByCat[e],s=void 0!==i?i:Q.topCatalogsByVol[e]),this.setState({fetchError:!1,isLoading:!1,catalogs:n,pathLabel:s}),t.abrupt("return",!0);case 27:return t.prev=27,t.t1=t.catch(7),console.error(t.t1),console.error((new Error).stack),this.setState({fetchError:!0,isLoading:!1,pathLabel:""}),t.abrupt("return",!1);case 33:return this.setState({fetchError:!1,isLoading:!1,pathLabel:""}),t.abrupt("break",35);case 35:case"end":return t.stop()}}),t,this,[[7,27]])})));return function(e){return t.apply(this,arguments)}}()},{key:"fetchTopCatalogs",value:function(t){var e=Array(),n=t?Q.topCatalogsByVol:Q.topCatalogsByCat;return Object.keys(n).forEach((function(t){var s={n:t,nodeType:null,work:null,label:n[t],file:null};e.push(s)})),this.setState({fetchError:!1,isLoading:!1,catalogs:e,pathLabel:""}),!0}},{key:"isTopCatalog",get:function(){var t=this;return["".concat(Q.pwaUrl,"/catalog"),"".concat(Q.pwaUrl,"/catalog/volumes"),"".concat(Q.pwaUrl,"/catalog/famous")].reduce((function(e,n){return e||n===t.props.match.url}),!1)}},{key:"parentPath",value:function(t){var e=t.split(".");return e.pop(),e.join(".")}},{key:"addBookmarkHandler",value:function(){this.props.dispatch({type:"ADD_BOOKMARK",bookmark:new Z({type:$.CATALOG,uuid:this.props.match.params.path,selectedText:this.state.pathLabel,epubcfi:"",fileName:"",work:null})})}},{key:"delBookmarkHandler",value:function(){this.props.dispatch({type:"DEL_BOOKMARK",uuid:this.props.match.params.path})}},{key:"hasBookmark",get:function(){var t=this;return null!=this.props.bookmarks.find((function(e){return e.type===$.CATALOG&&e.uuid===t.props.match.params.path}))}},{key:"getRows",value:function(){var t=this,e=Array();return this.state.catalogs.forEach((function(n,s){var o="",r="html"===n.nodeType;o=r?"".concat(Q.pwaUrl,"/catalog/juan/").concat(n.n,"/1"):null==n.work?"".concat(Q.pwaUrl,"/catalog/catalog/").concat(n.n):"".concat(Q.pwaUrl,"/catalog/work/").concat(n.work),e.push(Object(I.jsxs)(v.k,{button:!0,onClick:function(){var e=Object(u.a)(h.a.mark((function e(s){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s.preventDefault(),t.props.history.push({pathname:o,search:k.a.stringify(r?{file:n.file,title:n.label}:{})});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:n.label},"".concat(n.n,"label")+s)]},"".concat(n.n,"item")+s))})),e}},{key:"getFamousJuanRows",value:function(){var t=this,e=Array();return it.forEach((function(n,s){var o=n.title,r=n.url;e.push(Object(I.jsxs)(v.k,{button:!0,onClick:function(){var e=Object(u.a)(h.a.mark((function e(n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.props.history.push(r);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:o},"famousItemLabel_"+s)]},"famousJuanItem_"+s))})),e}},{key:"render",value:function(){var t=this,e=Object(I.jsx)(v.p,{children:2===this.state.topCatalogsType?this.getFamousJuanRows():this.getRows()});return Object(I.jsxs)(v.s,{children:[Object(I.jsx)(v.g,{children:Object(I.jsxs)(v.J,{children:[Object(I.jsx)(v.c,{hidden:this.isTopCatalog,fill:"clear",slot:"start",onClick:function(e){return t.props.history.goBack()},children:Object(I.jsx)(v.h,{icon:ot.a,slot:"icon-only"})}),Object(I.jsxs)(v.B,{hidden:!this.isTopCatalog,slot:"start",value:this.state.topCatalogsType,className:"buttonRounded",interface:"popover",interfaceOptions:{cssClass:"cbetar2themes"},onIonChange:function(e){var n="";switch(+e.detail.value){case 0:n="".concat(Q.pwaUrl,"/catalog");break;case 1:n="".concat(Q.pwaUrl,"/catalog/volumes");break;case 2:n="".concat(Q.pwaUrl,"/catalog/famous");break;case-1:n=t.props.match.url}t.props.match.url!==n&&t.props.history.push(n)},children:[Object(I.jsx)(v.C,{className:"uiFont",value:0,children:"\u90e8\u5206\u985e"}),Object(I.jsx)(v.C,{className:"uiFont",value:1,children:"\u518a\u5206\u985e"}),Object(I.jsx)(v.C,{className:"uiFont",value:2,children:"\u77e5\u540d\u7d93\u5178"})]}),Object(I.jsx)(v.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(e){return t.fetchData(t.props.match.params.path)},children:Object(I.jsx)(v.h,{icon:ot.E,slot:"icon-only"})}),Object(I.jsx)(v.c,{hidden:this.isTopCatalog,fill:this.hasBookmark?"solid":"clear",slot:"end",onClick:function(e){return t.hasBookmark?t.delBookmarkHandler():t.addBookmarkHandler()},children:Object(I.jsx)(v.h,{icon:ot.g,slot:"icon-only"})}),Object(I.jsx)(v.c,{hidden:this.isTopCatalog,fill:"clear",slot:"end",onClick:function(e){return t.props.history.push("/".concat(t.props.match.params.tab))},children:Object(I.jsx)(v.h,{icon:ot.v,slot:"icon-only"})}),Object(I.jsx)(v.c,{fill:"clear",slot:"end",onClick:function(e){return t.setState({showSearchAlert:!0})},children:Object(I.jsx)(v.h,{icon:ot.H,slot:"icon-only"})}),Object(I.jsx)(v.c,{fill:"clear",slot:"end",onClick:function(e){t.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})},children:Object(I.jsx)(v.h,{icon:ot.L,slot:"icon-only"})})]})}),Object(I.jsxs)(v.d,{children:[this.state.fetchError?Q.fetchErrorContent:Object(I.jsxs)(I.Fragment,{children:[Object(I.jsx)("div",{className:"uiFontX2",style:{color:"var(--ion-color-primary)"},children:this.state.pathLabel}),e]}),Object(I.jsx)(at,Object(p.a)({},Object(p.a)({showSearchAlert:this.state.showSearchAlert,finish:function(){t.setState({showSearchAlert:!1})}},this.props))),Object(I.jsx)("div",{style:{fontSize:"var(--ui-font-size)",textAlign:"center"},children:Object(I.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2#bookmark",target:"_new",children:"\u66f8\u7c64\u8207\u96e2\u7dda\u700f\u89bd\u8aaa\u660e"})}),Object(I.jsx)("div",{style:{fontSize:"var(--ui-font-size)",textAlign:"center"},children:Object(I.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2#search",target:"_new",children:"\u641c\u5c0b\u7d93\u66f8\u6559\u5b78"})}),Object(I.jsx)(v.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return t.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."})]})]})}}]),n}(r.a.Component),ht=Object(v.U)(lt),ut=Object(g.b)((function(t){return{bookmarks:t.settings.bookmarks,state:t,tmpSettings:t.tmpSettings}}))(ht),pt=(n(148),window.electronBackendApi),dt=function(t){Object(j.a)(n,t);var e=Object(f.a)(n);function n(t){var o;return Object(d.a)(this,n),(o=e.call(this,t)).fetchJuan="",o.workListType=void 0!==o.props.tmpSettings.workListType?o.props.tmpSettings.workListType:s.BY_JUAN,o.state={work:null,showSearchAlert:!1,showAddBookmarkDone:!1,isLoading:!1,fetchError:!1},o}return Object(b.a)(n,[{key:"ionViewWillEnter",value:function(){this.fetchWork(this.props.match.params.path)}},{key:"componentDidMount",value:function(){}},{key:"fetchWork",value:function(){var t=Object(u.a)(h.a.mark((function t(e){var n,s,o,r,a;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.setState({isLoading:!0}),!this.hasBookmark){t.next=5;break}n=this.bookmark.work,t.next=32;break;case 5:if(t.prev=5,!this.props.tmpSettings.cbetaOfflineDbMode){t.next=13;break}return null===pt||void 0===pt||pt.send("toMain",{event:"fetchWork",path:e}),t.next=10,new Promise((function(t,e){null===pt||void 0===pt||pt.receiveOnce("fromMain",(function(e){switch(e.event){case"fetchWork":t(e)}}))}));case 10:s=t.sent,t.next=17;break;case 13:return t.next=15,Q.axiosInstance.get("/works?work=".concat(e),{responseType:"arraybuffer"});case 15:o=t.sent,s=JSON.parse((new TextDecoder).decode(o.data));case 17:if(r=s.results,n=r[0],this.props.tmpSettings.cbetaOfflineDbMode){t.next=24;break}return t.next=22,Q.axiosInstance.get("/toc?work=".concat(e));case 22:a=t.sent,n.mulu=a.data.results[0].mulu.map((function(t){return new C(t)}));case 24:t.next=32;break;case 26:return t.prev=26,t.t0=t.catch(5),console.error(t.t0),console.error((new Error).stack),this.setState({fetchError:!0,isLoading:!1}),t.abrupt("return",!1);case 32:return this.setState({fetchError:!1,isLoading:!1,work:n}),t.abrupt("return",!0);case 34:case"end":return t.stop()}}),t,this,[[5,26]])})));return function(e){return t.apply(this,arguments)}}()},{key:"saveJuans",value:function(){var t=Object(u.a)(h.a.mark((function t(){var e,n,s,o;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=this.state.work,n=e.juan_list.split(","),s=0;case 3:if(!(s<n.length)){t.next=19;break}return this.fetchJuan=n[s],t.prev=5,t.next=8,Q.fetchJuan(e.work,this.fetchJuan,null);case 8:o=t.sent,Q.saveFileToIndexedDB(Q.getFileName(e.work,this.fetchJuan),o.htmlStr),t.next=16;break;case 12:t.prev=12,t.t0=t.catch(5),console.error("Fetching juan ".concat(s," failed! ").concat(t.t0)),console.error((new Error).stack);case 16:s++,t.next=3;break;case 19:case"end":return t.stop()}}),t,this,[[5,12]])})));return function(){return t.apply(this,arguments)}}()},{key:"addBookmarkHandler",value:function(){var t=Object(u.a)(h.a.mark((function t(){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.props.tmpSettings.cbetaOfflineDbMode){t.next=3;break}return t.next=3,this.saveJuans();case 3:this.setState({showAddBookmarkDone:!0}),this.props.dispatch({type:"ADD_BOOKMARK",bookmark:new Z({type:$.WORK,uuid:this.props.match.params.path,selectedText:this.state.work.title,epubcfi:"",fileName:"",work:this.state.work})});case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"delBookmarkHandler",value:function(){this.props.dispatch({type:"DEL_BOOKMARK",uuid:this.props.match.params.path})}},{key:"isTopPage",get:function(){return this.props.match.url==="".concat(Q.pwaUrl,"/catalog")}},{key:"bookmark",get:function(){var t=this;return this.props.bookmarks.find((function(e){return e.type===$.WORK&&e.uuid===t.props.match.params.path}))}},{key:"hasBookmark",get:function(){return null!=this.bookmark}},{key:"getRowsByChapter",value:function(){for(var t=this,e=this.state.work,n=null===e||void 0===e?void 0:e.mulu,s=Array(),o=function(o){var r="".concat(Q.pwaUrl,"/catalog/juan/").concat(null===e||void 0===e?void 0:e.work,"/").concat(n[o].juan);s.push(Object(I.jsxs)(v.k,{button:!0,onClick:function(){var e=Object(u.a)(h.a.mark((function e(n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.preventDefault(),t.props.history.push({pathname:r});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:n[o].title},"chapterLabel"+o)]},"chapterItem"+o))},r=0;r<((null===n||void 0===n?void 0:n.length)||-1);r++)o(r);return s}},{key:"getRowsByJuan",value:function(){for(var t=this,e=this.state.work,n=Array(),s=null===e||void 0===e?void 0:e.juan_list.split(","),o=function(o){var r="".concat(Q.pwaUrl,"/catalog/juan/").concat(null===e||void 0===e?void 0:e.work,"/").concat(s[o]);n.push(Object(I.jsxs)(v.k,{button:!0,onClick:function(){var e=Object(u.a)(h.a.mark((function e(n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.preventDefault(),t.props.history.push({pathname:r});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsxs)(v.o,{className:"ion-text-wrap uiFont",children:["\u5377",s[o]]},"juanLabel"+o)]},"juanItem"+o))},r=0;r<((null===s||void 0===s?void 0:s.length)||-1);r++)o(r);return n}},{key:"render",value:function(){var t,e=this;return Object(I.jsxs)(v.s,{children:[Object(I.jsx)(v.g,{children:Object(I.jsxs)(v.J,{children:[Object(I.jsx)(v.c,{hidden:this.isTopPage,fill:"clear",slot:"start",onClick:function(t){return e.props.history.goBack()},children:Object(I.jsx)(v.h,{icon:ot.a,slot:"icon-only"})}),Object(I.jsx)(v.c,{fill:"outline",shape:"round",size:"large",slot:"start",onClick:function(t){var n=e.workListType===s.BY_CHAPTER?s.BY_JUAN:s.BY_CHAPTER;e.props.dispatch({type:"TMP_SET_KEY_VAL",key:"workListType",val:n})},children:Object(I.jsx)("span",{className:"uiFont",style:{color:"var(--color)"},children:this.workListType===s.BY_CHAPTER?"\u5206\u54c1":"\u5206\u5377"})}),Object(I.jsx)(v.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(t){return e.fetchWork(e.props.match.params.path)},children:Object(I.jsx)(v.h,{icon:ot.E,slot:"icon-only"})}),Object(I.jsx)(v.c,{fill:this.hasBookmark?"solid":"clear",slot:"end",onClick:function(t){return e.hasBookmark?e.delBookmarkHandler():e.addBookmarkHandler()},children:Object(I.jsx)(v.h,{icon:ot.g,slot:"icon-only"})}),Object(I.jsx)(v.c,{fill:"clear",slot:"end",onClick:function(t){return e.props.history.push("".concat(Q.pwaUrl,"/").concat(e.props.match.params.tab))},children:Object(I.jsx)(v.h,{icon:ot.v,slot:"icon-only"})}),Object(I.jsx)(v.c,{fill:"clear",slot:"end",onClick:function(t){return e.setState({showSearchAlert:!0})},children:Object(I.jsx)(v.h,{icon:ot.H,slot:"icon-only"})}),Object(I.jsx)(v.c,{fill:"clear",slot:"end",onClick:function(t){e.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})},children:Object(I.jsx)(v.h,{icon:ot.L,slot:"icon-only"})})]})}),Object(I.jsxs)(v.d,{children:[Object(I.jsx)("div",{className:"uiFontX2",style:{color:"var(--ion-color-primary)"},children:null===(t=this.state.work)||void 0===t?void 0:t.title}),this.state.fetchError?Q.fetchErrorContent:Object(I.jsx)(v.p,{children:this.workListType===s.BY_CHAPTER?this.getRowsByChapter():this.getRowsByJuan()}),Object(I.jsx)(at,Object(p.a)({},Object(p.a)({showSearchAlert:this.state.showSearchAlert,finish:function(){e.setState({showSearchAlert:!1})}},this.props))),Object(I.jsx)(v.H,{cssClass:"uiFont",isOpen:this.state.showAddBookmarkDone,onDidDismiss:function(){return e.setState({showAddBookmarkDone:!1})},message:"\u66f8\u7c64\u65b0\u589e\u6210\u529f\uff01",duration:2e3}),Object(I.jsx)(v.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return e.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."})]})]})}}]),n}(r.a.Component),bt=Object(v.U)(dt),jt=Object(g.b)((function(t){return{bookmarks:t.settings.bookmarks,tmpSettings:t.tmpSettings}}))(bt),ft=n(16),xt=n(513),vt=(n(278),n(100)),mt=n(229),gt=n(46);function wt(){return kt.apply(this,arguments)}function kt(){return(kt=Object(u.a)(h.a.mark((function t(){var e,n;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Q.getFileFromIndexedDB(Q.twKaiFontKey);case 2:return e=t.sent,n=new window.FontFace("Kai",e),t.next=6,n.load();case 6:this.document.fonts.add(n);case 7:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}function yt(){var t=this;this.document.querySelectorAll(".pre .lb").forEach((function(e){var n=t.document.createElement("br");e.before(n)}))}function Ot(){n(433)(this.window,this.document)}!function(t){t[t.UNINITIAL=0]="UNINITIAL",t[t.SPEAKING=1]="SPEAKING",t[t.PAUSE=2]="PAUSE"}(st||(st={}));var St,Tt=function(t){Object(j.a)(s,t);var e=Object(f.a)(s);function s(t){var n;return Object(d.a)(this,s),(n=e.call(this,t)).htmlFile=void 0,n.htmlTitle=void 0,n.book=void 0,n.rendition=void 0,n.epub=void 0,n.displayed=void 0,n.cfiRange=void 0,n.speechSynthesisUtterance=void 0,n.currentWork="",n.uuidStr="",n.epubcfiFromUrl="",n.lastPage=0,n.epubcfiFromSelectedString="",n.bookCreated=!1,n.ePubIframe=null,n.selectedString="",n.clearSelectedStringTimer=void 0,n.selectedRange=void 0,n.pageWidth=0,n.pagesWidth=0,n.searchTextRanges=[],n.visibleTextNodes=[],n.visibleChars=[],n.isPageSearched=[],n.allTexts="",n.ePubIframeOffset=0,n.showedSearchTextIndex=0,n.maxCharsPerUtterance=1e3,n.workTexts=[],n.workTextsIndex=0,n.speechRepeatStart=void 0,n.speechRepeatEnd=void 0,n.state={isLoading:!1,fetchError:!1,workInfo:new A({}),htmlStr:null,currentPage:1,pageCount:1,showJumpPageAlert:!1,showNoSelectedTextAlert:!1,showSearchTextAlert:!1,searchText:"",showSearchTextToast:!1,showToast:!1,toastMessage:"",showSearchAlert:!1,popover:{show:!1,event:null},lookupDictPopover:{show:!1,data:[]},canTextToSpeech:"undefined"!==typeof SpeechSynthesisUtterance,speechState:st.UNINITIAL,isSpeechRepeatMode:!1,showSpeechRepeatStart:!1,showSpeechRepeatEnd:!1},n.htmlFile="",n.htmlTitle="",n.book=null,n.rendition=null,n.cfiRange="",n.speechSynthesisUtterance=null,n.state.canTextToSpeech&&(n.speechSynthesisUtterance=new SpeechSynthesisUtterance,n.speechSynthesisUtterance.onend=function(t){if(speechSynthesis.cancel(),n.state.speechState!==st.UNINITIAL){var e,s=n.workTextsIndex<n.workTexts.length-1,o=!n.state.isSpeechRepeatMode&&n.props.paginated&&n.state.currentPage<n.state.pageCount;if(s)n.workTextsIndex+=1;else{if(!o)return n.setState({speechState:st.UNINITIAL}),console.log("Stop work text to speech."),void(n.state.isSpeechRepeatMode&&n.playText2Speech());n.pageNext(),n.findTextsInPageAndChunking()}e=n.workTexts[n.workTextsIndex],n.speechSynthesisUtterance.text=e,speechSynthesis.speak(n.speechSynthesisUtterance),console.log("Play work text to speech part / page: ".concat(s?n.workTextsIndex:n.state.currentPage))}}),document.addEventListener("keydown",n.keyListener.bind(Object(ft.a)(n)),!1),n}return Object(b.a)(s,[{key:"loadEpubCoverToMemFs",value:function(){var t=Object(u.a)(h.a.mark((function t(){var e,s,o;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==(e=new Uint8Array(JSON.parse(localStorage.getItem("logo.png")||"[]"))).length){t.next=8;break}return t.next=4,Q.axiosInstance.get("".concat(window.location.origin,"/").concat(Q.pwaUrl,"/assets/icon/icon.png"),{responseType:"arraybuffer"});case 4:s=t.sent,e=new Uint8Array(s.data),o=JSON.stringify(Array.from(e)),localStorage.setItem("logo.png",o);case 8:n(44).writeFileSync("logo.png",e);case 10:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"workJuanId",get:function(){return"".concat(this.props.match.params.work,"/").concat(this.props.match.params.path)}},{key:"ionViewWillEnter",value:function(){var t=k.a.parse(this.props.location.search);this.htmlFile=t.file,this.htmlTitle=t.title,this.epubcfiFromUrl=t.bookmark||"";var e=this.props.location.state;this.uuidStr=e?e.uuid:"",this.currentWork!==this.workJuanId&&(this.currentWork=this.workJuanId,this.lastPage=0),this.fetchData()}},{key:"ionViewDidEnter",value:function(){}},{key:"ionViewWillLeave",value:function(){var t;this.state.canTextToSpeech&&speechSynthesis.cancel(),this.lastPage=this.state.currentPage,this.setState({htmlStr:null,currentPage:1,speechState:st.UNINITIAL,showSearchTextToast:!1}),null===(t=this.book)||void 0===t||t.destroy(),this.book=null,this.bookCreated=!1}},{key:"fileName",get:function(){return Q.getFileName(this.props.match.params.work,this.props.match.params.path)}},{key:"fetchData",value:function(){var t=Object(u.a)(h.a.mark((function t(){var e;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.setState({isLoading:!0}),t.prev=1,t.next=4,Q.fetchJuan(this.props.match.params.work,this.props.match.params.path,this.htmlFile,!1,this.props.tmpSettings.cbetaOfflineDbMode);case 4:return e=t.sent,t.next=7,this.loadEpubCoverToMemFs();case 7:this.setState({fetchError:!1,workInfo:e.workInfo,htmlStr:e.htmlStr}),t.next=15;break;case 10:t.prev=10,t.t0=t.catch(1),console.error(t.t0),console.error((new Error).stack),this.setState({isLoading:!1,fetchError:!0});case 15:case"end":return t.stop()}}),t,this,[[1,10]])})));return function(){return t.apply(this,arguments)}}()},{key:"addBookmarkHandler",value:function(){var t=this.selectedString;if(""!==t){var e=xt.a();this.props.dispatch({type:"ADD_BOOKMARK",htmlStr:this.state.htmlStr,bookmark:new Z({type:this.htmlFile?$.HTML:$.JUAN,uuid:e,selectedText:t,epubcfi:this.epubcfiFromSelectedString,fileName:this.props.tmpSettings.cbetaOfflineDbMode?null:this.htmlFile||"".concat(this.props.match.params.work,"_juan").concat(this.props.match.params.path,".html"),work:Object.assign(this.state.workInfo,{title:this.htmlFile?this.htmlTitle:this.state.workInfo.title,juan:this.props.match.params.path})})}),this.setState({showToast:!0,toastMessage:"\u66f8\u7c64\u65b0\u589e\u6210\u529f\uff01"})}else this.setState({showNoSelectedTextAlert:!0})}},{key:"isTopPage",get:function(){return this.props.match.url==="".concat(Q.pwaUrl,"/catalog")}},{key:"bookmark",get:function(){var t=this;return this.props.bookmarks.find((function(e){return e.type===$.JUAN&&e.uuid===t.uuidStr}))}},{key:"hasBookmark",get:function(){return""!==this.epubcfiFromUrl||null!=this.bookmark}},{key:"epubcfi",get:function(){return""!==this.epubcfiFromUrl?this.epubcfiFromUrl:null!=this.bookmark?this.bookmark.epubcfi:"epubcfi(/6/6[s1]!/4/4/2/6[body]/6,/1:0,/1:1)"}},{key:"pagePrev",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.props.paginated&&this.state.currentPage>1&&(null===(t=this.rendition)||void 0===t||t.prev(e),this.setState({currentPage:this.state.currentPage-e}))}},{key:"pageNext",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.props.paginated&&this.state.currentPage<this.state.pageCount&&(null===(t=this.rendition)||void 0===t||t.next(e),this.setState({currentPage:this.state.currentPage+e}))}},{key:"jumpToPage",value:function(t){if(0!==t){t=isNaN(t)?1:Math.max(Math.min(this.state.pageCount,t),1);var e=this.state.currentPage,n=e<t?1:-1,s=Math.abs(t-e);1===n?this.pageNext(s):this.pagePrev(s)}}},{key:"keyListener",value:function(t){var e=t.keyCode||t.which;console.log(t.type),e===(this.props.rtlVerticalLayout?37:40)&&this.buttonNext(),e===(this.props.rtlVerticalLayout?39:38)&&this.buttonPrev(),("F3"===t.code||t.ctrlKey&&"f"===t.key.toLowerCase())&&(t.preventDefault(),this.setState({showSearchTextToast:!1,showSearchTextAlert:!0}))}},{key:"html2Epub",value:function(){var t=Object(u.a)(h.a.mark((function t(){var e,s,o,r,a,i,c,l,u=this;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.bookCreated=!0,this.epub=mt.document({id:"123-123456789",cover:"./logo.png",title:"Title",series:"",sequence:1,author:"Author",fileAs:"",genre:"genre",tags:"",copyright:"",publisher:"",published:"",language:"en",description:"A temp book.",contents:this.state.workInfo.title,source:"",images:["logo.png"]}),e=this.state.htmlStr,this.props.rtlVerticalLayout&&(e=(e=(e=(e=(e=e.replace(/(margin|border)-left/g,"$1-temp")).replace(/(margin|border)-bottom/g,"$1-left")).replace(/(margin|border)-right/g,"$1-bottom")).replace(/(margin|border)-top/g,"$1-right")).replace(/(margin|border)-temp/g,"$1-top")),s=e+"\n    <script>\n    <\/script>\n    ",this.epub.addSection("",s,!0,!1),"\n    html {\n      writing-mode: vertical-rl;\n      direction: ltr;\n    }\n    ",this.epub.addCSS("\n    @page {\n      size: A4;\n      margin: 0.5in;\n    }\n\n    /* For double side printing for book bundling. */\n    @page :left {\n      margin-right: 1in;\n    }\n\n    @page :right {\n      margin-left: 1in;\n    }\n\n    @media print {\n      body {\n        color: ".concat(getComputedStyle(document.body).getPropertyValue("--print-text-color")," !important;\n        background: ").concat(getComputedStyle(document.body).getPropertyValue("--print-background")," !important;\n        padding: 0 !important;\n        width: 100% !important;\n        height: 100% !important;\n        column-gap: unset !important;\n        column-width: unset !important;\n      }\n    }\n\n    html {\n      /*\n      Because different fonts have different line heights with 'line-height: normal,'\n      the content size of epubjs iframe changes after the fallback font is swapped with the web font.\n      Unfortunately, epubjs can't detect the size change and update the iframe.\n      This problem causes the total page count is incorrect.\n      Fortunately, we can set the line height based on the same font size as below.\n      */\n      line-height: 1.2;\n      -webkit-text-size-adjust: none;\n      text-size-adjust: none;\n    }\n\n    body {\n      color: ").concat(getComputedStyle(document.body).getPropertyValue("--ion-text-color"),";\n      background: ").concat(getComputedStyle(document.body).getPropertyValue("--ion-background-color"),";\n      /* Disable browser's swipe to forward / backward page navigation. */\n      overscroll-behavior-x: none;\n    }\n\n    @font-face {\n        font-family: 'Times';\n        src: local('Times New Roman');\n        unicode-range: U+0-007F;\n    }\n\n    /* Workaround parenthesis orientation problem of TW-Kai-98_1 on iOS Safari. */\n    @font-face {\n        font-family: HeitiScoped;\n        src: local('Heiti TC');\n        unicode-range: U+3008-301B, U+FF01-FF60;\n    }\n\n    .lb {\n      display: none\n    }\n\n    /* In-HTML anchor jumps don't update this.state.currentPage.\n    Thus, we disable them. */\n    .noteAnchor {\n      pointer-events: none;\n      text-decoration: inherit;\n      color: inherit;\n      cursor: auto;\n    }\n\n    .doube-line-note, .doube-line-note .t {\n      font-size: ").concat(.8*this.props.fontSize,'px;\n    }\n\n    .doube-line-note::before {\n      content: "\uff08";\n    }\n\n    .doube-line-note::after {\n      content: "\uff09";\n    }\n\n    .bip-table {\n      display: table;\n    }\n\n    .bip-table-row {\n      display: table-row;\n    }\n\n    .bip-table-cell {\n      display: table-cell;\n      border: 1px solid ').concat(getComputedStyle(document.body).getPropertyValue("--ion-text-color"),";\n      text-align: center;\n    }\n  \n    ").concat(this.props.rtlVerticalLayout?"\n    html {\n      writing-mode: vertical-rl;\n      direction: ltr;\n    }\n    ":"","\n\n    .t, p, div {\n      font-family: ").concat(getComputedStyle(document.body).getPropertyValue("--ion-font-family"),";\n      font-size: ").concat(this.props.fontSize,"px;\n    }\n\n    .bold {\n      font-weight: 700;\n    }\n    \n    #back, #cbeta-copyright {\n      display: ").concat(this.props.showComments?"block":"none",";\n    }\n    ")),t.prev=8,t.next=11,this.epub.writeEPUB(".","temp");case 11:return r=n(44),a=r.readFileSync("temp.epub"),this.book=Object(vt.b)(a.buffer,{openAs:"binary"}),this.rendition=this.book.renderTo("cbetarEPubView",{width:"100%",height:"100%",spread:"none",flow:this.props.paginated?"paginated":"scrolled",scrollbarWidth:Q.scrollbarSizeIdToValue(this.props.scrollbarSize),defaultDirection:this.props.rtlVerticalLayout?"rtl":"ltr",afterScrolledTimeout:500}),this.rendition.on("selected",(function(t,e){u.epubcfiFromSelectedString=t;var n=u.setSelectedString(),s=u.setSelectedRange();""===n?u.clearSelectedStringTimer=setTimeout((function(){u.selectedString=n,u.selectedRange=s}),500):(u.selectedString=n,u.selectedRange=s)})),this.rendition.on(vt.a.RENDITION.DISPLAYED,(function(){u.updatePageInfos()})),this.rendition.on(vt.a.VIEWS.RENDERED,(function(){u.updateEPubIframe()})),t.next=20,this.rendition.display(this.props.paginated?this.epubcfi:void 0);case 20:if(this.props.paginated){t.next=26;break}return t.next=23,null===(i=this.rendition)||void 0===i?void 0:i.next();case 23:return t.next=25,null===(c=this.rendition)||void 0===c?void 0:c.next();case 25:this.updateEPubIframe();case 26:if(0!==this.lastPage&&null==this.bookmark&&this.lastPage!==this.state.currentPage&&this.jumpToPage(this.lastPage),this.setState({isLoading:!1}),this.hasBookmark)try{null===(l=this.rendition)||void 0===l||l.annotations.highlight(this.epubcfi)}catch(h){console.error(h)}null===(o=this.book)||void 0===o||o.locations.generate(150),t.next=35;break;case 32:t.prev=32,t.t0=t.catch(8),console.log(t.t0);case 35:case"end":return t.stop()}}),t,this,[[8,32]])})));return function(){return t.apply(this,arguments)}}()},{key:"updateEPubIframe",value:function(){var t=this,e=document.getElementsByTagName("iframe");if(1===e.length){var n;this.ePubIframe=e[0],null===(n=this.ePubIframe.contentDocument)||void 0===n||n.addEventListener("keydown",this.keyListener.bind(this),!1);var s=this.ePubIframe.contentWindow;Object(v.S)("android")?s.window.oncontextmenu=Q.disableAndroidChromeCallout:Object(v.S)("ios")&&(s.document.ontouchend=Q.disableIosSafariCallout.bind(s)),this.props.useFontKai&&(s.loadTwKaiFont=wt,s.loadTwKaiFont()),s.addCbetaLineBreaks=yt,s.addCbetaLineBreaks(),s.addSwpiedEvents=Ot,s.addSwpiedEvents(),s.document.addEventListener("swiped",(function(e){if(t.props.paginated)if(t.props.rtlVerticalLayout)switch(e.detail.dir){case"left":t.pagePrev();break;case"right":t.pageNext()}else switch(e.detail.dir){case"down":t.pagePrev();break;case"up":t.pageNext()}})),this.findVisibleTexts()}else e.length>1?alert("Error! This component locates ePub iframe by the only iframe."):console.error("ePub iframes count is 0.")}},{key:"updatePageInfos",value:function(){var t,e=(null===(t=this.rendition)||void 0===t?void 0:t.currentLocation()).start.displayed;this.setState({currentPage:e.page,pageCount:e.total})}},{key:"setSelectedString",value:function(){var t,e,n="",s=null===(t=this.ePubIframe)||void 0===t||null===(e=t.contentDocument)||void 0===e?void 0:e.getSelection();return((null===s||void 0===s?void 0:s.rangeCount)||0)>0&&s.getRangeAt(0).toString().length>0&&(n=s.toString()),n}},{key:"setSelectedRange",value:function(){var t,e,n;return null===(t=this.ePubIframe)||void 0===t||null===(e=t.contentDocument)||void 0===e||null===(n=e.getSelection())||void 0===n?void 0:n.getRangeAt(0)}},{key:"getRemainingWorkTextFromSelectedRange",value:function(){var t,e=this.ePubIframe.contentWindow.getSelection();if("Range"===e.type){var n=this.ePubIframe.contentDocument.getElementById("back"),s=e.getRangeAt(0);s.setEnd(n,0);var o=s.cloneContents();null===e||void 0===e||e.removeAllRanges();var r=new Document,a=r.createElement("html");r.appendChild(a),a.appendChild(o),Q.removeElementsByClassName(r,"lb"),Q.removeElementsByClassName(r,"doube-line-note"),t=r.getElementById("body").innerText}return t}},{key:"getAllTextNodes",value:function(t){return document.createTreeWalker(t,NodeFilter.SHOW_TEXT)}},{key:"visibleCharToRange",value:function(t){var e=this.visibleChars[t],n=new Range;return n.setStart(e.node,e.offset),n.setEnd(e.node,e.offset+1),n}},{key:"rectBinDirSize",value:function(t){return this.props.rtlVerticalLayout?t.y:t.x}},{key:"findBinBoundaryVisibleCharIndex",value:function(t,e,n){var s=e+Math.floor((n-e)/2);if(0===s)return 0;if(s===this.visibleChars.length-1)return this.visibleChars.length-1;var o=this.visibleCharToRange(s),r=this.visibleCharToRange(s+1),a=o.getBoundingClientRect(),i=r.getBoundingClientRect(),c=this.rectBinDirSize(a)-this.ePubIframeOffset,l=this.rectBinDirSize(i)-this.ePubIframeOffset;return c<t&&t<=l?s:c<t&&t>l?this.findBinBoundaryVisibleCharIndex(t,s+1,n):c>=t&&t<=l?this.findBinBoundaryVisibleCharIndex(t,e,s):(console.error("Unreasonable case!"),-1)}},{key:"findTextsInPage",value:function(t){var e=new Date,n=t-1;if(!this.isPageSearched[n]){var s=this.pageWidth*(t-1),o=this.pageWidth*t,r=0;1!==t&&(r=this.isPageSearched[n-1]?this.visibleChars.length-1-this.visibleChars.slice().reverse().findIndex((function(e){return e.page===t-1}))+1:this.findBinBoundaryVisibleCharIndex(s,0,this.visibleChars.length-1)+1);var a=this.visibleChars.length-1,i=this.visibleChars.length-1;t!==this.state.pageCount&&(i=this.isPageSearched[n+1]?this.visibleChars.findIndex((function(e){return e.page===t+1}))-1:this.findBinBoundaryVisibleCharIndex(o,r,a));for(var c=r;c<=i;c++)this.visibleChars[c].page=t;this.isPageSearched[n]=!0}var l=this.visibleChars.filter((function(e){return e.page===t})).map((function(t){return t.char})).join(""),h=(new Date).getTime()-e.getTime();return console.log("findTextsInPage spends: ".concat(h/1e3,"s")),l}},{key:"findVisibleTexts",value:function(){var t=this,e=this.ePubIframe.contentDocument.getElementById("body");if(e){var n,s=this.getAllTextNodes(e);this.visibleTextNodes=[],this.visibleChars=[],this.isPageSearched=[];for(var o=function(){var e=n;if(["t","pc","gaijiAnchor"].reduce((function(t,n){var s;return t&&n!==(null===(s=e.parentElement)||void 0===s?void 0:s.className)}),!0))return"continue";t.visibleTextNodes.push(n)};null!=(n=s.nextNode());)o();this.allTexts=this.visibleTextNodes.map((function(t){return t.textContent})).join("");for(var r=0,a=0;a<this.visibleTextNodes.length;a++)for(var i=this.visibleTextNodes[a],c=0;c<i.length;c++)this.visibleChars.push({node:i,offset:c,page:0,char:this.allTexts[r]}),r++;var l=document.querySelector(".epub-container");this.pageWidth=this.props.rtlVerticalLayout?l.clientHeight:l.clientWidth,this.pagesWidth=this.pageWidth*this.state.pageCount,this.isPageSearched=new Array(this.state.pageCount);for(var h=0;h<this.isPageSearched.length;h++)this.isPageSearched[h]=!1;var u=this.visibleCharToRange(0).getBoundingClientRect();this.ePubIframeOffset=this.props.rtlVerticalLayout?u.y:u.x}}},{key:"findSearchTextRanges",value:function(t){this.searchTextRanges=[],this.showedSearchTextIndex=0;var e=[],n=0,s=1;do{if(-1===(s=this.allTexts.indexOf(t,n)))break;n=s+t.length,e.push(s),e.push(s+t.length)}while(s<this.allTexts.length-1);if(0!==e.length){var o=[],r=0;s=e.shift();for(var a=0;a<this.visibleTextNodes.length;a++){for(var i=this.visibleTextNodes[a],c=0;c<i.length&&(r!==s||(o.push({node:i,offset:c}),-1!==(s=e.shift()||-1)));c++)r++;if(-1===s)break}for(var l=0;l<o.length/2;l+=1){var h=new Range,u=o[2*l],p=o[2*l+1];h.setStart(u.node,u.offset),h.setEnd(p.node,p.offset),this.searchTextRanges.push(h)}}}},{key:"findVisibleCharIndex",value:function(t,e){for(var n=0;n<this.visibleChars.length;n++){var s=this.visibleChars[n];if(s.node===t&&s.offset===e)return n}return-1}},{key:"searchTextPrev",value:function(){this.showedSearchTextIndex>0&&this.showedSearchTextIndex--,this.moveToSearchText(this.showedSearchTextIndex)}},{key:"searchTextNext",value:function(){this.showedSearchTextIndex<this.searchTextRanges.length-1&&this.showedSearchTextIndex++,this.moveToSearchText(this.showedSearchTextIndex)}},{key:"moveToSearchText",value:function(t){var e=this;this.epubcfiFromSelectedString="";var n=this.ePubIframe.contentWindow.getSelection();n.removeAllRanges(),setTimeout((function(){var s,o,r=e.searchTextRanges[t];(e.ePubIframe.contentWindow.focus(),n.addRange(r),e.props.paginated)?s=setInterval((function(){var t;""!==e.epubcfiFromSelectedString&&(clearInterval(s),null===(t=e.rendition)||void 0===t||t.display(e.epubcfiFromSelectedString).then((function(){var t,n;null===(t=e.rendition)||void 0===t||t.annotations.removeAll(),null===(n=e.rendition)||void 0===n||n.annotations.highlight(e.epubcfiFromSelectedString,{},(function(t){}))})))}),100):null===(o=r.startContainer.parentElement)||void 0===o||o.scrollIntoView()}),100)}},{key:"buttonPrev",value:function(){this.state.showSearchTextToast?this.searchTextPrev():this.pagePrev()}},{key:"buttonNext",value:function(){this.state.showSearchTextToast?this.searchTextNext():this.pageNext()}},{key:"findCbetaHtmlLine",value:function(t){var e=t.parentElement;do{var n,s;if(null===(s=e)||void 0===s?void 0:s.getAttribute("l"))break}while(e=null===(n=e)||void 0===n?void 0:n.parentElement);return e}},{key:"findTextsInPageAndChunking",value:function(){var t,e,n,s;if(this.state.isSpeechRepeatMode){var o=this.findVisibleCharIndex(this.speechRepeatStart.startContainer,this.speechRepeatStart.startOffset),r=this.findVisibleCharIndex(this.speechRepeatEnd.endContainer,this.speechRepeatEnd.endOffset-1);s="";for(var a=o;a<r+1;a++)s+=this.visibleChars[a].char}else s=this.props.paginated?this.findTextsInPage(this.state.currentPage):this.getRemainingWorkTextFromSelectedRange();var i=s||(null===(t=this.ePubIframe)||void 0===t||null===(e=t.contentDocument)||void 0===e||null===(n=e.getElementById("body"))||void 0===n?void 0:n.innerText)||"\u7121\u6cd5\u53d6\u5f97\u7d93\u6587\u5167\u5bb9";this.workTexts=[];for(var c=0;c<Math.ceil(i.length/this.maxCharsPerUtterance);c++)this.workTexts.push(i.substring(c*this.maxCharsPerUtterance,(c+1)*this.maxCharsPerUtterance));this.workTextsIndex=0}},{key:"playText2Speech",value:function(){var t=this,e=Q.zhVoices();switch(this.state.speechState){case st.UNINITIAL:var n=e.find((function(e){return e.voiceURI===t.props.voiceURI}))||e[0];void 0!==n&&(this.speechSynthesisUtterance.lang=n.lang,this.speechSynthesisUtterance.voice=n),this.findTextsInPageAndChunking(),this.speechSynthesisUtterance.text=this.workTexts[this.workTextsIndex],this.speechSynthesisUtterance.rate=this.props.speechRate,speechSynthesis.cancel(),speechSynthesis.speak(this.speechSynthesisUtterance),this.setState({speechState:st.SPEAKING,showToast:!0,toastMessage:"\u7d93\u6587\u5538\u8aa6\u975e\u771f\u4eba\u767c\u97f3\uff0c\u50c5\u4f5c\u53c3\u8003\uff01"});break;case st.SPEAKING:speechSynthesis.cancel(),this.setState({speechState:st.UNINITIAL,isSpeechRepeatMode:!1});break;case st.PAUSE:speechSynthesis.resume(),this.setState({speechState:st.SPEAKING})}}},{key:"render",value:function(){var t=this,e=Object(I.jsx)(v.g,{children:Object(I.jsxs)(v.J,{children:[Object(I.jsx)(v.G,{className:"uiFont"}),Object(I.jsx)(v.c,{hidden:this.isTopPage,fill:"clear",slot:"start",onClick:function(e){return t.props.history.goBack()},children:Object(I.jsx)(v.h,{icon:ot.a,slot:"icon-only"})}),Object(I.jsx)(v.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(e){return t.fetchData()},children:Object(I.jsx)(v.h,{icon:ot.E,slot:"icon-only"})}),Object(I.jsx)(v.c,{fill:"outline",shape:"round",hidden:!this.props.paginated,slot:"end",onClick:function(e){t.setState({showJumpPageAlert:!0})},children:Object(I.jsx)(v.o,{className:"uiFont",children:this.state.currentPage})}),Object(I.jsx)(v.c,{hidden:this.state.fetchError||!this.state.canTextToSpeech,fill:"clear",slot:"end",onClick:function(e){t.playText2Speech()},children:Object(I.jsx)(v.h,{icon:this.state.speechState===st.SPEAKING?ot.M:ot.B,slot:"icon-only"})}),Object(I.jsx)(v.c,{hidden:this.state.fetchError,fill:"clear",slot:"end",onClick:function(e){Object(gt.clearTimeout)(t.clearSelectedStringTimer),t.addBookmarkHandler()},children:Object(I.jsx)(v.h,{icon:ot.g,slot:"icon-only"})}),Object(I.jsx)(v.c,{fill:"clear",slot:"end",onClick:function(e){Object(gt.clearTimeout)(t.clearSelectedStringTimer),t.setState({popover:{show:!0,event:e.nativeEvent}})},children:Object(I.jsx)(v.h,{ios:ot.s,md:ot.t,slot:"icon-only"})}),Object(I.jsx)(v.t,{isOpen:this.state.popover.show,event:this.state.popover.event,onDidDismiss:function(e){t.setState({popover:{show:!1,event:null}})},children:Object(I.jsxs)(v.p,{children:[Object(I.jsxs)(v.k,{button:!0,onClick:function(e){t.setState({showSpeechRepeatStart:!0,popover:{show:!1,event:null}})},children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.C,slot:"start"}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u5faa\u74b0\u64ad\u653e"})]}),Object(I.jsxs)(v.k,{button:!0,onClick:function(e){t.setState({popover:{show:!1,event:null}}),t.props.history.push("".concat(Q.pwaUrl,"/catalog/work/").concat(t.props.match.params.work))},children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.v,slot:"start"}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u56de\u7d93\u76ee\u9304"})]}),Object(I.jsxs)(v.k,{button:!0,onClick:function(e){t.props.history.push("".concat(Q.pwaUrl,"/").concat(t.props.match.params.tab)),t.setState({popover:{show:!1,event:null}})},children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.v,slot:"start"}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u56de\u9996\u9801"})]}),Object(I.jsxs)(v.k,{button:!0,onClick:function(e){t.setState({popover:{show:!1,event:null}});var n=t.selectedString;Q.copyToClipboard(n),t.setState({showToast:!0,toastMessage:"\u8907\u88fd\u6587\u5b57\u6210\u529f\uff01"})},children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.p,slot:"start"}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u8907\u88fd\u6587\u5b57"})]}),Object(I.jsxs)(v.k,{button:!0,onClick:function(e){t.setState({popover:{show:!1,event:null}}),t.setState({showSearchTextToast:!1,showSearchTextAlert:!0})},children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.H,slot:"start"}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u641c\u5c0b\u6587\u5b57"})]}),Object(I.jsxs)(v.k,{button:!0,onClick:function(e){t.setState({popover:{show:!1,event:null}}),t.setState({showSearchAlert:!0})},children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.H,slot:"start"}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u641c\u5c0b\u7d93\u66f8"})]}),Object(I.jsxs)(v.k,{button:!0,onClick:function(e){t.setState({popover:{show:!1,event:null}});var n=t.selectedString;""!==n?t.props.history.push({pathname:"".concat(Q.pwaUrl,"/dictionary/search/").concat(n)}):t.setState({showNoSelectedTextAlert:!0})},children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.f,slot:"start"}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u67e5\u8a5e\u5178"})]}),Object(I.jsxs)(v.k,{button:!0,onClick:function(e){t.setState({popover:{show:!1,event:null}});var n=t.selectedString;""!==n?t.props.history.push({pathname:"".concat(Q.pwaUrl,"/dictionary/searchWord/").concat(n)}):t.setState({showNoSelectedTextAlert:!0})},children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.f,slot:"start"}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u67e5\u5b57\u5178"})]}),Object(I.jsxs)(v.k,{button:!0,onClick:function(e){var n,s;t.setState({popover:{show:!1,event:null}}),null===(n=t.ePubIframe)||void 0===n||null===(s=n.contentWindow)||void 0===s||s.print()},children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.D,slot:"start"}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u5217\u5370"})]}),Object(I.jsxs)(v.k,{button:!0,onClick:function(e){t.setState({popover:{show:!1,event:null}}),window.open("https://cbetaonline.dila.edu.tw/zh/".concat(t.props.match.params.work,"_").concat(t.props.match.params.path.padStart(3,"0")),"_bank")},children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.y,slot:"start"}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"CBETA Online"})]}),Object(I.jsxs)(v.k,{button:!0,onClick:function(e){var n,s;t.setState({popover:{show:!1,event:null}});var o=t.selectedString;if(""!==o){var r=t.selectedRange,a=null===(n=t.findCbetaHtmlLine(r.startContainer))||void 0===n?void 0:n.getAttribute("l"),i=null===(s=t.findCbetaHtmlLine(r.endContainer))||void 0===s?void 0:s.getAttribute("l");if(null!=a&&null!=i){var c=/0*([1-9]*)([a-z])0*([1-9]*)/.exec(a),l="".concat(c[1]).concat(c[2]).concat(c[3]),h=/0*([1-9]*)([a-z])0*([1-9]*)/.exec(i)[3],u="".concat(l);a!==i&&(u+="-".concat(h));var p="\u300a".concat(t.state.workInfo.title,"\u300b\u5377").concat(t.props.match.params.path,"\uff1a\u300c").concat(o,"\u300d(CBETA, ").concat(t.state.workInfo.vol,", no. ").concat(+/[^0-9]*(.*)/.exec(t.state.workInfo.work)[1],", p. ").concat(u,")");Q.copyToClipboard(p),t.setState({showToast:!0,toastMessage:"\u5df2\u8907\u88fd\u5230\u526a\u8cbc\u7c3f\uff01"})}else t.setState({showToast:!0,toastMessage:"\u6240\u9078\u6587\u5b57\u7121\u6cd5\u5f15\u7528\uff01"})}else t.setState({showNoSelectedTextAlert:!0})},children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.L,slot:"start"}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u5f15\u7528\u6587\u7ae0"})]}),Object(I.jsxs)(v.k,{button:!0,onClick:function(e){var n=window.location.href.split("?")[0];""!==t.selectedString&&(n+="?bookmark=".concat(t.epubcfiFromSelectedString)),t.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(n)}})},children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.L,slot:"start"}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u5206\u4eab\u6b64\u9801"})]})]})}),Object(I.jsx)(v.u,{reversed:this.props.rtlVerticalLayout,value:this.state.currentPage/this.state.pageCount})]})}),n=.2,s=Object(I.jsxs)(I.Fragment,{children:[Object(I.jsx)(v.e,{vertical:"center",horizontal:"start",slot:"fixed",children:Object(I.jsx)(v.f,{style:{opacity:n},onClick:function(e){return t.props.rtlVerticalLayout?t.buttonNext():t.buttonPrev()},onPointerDown:function(t){t.currentTarget.style.setProperty("opacity","1")},onPointerEnter:function(t){t.currentTarget.style.setProperty("opacity","1")},onPointerUp:function(t){Q.isTouchDevice()&&t.currentTarget.style.setProperty("opacity","".concat(n))},onPointerLeave:function(t){t.currentTarget.style.setProperty("opacity","".concat(n))},children:Object(I.jsx)(v.h,{icon:this.props.rtlVerticalLayout?ot.a:ot.e})})}),Object(I.jsx)(v.e,{vertical:"center",horizontal:"end",slot:"fixed",children:Object(I.jsx)(v.f,{style:{opacity:n},onClick:function(e){return t.props.rtlVerticalLayout?t.buttonPrev():t.buttonNext()},onPointerDown:function(t){t.currentTarget.style.setProperty("opacity","1")},onPointerEnter:function(t){t.currentTarget.style.setProperty("opacity","1")},onPointerUp:function(t){Q.isTouchDevice()&&t.currentTarget.style.setProperty("opacity","".concat(n))},onPointerLeave:function(t){t.currentTarget.style.setProperty("opacity","".concat(n))},children:Object(I.jsx)(v.h,{icon:this.props.rtlVerticalLayout?ot.d:ot.c})})})]});return this.bookCreated||null==this.state.htmlStr||this.html2Epub(),Object(I.jsxs)(v.s,{children:[e,Object(I.jsxs)(v.d,{children:[this.props.paginated||this.state.showSearchTextToast?s:Object(I.jsx)(I.Fragment,{}),Object(I.jsx)(v.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return t.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."}),this.state.fetchError?Q.fetchErrorContent:Object(I.jsx)(I.Fragment,{}),Object(I.jsx)("div",{id:"cbetarEPubView",style:{width:"100%",height:"100%",userSelect:"text",WebkitUserSelect:"text"}}),Object(I.jsx)(v.a,{cssClass:"uiFont",isOpen:this.state.showJumpPageAlert,header:"\u8df3\u9801",subHeader:"\u8acb\u8f38\u5165\u9801\u78bc(1 - ".concat(this.state.pageCount,")"),inputs:[{name:"name0",type:"number",min:1,max:this.state.pageCount,value:this.state.currentPage}],buttons:[{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary uiFont",handler:function(){return t.setState({showJumpPageAlert:!1})}},{text:"\u78ba\u5b9a",cssClass:"primary uiFont",handler:function(e){t.setState({showJumpPageAlert:!1}),t.jumpToPage(e.name0)}}]}),Object(I.jsx)(at,Object(p.a)({},Object(p.a)({showSearchAlert:this.state.showSearchAlert,finish:function(){t.setState({showSearchAlert:!1})}},this.props))),Object(I.jsx)(v.a,{cssClass:"uiFont",isOpen:this.state.showNoSelectedTextAlert,backdropDismiss:!1,header:"\u5931\u6557",message:"\u8acb\u78ba\u8a8d\u662f\u5426\u5df2\u9078\u64c7\u4e00\u6bb5\u6587\u5b57\uff0c\u7136\u5f8c\u518d\u57f7\u884c\u6240\u9078\u7684\u529f\u80fd!",buttons:[{text:"\u78ba\u5b9a",cssClass:"primary uiFont",handler:function(e){t.setState({showNoSelectedTextAlert:!1})}}]}),Object(I.jsx)(v.a,{cssClass:"uiFont",isOpen:this.state.showSearchTextAlert,header:"\u641c\u5c0b\u6587\u5b57",subHeader:"\u6309\u4e0b\u641c\u5c0b\u5f8c\uff0c\u5de6\u53f3\u65b9\u5411\u9215\u8b8a\u70ba\u641c\u5c0b\u6587\u5b57\u65b9\u5411\u9215\u3002\u6309\u4e0b\u65b9\u901a\u77e5UI\u95dc\u9589\u9215\uff0c\u96e2\u958b\u641c\u5c0b\u6587\u5b57\u6a21\u5f0f\u3002",inputs:[{name:"name0",type:"search",placeholder:"\u4f8b:\u5982\u662f\u6211\u805e"}],buttons:[{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary uiFont",handler:function(){return t.setState({showSearchTextAlert:!1})}},{text:"\u641c\u5c0b",cssClass:"primary uiFont",handler:function(e){""!==e.name0?(t.findSearchTextRanges(e.name0),0===t.searchTextRanges.length?t.setState({showSearchTextAlert:!1,showToast:!0,toastMessage:"\u627e\u4e0d\u5230\u6587\u5b57\uff1a".concat(e.name0)}):(t.setState({showSearchTextAlert:!1,showSearchTextToast:!0,searchText:e.name0}),t.searchTextPrev())):t.setState({showSearchTextAlert:!1})}}]}),Object(I.jsx)(v.H,{cssClass:"uiFont",isOpen:this.state.showSearchTextToast,onDidDismiss:function(){return t.setState({showSearchTextToast:!1})},message:"\u641c\u5c0b\uff1a".concat(this.state.searchText),buttons:[{text:"\u95dc\u9589",role:"cancel",handler:function(){return t.setState({showSearchTextToast:!1})}}]}),Object(I.jsx)(v.H,{cssClass:"uiFont",isOpen:this.state.showSpeechRepeatStart,onDidDismiss:function(){return t.setState({showSpeechRepeatStart:!1})},message:"\u8acb\u9078\u64c7\u5071\u74b0\u64ad\u653e\u6587\u5b57\u8d77\u9ede\uff0c\u518d\u6309\u78ba\u5b9a",buttons:[{text:"\u78ba\u5b9a",role:"ok",handler:function(){Object(gt.clearTimeout)(t.clearSelectedStringTimer),t.speechRepeatStart=t.selectedRange,t.setState({showSpeechRepeatStart:!1,showSpeechRepeatEnd:!0})}}]}),Object(I.jsx)(v.H,{cssClass:"uiFont",isOpen:this.state.showSpeechRepeatEnd,onDidDismiss:function(){return t.setState({showSpeechRepeatEnd:!1})},message:"\u8acb\u9078\u64c7\u5071\u74b0\u64ad\u653e\u6587\u5b57\u7d42\u9ede\uff0c\u518d\u6309\u78ba\u5b9a",buttons:[{text:"\u78ba\u5b9a",role:"ok",handler:function(){Object(gt.clearTimeout)(t.clearSelectedStringTimer),t.speechRepeatEnd=t.selectedRange,t.setState({isSpeechRepeatMode:!0,showSpeechRepeatEnd:!1}),t.playText2Speech()}}]}),Object(I.jsx)(v.H,{cssClass:"uiFont",isOpen:this.state.showToast,onDidDismiss:function(){return t.setState({showToast:!1})},message:this.state.toastMessage,duration:2e3})]})]})}}]),s}(r.a.Component),Ct=Object(v.U)(Tt),At=Object(g.b)((function(t){return{settings:t.settings,bookmarks:t.settings.bookmarks,fontSize:t.settings.fontSize,showComments:t.settings.showComments,paginated:t.settings.paginated,rtlVerticalLayout:t.settings.rtlVerticalLayout,useFontKai:t.settings.useFontKai,scrollbarSize:t.settings.scrollbarSize,voiceURI:t.settings.voiceURI,speechRate:t.settings.speechRate,tmpSettings:t.tmpSettings}}))(Ct),It=(n(434),n(435),n(436),n(437),n(438),n(439),n(440),n(441),n(442),n(443),n(444),n(445),n(101)),Et=function(t){Object(j.a)(n,t);var e=Object(f.a)(n);function n(t){var s;return Object(d.a)(this,n),(s=e.call(this,t)).reportText="",s.state={showFontLicense:!1,juansDownloadedRatio:0,showBugReportAlert:!1,showUpdateAllJuansDone:!1,showClearAlert:!1,showToast:!1,toastMessage:""},s}return Object(b.a)(n,[{key:"ionViewWillEnter",value:function(){}},{key:"updateBookmark",value:function(t,e){var n=t.findIndex((function(t){return t.uuid===e.uuid}));-1===n?console.error("Update bookmark fails! Can't find the original bookmark with UUID: ".concat(e.uuid)):t[n]=e}},{key:"updateAllJuans",value:function(){var t=Object(u.a)(h.a.mark((function t(){var e,n,s,o,r,a,i,c,l,u,p,d,b,j,f,x,v,m,g,w,k;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(this.setState({juansDownloadedRatio:0}),e=this.props.settings.bookmarks.filter((function(t){return t.type===$.WORK})),n=this.props.settings.bookmarks.filter((function(t){return t.type===$.JUAN})),s=n.filter((function(t){return-1===e.findIndex((function(e){var n,s;return(null===(n=e.work)||void 0===n?void 0:n.work)===(null===(s=t.work)||void 0===s?void 0:s.work)}))})),o=s.length,r=0;r<e.length;r++)a=e[r].work,o+=a.juan_list.split(",").length;i=0,c=0;case 8:if(!(c<e.length)){t.next=30;break}l=e[c],u=l.work,p=u.juan_list.split(","),d=0;case 13:if(!(d<p.length)){t.next=27;break}return b=p[d],i+=1,this.setState({juansDownloadedRatio:i/o}),t.next=19,Q.fetchJuan(u.work,b,null,!0);case 19:j=t.sent,f=Q.getFileName(u.work,b),this.props.tmpSettings.cbetaOfflineDbMode||Q.saveFileToIndexedDB(f,j.htmlStr),0===d&&this.updateBookmark(this.props.settings.bookmarks,Object.assign(l,{work:j.workInfo})),console.log("File saved: ".concat(f));case 24:d++,t.next=13;break;case 27:c++,t.next=8;break;case 30:x=0;case 31:if(!(x<s.length)){t.next=48;break}return i+=1,this.setState({juansDownloadedRatio:i/o}),v=s[x],m=v.work,t.next=38,Q.fetchJuan(m.work,"".concat(m.juan),null,!0);case 38:g=t.sent,w=Q.getFileName(m.work,"".concat(m.juan)),(k=g.workInfo).juan=m.juan,this.props.tmpSettings.cbetaOfflineDbMode||Q.saveFileToIndexedDB(w,g.htmlStr),this.updateBookmark(this.props.settings.bookmarks,Object.assign(v,{work:k})),console.log("File saved: ".concat(w));case 45:x++,t.next=31;break;case 48:this.props.dispatch({type:"UPDATE_BOOKMARKS",bookmarks:this.props.settings.bookmarks}),this.setState({showUpdateAllJuansDone:!0});case 50:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t=this;return Object(I.jsxs)(v.s,{children:[Object(I.jsx)(v.g,{children:Object(I.jsx)(v.J,{children:Object(I.jsx)(v.G,{className:"uiFont",children:"\u8a2d\u5b9a"})})}),Object(I.jsxs)(v.d,{children:[Object(I.jsxs)(v.p,{children:[Object(I.jsxs)(v.k,{hidden:!this.props.tmpSettings.mainVersion,children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.w,slot:"start"}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u4f7f\u7528CBETA\u96e2\u7dda\u7d93\u6587\u8cc7\u6599\u6a94"}),Object(I.jsx)(v.I,{slot:"end",disabled:!0,checked:this.props.tmpSettings.cbetaOfflineDbMode})]}),Object(I.jsxs)(v.k,{children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.h,slot:"start"}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:Object(I.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2#report",target:"_new",children:"\u555f\u7528app\u7570\u5e38\u8a18\u9304"})}),Object(I.jsx)(v.I,{slot:"end",checked:this.props.settings.hasAppLog,onIonChange:function(e){var n=e.detail.checked;t.props.settings.hasAppLog!==n&&(n?Q.enableAppLog():Q.disableAppLog(),t.props.dispatch({type:"SET_KEY_VAL",key:"hasAppLog",val:n}))}})]}),Object(I.jsxs)(v.k,{hidden:!this.props.settings.hasAppLog,children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.h,slot:"start"}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u56de\u5831app\u7570\u5e38\u8a18\u9304"}),Object(I.jsx)(v.c,{fill:"outline",shape:"round",slot:"end",size:"large",className:"uiFont",onClick:function(e){t.reportText="\u700f\u89bd\u5668\uff1a"+navigator.userAgent+"\n\nApp\u7248\u672c\uff1a"+It.pwaVersion+"\n\nApp\u8a2d\u5b9a\uff1a"+JSON.stringify(t.props.settings)+"\n\nLog\uff1a\n"+Q.getLog(),t.setState({showBugReportAlert:!0})},children:"\u56de\u5831"}),Object(I.jsx)(v.a,{cssClass:"uiFont",backdropDismiss:!1,isOpen:this.state.showBugReportAlert,header:"\u7570\u5e38\u56de\u5831",subHeader:"\u8f38\u5165\u60a8\u7684 E-mail\uff0c\u4ee5\u5f8c\u7e8c\u806f\u7d61",inputs:[{name:"name0",type:"email",placeholder:"abc@example.com"},{name:"name1",type:"textarea",placeholder:"\u8acb\u63cf\u8ff0\u767c\u751f\u6b65\u9a5f"}],buttons:[{text:"\u9001\u51fa",cssClass:"primary uiFont",handler:function(){var e=Object(u.a)(h.a.mark((function e(n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(/^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(n.name0)){e.next=3;break}return t.setState({showBugReportAlert:!1,showToast:!0,toastMessage:"\u932f\u8aa4\uff0cE-mail \u4e0d\u7b26\u683c\u5f0f\uff01"}),e.abrupt("return");case 3:return e.prev=3,e.next=6,Q.axiosInstance.post(Q.bugReportApiUrl,{subject:"".concat(It.productName,"\u7570\u5e38\u8a18\u9304\u56de\u5831"),text:"E-mail: ".concat(n.name0,"\n\n\u767c\u751f\u6b65\u9a5f: ").concat(n.name1,"\n\n").concat(t.reportText)});case 6:t.setState({showBugReportAlert:!1,showToast:!0,toastMessage:"\u7570\u5e38\u56de\u5831\u6210\u529f"}),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(3),console.error(e.t0),t.setState({showBugReportAlert:!1,showToast:!0,toastMessage:"\u7570\u5e38\u56de\u5831\u5931\u6557"});case 13:case"end":return e.stop()}}),e,null,[[3,9]])})));return function(t){return e.apply(this,arguments)}}()},{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary uiFont",handler:function(){return t.setState({showBugReportAlert:!1})}}]})]}),Object(I.jsxs)(v.k,{children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.r,slot:"start"}),Object(I.jsx)("div",{className:"contentBlock",children:Object(I.jsxs)("div",{style:{flexDirection:"column"},children:[Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"App\u8a2d\u5b9a\u8207\u66f8\u7c64"}),Object(I.jsxs)("div",{style:{textAlign:"right"},children:[Object(I.jsx)(v.c,{fill:"outline",shape:"round",size:"large",className:"uiFont",onClick:function(){var t=Object(u.a)(h.a.mark((function t(e){var n,s;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n="data:text/json;charset=utf-8,".concat(encodeURIComponent(localStorage.getItem(Q.storeFile)||"")),(s=document.createElement("a")).href=n,s.download=Q.storeFile,s.click(),s.remove();case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),children:"\u532f\u51fa"}),Object(I.jsx)("input",{id:"importJsonInput",type:"file",accept:".json",style:{display:"none"},onChange:function(){var e=Object(u.a)(h.a.mark((function e(n){var s,o,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=null===(s=n.target.files)||void 0===s?void 0:s.item(0),e.next=3,null===o||void 0===o?void 0:o.text();case 3:if(e.t0=e.sent,e.t0){e.next=6;break}e.t0="";case 6:r=e.t0;try{JSON.parse(r),localStorage.setItem(Q.storeFile,r),t.props.dispatch({type:"LOAD_SETTINGS"}),t.updateAllJuans()}catch(a){console.error(a),console.error((new Error).stack)}document.getElementById("importJsonInput").value="";case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),Object(I.jsx)(v.c,{fill:"outline",shape:"round",size:"large",className:"uiFont",onClick:function(t){document.querySelector("#importJsonInput").click()},children:"\u532f\u5165"}),Object(I.jsx)(v.c,{fill:"outline",shape:"round",size:"large",className:"uiFont",onClick:function(e){t.setState({showClearAlert:!0})},children:"\u91cd\u7f6e"}),Object(I.jsx)(v.a,{cssClass:"uiFont",isOpen:this.state.showClearAlert,backdropDismiss:!1,onDidPresent:function(t){},header:"\u91cd\u7f6e\u6703\u9084\u539fapp\u8a2d\u5b9a\u9810\u8a2d\u503c\u4e26\u6e05\u9664\u66f8\u7c64\u3001\u5b57\u578b\u6a94\uff01\u78ba\u5b9a\u91cd\u7f6e\uff1f",buttons:[{text:"\u53d6\u6d88",cssClass:"primary uiFont",handler:function(e){t.setState({showClearAlert:!1})}},{text:"\u91cd\u7f6e",cssClass:"secondary uiFont",handler:function(){var e=Object(u.a)(h.a.mark((function e(n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Q.clearAppData();case 2:for(t.props.dispatch({type:"DEFAULT_SETTINGS"});document.body.classList.length>0;)document.body.classList.remove(document.body.classList.item(0));document.body.classList.toggle("theme".concat(t.props.settings.theme),!0),document.body.classList.toggle("print".concat(t.props.settings.printStyle),!0),t.setState({showClearAlert:!1,showToast:!0,toastMessage:"\u6e05\u9664\u6210\u529f!"});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]})]})]})})]}),Object(I.jsxs)(v.k,{children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.E,slot:"start"}),Object(I.jsxs)("div",{style:{width:"100%"},children:[Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u66f4\u65b0\u96e2\u7dda\u7d93\u6587\u6a94"}),Object(I.jsx)(v.u,{value:this.state.juansDownloadedRatio})]}),Object(I.jsx)(v.c,{fill:"outline",shape:"round",slot:"end",size:"large",className:"uiFont",onClick:function(){var e=Object(u.a)(h.a.mark((function e(n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.updateAllJuans());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:"\u66f4\u65b0"}),Object(I.jsx)(v.H,{cssClass:"uiFont",isOpen:this.state.showUpdateAllJuansDone,onDidDismiss:function(){return t.setState({showUpdateAllJuansDone:!1})},message:"\u96e2\u7dda\u7d93\u6587\u6a94\u66f4\u65b0\u5b8c\u7562\uff01",duration:2e3})]}),Object(I.jsxs)(v.k,{children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.o,slot:"start"}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:Q.appSettings.theme}),Object(I.jsxs)(v.B,{slot:"end",value:this.props.settings.theme,className:"uiFont",interface:"popover",interfaceOptions:{cssClass:"cbetar2themes"},onIonChange:function(e){var n=+e.detail.value;t.props.settings.theme!==n&&t.props.dispatch({type:"SET_KEY_VAL",key:"theme",val:n})},children:[Object(I.jsx)(v.C,{className:"uiFont cbeta",value:0,children:"CBETA"}),Object(I.jsx)(v.C,{className:"uiFont dark",value:1,children:"\u6697\u8272"}),Object(I.jsx)(v.C,{className:"uiFont light",value:2,children:"\u4eae\u8272"}),Object(I.jsx)(v.C,{className:"uiFont oldPaper",value:3,children:"\u820a\u66f8"}),Object(I.jsx)(v.C,{className:"uiFont marble",value:4,children:"\u5927\u7406\u77f3"})]})]}),Object(I.jsxs)(v.k,{children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.q,slot:"start"}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:Q.appSettings.rtlVerticalLayout}),Object(I.jsx)(v.I,{slot:"end",checked:this.props.settings.rtlVerticalLayout,onIonChange:function(e){var n=e.detail.checked;t.props.settings.rtlVerticalLayout!==n&&t.props.dispatch({type:"SET_KEY_VAL",key:"rtlVerticalLayout",val:n})}})]}),Object(I.jsxs)(v.k,{children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.q,slot:"start"}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:Q.appSettings.paginated}),Object(I.jsx)(v.I,{slot:"end",checked:this.props.settings.paginated,onIonChange:function(e){var n=e.detail.checked;t.props.settings.paginated!==n&&t.props.dispatch({type:"SET_KEY_VAL",key:"paginated",val:n})}})]}),Object(I.jsxs)(v.k,{children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.q,slot:"start"}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u55ae\u9801\u7d93\u6587\u6372\u8ef8\u5927\u5c0f"}),Object(I.jsxs)(v.B,{slot:"end",value:this.props.settings.scrollbarSize,className:"uiFont",interface:"popover",interfaceOptions:{cssClass:"uiFont"},onIonChange:function(e){var n=+e.detail.value;t.props.settings.scrollbarSize!==n&&(t.props.dispatch({type:"SET_KEY_VAL",key:"scrollbarSize",val:n}),Q.updateCssVars(t.props.settings))},children:[Object(I.jsx)(v.C,{className:"uiFont",value:0,children:"\u7121"}),Object(I.jsx)(v.C,{className:"uiFont",value:1,children:"\u4e2d"}),Object(I.jsx)(v.C,{className:"uiFont",value:2,children:"\u5927"})]})]}),Object(I.jsxs)(v.k,{children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.q,slot:"start"}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:Q.appSettings.showComments}),Object(I.jsx)(v.I,{slot:"end",checked:this.props.settings.showComments,onIonChange:function(e){var n=e.detail.checked;t.props.settings.showComments!==n&&t.props.dispatch({type:"SET_KEY_VAL",key:"showComments",val:n})}})]}),Object(I.jsxs)(v.k,{children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.O,slot:"start"}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:Q.appSettings.useFontKai}),Object(I.jsx)(v.I,{slot:"end",checked:this.props.settings.useFontKai,onIonChange:function(e){var n=e.detail.checked;t.props.settings.useFontKai!==n&&(t.props.dispatch({type:"SET_KEY_VAL",key:"useFontKai",val:n}),Q.updateCssVars(t.props.settings))}})]}),Object(I.jsxs)(v.k,{children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.O,slot:"start"}),Object(I.jsx)("div",{className:"contentBlock",children:Object(I.jsxs)("div",{style:{flexDirection:"column"},children:[Object(I.jsxs)(v.o,{className:"ion-text-wrap uiFont",children:[Q.appSettings.uiFontSize,": ",this.props.settings.uiFontSize]}),Object(I.jsx)(v.v,{min:10,max:128,pin:!0,snaps:!0,value:this.props.settings.uiFontSize,onIonChange:function(e){t.props.dispatch({type:"SET_KEY_VAL",key:"uiFontSize",val:+e.detail.value}),Q.updateCssVars(t.props.settings)}})]})})]}),Object(I.jsxs)(v.k,{children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.O,slot:"start"}),Object(I.jsxs)("div",{className:"contentBlock",children:[Object(I.jsxs)(v.o,{className:"ion-text-wrap uiFont",children:[Q.appSettings.fontSize,": ",Object(I.jsx)("span",{className:"textFont",children:this.props.settings.fontSize})]}),Object(I.jsx)(v.v,{min:10,max:128,pin:!0,snaps:!0,value:this.props.settings.fontSize,onIonChange:function(e){t.props.dispatch({type:"SET_KEY_VAL",key:"fontSize",val:e.detail.value}),Q.updateCssVars(t.props.settings)}})]})]}),Object(I.jsxs)(v.k,{children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.D,slot:"start"}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:Q.appSettings.printStyle}),Object(I.jsxs)(v.B,{slot:"end",value:this.props.settings.printStyle,className:"uiFont",interface:"popover",interfaceOptions:{cssClass:"cbetar2themes"},onIonChange:function(e){var n=+e.detail.value;t.props.settings.printStyle!==n&&t.props.dispatch({type:"SET_KEY_VAL",key:"printStyle",val:n})},children:[Object(I.jsx)(v.C,{className:"uiFont blackWhite printVar",value:0,children:"\u767d\u5e95\u9ed1\u5b57"}),Object(I.jsx)(v.C,{className:"uiFont manuscript printVar",value:1,children:"\u6284\u7d93\u672c"})]})]}),Object(I.jsxs)(v.k,{children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.D,slot:"start"}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u5408\u6210\u8a9e\u97f3"}),Object(I.jsx)(v.B,{slot:"end",value:this.props.settings.voiceURI,className:"uiFont",interface:"action-sheet",cancelText:"\u53d6\u6d88",onIonChange:function(e){var n=e.detail.value;t.props.settings.voiceURI!==n&&t.props.dispatch({type:"SET_KEY_VAL",key:"voiceURI",val:n})},children:Q.zhVoices().map((function(t,e){return Object(I.jsx)(v.C,{className:"uiFont blackWhite printVar",value:t.voiceURI,children:t.name},e)}))})]}),Object(I.jsxs)(v.k,{children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.C,slot:"start"}),Object(I.jsx)("div",{className:"contentBlock",children:Object(I.jsxs)("div",{style:{flexDirection:"column"},children:[Object(I.jsxs)(v.o,{className:"ion-text-wrap uiFont",children:[Object(I.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2#text2speech",target:"_new",children:"\u5408\u6210\u8a9e\u97f3\u8a9e\u901f"}),": ",this.props.settings.speechRate]}),Object(I.jsx)(v.v,{min:.1,max:1.5,step:.1,snaps:!0,value:this.props.settings.speechRate,onIonChange:function(e){t.props.dispatch({type:"SET_KEY_VAL",key:"speechRate",val:e.detail.value.toFixed(1)})}})]})})]}),Object(I.jsxs)(v.k,{children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.u,slot:"start"}),Object(I.jsxs)("div",{className:"uiFont",children:[Object(I.jsx)("div",{children:"\u95dc\u65bc"}),Object(I.jsx)("div",{children:Object(I.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2",target:"_new",children:"\u64cd\u4f5c\u8aaa\u660e"})}),Object(I.jsxs)("div",{children:["\u7248\u672c\uff1a",It.pwaVersion]}),Object(I.jsxs)("div",{children:["CBETA API \u7248\u672c: ",Q.apiVersion]}),Object(I.jsx)("div",{children:Object(I.jsx)("a",{href:"http://cbdata.dila.edu.tw/v1.2/",target:"_new",children:"CBETA API \u53c3\u8003\u6587\u4ef6"})}),Object(I.jsx)("div",{children:Object(I.jsx)("a",{href:"http://glossaries.dila.edu.tw/?locale=zh-TW",target:"_new",children:"DILA \u4f5b\u5b78\u8853\u8a9e\u5b57\u8fad\u5178"})}),Object(I.jsx)("div",{children:"\u4f5c\u8005: Meng-Yuan Huang"}),Object(I.jsx)("div",{children:Object(I.jsx)("a",{href:"mailto:myh@live.com",target:"_new",children:"myh@live.com"})}),Object(I.jsx)("div",{children:Object(I.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2#contributors",target:"_new",children:"App \u76f8\u95dc\u8ca2\u737b\u8005"})}),Object(I.jsx)("div",{children:Object(I.jsx)("a",{href:"/",onClick:function(e){e.preventDefault(),t.setState({showFontLicense:!0})},children:"\u5168\u5b57\u5eab\u5b57\u578b\u7248\u6b0a\u8072\u660e"})})]})]}),Object(I.jsx)(v.a,{cssClass:"uiFont",isOpen:this.state.showFontLicense,backdropDismiss:!1,message:"\u6b64 app \u4f7f\u7528\u7684\u5168\u5b57\u5eab\u5b57\u578b(2020-08-18\u7248)\u7531\u570b\u5bb6\u767c\u5c55\u59d4\u54e1\u6703\u63d0\u4f9b\u3002\u6b64\u958b\u653e\u8cc7\u6599\u4f9d\u653f\u5e9c\u8cc7\u6599\u958b\u653e\u6388\u6b0a\u689d\u6b3e (Open Government Data License) \u9032\u884c\u516c\u773e\u91cb\u51fa\uff0c\u4f7f\u7528\u8005\u65bc\u9075\u5b88\u672c\u689d\u6b3e\u5404\u9805\u898f\u5b9a\u4e4b\u524d\u63d0\u4e0b\uff0c\u5f97\u5229\u7528\u4e4b\u3002\u653f\u5e9c\u8cc7\u6599\u958b\u653e\u6388\u6b0a\u689d\u6b3e\uff1ahttps://data.gov.tw/license",buttons:[{text:"\u95dc\u9589",cssClass:"primary uiFont",handler:function(e){t.setState({showFontLicense:!1})}},{text:"\u958b\u555f\u6388\u6b0a",cssClass:"secondary uiFont",handler:function(e){t.setState({showFontLicense:!1}),window.open("https://data.gov.tw/license")}}]})]}),Object(I.jsx)(v.H,{cssClass:"uiFont",isOpen:this.state.showToast,onDidDismiss:function(){return t.setState({showToast:!1})},message:this.state.toastMessage,duration:2e3})]})]})}}]),n}(r.a.Component),Ft=Object(v.U)(Et),Nt=Object(g.b)((function(t){return{settings:t.settings,tmpSettings:t.tmpSettings}}))(Ft),Lt=function(t){Object(j.a)(n,t);var e=Object(f.a)(n);function n(t){var s;return Object(d.a)(this,n),(s=e.call(this,t)).bookmarkListRef=void 0,s.state={reorder:!1,showToast:!1,toastMessage:""},s.bookmarkListRef=r.a.createRef(),s}return Object(b.a)(n,[{key:"ionViewWillEnter",value:function(){var t=k.a.parse(this.props.location.search);if(t.item&&t.item<this.props.bookmarks.length){var e,n,s=this.props.bookmarks[t.item];this.props.history.push("".concat(Q.pwaUrl,"/catalog/juan/").concat(null===(e=s.work)||void 0===e?void 0:e.work,"/").concat(null===(n=s.work)||void 0===n?void 0:n.juan))}else this.hasBookmark||(this.setState({showToast:!0,toastMessage:"\u7121\u66f8\u7c64\uff01\u8acb\u5f9e\u76ee\u9304\u9801\u65b0\u589e\u66f8\u7c64\u3002"}),this.props.history.push("".concat(Q.pwaUrl,"/catalog/famous")))}},{key:"componentDidMount",value:function(){console.log("did mount: ".concat(this.props.match.url))}},{key:"hasBookmark",get:function(){return this.props.bookmarks.length>0}},{key:"isFamousPage",get:function(){return this.props.match.url==="".concat(Q.pwaUrl,"/catalog/famous")}},{key:"delBookmarkHandler",value:function(t){this.props.dispatch({type:"DEL_BOOKMARK",uuid:t}),this.hasBookmark||this.props.history.push("".concat(Q.pwaUrl,"/catalog/famous"))}},{key:"reorderBookmarks",value:function(t){var e=t.detail.complete(this.props.bookmarks);this.props.dispatch({type:"UPDATE_BOOKMARKS",bookmarks:e})}},{key:"getBookmarkRows",value:function(){var t=this,e=this.props.bookmarks,n=Array();return e.forEach((function(e,s){var o,r,a,i,c,l,p="",d="".concat(e.selectedText),b=!1;switch(e.type){case $.CATALOG:p="".concat(Q.pwaUrl,"/catalog/catalog/").concat(e.uuid);break;case $.WORK:p="".concat(Q.pwaUrl,"/catalog/work/").concat(e.uuid);break;case $.JUAN:p="".concat(Q.pwaUrl,"/catalog/juan/").concat(null===(o=e.work)||void 0===o?void 0:o.work,"/").concat(null===(r=e.work)||void 0===r?void 0:r.juan),d="".concat(null===(a=e.work)||void 0===a?void 0:a.title,"\u7b2c").concat(null===(i=e.work)||void 0===i?void 0:i.juan,"\u5377 - ").concat(d);break;case $.HTML:b=!0,p="".concat(Q.pwaUrl,"/catalog/juan/").concat(null===(c=e.work)||void 0===c?void 0:c.work,"/1"),d="".concat(null===(l=e.work)||void 0===l?void 0:l.title," - ").concat(d)}n.push(Object(I.jsxs)(v.n,{children:[Object(I.jsxs)(v.k,{button:!0,onClick:function(){var n=Object(u.a)(h.a.mark((function n(s){var o;return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.state.reorder){n.next=3;break}return t.setState({showToast:!0,toastMessage:"\u8acb\u5148\u95dc\u9589\u6392\u5217\u529f\u80fd\uff0c\u624d\u53ef\u9ede\u64ca\u66f8\u7c64\uff01"}),n.abrupt("return");case 3:s.preventDefault(),t.props.history.push({pathname:p,state:{uuid:e.uuid},search:k.a.stringify(b?{file:e.fileName,title:null===(o=e.work)||void 0===o?void 0:o.title}:{})});case 5:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}(),children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:d},"bookmarkItemLabel_"+s),e.type===$.CATALOG?"":Object(I.jsx)(v.h,{icon:ot.r,slot:"end"}),Object(I.jsx)(v.w,{slot:"end"})]},"bookmarkItem_"+s),Object(I.jsx)(v.m,{side:"end",children:Object(I.jsx)(v.l,{className:"uiFont",color:"danger",onClick:function(n){var s;t.delBookmarkHandler(e.uuid),null===(s=t.bookmarkListRef.current)||void 0===s||s.closeSlidingItems()},children:"\u522a\u9664"})})]},"bookmarkItemSliding_"+s))})),n}},{key:"render",value:function(){var t=this,e=this.getBookmarkRows();return Object(I.jsxs)(v.s,{children:[Object(I.jsx)(v.g,{children:Object(I.jsxs)(v.J,{children:[Object(I.jsx)(v.G,{className:"uiFont",children:"\u66f8\u7c64"}),Object(I.jsx)(v.c,{fill:this.state.reorder?"solid":"clear",slot:"end",onClick:function(e){return t.setState({reorder:!t.state.reorder})},children:Object(I.jsx)(v.h,{icon:ot.N,slot:"icon-only"})})]})}),Object(I.jsxs)(v.d,{children:[this.hasBookmark?Object(I.jsx)(I.Fragment,{children:Object(I.jsx)(v.p,{ref:this.bookmarkListRef,children:Object(I.jsx)(v.x,{disabled:!this.state.reorder,onIonItemReorder:function(e){t.reorderBookmarks(e)},children:e})},"bookmarkList0")}):Object(I.jsx)(I.Fragment,{children:Object(I.jsx)(v.p,{children:e},"bookmarkList1")}),Object(I.jsx)(v.H,{cssClass:"uiFont",isOpen:this.state.showToast,onDidDismiss:function(){return t.setState({showToast:!1})},message:this.state.toastMessage,duration:2e3})]})]},"bookmarksPage".concat(this.isFamousPage))}}]),n}(r.a.Component),Dt=Object(v.U)(Lt),Ut=Object(g.b)((function(t){return{bookmarks:t.settings.bookmarks}}))(Dt),Pt=function t(e){var n;Object(d.a)(this,t),this.type=void 0,this.n=void 0,this.label=void 0,this.work=void 0,this.title=void 0,this.creators=void 0,this.type=e.type,this.n=e.n,this.label=e.label,this.work=e.work,this.title=e.title,this.creators=null!==(n=e.creators)&&void 0!==n?n:"\u7121"},Bt=function(t){Object(j.a)(n,t);var e=Object(f.a)(n);function n(t){var s;return Object(d.a)(this,n),(s=e.call(this,t)).state={fetchError:!1,showSearchAlert:!1,searches:[],isLoading:!1},s}return Object(b.a)(n,[{key:"ionViewWillEnter",value:function(){this.search(this.props.match.params.keyword)}},{key:"componentDidMount",value:function(){}},{key:"search",value:function(){var t=Object(u.a)(h.a.mark((function t(e){var n,s,o;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.setState({isLoading:!0}),t.prev=1,t.next=4,Q.axiosInstance.get("/toc?q=".concat(e),{responseType:"arraybuffer"});case 4:return n=t.sent,s=JSON.parse((new TextDecoder).decode(n.data)).results,o=s.map((function(t){return new Pt(t)})),this.setState({fetchError:!1,isLoading:!1,searches:o}),t.abrupt("return",!0);case 11:return t.prev=11,t.t0=t.catch(1),console.error(t.t0),console.error((new Error).stack),this.setState({fetchError:!0,isLoading:!1}),t.abrupt("return",!1);case 17:case"end":return t.stop()}}),t,this,[[1,11]])})));return function(e){return t.apply(this,arguments)}}()},{key:"isTopPage",get:function(){return this.props.match.url==="".concat(Q.pwaUrl,"/catalog")}},{key:"getRows",value:function(){var t=this,e=Array();return this.state.searches.forEach((function(n,s){var o="catalog"===n.type,r=o?n.label:"".concat(n.title,"\n\u4f5c\u8005:").concat(n.creators),a="".concat(Q.pwaUrl,"/").concat(t.props.match.params.tab)+(o?"/catalog/".concat(n.n):"/work/".concat(n.work));e.push(Object(I.jsxs)(v.k,{button:!0,onClick:function(){var e=Object(u.a)(h.a.mark((function e(n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.preventDefault(),t.props.history.push({pathname:a});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:r},"searchLabel_"+s)]},"searchItem_"+s))})),e}},{key:"render",value:function(){var t=this,e=this.getRows();return Object(I.jsxs)(v.s,{children:[Object(I.jsx)(v.g,{children:Object(I.jsxs)(v.J,{children:[Object(I.jsxs)(v.G,{className:"uiFont",children:["\u641c\u5c0b - ",this.props.match.params.keyword]}),Object(I.jsx)(v.c,{hidden:this.isTopPage,fill:"clear",slot:"start",onClick:function(e){return t.props.history.goBack()},children:Object(I.jsx)(v.h,{icon:ot.a,slot:"icon-only"})}),Object(I.jsx)(v.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(e){return t.search(t.props.match.params.keyword)},children:Object(I.jsx)(v.h,{icon:ot.E,slot:"icon-only"})}),Object(I.jsx)(v.c,{fill:"clear",slot:"end",onClick:function(e){return t.props.history.push("".concat(Q.pwaUrl,"/").concat(t.props.match.params.tab))},children:Object(I.jsx)(v.h,{icon:ot.v,slot:"icon-only"})}),Object(I.jsx)(v.c,{fill:"clear",slot:"end",onClick:function(e){return t.setState({showSearchAlert:!0})},children:Object(I.jsx)(v.h,{icon:ot.H,slot:"icon-only"})}),Object(I.jsx)(v.c,{fill:"clear",slot:"end",onClick:function(e){t.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})},children:Object(I.jsx)(v.h,{icon:ot.L,slot:"icon-only"})})]})}),Object(I.jsxs)(v.d,{children:[this.state.fetchError?Q.fetchErrorContent:Object(I.jsx)(v.p,{children:e}),Object(I.jsx)(v.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return t.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."}),Object(I.jsx)(at,Object(p.a)({},Object(p.a)({showSearchAlert:this.state.showSearchAlert,finish:function(){t.setState({showSearchAlert:!1})}},this.props)))]})]})}}]),n}(r.a.Component),Rt=Object(v.U)(Bt),_t=Object(g.b)((function(t){return{}}))(Rt),Mt=function(t){Object(j.a)(n,t);var e=Object(f.a)(n);function n(t){var s;return Object(d.a)(this,n),(s=e.call(this,t)).searchBarRef=void 0,s.selectedTextBeforeIonPopover="",s.state={keyword:"",searches:[],showNoSelectedTextAlert:!1,popover:{show:!1,event:null},isLoading:!1,fetchError:!1,showToast:!1,toastMessage:""},s.searchBarRef=r.a.createRef(),s}return Object(b.a)(n,[{key:"ionViewWillEnter",value:function(){this.setState({keyword:this.props.match.params.keyword}),this.props.match.params.keyword?this.lookupDict(this.props.match.params.keyword):this.setState({searches:[]})}},{key:"isTopPage",get:function(){return void 0===this.props.match.params.keyword}},{key:"lookupDict",value:function(){var t=Object(u.a)(h.a.mark((function t(e){var n;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.setState({isLoading:!0}),t.prev=1,t.next=4,Q.axiosInstance.get("".concat(Q.dilaDictApiUrl,"/?type=match&dicts=dila&term=").concat(e),{responseType:"json"});case 4:n=t.sent,this.props.dictionaryHistory.unshift(e),this.props.dictionaryHistory.splice(10),this.props.dispatch({type:"SET_KEY_VAL",key:"dictionaryHistory",val:this.props.dictionaryHistory}),this.setState({fetchError:!1,isLoading:!1,searches:n.data}),t.next=17;break;case 11:return t.prev=11,t.t0=t.catch(1),console.error(t.t0),console.error((new Error).stack),this.setState({fetchError:!0,isLoading:!1}),t.abrupt("return",!1);case 17:case"end":return t.stop()}}),t,this,[[1,11]])})));return function(e){return t.apply(this,arguments)}}()},{key:"getSelectedString",value:function(){var t=document.getSelection();return((null===t||void 0===t?void 0:t.rangeCount)||0)>0&&t.getRangeAt(0).toString().length>0?t.getRangeAt(0).toString():""}},{key:"getRows",value:function(){var t=this.state.searches,e=Array();return t.forEach((function(t,n){e.push(Object(I.jsx)("div",{style:{display:"table-row"},children:Object(I.jsxs)("div",{className:"tableCell",children:[Object(I.jsx)("div",{className:"textFont",style:{color:"var(--ion-color-primary)",paddingBottom:"18pt"},dangerouslySetInnerHTML:{__html:t.dict_name_zh}}),Object(I.jsx)("div",{className:"textFont",style:{padding:"0 5px",textAlign:"justify",overflowWrap:"normal"},dangerouslySetInnerHTML:{__html:t.desc}},"dictItemLabel"+n)]})},"dictItem"+n))})),e}},{key:"render",value:function(){var t=this;return Object(I.jsxs)(v.s,{children:[Object(I.jsx)(v.g,{children:Object(I.jsxs)(v.J,{children:[Object(I.jsx)(v.c,{hidden:this.isTopPage,fill:"clear",slot:"start",onClick:function(e){return t.props.history.goBack()},children:Object(I.jsx)(v.h,{icon:ot.a,slot:"icon-only"})}),Object(I.jsx)(v.c,{fill:"outline",shape:"round",slot:"start",onClick:function(e){t.props.history.push("".concat(Q.pwaUrl,"/dictionary/searchWord"))},children:Object(I.jsx)("span",{className:"uiFont",style:{color:"var(--color)"},children:"\u4f5b\u5b78\u8a5e\u5178"})}),Object(I.jsx)(v.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(e){return t.lookupDict(t.props.match.params.keyword)},children:Object(I.jsx)(v.h,{icon:ot.E,slot:"icon-only"})}),Object(I.jsx)(v.c,{fill:"clear",slot:"end",onClick:function(e){t.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})},children:Object(I.jsx)(v.h,{icon:ot.L,slot:"icon-only"})}),Object(I.jsx)(v.c,{fill:"clear",slot:"end",onPointerDown:function(e){t.selectedTextBeforeIonPopover=t.getSelectedString()},onClick:function(e){t.setState({popover:{show:!0,event:e.nativeEvent}})},children:Object(I.jsx)(v.h,{ios:ot.s,md:ot.t,slot:"icon-only"})}),Object(I.jsx)(v.t,{isOpen:this.state.popover.show,event:this.state.popover.event,onDidDismiss:function(e){t.selectedTextBeforeIonPopover="",t.setState({popover:{show:!1,event:null}})},children:Object(I.jsxs)(v.p,{children:[Object(I.jsxs)(v.k,{button:!0,onClick:function(e){t.props.history.push("".concat(Q.pwaUrl,"/").concat(t.props.match.params.tab,"/search")),t.setState({popover:{show:!1,event:null}})},children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.v,slot:"start"}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u56de\u9996\u9801"})]}),Object(I.jsxs)(v.k,{button:!0,onClick:function(e){t.setState({popover:{show:!1,event:null}}),Q.copyToClipboard(t.selectedTextBeforeIonPopover),t.setState({showToast:!0,toastMessage:"\u8907\u88fd\u6587\u5b57\u6210\u529f"})},children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.p,slot:"start"}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u8907\u88fd\u6587\u5b57"})]}),Object(I.jsxs)(v.k,{button:!0,onClick:function(e){t.setState({popover:{show:!1,event:null}}),""!==t.selectedTextBeforeIonPopover?t.props.history.push({pathname:"".concat(Q.pwaUrl,"/dictionary/search/").concat(t.selectedTextBeforeIonPopover)}):t.setState({showNoSelectedTextAlert:!0})},children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.f,slot:"start"}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u67e5\u8a5e\u5178"})]}),Object(I.jsxs)(v.k,{button:!0,onClick:function(e){t.setState({popover:{show:!1,event:null}}),""!==t.selectedTextBeforeIonPopover?t.props.history.push({pathname:"".concat(Q.pwaUrl,"/dictionary/searchWord/").concat(t.selectedTextBeforeIonPopover)}):t.setState({showNoSelectedTextAlert:!0})},children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.f,slot:"start"}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u67e5\u5b57\u5178"})]})]})})]})}),Object(I.jsxs)(v.d,{children:[Object(I.jsx)(v.A,{ref:this.searchBarRef,placeholder:"\u8acb\u8f38\u5165\u5b57\u8a5e\uff0c\u518d\u6309\u9375\u76e4Enter\u9375",value:this.state.keyword,onIonClear:function(e){t.setState({searches:[]})},onKeyUp:function(e){var n=e.target.value;t.setState({keyword:n}),""===n?t.setState({searches:[]}):"Enter"===e.key&&(n===t.props.match.params.keyword?(t.setState({keyword:n}),t.lookupDict(n)):t.props.history.push("".concat(Q.pwaUrl,"/dictionary/search/").concat(n)))}}),this.state.fetchError?Q.fetchErrorContent:this.state.searches.length<1||this.props.dictionaryHistory.length>0&&(""===this.state.keyword||void 0===this.state.keyword)?Object(I.jsxs)(I.Fragment,{children:[Object(I.jsx)("div",{className:"uiFont",style:{color:"var(--ion-color-primary)"},children:"\u641c\u5c0b\u6b77\u53f2"}),Object(I.jsx)(v.p,{children:this.props.dictionaryHistory.map((function(e,n){return Object(I.jsx)(v.k,{button:!0,onClick:function(){var n=Object(u.a)(h.a.mark((function n(s){return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e===t.props.match.params.keyword?(t.setState({keyword:e}),t.lookupDict(e)):t.props.history.push("".concat(Q.pwaUrl,"/dictionary/search/").concat(e));case 1:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}(),children:Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:e},"dictHistoryLabel_"+n)},"dictHistoryItem_".concat(n))}))}),Object(I.jsx)("div",{style:{textAlign:"center"},children:Object(I.jsx)(v.c,{fill:"outline",shape:"round",size:"large",onClick:function(e){t.setState({keyword:""}),t.props.dispatch({type:"SET_KEY_VAL",key:"dictionaryHistory",val:[]})},children:"\u6e05\u9664\u6b77\u53f2"})})]}):Object(I.jsx)("div",{style:{display:"table",tableLayout:"fixed",width:"100%"},children:this.getRows()}),Object(I.jsx)("div",{style:{fontSize:"var(--ui-font-size)",textAlign:"center"},children:Object(I.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2#dictionary",target:"_new",children:"\u4f5b\u5b78\u8a5e\u5178\u8aaa\u660e"})}),Object(I.jsx)(v.a,{cssClass:"uiFont",isOpen:this.state.showNoSelectedTextAlert,backdropDismiss:!1,header:"\u5931\u6557",message:"\u8acb\u78ba\u8a8d\u662f\u5426\u5df2\u9078\u64c7\u4e00\u6bb5\u6587\u5b57\uff0c\u7136\u5f8c\u518d\u57f7\u884c\u6240\u9078\u7684\u529f\u80fd!",buttons:[{text:"\u78ba\u5b9a",cssClass:"primary uiFont",handler:function(e){t.setState({showNoSelectedTextAlert:!1})}}]}),Object(I.jsx)(v.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return t.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."}),Object(I.jsx)(v.H,{cssClass:"uiFont",isOpen:this.state.showToast,onDidDismiss:function(){return t.setState({showToast:!1})},message:this.state.toastMessage,duration:2e3})]})]})}}]),n}(r.a.Component),Vt=Object(v.U)(Mt),Kt=Object(g.b)((function(t){return{dictionaryHistory:t.settings.dictionaryHistory}}))(Vt),Ht=function t(e){Object(d.a)(this,t),this.id=void 0,this.term_hits=void 0,this.work=void 0,this.juan=void 0,this.title=void 0,this.creators=void 0,this.id=e.id,this.term_hits=e.term_hits,this.work=e.work,this.juan=e.juan,this.title=e.title,this.creators=e.creators},zt=function(t){Object(j.a)(n,t);var e=Object(f.a)(n);function n(t){var s;return Object(d.a)(this,n),(s=e.call(this,t)).page=0,s.rows=20,s.state={showSearchAlert:!1,searches:[],isScrollOn:!1,isLoading:!1,fetchError:!1},s}return Object(b.a)(n,[{key:"ionViewWillEnter",value:function(){this.search(this.props.match.params.keyword,!0)}},{key:"componentDidMount",value:function(){}},{key:"search",value:function(){var t=Object(u.a)(h.a.mark((function t(e){var n,s,o,r,a=arguments;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=a.length>1&&void 0!==a[1]&&a[1],this.setState({isLoading:!0}),n&&(this.page=0,this.setState({searches:[]})),t.prev=3,console.log("Loading page ".concat(this.page)),t.next=7,Q.axiosInstance.get("/sphinx?q=".concat(e,"&start=").concat(this.page*this.rows,"&rows=").concat(this.rows),{responseType:"arraybuffer"});case 7:return s=t.sent,o=JSON.parse((new TextDecoder).decode(s.data)).results,r=o.map((function(t){return new Ht(t)})),this.setState({fetchError:!1,isLoading:!1,searches:[].concat(Object(O.a)(this.state.searches),Object(O.a)(r)),isScrollOn:r.length===this.rows}),this.page+=1,t.abrupt("return",!0);case 15:return t.prev=15,t.t0=t.catch(3),console.error(t.t0),console.error((new Error).stack),this.setState({fetchError:!0,isLoading:!1,isScrollOn:!1}),t.abrupt("return",!1);case 21:case"end":return t.stop()}}),t,this,[[3,15]])})));return function(e){return t.apply(this,arguments)}}()},{key:"isTopPage",get:function(){return this.props.match.url==="".concat(Q.pwaUrl,"/catalog")}},{key:"getRows",value:function(){var t=this,e=Array();return this.state.searches.forEach((function(n,s){var o="".concat(n.title,"\u5377").concat(n.juan,"\n\u4f5c\u8005:").concat(n.creators),r="".concat(Q.pwaUrl,"/catalog/juan/").concat(n.work,"/").concat(n.juan);e.push(Object(I.jsxs)(v.k,{button:!0,onClick:function(){var e=Object(u.a)(h.a.mark((function e(n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.preventDefault(),t.props.history.push({pathname:r});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:o},"searchLabel_"+s)]},"searchItem_"+s))})),e}},{key:"render",value:function(){var t=this,e=this.getRows();return Object(I.jsxs)(v.s,{children:[Object(I.jsx)(v.g,{children:Object(I.jsxs)(v.J,{children:[Object(I.jsxs)(v.G,{className:"uiFont",children:["\u5168\u6587\u6aa2\u7d22 - ",this.props.match.params.keyword]}),Object(I.jsx)(v.c,{hidden:this.isTopPage,fill:"clear",slot:"start",onClick:function(e){return t.props.history.goBack()},children:Object(I.jsx)(v.h,{icon:ot.a,slot:"icon-only"})}),Object(I.jsx)(v.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(e){return t.search(t.props.match.params.keyword)},children:Object(I.jsx)(v.h,{icon:ot.E,slot:"icon-only"})}),Object(I.jsx)(v.c,{fill:"clear",slot:"end",onClick:function(e){return t.props.history.push("".concat(Q.pwaUrl,"/").concat(t.props.match.params.tab))},children:Object(I.jsx)(v.h,{icon:ot.v,slot:"icon-only"})}),Object(I.jsx)(v.c,{fill:"clear",slot:"end",onClick:function(e){return t.setState({showSearchAlert:!0})},children:Object(I.jsx)(v.h,{icon:ot.H,slot:"icon-only"})}),Object(I.jsx)(v.c,{fill:"clear",slot:"end",onClick:function(e){t.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})},children:Object(I.jsx)(v.h,{icon:ot.L,slot:"icon-only"})})]})}),Object(I.jsxs)(v.d,{children:[this.state.fetchError?Q.fetchErrorContent:Object(I.jsxs)(v.p,{children:[e,Object(I.jsx)(v.i,{threshold:"100px",disabled:!this.state.isScrollOn,onIonInfinite:function(e){t.search(t.props.match.params.keyword),e.target.complete()},children:Object(I.jsx)(v.j,{loadingText:"\u8f09\u5165\u4e2d..."})})]}),Object(I.jsx)(v.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return t.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."}),Object(I.jsx)(at,Object(p.a)({},Object(p.a)({showSearchAlert:this.state.showSearchAlert,finish:function(){t.setState({showSearchAlert:!1})}},this.props)))]})]})}}]),n}(r.a.Component),Jt=Object(v.U)(zt),Wt=Object(g.b)((function(t){return{}}))(Jt),Yt=n(230),Gt=function(t){Object(j.a)(n,t);var e=Object(f.a)(n);function n(t){var s;return Object(d.a)(this,n),(s=e.call(this,t)).state={isAppSettingsExport:Array(Object.keys(Q.appSettings).length)},s}return Object(b.a)(n,[{key:"updateQrCode",value:function(){var t=this,e=Object.keys(Q.appSettings).filter((function(e,n){return t.state.isAppSettingsExport[n]})).map((function(e,n){return{key:e,val:t.props.settings[e]}})).map((function(t){return"".concat(t.key,"=").concat(+t.val)})).join(",");e=""!==e?"settings=".concat(e):null;var n=this.props.text,s=/\?/.test(n);e&&(n+=s?"&".concat(e):"?".concat(e)),Q.copyToClipboard(n);var o=document.getElementById("qrcCanvas");return Yt.toCanvas(o,n),o}},{key:"render",value:function(){var t=this;return Object(I.jsx)(v.r,{isOpen:this.props.showModal,cssClass:"uiFont",swipeToClose:!0,onWillPresent:function(){for(var e=[],n=0;n<t.state.isAppSettingsExport.length;n++)e.push(!1);t.setState({isAppSettingsExport:e}),t.updateQrCode()},onDidDismiss:function(){return t.props.finish()},children:Object(I.jsx)(v.d,{children:Object(I.jsxs)("div",{style:{display:"flex",flexDirection:"column",height:"100%",alignItems:"center"},children:[Object(I.jsx)("div",{children:Object(I.jsx)(v.o,{className:"uiFont",children:"\u6b64\u9801app\u9023\u7d50\u5df2\u8907\u88fd\u81f3\u526a\u8cbc\u7c3f\uff01"})}),Object(I.jsx)("div",{children:Object(I.jsx)(v.o,{className:"uiFont",children:"\u4e5f\u53ef\u4ee5\u4f7f\u7528QR Code\u5206\u4eab:"})}),Object(I.jsx)("div",{style:{flexGrow:1,flexShrink:0,display:"flex",alignItems:"center",margin:10},children:Object(I.jsx)("canvas",{id:"qrcCanvas",width:"500",height:"500",style:{margin:"0px auto"}})}),Object(I.jsxs)("div",{children:[Object(I.jsx)(v.o,{className:"uiFont",children:"\u5305\u62ecapp\u8a2d\u5b9a:"}),Object(I.jsx)(v.p,{children:Object.keys(Q.appSettings).map((function(e,n){return Object(I.jsxs)(v.k,{children:[Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:Q.appSettings[e]}),Object(I.jsx)(v.I,{slot:"end",onIonChange:function(e){var s=t.state.isAppSettingsExport;s[n]=e.detail.checked,t.setState({isAppSettingsExport:s}),t.updateQrCode()}})]},"appSettingExportItem_".concat(n))}))})]}),Object(I.jsx)("div",{children:Object(I.jsx)(v.c,{fill:"outline",shape:"round",size:"large",onClick:function(){return t.props.finish()},children:"\u95dc\u9589"})})]})})})}}]),n}(r.a.Component),qt=Object(g.b)((function(t){return{settings:t.settings}}))(Gt);!function(t){t.NOUN="\u540d",t.VERB="\u52d5"}(St||(St={}));var Xt=function(t){Object(j.a)(n,t);var e=Object(f.a)(n);function n(t){var s;return Object(d.a)(this,n),(s=e.call(this,t)).searchBarRef=void 0,s.selectedTextBeforeIonPopover="",s.state={keyword:"",search:null,showNoSelectedTextAlert:!1,popover:{show:!1,event:null},isLoading:!1,fetchError:!1,showToast:!1,toastMessage:""},s.searchBarRef=r.a.createRef(),s}return Object(b.a)(n,[{key:"ionViewWillEnter",value:function(){this.props.match.params.keyword&&(this.setState({keyword:this.props.match.params.keyword}),this.lookupDict(this.props.match.params.keyword))}},{key:"componentDidMount",value:function(){}},{key:"ionViewWillLeave",value:function(){}},{key:"isTopPage",get:function(){return this.props.match.url==="".concat(Q.pwaUrl,"/").concat(this.props.match.params.tab)}},{key:"lookupDict",value:function(){var t=Object(u.a)(h.a.mark((function t(e){var n,s,o;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.setState({isLoading:!0}),t.prev=1,t.next=4,Q.axiosInstance.get("https://www.moedict.tw/uni/".concat(e.substring(0,1)),{responseType:"json"});case 4:n=t.sent,this.props.wordDictionaryHistory.unshift(e),this.props.wordDictionaryHistory.splice(10),this.props.dispatch({type:"SET_KEY_VAL",key:"wordDictionaryHistory",val:this.props.wordDictionaryHistory}),this.setState({fetchError:!1,isLoading:!1,search:n.data.heteronyms}),t.next=16;break;case 11:return t.prev=11,t.t0=t.catch(1),o=t.t0,404===(null===(s=o.response)||void 0===s?void 0:s.status)?this.setState({fetchError:!1,isLoading:!1,search:[]}):(console.error(t.t0),console.error((new Error).stack),this.setState({fetchError:!0,isLoading:!1})),t.abrupt("return",!1);case 16:case"end":return t.stop()}}),t,this,[[1,11]])})));return function(e){return t.apply(this,arguments)}}()},{key:"getSelectedString",value:function(){var t=document.getSelection();return((null===t||void 0===t?void 0:t.rangeCount)||0)>0&&t.getRangeAt(0).toString().length>0?t.getRangeAt(0).toString():""}},{key:"defToView",value:function(t,e){return void 0!==t&&t.length>0?Object(I.jsxs)(I.Fragment,{children:[Object(I.jsx)("div",{style:{color:"var(--ion-color-primary)"},children:e},xt.a()),Object(I.jsx)("ol",{children:null===t||void 0===t?void 0:t.map((function(t){var e,n,s;return Object(I.jsxs)("li",{children:[Object(I.jsx)("div",{children:t.def},xt.a()),null===(e=t.quote)||void 0===e?void 0:e.map((function(t){return Object(I.jsx)("div",{children:t},xt.a())})),null===(n=t.example)||void 0===n?void 0:n.map((function(t){return Object(I.jsx)("div",{children:t},xt.a())})),null===(s=t.link)||void 0===s?void 0:s.map((function(t){return Object(I.jsx)("div",{children:t},xt.a())}))]},xt.a())}))},xt.a())]}):Object(I.jsx)(I.Fragment,{})}},{key:"render",value:function(){var t,e,n=this,s=[];this.props.match.params.keyword&&(null===(e=this.state.search)||void 0===e||e.forEach((function(t){var e=null===t||void 0===t?void 0:t.definitions.filter((function(t){return t.type===St.NOUN})),o=null===t||void 0===t?void 0:t.definitions.filter((function(t){return t.type===St.VERB})),r=null===t||void 0===t?void 0:t.definitions.filter((function(t){return void 0===t.type})),a=n.defToView(e,"\u540d\u8a5e"),i=n.defToView(o,"\u52d5\u8a5e"),c=n.defToView(r,"");s.push(Object(I.jsxs)("div",{className:"textFont textSelectable",style:{padding:"0 5px"},children:[Object(I.jsx)("div",{className:"textFontX3",children:n.props.match.params.keyword.substring(0,1)},xt.a()),(null===t||void 0===t?void 0:t.bopomofo)?Object(I.jsxs)("div",{children:["\u6ce8\u97f3\uff1a",null===t||void 0===t?void 0:t.bopomofo]}):null,(null===t||void 0===t?void 0:t.pinyin)?Object(I.jsxs)("div",{children:["\u62fc\u97f3\uff1a",null===t||void 0===t?void 0:t.pinyin]}):null,a,i,c]},xt.a()))})));return Object(I.jsxs)(v.s,{children:[Object(I.jsx)(v.g,{children:Object(I.jsxs)(v.J,{children:[Object(I.jsx)(v.c,{fill:"clear",slot:"start",onClick:function(t){return n.props.history.goBack()},children:Object(I.jsx)(v.h,{icon:ot.a,slot:"icon-only"})}),Object(I.jsx)(v.c,{fill:"outline",shape:"round",slot:"start",onClick:function(t){n.props.history.push("".concat(Q.pwaUrl,"/dictionary/search"))},children:Object(I.jsx)("span",{className:"uiFont",children:"\u840c\u5178\u5b57\u5178"})}),Object(I.jsx)(v.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(t){return n.lookupDict(n.props.match.params.keyword)},children:Object(I.jsx)(v.h,{icon:ot.E,slot:"icon-only"})}),Object(I.jsx)(v.c,{fill:"clear",slot:"end",onClick:function(t){n.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})},children:Object(I.jsx)(v.h,{icon:ot.L,slot:"icon-only"})}),Object(I.jsx)(v.c,{fill:"clear",slot:"end",onPointerDown:function(t){n.selectedTextBeforeIonPopover=n.getSelectedString()},onClick:function(t){n.setState({popover:{show:!0,event:t.nativeEvent}})},children:Object(I.jsx)(v.h,{ios:ot.s,md:ot.t,slot:"icon-only"})}),Object(I.jsx)(v.t,{isOpen:this.state.popover.show,event:this.state.popover.event,onDidDismiss:function(t){n.setState({popover:{show:!1,event:null}}),n.selectedTextBeforeIonPopover=""},children:Object(I.jsxs)(v.p,{children:[Object(I.jsxs)(v.k,{button:!0,onClick:function(t){n.props.history.push("".concat(Q.pwaUrl,"/").concat(n.props.match.params.tab,"/searchWord")),n.setState({popover:{show:!1,event:null}})},children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.v,slot:"start"}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u56de\u9996\u9801"})]}),Object(I.jsxs)(v.k,{button:!0,onClick:function(t){n.setState({popover:{show:!1,event:null}}),Q.copyToClipboard(n.selectedTextBeforeIonPopover),n.setState({showToast:!0,toastMessage:"\u8907\u88fd\u6587\u5b57\u6210\u529f"})},children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.p,slot:"start"}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u8907\u88fd\u6587\u5b57"})]}),Object(I.jsxs)(v.k,{button:!0,onClick:function(t){n.setState({popover:{show:!1,event:null}}),""!==n.selectedTextBeforeIonPopover?n.props.history.push("".concat(Q.pwaUrl,"/dictionary/search/").concat(n.selectedTextBeforeIonPopover)):n.setState({showNoSelectedTextAlert:!0})},children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.f,slot:"start"}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u67e5\u8a5e\u5178"})]}),Object(I.jsxs)(v.k,{button:!0,onClick:function(t){n.setState({popover:{show:!1,event:null}}),""!==n.selectedTextBeforeIonPopover?n.props.history.push({pathname:"".concat(Q.pwaUrl,"/dictionary/searchWord/").concat(n.selectedTextBeforeIonPopover)}):n.setState({showNoSelectedTextAlert:!0})},children:[Object(I.jsx)("div",{tabIndex:0}),Object(I.jsx)(v.h,{icon:ot.f,slot:"start"}),Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u67e5\u5b57\u5178"})]})]})})]})}),Object(I.jsx)(v.d,{children:Object(I.jsxs)("div",{style:{display:"flex",flexFlow:"column",height:"100%"},children:[Object(I.jsx)(v.A,{ref:this.searchBarRef,placeholder:"\u8acb\u8f38\u5165\u5b57\uff0c\u518d\u6309\u9375\u76e4Enter\u9375",value:this.state.keyword,onIonClear:function(t){n.setState({search:null})},onKeyUp:function(t){var e=t.target.value;n.setState({keyword:e}),""===e?n.setState({search:null}):"Enter"===t.key&&(e===n.props.match.params.keyword?(n.setState({keyword:e}),n.lookupDict(e)):n.props.history.push("".concat(Q.pwaUrl,"/dictionary/searchWord/").concat(e)))}}),this.state.fetchError?Q.fetchErrorContent:((null===(t=this.state.search)||void 0===t?void 0:t.length)||0)<1||this.props.wordDictionaryHistory.length>0&&(""===this.state.keyword||void 0===this.state.keyword)?Object(I.jsxs)(I.Fragment,{children:[Object(I.jsx)("div",{className:"uiFont",style:{color:"var(--ion-color-primary)"},children:"\u641c\u5c0b\u6b77\u53f2"}),Object(I.jsx)(v.p,{children:this.props.wordDictionaryHistory.map((function(t,e){return Object(I.jsx)(v.k,{button:!0,onClick:function(){var e=Object(u.a)(h.a.mark((function e(s){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t===n.props.match.params.keyword?(n.setState({keyword:t}),n.lookupDict(t)):n.props.history.push("".concat(Q.pwaUrl,"/dictionary/searchWord/").concat(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:Object(I.jsx)(v.o,{className:"ion-text-wrap uiFont",children:t},"wordDictHistoryLabel_"+e)},"wordDictHistoryItem_".concat(e))}))}),Object(I.jsx)("div",{style:{textAlign:"center"},children:Object(I.jsx)(v.c,{fill:"outline",shape:"round",size:"large",className:"uiFont",onClick:function(t){n.setState({keyword:""}),n.props.dispatch({type:"SET_KEY_VAL",key:"wordDictionaryHistory",val:[]})},children:"\u6e05\u9664\u6b77\u53f2"})})]}):s,Object(I.jsx)(v.a,{cssClass:"uiFont",isOpen:this.state.showNoSelectedTextAlert,backdropDismiss:!1,header:"\u5931\u6557",message:"\u8acb\u78ba\u8a8d\u662f\u5426\u5df2\u9078\u64c7\u4e00\u6bb5\u6587\u5b57\uff0c\u7136\u5f8c\u518d\u57f7\u884c\u6240\u9078\u7684\u529f\u80fd!",buttons:[{text:"\u78ba\u5b9a",cssClass:"primary uiFont",handler:function(t){n.setState({showNoSelectedTextAlert:!1})}}]}),Object(I.jsx)(v.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return n.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."}),Object(I.jsx)(v.H,{cssClass:"uiFont",isOpen:this.state.showToast,onDidDismiss:function(){return n.setState({showToast:!1})},message:this.state.toastMessage,duration:2e3})]})})]})}}]),n}(r.a.Component),$t=Object(v.U)(Xt),Qt=Object(g.b)((function(t){return{wordDictionaryHistory:t.settings.wordDictionaryHistory}}))($t),Zt=function(t){Object(j.a)(n,t);var e=Object(f.a)(n);function n(t){var s;return Object(d.a)(this,n),(s=e.call(this,t)).state={isAppSettingsExport:Array(Object.keys(Q.appSettings).length)},s}return Object(b.a)(n,[{key:"render",value:function(){return Object(I.jsx)(v.r,{isOpen:this.props.showModal,cssClass:"uiFont",backdropDismiss:!1,swipeToClose:!1,children:Object(I.jsx)(v.d,{children:Object(I.jsxs)("div",{style:{display:"flex",flexDirection:"column",height:"100%",alignItems:"center"},children:[Object(I.jsx)("div",{style:{marginBottom:"50px"},children:Object(I.jsx)(v.o,{className:"uiFont",children:"\u5f8c\u7aefapp\u4e0b\u8f09\u9032\u5ea6"})}),Object(I.jsx)(v.u,{style:{height:"40px"},value:this.props.progress}),Object(I.jsxs)(v.o,{className:"uiFont",children:[Math.floor(100*this.props.progress),"%"]})]})})})}}]),n}(r.a.Component),te=Object(g.b)((function(t){return{}}))(Zt),ee=window.electronBackendApi,ne=function(){var t=localStorage.getItem(Q.storeFile);return null!=t?Object(y.b)(nt,JSON.parse(t)):Object(y.b)(nt)}();Object(v.T)({mode:"md",swipeBackEnabled:!1});var se={onSuccess:function(t){},onUpdate:function(t){}},oe=function(t){Object(j.a)(n,t);var e=Object(f.a)(n);function n(){return Object(d.a)(this,n),e.apply(this,arguments)}return Object(b.a)(n,[{key:"render",value:function(){return Object(I.jsx)(g.a,{store:ne,children:Object(I.jsx)(ae,Object(p.a)({},this.props))})}}]),n}(r.a.Component),re=function(t){Object(j.a)(n,t);var e=Object(f.a)(n);function n(t){var s;for(Object(d.a)(this,n),(s=e.call(this,t)).registrationNew=void 0,s.originalAppSettingsStr=void 0,s.wakeLock=void 0,s.props.settings.hasAppLog||Q.disableAppLog(),null===ee||void 0===ee||ee.receive("fromMain",(function(t){switch(t.event){case"version":ne.dispatch({type:"TMP_SET_KEY_VAL",key:"mainVersion",val:t.version});break;case"cbetaOfflineDbMode":ne.dispatch({type:"TMP_SET_KEY_VAL",key:"cbetaOfflineDbMode",val:t.isOn});break;case"DownloadingBackend":s.setState({downloadModal:{show:!0,progress:t.progress/100}});break;case"DownloadingBackendDone":s.setState({downloadModal:{show:!1,progress:s.state.downloadModal.progress}})}})),null===ee||void 0===ee||ee.send("toMain",{event:"ready"}),s.registrationNew=null,Object(v.S)("android")?window.oncontextmenu=Q.disableAndroidChromeCallout:Object(v.S)("ios")&&(document.ontouchend=Q.disableIosSafariCallout.bind(window)),Q.isTouchDevice()&&(window.onorientationchange=function(t){setTimeout((function(){s.forceUpdate()}),500)});document.body.classList.length>0;)document.body.classList.remove(document.body.classList.item(0));document.body.classList.toggle("theme".concat(s.props.settings.theme),!0),document.body.classList.toggle("print".concat(s.props.settings.printStyle),!0);var o=k.a.parse(s.props.location.search);return o.settings&&(s.originalAppSettingsStr=localStorage.getItem(Q.storeFile),o.settings.split(",").forEach((function(t){var e=t.split("=");s.props.dispatch({type:"SET_KEY_VAL",key:e[0],val:+e[1]})}))),Q.updateCssVars(s.props.settings),s.state={showUpdateAlert:!1,showRestoreAppSettingsToast:null!=o.settings&&null!=s.originalAppSettingsStr||!1,showToast:!1,toastMessage:"",downloadModal:{progress:0,show:!1}},se.onUpdate=function(t){s.registrationNew=t,s.setState({showUpdateAlert:!0})},se.onSuccess=function(t){},"undefined"!==typeof speechSynthesis&&(speechSynthesis.getVoices(),speechSynthesis.cancel()),navigator.wakeLock&&(s.wakeLockScreen(),document.addEventListener("visibilitychange",Object(u.a)(h.a.mark((function t(){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:"visible"===document.visibilityState?s.wakeLockScreen():s.wakeLockScreenRelease();case 1:case"end":return t.stop()}}),t)}))))),indexedDB.open(Q.cbetardb).onupgradeneeded=function(t){t.target.result.createObjectStore("store")},s.loadTwKaiFont(),s}return Object(b.a)(n,[{key:"restoreAppSettings",value:function(){for(localStorage.setItem(Q.storeFile,this.originalAppSettingsStr),this.props.dispatch({type:"LOAD_SETTINGS"});document.body.classList.length>0;)document.body.classList.remove(document.body.classList.item(0));document.body.classList.toggle("theme".concat(this.props.settings.theme),!0),document.body.classList.toggle("print".concat(this.props.settings.printStyle),!0),Q.updateCssVars(this.props.settings)}},{key:"loadTwKaiFont",value:function(){var t=Object(u.a)(h.a.mark((function t(){var e,n,s;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Q.getFileFromIndexedDB(Q.twKaiFontKey);case 3:e=t.sent,t.next=13;break;case 6:return t.prev=6,t.t0=t.catch(0),t.next=10,Q.axiosInstance.get("".concat(window.location.origin,"/").concat(Q.twKaiFontPath),{responseType:"arraybuffer",timeout:0});case 10:n=t.sent,e=n.data,Q.saveFileToIndexedDB(Q.twKaiFontKey,e);case 13:return s=new window.FontFace("Kai",e),t.next=16,s.load();case 16:document.fonts.add(s),console.log("[Main] TW-Kai font loading success!");case 18:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(){return t.apply(this,arguments)}}()},{key:"wakeLockScreen",value:function(){var t=Object(u.a)(h.a.mark((function t(){var e;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,null==(e=navigator.wakeLock)){t.next=9;break}return t.next=5,e.request("screen");case 5:this.wakeLock=t.sent,console.log("Screen wake lock is requested."),t.next=10;break;case 9:console.error("navigator.wakeLock is undefined.");case 10:t.next=16;break;case 12:t.prev=12,t.t0=t.catch(0),console.log("".concat(t.t0.name,", ").concat(t.t0.message)),console.log((new Error).stack);case 16:case"end":return t.stop()}}),t,this,[[0,12]])})));return function(){return t.apply(this,arguments)}}()},{key:"wakeLockScreenRelease",value:function(){var t=Object(u.a)(h.a.mark((function t(){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null==this.wakeLock){t.next=5;break}return t.next=3,this.wakeLock.release();case 3:this.wakeLock=null,console.log("Screen wake lock is released.");case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"routeByQueryString",value:function(){console.log("path: ".concat(window.location.pathname,", search ").concat(window.location.search));var t=/route=([^&]*)/.exec(window.location.search),e=/query=([^&]*)/.exec(window.location.search);if(null!==t){var n="";return null!==e&&(n=decodeURIComponent(e[1])),Object(I.jsx)(x.a,{to:t[1]+n})}if(window.location.pathname==="".concat(Q.pwaUrl,"/")||window.location.pathname==="".concat(Q.pwaUrl))return Object(I.jsx)(x.a,{to:"".concat(Q.pwaUrl,"/bookmarks")})}},{key:"render",value:function(){var t,e,n=this;return Object(I.jsxs)(v.b,{style:Q.isTouchDevice()?{height:"".concat(window.innerHeight,"px")}:{},children:[Object(I.jsx)(m.a,{children:Object(I.jsxs)(v.F,{children:[Object(I.jsxs)(v.z,{animated:!1,children:[Object(I.jsx)(x.b,{path:"".concat(Q.pwaUrl,"/:tab(catalog)/webview/:work/:path/:label"),render:function(t){return Object(I.jsx)(At,Object(p.a)({},t))},exact:!0}),Object(I.jsx)(x.b,{path:"".concat(Q.pwaUrl,"/:tab(catalog)/juan/:work/:path/"),render:function(t){return Object(I.jsx)(At,Object(p.a)({},t))},exact:!0}),Object(I.jsx)(x.b,{path:"".concat(Q.pwaUrl,"/:tab(catalog)/work/:path/:label"),render:function(t){return Object(I.jsx)(jt,Object(p.a)({},t))},exact:!0}),Object(I.jsx)(x.b,{path:"".concat(Q.pwaUrl,"/:tab(catalog)/work/:path"),render:function(t){return Object(I.jsx)(jt,Object(p.a)({},t))},exact:!0}),Object(I.jsx)(x.b,{path:"".concat(Q.pwaUrl,"/:tab(catalog)/search/:keyword"),render:function(t){return Object(I.jsx)(_t,Object(p.a)({},t))},exact:!0}),Object(I.jsx)(x.b,{path:"".concat(Q.pwaUrl,"/:tab(catalog)/fulltextsearch/:keyword"),render:function(t){return Object(I.jsx)(Wt,Object(p.a)({},t))},exact:!0}),Object(I.jsx)(x.b,{path:"".concat(Q.pwaUrl,"/:tab(catalog)/catalog/:path/:label"),render:function(t){return Object(I.jsx)(ut,Object(p.a)({},t))},exact:!0}),Object(I.jsx)(x.b,{path:"".concat(Q.pwaUrl,"/:tab(catalog)/:type(catalog|volumes|famous)?/:path?"),render:function(t){return Object(I.jsx)(ut,Object(p.a)({},t))},exact:!0}),Object(I.jsx)(x.b,{path:"".concat(Q.pwaUrl,"/:tab(bookmarks)"),render:function(t){return Object(I.jsx)(Ut,Object(p.a)({},t))},exact:!0}),Object(I.jsx)(x.b,{path:"".concat(Q.pwaUrl,"/:tab(dictionary)/search/:keyword?"),render:function(t){return Object(I.jsx)(Kt,Object(p.a)({},t))},exact:!0}),Object(I.jsx)(x.b,{path:"".concat(Q.pwaUrl,"/:tab(dictionary)/searchWord/:keyword?"),render:function(t){return Object(I.jsx)(Qt,Object(p.a)({},t))},exact:!0}),Object(I.jsx)(x.b,{path:"".concat(Q.pwaUrl,"/settings"),render:function(t){return Object(I.jsx)(Nt,Object(p.a)({},t))}}),Object(I.jsx)(x.b,{path:"".concat(Q.pwaUrl,"/"),render:function(){return n.routeByQueryString()},exact:!0})]}),Object(I.jsxs)(v.D,{slot:"bottom",children:[Object(I.jsx)(v.E,{tab:"bookmarks",href:"".concat(Q.pwaUrl,"/bookmarks"),children:Object(I.jsx)(v.h,{icon:ot.g})}),Object(I.jsx)(v.E,{tab:"catalog",href:"".concat(Q.pwaUrl,"/catalog"),children:Object(I.jsx)(v.h,{icon:ot.x})}),Object(I.jsx)(v.E,{tab:"dictionay",href:"".concat(Q.pwaUrl,"/dictionary/search"),children:Object(I.jsx)(v.h,{icon:ot.f})}),Object(I.jsx)(v.E,{tab:"settings",href:"".concat(Q.pwaUrl,"/settings"),children:Object(I.jsx)(v.h,{icon:ot.K})})]})]})}),Object(I.jsx)(v.a,{cssClass:"uiFont",isOpen:this.state.showUpdateAlert,backdropDismiss:!1,onDidPresent:function(t){var e,s,o,r;null===(e=n.registrationNew)||void 0===e||null===(s=e.installing)||void 0===s||s.postMessage({type:"SKIP_WAITING"}),null===(o=n.registrationNew)||void 0===o||null===(r=o.waiting)||void 0===r||r.postMessage({type:"SKIP_WAITING"})},header:"App \u5df2\u66f4\u65b0\uff0c\u8acb\u91cd\u555f!",buttons:[{text:"\u95dc\u9589",cssClass:"primary uiFont",handler:function(t){n.setState({showUpdateAlert:!1})}}]}),Object(I.jsx)(qt,Object(p.a)({},Object(p.a)({text:null===(t=this.props.tmpSettings.shareTextModal)||void 0===t?void 0:t.text,showModal:(null===(e=this.props.tmpSettings.shareTextModal)||void 0===e?void 0:e.show)||!1,finish:function(){ne.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!1}})}},this.props))),Object(I.jsx)(te,Object(p.a)({},Object(p.a)({progress:this.state.downloadModal.progress,showModal:this.state.downloadModal.show},this.props))),Object(I.jsx)(v.H,{cssClass:"uiFont",isOpen:this.state.showRestoreAppSettingsToast,onDidDismiss:function(){return n.setState({showRestoreAppSettingsToast:!1})},message:"\u5df2\u5957\u7528app\u9023\u7d50\u4e2d\u7684\u8a2d\u5b9a\uff0c\u662f\u5426\u9084\u539f\u8a2d\u5b9a\uff1f",buttons:[{text:"\u53d6\u6d88",role:"cancel",handler:function(){return n.setState({showRestoreAppSettingsToast:!1})}},{text:"\u9084\u539f",handler:function(){return n.restoreAppSettings()}}]}),Object(I.jsx)(v.H,{cssClass:"uiFont",isOpen:this.state.showToast,onDidDismiss:function(){return n.setState({showToast:!1})},message:this.state.toastMessage,duration:2e3})]})}}]),n}(r.a.Component),ae=Object(g.b)((function(t){return{tmpSettings:t.tmpSettings,settings:t.settings}}))(re),ie=Object(x.f)(oe),ce=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function le(t,e){navigator.serviceWorker.register(t).then((function(t){t.onupdatefound=function(){var n=t.installing;null!=n&&(n.onstatechange=function(){console.log("installingWorker stage changed: ".concat(n.state)),"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),e&&e.onUpdate&&e.onUpdate(t)):(console.log("Content is cached for offline use."),e&&e.onSuccess&&e.onSuccess(t)))})}})).catch((function(t){console.error("Error during service worker registration:",t)}))}Q.enableAppLog(),i.a.render(Object(I.jsx)(c.a,{children:Object(I.jsx)(ie,{})}),document.getElementById("root")),function(t){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("","/service-worker.js");ce?(!function(t,e){fetch(t,{headers:{"Service-Worker":"script"}}).then((function(n){var s=n.headers.get("content-type");404===n.status||null!=s&&-1===s.indexOf("javascript")?navigator.serviceWorker.ready.then((function(t){t.unregister().then((function(){window.location.reload()}))})):le(t,e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e,t),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):le(e,t)}))}}({onSuccess:function(t){console.log("Precache app loaded!"),se.onSuccess(t)},onUpdate:function(t){console.log("Found app updated!"),se.onUpdate(t)}})}},[[466,3,4]]]);
//# sourceMappingURL=main.06dfac5c.chunk.js.map