{"version":3,"sources":["../node_modules/@ionic/core/dist/esm-es5 lazy /^/.//.*/.entry/.js$/ include: //.entry/.js$/ exclude: //.system/.entry/.js$/ groupOptions: {} namespace object","../node_modules/ionicons/dist/esm-es5 lazy /^/.//.*/.entry/.js$/ include: //.entry/.js$/ exclude: //.system/.entry/.js$/ groupOptions: {} namespace object","models/Work.tsx","Globals.tsx","models/Bookmark.tsx","redux/reducers/index.tsx","redux/reducers/setReducer.tsx","redux/reducers/tmpSetReducer.tsx","pages/EPubViewPage.tsx","models/Catalog.tsx","components/SearchAlert.tsx","pages/CatalogPage.tsx","pages/WorkPage.tsx","models/DictWordItem.tsx","pages/SettingsPage.tsx","pages/BookmarkPage.tsx","models/Search.tsx","pages/SearchPage.tsx","pages/DictionaryPage.tsx","models/FullTextSearch.tsx","pages/FullTextSearchPage.tsx","components/ShareTextModal.tsx","pages/WordDictionaryPage.tsx","App.tsx","redux/store.tsx","serviceWorker.ts","index.tsx"],"names":["map","webpackAsyncContext","req","__webpack_require__","o","Promise","resolve","then","e","Error","code","ids","id","keys","Object","module","exports","WorkListType","WorkChapter","json","title","juan","this","Work","juan_list","mulu","work","vol","cbetaApiUrl","log","axiosInstance","axios","create","baseURL","timeout","scrollbarSizeIdToValue","getFileName","getFileFromIndexedDB","fileName","a","dbOpenReq","indexedDB","open","ok","fail","onsuccess","ev","db","result","trans","transaction","objectStore","get","_ev","data","console","error","stack","transWrite","put","delete","htmlFile","update","htmlStr","settingsStr","localStorage","getItem","workInfo","bookmarks","JSON","parse","settings","bookmark","find","b","uuid","undefined","responseType","res","tryDecoder","TextDecoder","tryDecodeHtmlStr","decode","includes","results","work_info","doc","document","implementation","createHTMLDocument","body","innerHTML","XMLSerializer","serializeToString","replace","consoleLog","bind","consoleError","BookmarkType","storeFile","fontSizeNorm","fontSizeLarge","getLog","enableAppLog","Array","from","arguments","apply","disableAppLog","cbetardb","apiVersion","dilaDictApiUrl","twKaiFontKey","twKaiFontPath","topCatalogsByCat","topCatalogsByVol","fetchErrorContent","className","style","fontSize","paddingTop","href","target","updateApp","navigator","serviceWorker","getRegistrations","regs","all","reg","updateCssVars","scrollbarSize","documentElement","cssText","useFontKai","uiFontSize","isTouchDevice","isPlatform","fetchJuan","saveFileToIndexedDB","removeFileFromIndexedDB","removeElementsByClassName","elements","getElementsByClassName","length","parentNode","removeChild","Bookmark","type","CATALOG","selectedText","epubcfi","combineReducers","state","action","newSettings","Globals","key","val","setItem","stringify","oldBookmarks","some","bookmarksTemp","idxToDel","findIndex","deletedBookmarks","splice","deletedBookmark","noJuanBookmarkUseTheFile","JUAN","noWorkBookmarkUseTheFile","WORK","juans","split","i","vals","k","tmpSettings","newState","SpeechState","Catalog","n","nodeType","label","file","node_type","SearchAlert","cssClass","isOpen","props","showSearchAlert","header","subHeader","inputs","name","placeholder","buttons","text","role","handler","finish","value","history","push","name0","React","Component","_CatalogPage","fetchError","catalogs","pathLabel","isLoading","match","url","fetchData","params","path","setState","fetchTopCatalogs","topCatalogsType","obj","parentPath","topCatalogsByCatLabel","topCatalogs","forEach","catalog","paths","pop","join","dispatch","rows","index","routeLink","isHtmlNode","button","onClick","event","preventDefault","pathname","search","queryString","tabIndex","list","getRows","hidden","isTopCatalog","fill","slot","goBack","icon","arrowBack","newTopCatalogsType","color","refreshCircle","hasBookmark","delBookmarkHandler","addBookmarkHandler","tab","home","show","decodeURIComponent","window","location","shareSocial","textAlign","onDidDismiss","message","CatalogPage","withIonLifeCycle","connect","_WorkPage","showAddBookmarkDone","fetchWork","works","resToc","wc","saveJuans","isTopPage","newWorkListType","workListType","BY_CHAPTER","BY_JUAN","getRowsByChapter","getRowsByJuan","duration","WorkPage","loadTwKaiFont","fontData","fontFace","FontFace","load","fonts","add","WordType","_EPubViewPage","htmlTitle","book","rendition","epub","displayed","cfiRange","speechSynthesisUtterance","uuidStr","epubcfiFromUrl","epubcfiFromSelectedString","bookCreated","ePubIframe","searchTextRanges","showedSearchTextIndex","maxCharsPerUtterance","workTexts","workTextsIndex","currentPage","pageCount","showJumpPageAlert","showNoSelectedTextAlert","showAddBookmarkSuccess","showsCopyToClipboardSuccess","showsCitationFail","showSearchTextAlert","searchText","showSearchTextToast","showToast","toastMessage","popover","lookupDictPopover","speechState","UNINITIAL","SpeechSynthesisUtterance","lang","onend","speechSynthesis","speak","addEventListener","keyListener","logoArray","Uint8Array","origin","logoStr","require","writeFileSync","queryParams","loadEpubCoverToMemFs","getSelectedString","HTML","assign","cancel","destroy","paginated","prev","next","page","isNaN","Math","max","min","step","diff","abs","pageNext","pagePrev","keyCode","which","rtlVerticalLayout","buttonNext","buttonPrev","nodepub","series","sequence","author","fileAs","genre","tags","copyright","publisher","published","language","description","contents","source","images","htmlStrModifiedStyles","htmlStrWithCssJs","addSection","addCSS","getComputedStyle","getPropertyValue","showComments","writeEPUB","fs","tempEpubBuffer","readFileSync","ePub","buffer","openAs","renderTo","width","height","spread","flow","scrollbarWidth","defaultDirection","on","EVENTS","RENDITION","DISPLAYED","updatePageInfos","VIEWS","RENDERED","updateEPubIframe","display","annotations","highlight","locations","generate","iframes","getElementsByTagName","contentDocument","contentWindow","alert","currentLocation","start","total","sel","getSelection","rangeCount","getRangeAt","toString","removeAllRanges","remainingWorkText","selection","back","getElementById","s","setEnd","docFragment","cloneContents","Document","docHtml","createElement","appendChild","innerText","root","createTreeWalker","NodeFilter","SHOW_TEXT","node","cbetaHtmlBody","textNodesWalker","getAllTextNodes","visibleTextNodes","nextNode","parentElement","textContent","r","Range","setStart","lastVisiableTextNode","addRange","allTexts","searchTextIndexes","startIndex","searchTextIndex","indexOf","searchTextNodes","shift","visibleTextNode","c","offset","end","moveToSearchText","setTimeout","timer","range","focus","setInterval","clearInterval","startContainer","scrollIntoView","searchTextPrev","searchTextNext","parent","getAttribute","voices","getVoices","zhTwVoice","voice","workText","getRemainingWorkTextFromSelectedRange","ceil","substring","rate","speechRate","SPEAKING","PAUSE","resume","stopCircle","musicalNotes","nativeEvent","ios","ellipsisHorizontal","md","ellipsisVertical","print","startLine","findCbetaHtmlLine","endLine","endContainer","startLineMatches","exec","startLineModified","endLineModified","lineInfo","citation","clipboard","writeText","sharedUrl","navButtons","vertical","horizontal","opacity","onTouchStart","currentTarget","setProperty","onMouseOver","onTouchEnd","onMouseLeave","arrowForward","html2Epub","userSelect","WebkitUserSelect","jumpToPage","backdropDismiss","findSearchTextRanges","EPubViewPage","SettingsPage","showFontLicense","juansDownloadedRatio","showUpdateAllJuansDone","newBookmarks","newBookmark","updateIndex","workBookmarksWithHtml","filter","juanBookmarksWithHtml","juanBookmarksNotInWorkBookmarksWithHtml","wb","juansToDownload","juansDownloaded","bookmarkWithHtml","j","updateBookmark","newWork","PackageInfos","version","size","bug","checked","hasAppLog","onIonChange","isChecked","detail","encodeURIComponent","userAgent","download","settingsJsonUri","click","remove","accept","onChange","files","item","fileText","updateAllJuans","querySelector","colorPalette","theme","interface","interfaceOptions","classList","toggle","documentText","flexDirection","pin","snaps","toFixed","helpCircle","helpDoc","_BookmarkPage","bookmarkListRef","reorder","createRef","complete","side","current","closeSlidingItems","swapVertical","ref","disabled","onIonItemReorder","reorderBookmarks","paddingBottom","BookmarkPage","Search","creators","_SearchPage","searches","keyword","isCatalog","SearchPage","_DictionaryPage","searchBarRef","selectedTextBeforeIonPopover","lookupDict","dangerouslySetInnerHTML","__html","dict_name_zh","desc","onIonClear","onKeyUp","DictionaryPage","FullTextSearch","term_hits","ShareTextModal","qrcCanvas","qrcode","showModal","swipeToClose","onWillPresent","updateQrCode","alignItems","flexGrow","margin","_WordDictionaryPage","heteronyms","defs","d","def","quote","q","example","link","l","dictView","nouns","definitions","NOUN","verbs","VERB","others","nounsView","defToView","verbsView","othersView","bopomofo","pinyin","WordDictionaryPage","store","savedSettingsStr","createStore","reducer","getSavedStore","getState","setupConfig","mode","swipeBackEnabled","serviceWorkCallbacks","onSuccess","registration","onUpdate","_App","AppOrig","_AppOrig","registrationNew","wakeLock","showUpdateAlert","wakeLockScreen","onupgradeneeded","createObjectStore","request","routeMatches","queryMatches","query","to","innerHeight","animated","render","exact","component","FullTextSearchPage","routeByQueryString","library","onDidPresent","installing","postMessage","waiting","shareTextModal","App","withRouter","isLocalhost","Boolean","hostname","registerValidSW","swUrl","config","register","onupdatefound","installingWorker","onstatechange","controller","catch","ReactDOM","URL","process","fetch","headers","response","contentType","status","ready","unregister","reload","checkValidServiceWorker"],"mappings":"8lDAAA,IAAIA,EAAM,CACT,8BAA+B,CAC9B,IACA,GAED,uBAAwB,CACvB,IACA,GAED,uBAAwB,CACvB,IACA,GAED,0BAA2B,CAC1B,IACA,IAED,6BAA8B,CAC7B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,wBAAyB,CACxB,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,sBAAuB,CACtB,IACA,IAED,uBAAwB,CACvB,IACA,IAED,4BAA6B,CAC5B,IACA,IAED,uBAAwB,CACvB,IACA,IAED,qBAAsB,CACrB,IACA,IAED,mCAAoC,CACnC,IACA,IAED,uBAAwB,CACvB,IACA,IAED,+BAAgC,CAC/B,IACA,IAED,wBAAyB,CACxB,IACA,IAED,yBAA0B,CACzB,IACA,IAED,wBAAyB,CACxB,IACA,IAED,uBAAwB,CACvB,IACA,GAED,uBAAwB,CACvB,IACA,IAED,yBAA0B,CACzB,IACA,GAED,8BAA+B,CAC9B,IACA,IAED,yBAA0B,CACzB,IACA,IAED,uBAAwB,CACvB,IACA,IAED,6BAA8B,CAC7B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,+BAAgC,CAC/B,IACA,IAED,yBAA0B,CACzB,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,yBAA0B,CACzB,IACA,IAED,yBAA0B,CACzB,IACA,IAED,4BAA6B,CAC5B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,uBAAwB,CACvB,IACA,IAED,sBAAuB,CACtB,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,uBAAwB,CACvB,IACA,IAED,wBAAyB,CACxB,IACA,IAED,gCAAiC,CAChC,IACA,KAGF,SAASC,EAAoBC,GAC5B,IAAIC,EAAoBC,EAAEJ,EAAKE,GAC9B,OAAOG,QAAQC,UAAUC,MAAK,WAC7B,IAAIC,EAAI,IAAIC,MAAM,uBAAyBP,EAAM,KAEjD,MADAM,EAAEE,KAAO,mBACHF,KAIR,IAAIG,EAAMX,EAAIE,GAAMU,EAAKD,EAAI,GAC7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","file":"static/js/main.21405b19.chunk.js","sourcesContent":["var map = {\n\t\"./ion-action-sheet.entry.js\": [\n\t\t431,\n\t\t5\n\t],\n\t\"./ion-alert.entry.js\": [\n\t\t432,\n\t\t6\n\t],\n\t\"./ion-app_8.entry.js\": [\n\t\t433,\n\t\t7\n\t],\n\t\"./ion-avatar_3.entry.js\": [\n\t\t434,\n\t\t18\n\t],\n\t\"./ion-back-button.entry.js\": [\n\t\t435,\n\t\t19\n\t],\n\t\"./ion-backdrop.entry.js\": [\n\t\t436,\n\t\t43\n\t],\n\t\"./ion-button_2.entry.js\": [\n\t\t437,\n\t\t20\n\t],\n\t\"./ion-card_5.entry.js\": [\n\t\t438,\n\t\t21\n\t],\n\t\"./ion-checkbox.entry.js\": [\n\t\t439,\n\t\t22\n\t],\n\t\"./ion-chip.entry.js\": [\n\t\t440,\n\t\t23\n\t],\n\t\"./ion-col_3.entry.js\": [\n\t\t441,\n\t\t44\n\t],\n\t\"./ion-datetime_3.entry.js\": [\n\t\t442,\n\t\t10\n\t],\n\t\"./ion-fab_3.entry.js\": [\n\t\t443,\n\t\t24\n\t],\n\t\"./ion-img.entry.js\": [\n\t\t444,\n\t\t45\n\t],\n\t\"./ion-infinite-scroll_2.entry.js\": [\n\t\t445,\n\t\t46\n\t],\n\t\"./ion-input.entry.js\": [\n\t\t446,\n\t\t25\n\t],\n\t\"./ion-item-option_3.entry.js\": [\n\t\t447,\n\t\t26\n\t],\n\t\"./ion-item_8.entry.js\": [\n\t\t448,\n\t\t27\n\t],\n\t\"./ion-loading.entry.js\": [\n\t\t449,\n\t\t28\n\t],\n\t\"./ion-menu_3.entry.js\": [\n\t\t450,\n\t\t29\n\t],\n\t\"./ion-modal.entry.js\": [\n\t\t451,\n\t\t8\n\t],\n\t\"./ion-nav_2.entry.js\": [\n\t\t452,\n\t\t15\n\t],\n\t\"./ion-popover.entry.js\": [\n\t\t453,\n\t\t9\n\t],\n\t\"./ion-progress-bar.entry.js\": [\n\t\t454,\n\t\t30\n\t],\n\t\"./ion-radio_2.entry.js\": [\n\t\t455,\n\t\t31\n\t],\n\t\"./ion-range.entry.js\": [\n\t\t456,\n\t\t32\n\t],\n\t\"./ion-refresher_2.entry.js\": [\n\t\t457,\n\t\t11\n\t],\n\t\"./ion-reorder_2.entry.js\": [\n\t\t458,\n\t\t17\n\t],\n\t\"./ion-ripple-effect.entry.js\": [\n\t\t459,\n\t\t47\n\t],\n\t\"./ion-route_4.entry.js\": [\n\t\t460,\n\t\t33\n\t],\n\t\"./ion-searchbar.entry.js\": [\n\t\t461,\n\t\t34\n\t],\n\t\"./ion-segment_2.entry.js\": [\n\t\t462,\n\t\t35\n\t],\n\t\"./ion-select_3.entry.js\": [\n\t\t463,\n\t\t36\n\t],\n\t\"./ion-slide_2.entry.js\": [\n\t\t464,\n\t\t48\n\t],\n\t\"./ion-spinner.entry.js\": [\n\t\t465,\n\t\t13\n\t],\n\t\"./ion-split-pane.entry.js\": [\n\t\t466,\n\t\t49\n\t],\n\t\"./ion-tab-bar_2.entry.js\": [\n\t\t467,\n\t\t37\n\t],\n\t\"./ion-tab_2.entry.js\": [\n\t\t468,\n\t\t16\n\t],\n\t\"./ion-text.entry.js\": [\n\t\t469,\n\t\t38\n\t],\n\t\"./ion-textarea.entry.js\": [\n\t\t470,\n\t\t39\n\t],\n\t\"./ion-toast.entry.js\": [\n\t\t471,\n\t\t40\n\t],\n\t\"./ion-toggle.entry.js\": [\n\t\t472,\n\t\t12\n\t],\n\t\"./ion-virtual-scroll.entry.js\": [\n\t\t473,\n\t\t50\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 217;\nmodule.exports = webpackAsyncContext;","var map = {\n\t\"./ion-icon.entry.js\": [\n\t\t477,\n\t\t57\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 219;\nmodule.exports = webpackAsyncContext;","export enum WorkListType {\n    // Don't change the order! Otherwise, it breaks file compatibility!\n    BY_CHAPTER,\n    BY_JUAN,\n}\n\nexport class WorkChapter {\n    title: string;\n    juan: number;\n\n    constructor(json: any) {\n        this.title = json.title;\n        this.juan = json.juan;\n    }\n}\n\nexport class Work {\n    title: string;\n    juan: number;\n    juan_list: string;\n    mulu: WorkChapter[];\n    work: string;\n    vol: string;\n\n    constructor(json: any) {\n        this.title = json.title;\n        this.juan = json.juan;\n        this.juan_list = json.juan_list;\n        this.mulu = json.mulu;\n        this.work = json.work;\n        this.vol = json.vol;\n    }\n}\n","import axios from 'axios';\nimport { isPlatform, IonLabel } from '@ionic/react';\nimport React from 'react';\nimport { Work } from './models/Work';\nimport { Bookmark } from './models/Bookmark';\n\nconst apiVersion = 'v1.2';\nconst cbetaApiUrl = `https://cbdata.dila.edu.tw/${apiVersion}`;\nconst dilaDictApiUrl = `https://glossaries.dila.edu.tw/search.json`;\nconst cbetardb = 'cbetardb';\nconst twKaiFontKey = 'twKaoFont';\n/* Font source: https://data.gov.tw/dataset/5961 */\nconst twKaiFontPath = '/assets/TW-Kai-98_1.woff';\nlet log = '';\n\nconst axiosInstance = axios.create({\n  baseURL: cbetaApiUrl,\n  timeout: 3000,\n});\n\nfunction scrollbarSizeIdToValue(id: number) {\n  switch (id) {\n    case 0: return 0;\n    case 1: return 20;\n    case 2: return 40;\n  }\n}\n\nfunction getFileName(work: string, juan: string) {\n  return `${work}_juan${juan}.html`;\n}\n\nasync function getFileFromIndexedDB(fileName: string) {\n  const dbOpenReq = indexedDB.open(cbetardb);\n\n  return new Promise(function (ok, fail) {\n    dbOpenReq.onsuccess = async function (ev) {\n      const db = dbOpenReq.result;\n\n      const trans = db.transaction([\"store\"], 'readwrite');\n      let req = trans.objectStore('store').get(fileName);\n      req.onsuccess = async function (_ev) {\n        const data = req.result;\n        if (!data) {\n          console.error(`${fileName} loading failed!`);\n          console.error(new Error().stack);\n          return fail();\n        }\n        return ok(data);\n      };\n    };\n  });\n}\n\nasync function saveFileToIndexedDB(fileName: string, data: any) {\n  const dbOpenReq = indexedDB.open(cbetardb);\n  return new Promise((ok, fail) => {\n    dbOpenReq.onsuccess = async (ev: Event) => {\n      const db = dbOpenReq.result;\n\n      const transWrite = db.transaction([\"store\"], 'readwrite')\n      const reqWrite = transWrite.objectStore('store').put(data, fileName);\n      reqWrite.onsuccess = (_ev: any) => {\n        return ok();\n      };\n    };\n  });\n}\n\nasync function removeFileFromIndexedDB(fileName: string) {\n  const dbOpenReq = indexedDB.open(cbetardb);\n  return new Promise((ok, fail) => {\n    dbOpenReq.onsuccess = async (ev: Event) => {\n      const db = dbOpenReq.result;\n\n      const transWrite = db.transaction([\"store\"], 'readwrite')\n      const reqWrite = transWrite.objectStore('store').delete(fileName);\n      reqWrite.onsuccess = (_ev: any) => {\n        return ok();\n      };\n    };\n  });\n}\n\n// Fetch juan or HTML file.\nasync function fetchJuan(work: string, juan: string, htmlFile: string | null, update: boolean = false) {\n  const fileName = htmlFile || getFileName(work, juan);\n  let htmlStr: string | null = null;\n  try {\n    htmlStr = await getFileFromIndexedDB(fileName) as string;\n  } catch {\n    // Ignore file not found.\n  }\n  const settingsStr = localStorage.getItem('Settings.json')\n\n  let workInfo = new Work({});\n  let bookmark: Bookmark | undefined;\n  if (settingsStr) {\n    const bookmarks: Array<Bookmark> = (JSON.parse(settingsStr) as any).settings.bookmarks;\n    bookmark = bookmarks.find((b) => b.fileName === fileName || b.uuid === work);\n  }\n\n  if (htmlStr !== null && bookmark !== undefined && !update) {\n    workInfo = bookmark.work!;\n  } else {\n    if (htmlFile) {\n      const res = await axiosInstance.get(`/${htmlFile}`, {\n        responseType: 'arraybuffer',\n      });\n      let tryDecoder = new TextDecoder();\n      let tryDecodeHtmlStr = tryDecoder.decode(res.data);\n      if (tryDecodeHtmlStr.includes('charset=big5')) {\n        htmlStr = new TextDecoder('big5').decode(res.data);\n      } else {\n        htmlStr = tryDecodeHtmlStr;\n      }\n    } else {\n      const res = await axiosInstance.get(`/juans?edition=CBETA&work_info=1&work=${work}&juan=${juan}`, {\n        responseType: 'arraybuffer',\n      });\n      let data = JSON.parse(new TextDecoder().decode(res.data));\n      htmlStr = data.results[0];\n      workInfo = data.work_info;\n    }\n\n    // Convert HTML to XML, because ePub requires XHTML.\n    // Bad structured HTML will cause DOMParser parse error on some browsers!\n    let doc = document.implementation.createHTMLDocument(\"\");\n    doc.body.innerHTML = htmlStr!;\n    htmlStr = new XMLSerializer().serializeToString(doc.body);\n    // Remove body tag.\n    htmlStr = htmlStr.replace('<body', '<div');\n    htmlStr = htmlStr.replace('/body>', '/div>');\n  }\n  return { htmlStr, workInfo };\n}\n\nfunction removeElementsByClassName(doc: Document, className: string) {\n  let elements = doc.getElementsByClassName(className);\n  while (elements.length > 0) {\n    elements[0].parentNode?.removeChild(elements[0]);\n  }\n}\n\nconst consoleLog = console.log.bind(console);\nconst consoleError = console.error.bind(console);\n\nfunction getLog() {\n  return log;\n}\n\nfunction enableAppLog() {\n  console.log = function () {\n    log += '----- Info ----\\n';\n    log += (Array.from(arguments)) + '\\n';\n    consoleLog.apply(console, arguments as any);\n  };\n\n  console.error = function () {\n    log += '----- Error ----\\n';\n    log += (Array.from(arguments)) + '\\n';\n    consoleError.apply(console, arguments as any);\n  };\n}\n\nfunction disableAppLog() {\n  log = '';\n  console.log = consoleLog;\n  console.error = consoleError;\n}\n\nexport default {\n  storeFile: 'Settings.json',\n  fontSizeNorm: 24,\n  fontSizeLarge: 48,\n  getLog,\n  enableAppLog,\n  disableAppLog,\n  cbetardb,\n  apiVersion,\n  cbetaApiUrl,\n  dilaDictApiUrl,\n  twKaiFontKey,\n  twKaiFontPath,\n  axiosInstance,\n  topCatalogsByCat: {\n    \"CBETA\": \"CBETA \",\n    \"Cat-T\": \"\",\n    \"Cat-X\": \"\",\n    \"Cat-N\": \"\",\n    \"others\": \"\",\n    \"modern\": \"\",\n  } as Record<string, string>,\n  topCatalogsByVol: {\n    \"Vol-T\": \"T \",\n    \"Vol-X\": \"X \",\n    \"Vol-A\": \"A \",\n    \"Vol-K\": \"K -\",\n    \"Vol-S\": \"S -\",\n    \"Vol-F\": \"F \",\n    \"Vol-C\": \"C -\",\n    \"Vol-U\": \"U \",\n    \"Vol-P\": \"P \",\n    \"Vol-J\": \"J \",\n    \"Vol-L\": \"L -\",\n    \"Vol-G\": \"G \",\n    \"Vol-M\": \"M -\",\n    \"Vol-D\": \"D \",\n    \"Vol-N\": \"N ()\",\n    \"Vol-ZS\": \"ZS \",\n    \"Vol-I\": \"I \",\n    \"Vol-ZW\": \"ZW \",\n    \"Vol-B\": \"B \",\n    \"Vol-GA\": \"GA \",\n    \"Vol-GB\": \"GB \",\n    \"Vol-Y\": \"Y \",\n    \"Vol-LC\": \"LC \",\n  } as Record<string, string>,\n  fetchErrorContent: (\n    <IonLabel className='contentCenter'>\n      <div>\n        <div>!</div>\n        <div style={{ fontSize: 'var(--ui-font-size)', paddingTop: 24 }}><a href=\"/settings\" target=\"_self\"></a>app</div>\n      </div>\n    </IonLabel>),\n  updateApp: () => {\n    navigator.serviceWorker.getRegistrations().then(regs => {\n      return Promise.all(regs.map(reg => reg.update()));\n    });\n  },\n  scrollbarSizeIdToValue,\n  updateCssVars: (settings: any) => {\n    let scrollbarSize = scrollbarSizeIdToValue(settings.scrollbarSize);\n    document.documentElement.style.cssText = `--ion-font-family: ${settings.useFontKai ? 'Heiti, Times, Kai' : 'Times, Heiti'};\n        --scrollbar-size: ${scrollbarSize}px; --ui-font-size: ${settings.uiFontSize}px; --text-font-size: ${settings.fontSize}px`\n  },\n  isTouchDevice: () => {\n    return isPlatform('ios') || isPlatform('android');\n  },\n  fetchJuan,\n  getFileName,\n  getFileFromIndexedDB,\n  saveFileToIndexedDB,\n  removeFileFromIndexedDB,\n  removeElementsByClassName,\n};\n","import { Work } from \"./Work\";\n\nexport enum BookmarkType {\n    // Don't change the order! Otherwise, it breaks file compatibility!\n    CATALOG,\n    WORK,\n    JUAN,\n    HTML,\n}\n\nexport class Bookmark {\n    type: BookmarkType = BookmarkType.CATALOG;\n    uuid: string = '';\n    work: Work | null | undefined = null;\n    selectedText: string = '';\n    epubcfi: string = '';\n    fileName: string = '';\n\n    constructor(json: Bookmark) {\n        this.type = json.type;\n        this.uuid = json.uuid;\n        this.work = json.work;\n        this.selectedText = json.selectedText;\n        this.epubcfi = json.epubcfi;\n        this.fileName = json.fileName;\n    }\n}\n","import { combineReducers } from \"redux\"\n\nimport settings from \"./setReducer\"\nimport tmpSettings from \"./tmpSetReducer\"\n\nexport default combineReducers({\n  settings, tmpSettings\n})\n","import Globals from '../../Globals';\nimport { Bookmark, BookmarkType } from '../../models/Bookmark';\n\n// Used to store settings. They will be saved to file.\nexport default function reducer(state = {\n}, action: any) {\n  var newSettings = { ...state } as any;\n  switch (action.type) {\n    case \"LOAD_SETTINGS\":\n      newSettings = JSON.parse(localStorage.getItem(Globals.storeFile)!).settings;\n      break;\n    case \"SET_KEY_VAL\":\n      var key = action.key;\n      var val = action.val;\n      newSettings[key] = val;\n      localStorage.setItem(Globals.storeFile, JSON.stringify({ settings: newSettings }));\n      break;\n    case \"ADD_BOOKMARK\":\n      const oldBookmarks = newSettings.bookmarks as [Bookmark];\n      let fileName = action.bookmark.fileName;\n      if (fileName !== null && fileName !== '' &&\n        !oldBookmarks.some((bookmark: Bookmark) => bookmark.fileName === fileName)\n      ) {\n        Globals.saveFileToIndexedDB(fileName, action.htmlStr);\n      }\n      newSettings.bookmarks = [...newSettings.bookmarks, action.bookmark];\n      localStorage.setItem(Globals.storeFile, JSON.stringify({ settings: newSettings }));\n      break;\n    case \"DEL_BOOKMARK\":\n      let bookmarksTemp = newSettings.bookmarks as [Bookmark];\n      const idxToDel = bookmarksTemp.findIndex((b) => { return b.uuid === action.uuid });\n      if (idxToDel !== -1) {\n        let deletedBookmarks = bookmarksTemp.splice(idxToDel, 1);\n\n        if (deletedBookmarks.length === 1) {\n          // Remove the HTML file from localStorage if all its bookmarks are deleted.\n          const deletedBookmark = deletedBookmarks[0];\n          let fileName = deletedBookmark.fileName;\n          let noJuanBookmarkUseTheFile = bookmarksTemp.find((b) => b.type === BookmarkType.JUAN && b.uuid === deletedBookmark.uuid) == null;\n          let noWorkBookmarkUseTheFile = bookmarksTemp.find((b) => b.type === BookmarkType.WORK && b.work?.work === deletedBookmark.work?.work) == null;\n          if (noWorkBookmarkUseTheFile) {\n            switch (deletedBookmark.type) {\n              case BookmarkType.WORK:\n                const work = deletedBookmark.work!;\n                // For back compatibility.\n                if (work == null) {\n                  break;\n                }\n                const juans = work.juan_list.split(',');\n                for (let i = 0; i < juans.length; i++) {\n                  const fileName = Globals.getFileName(work.work, juans[i]);\n                  noJuanBookmarkUseTheFile = bookmarksTemp.find((b) => b.type === BookmarkType.JUAN && b.fileName === fileName) == null;\n                  if (noJuanBookmarkUseTheFile) {\n                    Globals.removeFileFromIndexedDB(fileName);\n                  }\n                }\n                break;\n              case BookmarkType.JUAN:\n                if (noJuanBookmarkUseTheFile)\n                  Globals.removeFileFromIndexedDB(fileName);\n                break;\n            }\n          }\n        }\n      }\n      newSettings.bookmarks = [...bookmarksTemp];\n      localStorage.setItem(Globals.storeFile, JSON.stringify({ settings: newSettings }));\n      break;\n    case \"UPDATE_BOOKMARKS\": {\n      newSettings.bookmarks = action.bookmarks;\n      localStorage.setItem(Globals.storeFile, JSON.stringify({ settings: newSettings }));\n      break;\n    }\n    default:\n      if (Object.keys(newSettings).length === 0) {\n        newSettings = {};\n      }\n      // Setting default values.\n      // version is the setting file version.\n      var keys = ['version', 'topCatalogsType', 'hasAppLog', 'theme', 'paginated', 'rtlVerticalLayout', 'scrollbarSize', 'useFontKai', 'fontSize', 'uiFontSize', 'showComments', 'speechRate', 'bookmarks'];\n      var vals = [1, 0, 1, 0, 1, 1, 2, 1, 32, 24, 0, 0.8, []];\n      for (let k = 0; k < keys.length; k++) {\n        if (newSettings[keys[k]] === undefined) {\n          newSettings[keys[k]] = vals[k];\n        }\n      }\n  }\n  return newSettings;\n}\n","// Used to store temp settings in RAM. They will not be saved to file.\nexport default function reducer(state = {\n}, action: any) {\n  var newState = { ...state } as any;\n  var key = action.key;\n  var val = action.val;\n  newState[key] = val;\n  switch (action.type) {\n    case \"TMP_SET_KEY_VAL\": {\n      return newState;\n    }\n    default:\n      break;\n  }\n  return state;\n}\n","//import * as fs from 'fs';\nimport React from 'react';\nimport { IonContent, IonHeader, IonPage, IonTitle, IonToolbar, IonButton, withIonLifeCycle, IonIcon, IonAlert, IonPopover, IonList, IonItem, IonLabel, IonFab, IonFabButton, IonToast, IonLoading } from '@ionic/react';\nimport { RouteComponentProps } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport * as uuid from 'uuid';\nimport queryString from 'query-string';\nimport './EPubViewPage.css';\nimport Globals from '../Globals';\nimport { bookmark, arrowBack, home, search, ellipsisHorizontal, ellipsisVertical, arrowForward, musicalNotes, stopCircle, book, shareSocial, print, refreshCircle } from 'ionicons/icons';\nimport { Bookmark, BookmarkType } from '../models/Bookmark';\nimport { Work } from '../models/Work';\nimport SearchAlert from '../components/SearchAlert';\nimport ePub, { Book, Rendition, EVENTS } from 'epubjs-myh';\nimport * as nodepub from 'nodepub';\n\n// Load TW-Kai font in iframe.\nasync function loadTwKaiFont(this: any) {\n  const fontData = await Globals.getFileFromIndexedDB(Globals.twKaiFontKey);\n  const fontFace = new (window as any).FontFace('Kai', fontData);\n  await fontFace.load();\n  (this.document as any).fonts.add(fontFace);\n}\n\ninterface Props {\n  dispatch: Function;\n  bookmarks: [Bookmark];\n  fontSize: number;\n  scrollbarSize: number;\n  settings: any;\n  showComments: boolean;\n  paginated: boolean;\n  rtlVerticalLayout: boolean;\n  useFontKai: boolean;\n  speechRate: number;\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n  tab: string;\n  work: string;\n  path: string;\n  label: string;\n}> { }\n\nenum SpeechState {\n  UNINITIAL,\n  SPEAKING,\n  PAUSE\n}\n\ninterface State {\n  isLoading: boolean;\n  fetchError: boolean;\n  workInfo: Work;\n  htmlStr: string | null;\n  currentPage: number;\n  pageCount: number;\n  showJumpPageAlert: boolean;\n  showNoSelectedTextAlert: boolean;\n  searchText: string;\n  showSearchTextToast: boolean;\n  showAddBookmarkSuccess: boolean;\n  showsCopyToClipboardSuccess: boolean;\n  showsCitationFail: boolean;\n  showSearchTextAlert: boolean;\n  showToast: boolean;\n  toastMessage: string;\n  showSearchAlert: boolean;\n  popover: any;\n  lookupDictPopover: any;\n  speechState: SpeechState;\n}\n\nclass _EPubViewPage extends React.Component<PageProps, State> {\n  htmlFile: string;\n  htmlTitle: string;\n  book: Book | null;\n  rendition: Rendition | null;\n  epub: any;\n  displayed: any;\n  cfiRange: string;\n  speechSynthesisUtterance: SpeechSynthesisUtterance;\n\n  constructor(props: any) {\n    super(props);\n    this.state = {\n      isLoading: false,\n      fetchError: false,\n      workInfo: new Work({}),\n      htmlStr: null,\n      currentPage: 1,\n      pageCount: 1,\n      showJumpPageAlert: false,\n      showNoSelectedTextAlert: false,\n      showAddBookmarkSuccess: false,\n      showsCopyToClipboardSuccess: false,\n      showsCitationFail: false,\n      showSearchTextAlert: false,\n      searchText: '',\n      showSearchTextToast: false,\n      showToast: false,\n      toastMessage: '',\n      showSearchAlert: false,\n      popover: {\n        show: false,\n        event: null,\n      },\n      lookupDictPopover: {\n        show: false,\n        data: [],\n      },\n      speechState: SpeechState.UNINITIAL,\n    }\n    this.htmlFile = '';\n    this.htmlTitle = '';\n    this.book = null;\n    this.rendition = null;\n    this.cfiRange = '';\n    this.speechSynthesisUtterance = new SpeechSynthesisUtterance();\n    this.speechSynthesisUtterance.lang = 'zh-TW';\n    this.speechSynthesisUtterance.onend = (ev: SpeechSynthesisEvent) => {\n      if (this.state.speechState === SpeechState.UNINITIAL) {\n        return;\n      }\n\n      if (this.workTextsIndex < this.workTexts.length - 1) {\n        this.workTextsIndex += 1;\n        this.speechSynthesisUtterance.text = this.workTexts[this.workTextsIndex];\n        speechSynthesis.speak(this.speechSynthesisUtterance);\n        console.log(`Play work text to speech part: ${this.workTextsIndex}`);\n      } else {\n        this.setState({ speechState: SpeechState.UNINITIAL });\n        console.log(`Stop work text to speech.`);\n      }\n    };\n    document.addEventListener(\"keyup\", this.keyListener.bind(this), false);\n  }\n\n  async loadEpubCoverToMemFs() {\n    let logoArray = new Uint8Array(JSON.parse(localStorage.getItem('logo.png') || '[]'));\n\n    if (logoArray.length === 0) {\n      // Download book logo.\n      const res = await Globals.axiosInstance.get(`${window.location.origin}/assets/icon/icon.png`, {\n        responseType: 'arraybuffer',\n      });\n      logoArray = new Uint8Array(res.data);\n      let logoStr = JSON.stringify(Array.from(logoArray));\n      localStorage.setItem('logo.png', logoStr);\n    }\n    let fs = require('fs');\n    fs.writeFileSync('logo.png', logoArray);\n  }\n\n  uuidStr = '';\n  epubcfiFromUrl = '';\n  ionViewWillEnter() {\n    let queryParams = queryString.parse(this.props.location.search) as any;\n    this.htmlFile = queryParams.file;\n    this.htmlTitle = queryParams.title;\n    this.epubcfiFromUrl = queryParams.bookmark || '';\n    let state = this.props.location.state as any;\n    this.uuidStr = state ? state.uuid : '';\n    //console.log( 'view will enter' );\n    this.fetchData();\n  }\n\n  ionViewDidEnter() {\n  }\n\n  get fileName() {\n    return Globals.getFileName(\n      this.props.match.params.work,\n      this.props.match.params.path\n    );\n  }\n\n  async fetchData() {\n    this.setState({ isLoading: true });\n    try {\n      const res = await Globals.fetchJuan(\n        this.props.match.params.work,\n        this.props.match.params.path,\n        this.htmlFile,\n      );\n\n      await this.loadEpubCoverToMemFs();\n\n      // isLoading shall consider the epub.js loading time, thus disable it here.\n      this.setState({ /*isLoading: false, */fetchError: false, workInfo: res.workInfo, htmlStr: res.htmlStr });\n    } catch (e) {\n      console.error(e);\n      console.error(new Error().stack);\n      this.setState({ isLoading: false, fetchError: true });\n    }\n  }\n\n  epubcfiFromSelectedString = '';\n  addBookmarkHandler() {\n    const selectedText = this.getSelectedString();\n    if (selectedText === '') {\n      this.setState({ showNoSelectedTextAlert: true });\n      return;\n    }\n\n    let uuidStr = uuid.v4();\n    this.props.dispatch({\n      type: \"ADD_BOOKMARK\",\n      // IMPORTANT!!! Don't arbitrarily change the HTML structure of htmlStr.\n      // Otherwise, saved epubcfi bookmarks will become invalid!\n      htmlStr: this.state.htmlStr,\n      bookmark: new Bookmark({\n        type: this.htmlFile ? BookmarkType.HTML : BookmarkType.JUAN,\n        uuid: uuidStr,\n        selectedText: selectedText,\n        epubcfi: this.epubcfiFromSelectedString,\n        fileName: this.htmlFile || `${this.props.match.params.work}_juan${this.props.match.params.path}.html`,\n        work: Object.assign(this.state.workInfo, {\n          title: this.htmlFile ? this.htmlTitle : this.state.workInfo.title,\n          juan: this.props.match.params.path,\n        }\n        ),\n      }),\n    });\n    this.setState({ showAddBookmarkSuccess: true });\n    return;\n  }\n\n  get isTopPage() {\n    return this.props.match.url === '/catalog';\n  }\n\n  get bookmark() {\n    return this.props.bookmarks.find(\n      (e) => e.type === BookmarkType.JUAN && e.uuid === this.uuidStr);\n  }\n\n  get hasBookmark() {\n    return this.epubcfiFromUrl !== '' || this.bookmark != null;\n  }\n\n  get epubcfi() {\n    return this.epubcfiFromUrl !== '' ? this.epubcfiFromUrl : this.bookmark != null ? this.bookmark!.epubcfi : 'epubcfi(/6/6[s1]!/4/4/2/6[body]/6,/1:0,/1:1)';\n  }\n\n  ionViewWillLeave() {\n    speechSynthesis.cancel();\n    this.setState({ htmlStr: null, currentPage: 1, speechState: SpeechState.UNINITIAL, showSearchTextToast: false });\n    this.book?.destroy();\n    this.book = null;\n    this.bookCreated = false;\n  }\n\n  pagePrev(n: number = 1) {\n    if (this.props.paginated && this.state.currentPage > 1) {\n      this.rendition?.prev(n);\n      this.setState({ currentPage: this.state.currentPage - n });\n    }\n  }\n\n  pageNext(n: number = 1) {\n    if (this.props.paginated && this.state.currentPage < this.state.pageCount) {\n      this.rendition?.next(n);\n      this.setState({ currentPage: this.state.currentPage + n });\n    }\n  }\n\n  jumpToPage(page: number) {\n    if (page === 0) {\n      return;\n    }\n    page = isNaN(page) ? 1 : Math.max(Math.min(this.state.pageCount, page), 1);\n    const currentPage = this.state.currentPage;\n    let step = currentPage < page ? 1 : -1;\n    let diff = Math.abs(page - currentPage);\n    if (step === 1) {\n      this.pageNext(diff);\n    } else {\n      this.pagePrev(diff);\n    }\n  }\n\n  keyListener(e: KeyboardEvent) {\n    let key = e.keyCode || e.which;\n\n    console.log(e.type)\n\n    // Left/down Key\n    if (key === (this.props.rtlVerticalLayout ? 37 : 40)) {\n      this.buttonNext()\n    }\n\n    // Right/top Key\n    if (key === (this.props.rtlVerticalLayout ? 39 : 38)) {\n      this.buttonPrev();\n    }\n  };\n\n  bookCreated = false;\n  ePubIframe: HTMLIFrameElement | null = null;\n  async html2Epub() {\n    this.bookCreated = true;\n    this.epub = nodepub.document({\n      id: '123-123456789',\n      title: 'Title',\n      series: '',\n      sequence: 1,\n      author: 'Author',\n      fileAs: '',\n      genre: 'genre',\n      tags: '',\n      copyright: '',\n      publisher: '',\n      published: '',\n      language: 'en',\n      description: 'A temp book.',\n      contents: this.state.workInfo.title,\n      source: '',\n      images: ['logo.png'],\n    }, 'logo.png');\n\n    let htmlStrModifiedStyles = this.state.htmlStr!;\n    if (this.props.rtlVerticalLayout) {\n      htmlStrModifiedStyles = htmlStrModifiedStyles.replace(/margin-left/g, 'margin-top');\n    }\n    /* else {\n      htmlStrModifiedStyles = htmlStrModifiedStyles.replace(/margin-top/g, 'margin-left');\n    }*/\n\n    const htmlStrWithCssJs = htmlStrModifiedStyles + `\n    <script>\n    </script>\n    `;\n\n    this.epub.addSection('', htmlStrWithCssJs, true, false);\n\n    let rtlVerticalStyles = `\n    html {\n      writing-mode: vertical-rl;\n      direction: ltr;\n    }\n    `;\n\n    this.epub.addCSS(`\n    @page {\n      size: A4;\n      margin: 0.5in;\n    }\n\n    @page :left {\n      margin-right: 1in;\n    }\n\n    @page :right {\n      margin-left: 1in;\n    }\n\n    @media print {\n      body {\n        color: black !important;\n        background: white !important;\n        padding: 0 !important;\n        width: 100% !important;\n        height: 100% !important;\n        column-gap: unset !important;\n        column-width: unset !important;\n      }\n    }\n\n    html {\n      /*\n      Because different fonts have different line heights with 'line-height: normal,'\n      the content size of epubjs iframe changes after the fallback font is swapped with the web font.\n      Unfortunately, epubjs can't detect the size change and update the iframe.\n      This problem causes the total page count is incorrect.\n      Fortunately, we can set the line height based on the same font size as below.\n      */\n      line-height: 1.2;\n    }\n\n    body {\n      color: ${getComputedStyle(document.body).getPropertyValue('--ion-text-color')};\n      background: ${getComputedStyle(document.body).getPropertyValue('--ion-background-color')};\n    }\n\n    @font-face {\n        font-family: 'Times';\n        src: local('Times New Roman');\n        unicode-range: U+0-007F;\n    }\n\n    /* Workaround parenthesis orientation problem of TW-Kai-98_1 on iOS Safari. */\n    @font-face {\n        font-family: 'Heiti';\n        src: local('Heiti TC');\n        unicode-range: U+3008-301B, U+FF01-FF60;\n    }\n\n    .lb {\n      display: none\n    }\n\n    /* In-HTML anchor jumps don't update this.state.currentPage.\n    Thus, we disable them. */\n    .noteAnchor {\n      pointer-events: none;\n      text-decoration: inherit;\n      color: inherit;\n      cursor: auto;\n    }\n\n    .doube-line-note, .doube-line-note .t {\n      font-size: ${this.props.fontSize * 0.8}px;\n    }\n\n    .doube-line-note::before {\n      content: \"\";\n    }\n\n    .doube-line-note::after {\n      content: \"\";\n    }\n\n    .bip-table {\n      display: table;\n    }\n\n    .bip-table-row {\n      display: table-row;\n    }\n\n    .bip-table-cell {\n      display: table-cell;\n      border: 1px solid ${getComputedStyle(document.body).getPropertyValue('--ion-text-color')};\n      text-align: center;\n    }\n  \n    ${this.props.rtlVerticalLayout ? rtlVerticalStyles : ''}\n\n    .t, p, div {\n      font-family: ${getComputedStyle(document.body).getPropertyValue('--ion-font-family')};\n      font-size: ${this.props.fontSize}px;\n    }\n    \n    #back, #cbeta-copyright {\n      display: ${this.props.showComments ? \"block\" : \"none\"};\n    }\n    `);\n    //await new Promise((ok, fail) => {\n    this.epub.writeEPUB(\n      (e: any) => {\n        console.log(`Error: ${e}`);\n      },\n      '.', 'temp',\n      async () => {\n        let fs = require('fs');\n        let tempEpubBuffer = fs.readFileSync('temp.epub');\n        this.book = ePub(tempEpubBuffer.buffer, {\n          openAs: 'binary',\n        });\n        this.rendition = this.book.renderTo('cbetarEPubView', {\n          width: \"100%\", height: \"100%\",\n          spread: 'none',\n          flow: this.props.paginated ? 'paginated' : 'scrolled',\n          scrollbarWidth: Globals.scrollbarSizeIdToValue(this.props.scrollbarSize),\n          defaultDirection: this.props.rtlVerticalLayout ? 'rtl' : 'ltr',\n        });\n        //this.rendition.on(\"keyup\", this.keyListener.bind(this));\n\n        this.rendition.on(\"selected\", (cfiRange: any, contents: any) => {\n          this.epubcfiFromSelectedString = cfiRange;\n          /*\n          this.rendition?.annotations.highlight(cfiRange, {}, (e: any) => {\n            console.log(\"highlight clicked\", e.target);\n          });*/\n          //contents.window.getSelection().removeAllRanges();\n        });\n\n        this.rendition.on(EVENTS.RENDITION.DISPLAYED, () => {\n          this.updatePageInfos();\n        });\n\n        this.rendition.on(EVENTS.VIEWS.RENDERED, () => {\n          this.updateEPubIframe();\n        });\n\n        await this.rendition.display(this.props.paginated ? this.epubcfi : undefined);\n        // Navigate to the first work page.\n        if (!this.props.paginated) {\n          // Skip cover page.\n          await this.rendition?.next();\n          // Skip TOC page.\n          await this.rendition?.next();\n          this.updateEPubIframe();\n        }\n        this.setState({ isLoading: false });\n\n        if (this.hasBookmark) {\n          try {\n            this.rendition?.annotations.highlight(this.epubcfi);\n          } catch (e) {\n            console.error(e);\n          }\n        }\n\n        this.book?.locations.generate(150);\n      }\n    );\n  }\n\n  updateEPubIframe() {\n    const iframes = document.getElementsByTagName('iframe');\n    if (iframes.length === 1) {\n      this.ePubIframe = iframes[0];\n      this.ePubIframe.contentDocument?.addEventListener('keyup', this.keyListener.bind(this), false);\n      (this.ePubIframe!.contentWindow! as any).loadTwKaiFont = loadTwKaiFont;\n      (this.ePubIframe!.contentWindow! as any).loadTwKaiFont();\n      /*\n      this.ePubIframe.contentWindow?.addEventListener('unload', () => {\n        console.log('iframe unloaded!');\n        this.ePubIframe?.contentDocument?.removeEventListener('keyup', this.keyListener.bind(this), false);\n      });*/\n    } else if (iframes.length > 1) {\n      alert('Error! This component locates ePub iframe by the only iframe.');\n    } else {\n      console.error('ePub iframes count is 0.');\n    }\n  }\n\n  updatePageInfos() {\n    const displayed = (this.rendition?.currentLocation() as any).start.displayed;\n    this.setState({ currentPage: displayed.page, pageCount: displayed.total });\n  }\n\n  getSelectedString() {\n    let selectedText = '';\n    const sel = this.ePubIframe?.contentDocument?.getSelection();\n    if ((sel?.rangeCount || 0) > 0 && sel!.getRangeAt(0).toString().length > 0) {\n      selectedText = sel!.toString();\n      sel?.removeAllRanges();\n    }\n    return selectedText;\n  }\n\n  getRemainingWorkTextFromSelectedRange() {\n    let selection = this.ePubIframe!.contentWindow!.getSelection();\n    let remainingWorkText;\n\n    if (selection!.type === 'Range') {\n      const back = this.ePubIframe!.contentDocument!.getElementById('back')!;\n      let s = selection!.getRangeAt(0);\n      // Get a range from selected texts to end of id='body' (start of id='back').\n      s.setEnd(back, 0);\n      // Get document fragment containing the range.\n      let docFragment = s.cloneContents();\n      selection?.removeAllRanges();\n\n      // For manipulate content of docFragment laterly.\n      let doc = new Document();\n      let docHtml = doc.createElement('html')\n      doc.appendChild(docHtml);\n      docHtml.appendChild(docFragment);\n\n      // Remove texts being not part of speech including line number and note texts in work texts.\n      Globals.removeElementsByClassName(doc, 'lb');\n      Globals.removeElementsByClassName(doc, 'doube-line-note');\n      remainingWorkText = doc.getElementById('body')!.innerText;\n    }\n\n    return remainingWorkText;\n  }\n\n  getAllTextNodes(root: any) {\n    const walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT);\n    return walker;\n  }\n\n  searchTextRanges: Array<Range> = [];\n\n  findSearchTextRanges(searchText: string) {\n    this.searchTextRanges = [];\n    this.showedSearchTextIndex = 0;\n    const cbetaHtmlBody = this.ePubIframe!.contentDocument!.getElementById('body');\n    const sel = this.ePubIframe!.contentWindow!.getSelection()!;\n    const textNodesWalker = this.getAllTextNodes(cbetaHtmlBody);\n    let visibleTextNodes: Array<Node> = [];\n\n    let node;\n    while ((node = textNodesWalker.nextNode()) != null) {\n      if (node.parentElement?.className === 'lb' || node.textContent?.replace(/[\\r\\n\\t ]*/g, '') === '') {\n        continue;\n      }\n\n      visibleTextNodes.push(node);\n    }\n\n    const r = new Range();\n    r.setStart(visibleTextNodes[0], 0);\n    const lastVisiableTextNode = visibleTextNodes[visibleTextNodes.length - 1] as any;\n    r.setEnd(lastVisiableTextNode, lastVisiableTextNode.length);\n    sel.removeAllRanges();\n    sel.addRange(r);\n    const allTexts = sel.toString().replace(/[\\n]/g, '');\n    sel.removeAllRanges();\n\n    let searchTextIndexes: Array<number> = []\n\n    let startIndex = 0;\n    let searchTextIndex = 1;\n    do {\n      searchTextIndex = allTexts.indexOf(searchText, startIndex);\n      if (searchTextIndex === -1) {\n        break;\n      }\n      startIndex = searchTextIndex + searchText.length;\n      searchTextIndexes.push(searchTextIndex);\n      searchTextIndexes.push(searchTextIndex + searchText.length);\n    } while (searchTextIndex < allTexts.length - 1);\n\n    if (searchTextIndexes.length === 0) {\n      return;\n    }\n\n    let searchTextNodes: Array<any> = [];\n    let i = 0;\n    searchTextIndex = searchTextIndexes.shift()!;\n    for (let n = 0; n < visibleTextNodes.length; n++) {\n      const visibleTextNode = visibleTextNodes[n];\n      for (let c = 0; c < (visibleTextNode as any).length; c++) {\n        if (i === searchTextIndex) {\n          searchTextNodes.push({ node: visibleTextNode, offset: c });\n          searchTextIndex = searchTextIndexes.shift() || -1;\n\n          if (searchTextIndex === -1) {\n            break;\n          }\n        }\n        i++;\n      }\n\n      if (searchTextIndex === -1) {\n        break;\n      }\n    }\n\n    for (let i = 0; i < searchTextNodes.length / 2; i += 1) {\n      const r = new Range();\n      let start = searchTextNodes[i * 2];\n      let end = searchTextNodes[i * 2 + 1];\n      r.setStart(start.node, start.offset);\n      r.setEnd(end.node, end.offset);\n      this.searchTextRanges.push(r);\n    }\n  }\n\n  showedSearchTextIndex = 0;\n  searchTextPrev() {\n    if (this.showedSearchTextIndex > 0) {\n      this.showedSearchTextIndex--;\n    }\n    this.moveToSearchText(this.showedSearchTextIndex);\n  }\n\n  searchTextNext() {\n    if (this.showedSearchTextIndex < this.searchTextRanges.length - 1) {\n      this.showedSearchTextIndex++;\n    }\n    this.moveToSearchText(this.showedSearchTextIndex);\n  }\n\n  moveToSearchText(index: number) {\n    this.epubcfiFromSelectedString = '';\n    const sel = this.ePubIframe!.contentWindow!.getSelection()!;\n    sel.removeAllRanges();\n\n    setTimeout(() => {\n      const range = this.searchTextRanges[index];\n      this.ePubIframe!.contentWindow!.focus();\n      sel.addRange(range);\n\n      if (this.props.paginated) {\n        let timer: any;\n        timer = setInterval(() => {\n          if (this.epubcfiFromSelectedString !== '') {\n            clearInterval(timer);\n            this.rendition?.display(this.epubcfiFromSelectedString).then(() => {\n            });\n          }\n        }, 100);\n      } else {\n        range.startContainer.parentElement?.scrollIntoView();\n      }\n    }, 100);\n  }\n\n  buttonPrev() {\n    if (this.state.showSearchTextToast) {\n      this.searchTextPrev();\n    } else {\n      this.pagePrev();\n    }\n  }\n\n  buttonNext() {\n    if (this.state.showSearchTextToast) {\n      this.searchTextNext();\n    } else {\n      this.pageNext();\n    }\n  }\n\n  findCbetaHtmlLine(node: Node) {\n    let parent: HTMLElement | null | undefined = node.parentElement;\n    do {\n      if (parent?.getAttribute('l')) {\n        break;\n      }\n    } while ((parent = parent?.parentElement));\n    return parent;\n  }\n\n  // There is a max characters per utterance limit on Android Chrome.\n  // This max value is obtained by try and error.\n  maxCharsPerUtterance = 1000;\n  workTexts: Array<string> = [];\n  workTextsIndex = 0;\n  render() {\n    let header = (\n      <IonHeader>\n        <IonToolbar>\n          <IonTitle style={{ fontSize: 'var(--ui-font-size)' }}></IonTitle>\n\n          <IonButton hidden={this.isTopPage} fill=\"clear\" slot='start' onClick={e => this.props.history.goBack()}>\n            <IonIcon icon={arrowBack} slot='icon-only' />\n          </IonButton>\n\n          <IonButton hidden={!this.state.fetchError} fill=\"clear\" slot='end' onClick={e => this.fetchData()}>\n            <IonIcon icon={refreshCircle} slot='icon-only' />\n          </IonButton>\n\n          <IonButton hidden={!this.props.paginated} slot='end' onClick={ev => {\n            this.setState({ showJumpPageAlert: true });\n          }}>\n            <span className='uiFont' style={{ color: 'var(--color)' }}>{this.state.currentPage}/{this.state.pageCount}</span>\n          </IonButton>\n\n          <IonButton fill=\"clear\" slot='end' onClick={e => {\n            const voices = speechSynthesis.getVoices();\n            if (voices.length === 0) {\n              return;\n            }\n\n            switch (this.state.speechState) {\n              case SpeechState.UNINITIAL:\n                const zhTwVoice = voices.find((voice: SpeechSynthesisVoice) => {\n                  return voice.lang.indexOf('zh-TW') > -1 || voice.lang.indexOf('zh_TW') > -1\n                })\n                if (zhTwVoice !== undefined) {\n                  this.speechSynthesisUtterance.voice = zhTwVoice;\n                }\n\n                const remainingWorkText = this.getRemainingWorkTextFromSelectedRange();\n                const workText = remainingWorkText || this.ePubIframe?.contentDocument?.getElementById('body')?.innerText || '';\n\n                this.workTexts = [];\n                for (let i = 0; i < Math.ceil(workText.length / this.maxCharsPerUtterance); i++) {\n                  this.workTexts.push(workText.substring(i * this.maxCharsPerUtterance, (i + 1) * this.maxCharsPerUtterance));\n                }\n\n                this.workTextsIndex = 0;\n                this.speechSynthesisUtterance.text = this.workTexts[this.workTextsIndex];\n                this.speechSynthesisUtterance.rate = this.props.speechRate;\n                // Improve reliability by cancel first.\n                speechSynthesis.cancel();\n                speechSynthesis.speak(this.speechSynthesisUtterance);\n                this.setState({ speechState: SpeechState.SPEAKING });\n                break;\n              case SpeechState.SPEAKING:\n                // Unfortunately, pause() doesn't work on most Chrome browser.\n                // Instead, we support stop.\n                /*\n                speechSynthesis.pause();\n                this.setState({speechState: SpeechState.PAUSE});\n                */\n                speechSynthesis.cancel();\n                this.setState({ speechState: SpeechState.UNINITIAL });\n                break;\n              case SpeechState.PAUSE:\n                speechSynthesis.resume();\n                this.setState({ speechState: SpeechState.SPEAKING });\n                break;\n            }\n          }}>\n            <IonIcon icon={this.state.speechState === SpeechState.SPEAKING ? stopCircle : musicalNotes} slot='icon-only' />\n          </IonButton>\n\n          <IonButton fill=\"clear\" slot='end' onClick={e => this.setState({ popover: { show: true, event: e.nativeEvent } })}>\n            <IonIcon ios={ellipsisHorizontal} md={ellipsisVertical} slot='icon-only' />\n          </IonButton>\n\n          <IonPopover\n            isOpen={this.state.popover.show}\n            event={this.state.popover.event}\n            onDidDismiss={e => { this.setState({ popover: { show: false, event: null } }) }}\n          >\n            <IonList>\n              <IonItem button onClick={e => {\n                this.setState({ popover: { show: false, event: null } });\n                this.props.history.push(`/catalog/work/${this.props.match.params.work}`);\n              }}>\n                <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                <IonIcon icon={home} slot='start' />\n                <IonLabel className='ion-text-wrap uiFont'></IonLabel>\n              </IonItem>\n\n              <IonItem button onClick={e => {\n                this.props.history.push(`/${this.props.match.params.tab}`);\n                this.setState({ popover: { show: false, event: null } });\n              }}>\n                <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                <IonIcon icon={home} slot='start' />\n                <IonLabel className='ion-text-wrap uiFont'></IonLabel>\n              </IonItem>\n\n              <IonItem button onClick={e => {\n                this.setState({ popover: { show: false, event: null } });\n                this.addBookmarkHandler();\n              }}>\n                <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                <IonIcon icon={bookmark} slot='start' />\n                <IonLabel className='ion-text-wrap uiFont'></IonLabel>\n              </IonItem>\n\n              <IonItem button onClick={e => {\n                this.setState({ popover: { show: false, event: null } });\n                this.setState({ showSearchTextToast: false, showSearchTextAlert: true });\n              }}>\n                <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                <IonIcon icon={search} slot='start' />\n                <IonLabel className='ion-text-wrap uiFont'></IonLabel>\n              </IonItem>\n              <IonItem button onClick={e => {\n                this.setState({ popover: { show: false, event: null } });\n                this.setState({ showSearchAlert: true });\n              }}>\n                <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                <IonIcon icon={search} slot='start' />\n                <IonLabel className='ion-text-wrap uiFont'></IonLabel>\n              </IonItem>\n\n              <IonItem button onClick={e => {\n                this.setState({ popover: { show: false, event: null } });\n                const selectedText = this.getSelectedString();\n                if (selectedText === '') {\n                  this.setState({ showNoSelectedTextAlert: true });\n                  return;\n                }\n\n                this.props.history.push({\n                  pathname: `/dictionary/search/${selectedText}`,\n                });\n              }}>\n                <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                <IonIcon icon={book} slot='start' />\n                <IonLabel className='ion-text-wrap uiFont'></IonLabel>\n              </IonItem>\n\n              <IonItem button onClick={e => {\n                this.setState({ popover: { show: false, event: null } });\n                const selectedText = this.getSelectedString();\n                if (selectedText === '') {\n                  this.setState({ showNoSelectedTextAlert: true });\n                  return;\n                }\n\n                this.props.history.push({\n                  pathname: `/dictionary/searchWord/${selectedText}`,\n                });\n              }}>\n                <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                <IonIcon icon={book} slot='start' />\n                <IonLabel className='ion-text-wrap uiFont'></IonLabel>\n              </IonItem>\n\n              <IonItem button onClick={e => {\n                this.setState({ popover: { show: false, event: null } });\n                this.ePubIframe?.contentWindow?.print();\n              }}>\n                <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                <IonIcon icon={print} slot='start' />\n                <IonLabel className='ion-text-wrap uiFont'></IonLabel>\n              </IonItem>\n\n              <IonItem button onClick={ev => {\n                this.setState({ popover: { show: false, event: null } });\n                const sel = this.ePubIframe?.contentDocument?.getSelection()!;\n                if ((sel.rangeCount || 0) > 0 && sel.getRangeAt(0).toString().length > 0) {\n                  const selectedText = sel!.toString();\n                  const range = sel.getRangeAt(0);\n                  let startLine = this.findCbetaHtmlLine(range.startContainer)?.getAttribute('l');\n                  let endLine = this.findCbetaHtmlLine(range.endContainer)?.getAttribute('l');\n                  sel?.removeAllRanges();\n                  if (startLine == null || endLine == null) {\n                    this.setState({ showsCitationFail: true });\n                    return;\n                  }\n                  const startLineMatches = /0*([1-9]*)([a-z])0*([1-9]*)/.exec(startLine!)!;\n                  const startLineModified = `${startLineMatches[1]}${startLineMatches[2]}${startLineMatches[3]}`;\n                  const endLineModified = /0*([1-9]*)([a-z])0*([1-9]*)/.exec(endLine!)![3];\n\n                  let lineInfo = `${startLineModified}`;\n                  if (startLine !== endLine) {\n                    lineInfo += `-${endLineModified}`;\n                  }\n                  const citation = `${this.state.workInfo.title}${this.props.match.params.path}${selectedText}(CBETA, ${this.state.workInfo.vol}, no. ${/[^0-9]*(.*)/.exec(this.state.workInfo.work)![1]}, p. ${lineInfo})`;\n                  navigator.clipboard && navigator.clipboard.writeText(citation);\n                  this.setState({ showsCopyToClipboardSuccess: true });\n                } else {\n                  this.setState({ showNoSelectedTextAlert: true });\n                }\n              }}>\n                <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                <IonIcon icon={shareSocial} slot='start' />\n                <IonLabel className='ion-text-wrap uiFont'></IonLabel>\n              </IonItem>\n\n              <IonItem button onClick={ev => {\n                let sharedUrl = window.location.href.split('?')[0];\n                const selectedText = this.getSelectedString();\n                if (selectedText !== '') {\n                  sharedUrl += `?bookmark=${this.epubcfiFromSelectedString}`;\n                }\n\n                this.props.dispatch({\n                  type: \"TMP_SET_KEY_VAL\",\n                  key: 'shareTextModal',\n                  val: {\n                    show: true,\n                    text: decodeURIComponent(sharedUrl),\n                  },\n                });\n              }}>\n                <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                <IonIcon icon={shareSocial} slot='start' />\n                <IonLabel className='ion-text-wrap uiFont'></IonLabel>\n              </IonItem>\n            </IonList>\n          </IonPopover>\n        </IonToolbar>\n      </IonHeader>\n    );\n\n    const fabButtonOpacity = 0.2;\n    let navButtons = (<>\n      <IonFab vertical='center' horizontal='start' slot='fixed'>\n        <IonFabButton style={{ opacity: fabButtonOpacity }} onClick={e => this.props.rtlVerticalLayout ? this.buttonNext() : this.buttonPrev()}\n          onTouchStart={e => {\n            e.currentTarget.style.setProperty('opacity', '1');\n          }}\n          onMouseOver={e => {\n            // Disable mouse events for iOS. Because a touch stat gesture can trigger onMouseOver, but a touch-end gesture can't trigger onMouseLeave.\n            if (Globals.isTouchDevice()) {\n              return;\n            }\n            e.currentTarget.style.setProperty('opacity', '1');\n          }}\n          onTouchEnd={e => {\n            e.currentTarget.style.setProperty('opacity', `${fabButtonOpacity}`);\n          }}\n          onMouseLeave={e => {\n            if (Globals.isTouchDevice()) {\n              return;\n            }\n            e.currentTarget.style.setProperty('opacity', `${fabButtonOpacity}`);\n          }}>\n          <IonIcon icon={arrowBack} />\n        </IonFabButton>\n      </IonFab>\n      <IonFab vertical='center' horizontal='end' slot='fixed'>\n        <IonFabButton style={{ opacity: fabButtonOpacity }} onClick={e => this.props.rtlVerticalLayout ? this.buttonPrev() : this.buttonNext()} onTouchStart={e => {\n          e.currentTarget.style.setProperty('opacity', '1');\n        }}\n          onMouseOver={e => {\n            if (Globals.isTouchDevice()) {\n              return;\n            }\n            e.currentTarget.style.setProperty('opacity', '1');\n          }}\n          onTouchEnd={e => {\n            e.currentTarget.style.setProperty('opacity', `${fabButtonOpacity}`);\n          }}\n          onMouseLeave={e => {\n            if (Globals.isTouchDevice()) {\n              return;\n            }\n            e.currentTarget.style.setProperty('opacity', `${fabButtonOpacity}`);\n          }}>\n          <IonIcon icon={arrowForward} />\n        </IonFabButton>\n      </IonFab>\n    </>);\n\n    if (!this.bookCreated && this.state.htmlStr != null) {\n      this.html2Epub();\n    }\n\n    return (\n      <IonPage>\n        {header}\n        <IonContent>\n          {this.props.paginated || this.state.showSearchTextToast ? navButtons : <></>}\n\n          <IonLoading\n            cssClass='uiFont'\n            isOpen={this.state.isLoading}\n            onDidDismiss={() => this.setState({ isLoading: false })}\n            message={'...'}\n          />\n\n          {this.state.fetchError ? Globals.fetchErrorContent : <></>}\n\n          <div id='cbetarEPubView' style={{ width: '100%', height: '100%', userSelect: \"text\", WebkitUserSelect: \"text\" }}>\n          </div>\n\n          <IonAlert\n            cssClass='uiFont'\n            isOpen={this.state.showJumpPageAlert}\n            header={''}\n            subHeader={`(1 - ${this.state.pageCount})`}\n            inputs={[\n              {\n                name: 'name0',\n                type: 'number',\n                min: 1,\n                max: this.state.pageCount,\n                value: this.state.currentPage,\n              },\n            ]}\n            buttons={[\n              {\n                text: '',\n                role: 'cancel',\n                cssClass: 'secondary uiFont',\n                handler: () => this.setState({ showJumpPageAlert: false }),\n              },\n              {\n                text: '',\n                cssClass: 'primary uiFont',\n                handler: (value) => {\n                  this.setState({ showJumpPageAlert: false });\n                  this.jumpToPage(value.name0);\n                },\n              }\n            ]}\n          />\n\n          <SearchAlert\n            {...{\n              showSearchAlert: (this.state as any).showSearchAlert,\n              finish: () => { this.setState({ showSearchAlert: false }) }, ...this.props\n            }}\n          />\n\n          <IonAlert\n            cssClass='uiFont'\n            isOpen={this.state.showNoSelectedTextAlert}\n            backdropDismiss={false}\n            header=''\n            message='!'\n            buttons={[\n              {\n                text: '',\n                cssClass: 'primary uiFont',\n                handler: (value) => {\n                  this.setState({\n                    showNoSelectedTextAlert: false,\n                  });\n                },\n              }\n            ]}\n          />\n\n          <IonToast\n            cssClass='uiFont'\n            isOpen={this.state.showAddBookmarkSuccess}\n            onDidDismiss={() => this.setState({ showAddBookmarkSuccess: false })}\n            message=\"\"\n            duration={2000}\n          />\n\n          <IonToast\n            cssClass='uiFont'\n            isOpen={this.state.showsCopyToClipboardSuccess}\n            onDidDismiss={() => this.setState({ showsCopyToClipboardSuccess: false })}\n            message=\"\"\n            duration={2000}\n          />\n\n          <IonToast\n            cssClass='uiFont'\n            isOpen={this.state.showsCitationFail}\n            onDidDismiss={() => this.setState({ showsCitationFail: false })}\n            message=\"\"\n            duration={2000}\n          />\n\n          <IonAlert\n            cssClass='uiFont'\n            isOpen={this.state.showSearchTextAlert}\n            header={''}\n            subHeader='UI'\n            inputs={[\n              {\n                name: 'name0',\n                type: 'search',\n                placeholder: ':'\n              },\n            ]}\n            buttons={[\n              {\n                text: '',\n                role: 'cancel',\n                cssClass: 'secondary uiFont',\n                handler: () => this.setState({ showSearchTextAlert: false }),\n              },\n              {\n                text: '',\n                cssClass: 'primary uiFont',\n                handler: (value) => {\n                  if (value.name0 === '') {\n                    this.setState({ showSearchTextAlert: false });\n                    return;\n                  }\n\n                  this.findSearchTextRanges(value.name0);\n                  if (this.searchTextRanges.length === 0) {\n                    this.setState({ showSearchTextAlert: false, showToast: true, toastMessage: `${value.name0}` });\n                  } else {\n                    this.setState({ showSearchTextAlert: false, showSearchTextToast: true, searchText: value.name0 });\n                    this.searchTextPrev();\n                  }\n                },\n              },\n            ]}\n          />\n\n          <IonToast\n            cssClass='uiFont'\n            isOpen={this.state.showSearchTextToast}\n            onDidDismiss={() => this.setState({ showSearchTextToast: false })}\n            message={`${this.state.searchText}`}\n            buttons={[\n              {\n                text: '',\n                role: 'cancel',\n                handler: () => this.setState({ showSearchTextToast: false })\n              }\n            ]}\n          />\n\n          <IonToast\n            cssClass='uiFont'\n            isOpen={this.state.showToast}\n            onDidDismiss={() => this.setState({ showToast: false })}\n            message={this.state.toastMessage}\n            duration={2000}\n          />\n        </IonContent>\n      </IonPage>\n    );\n  }\n};\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n    bookmarks: state.settings.bookmarks,\n    fontSize: state.settings.fontSize,\n    showComments: state.settings.showComments,\n    paginated: state.settings.paginated,\n    rtlVerticalLayout: state.settings.rtlVerticalLayout,\n    settings: state.settings,\n    scrollbarSize: state.settings.scrollbarSize,\n    speechRate: state.settings.speechRate,\n  }\n};\n\nconst EPubViewPage = withIonLifeCycle(_EPubViewPage);\n\nexport default connect(\n  mapStateToProps,\n)(EPubViewPage);\n","export class Catalog {\n    n: string;\n    nodeType: string | null | undefined;\n    label: string;\n    work: string | null | undefined;\n    file: string | null | undefined;\n\n    constructor(json: any) {\n        this.n = json.n;\n        this.nodeType = json.node_type;\n        this.label = json.label;\n        this.work = json.work;\n        this.file = json.file;\n    }\n}\n","import React from 'react';\nimport { IonAlert } from '@ionic/react';\nimport { RouteComponentProps } from 'react-router-dom';\n\ninterface Props {\n  showSearchAlert: boolean;\n  finish: Function;\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n  tab: string;\n  path: string;\n  label: string;\n}> { }\n\nclass SearchAlert extends React.Component<PageProps> {\n  /*constructor(props: any) {\n    super(props);\n  }*/\n\n  render() {\n    return (\n      <IonAlert\n        cssClass='uiFont'\n        isOpen={this.props.showSearchAlert}\n        header={''}\n        subHeader=''\n        inputs={[\n          {\n            name: 'name0',\n            type: 'search',\n            placeholder: ':'\n          },\n        ]}\n        buttons={[\n          {\n            text: '',\n            role: 'cancel',\n            cssClass: 'secondary uiFont',\n            handler: () => this.props.finish(),\n          },\n          {\n            text: '',\n            cssClass: 'primary uiFont',\n            handler: (value) => {\n              this.props.finish();\n              this.props.history.push(`/catalog/search/${value.name0}`);\n            },\n          },\n          {\n            text: '',\n            cssClass: 'primary uiFont',\n            handler: (value) => {\n              this.props.finish();\n              this.props.history.push(`/catalog/fulltextsearch/${value.name0}`);\n            },\n          }\n        ]}\n      />\n    );\n  }\n};\n\nexport default SearchAlert;\n","import React from 'react';\nimport { IonContent, IonHeader, IonPage, IonToolbar, IonList, IonItem, IonLabel, IonButton, IonIcon, withIonLifeCycle, IonLoading } from '@ionic/react';\nimport { RouteComponentProps } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport './CatalogPage.css';\nimport { Catalog } from '../models/Catalog';\nimport Globals from '../Globals';\nimport { Bookmark, BookmarkType } from '../models/Bookmark';\nimport { bookmark, arrowBack, home, search, shareSocial, refreshCircle } from 'ionicons/icons';\nimport SearchAlert from '../components/SearchAlert';\nimport queryString from 'query-string';\n\ninterface Props {\n  dispatch: Function;\n  bookmarks: [Bookmark];\n  topCatalogsType: number;\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n  tab: string;\n  path: string;\n  label: string;\n}> { }\n\ninterface State {\n  showSearchAlert: boolean;\n  fetchError: boolean;\n  catalogs: Array<Catalog>;\n  pathLabel: string;\n  isLoading: boolean;\n}\n\nclass _CatalogPage extends React.Component<PageProps, State> {\n  constructor(props: any) {\n    super(props);\n    this.state = {\n      fetchError: false,\n      catalogs: [],\n      pathLabel: '',\n      showSearchAlert: false,\n      isLoading: false,\n    };\n  }\n\n  ionViewWillEnter() {\n    console.log(`view will enter: ${this.props.match.url}`);\n  }\n\n  /*\n  componentWillReceiveProps(nextProps){\n    console.log(`route changed: ${nextProps.match.url}`)\n }*/\n\n  componentDidMount() {\n    console.log(`did mount: ${this.props.match.url}`);\n    this.fetchData(this.props.match.params.path);\n  }\n\n  /*\n  componentWillUnmount() {\n  }*/\n\n  async fetchData(path: string) {\n    //console.log('fetch');\n    this.setState({ isLoading: true });\n    let catalogs = new Array<Catalog>();\n    let pathLabel = '';\n\n    if (path == null) {\n      return this.fetchTopCatalogs(this.props.topCatalogsType);\n    } else {\n      try {\n        const res = await Globals.axiosInstance.get(`/catalog_entry?q=${path}`, {\n          responseType: 'arraybuffer',\n        });\n        const obj = JSON.parse(new TextDecoder().decode(res.data)) as any;\n        const data = obj.results as [any];\n        catalogs = data.map((json) => new Catalog(json));\n\n        const parentPath = this.parentPath(path);\n        // path is not a top catalog.\n        if (parentPath !== '') {\n          pathLabel = obj.label;\n        } else {\n          const topCatalogsByCatLabel = Globals.topCatalogsByCat[path];\n          pathLabel = (topCatalogsByCatLabel !== undefined) ? topCatalogsByCatLabel : Globals.topCatalogsByVol[path];\n        }\n\n        this.setState({ fetchError: false, isLoading: false, catalogs: catalogs, pathLabel });\n        return true;\n      } catch (e) {\n        console.error(e);\n        console.error(new Error().stack);\n        this.setState({ fetchError: true, isLoading: false });\n        return false;\n      }\n    }\n  }\n\n  fetchTopCatalogs(topCatalogsType: number) {\n    let catalogs = Array<Catalog>();\n\n    const topCatalogs = topCatalogsType ? Globals.topCatalogsByVol : Globals.topCatalogsByCat;\n\n    Object.keys(topCatalogs).forEach((key) => {\n      const catalog: Catalog = {\n        n: key,\n        nodeType: null,\n        work: null,\n        label: topCatalogs[key],\n        file: null,\n      };\n      catalogs.push(catalog);\n    });\n    this.setState({ fetchError: false, isLoading: false, catalogs: catalogs });\n    return true;\n  }\n\n  get isTopCatalog() {\n    return this.props.match.url === '/catalog';\n  }\n\n  parentPath(path: string) {\n    let paths = path.split('.');\n    paths.pop();\n    return paths.join('.');\n  }\n\n  addBookmarkHandler() {\n    this.props.dispatch({\n      type: \"ADD_BOOKMARK\",\n      bookmark: new Bookmark({\n        type: BookmarkType.CATALOG,\n        uuid: this.props.match.params.path,\n        selectedText: this.state.pathLabel,\n        epubcfi: '',\n        fileName: '',\n        work: null,\n      }),\n    });\n  }\n\n  delBookmarkHandler() {\n    this.props.dispatch({\n      type: \"DEL_BOOKMARK\",\n      uuid: this.props.match.params.path,\n    });\n  }\n\n  get hasBookmark() {\n    return this.props.bookmarks.find(\n      (e) => e.type === BookmarkType.CATALOG && e.uuid === this.props.match.params.path) != null;\n  }\n\n  getRows() {\n    let rows = Array<object>();\n    this.state.catalogs.forEach((catalog: Catalog, index: number) => {\n      let routeLink = '';\n      const isHtmlNode = catalog.nodeType === 'html';\n      if (isHtmlNode) {\n        routeLink = `/catalog/juan/${catalog.n}/1`;\n      } else if (catalog.work == null) {\n        routeLink = `/catalog/catalog/${catalog.n}`;\n      } else {\n        routeLink = `/catalog/work/${catalog.work}`;\n      }\n      rows.push(\n        <IonItem key={`${catalog.n}item` + index} button={true} onClick={async event => {\n          event.preventDefault();\n          this.props.history.push({\n            pathname: routeLink,\n            search: queryString.stringify(isHtmlNode ? { file: catalog.file!, title: catalog.label } : {}),\n          });\n        }}>\n          <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n          <IonLabel className='ion-text-wrap uiFont' key={`${catalog.n}label` + index}>\n            {catalog.label}\n          </IonLabel>\n        </IonItem>\n      );\n    });\n    return rows;\n  }\n\n  render() {\n    //console.log(`${this.props.match.url} render`)\n\n    let list = <IonList>\n      {this.getRows()}\n    </IonList>\n\n    return (\n      <IonPage>\n        <IonHeader>\n          <IonToolbar>\n            <IonButton hidden={this.isTopCatalog} fill=\"clear\" slot='start' onClick={e => this.props.history.goBack()}>\n              <IonIcon icon={arrowBack} slot='icon-only' />\n            </IonButton>\n\n            <IonButton hidden={!this.isTopCatalog} slot='start' onClick={ev => {\n              const newTopCatalogsType = (this.props.topCatalogsType + 1) % 2\n              this.fetchTopCatalogs(newTopCatalogsType);\n              this.props.dispatch({\n                type: \"SET_KEY_VAL\",\n                key: 'topCatalogsType',\n                val: newTopCatalogsType\n              });\n            }}>\n              <span className='uiFont' style={{ color: 'var(--color)' }}>{this.props.topCatalogsType ? '' : ''}</span>\n            </IonButton>\n\n            <IonButton hidden={!this.state.fetchError} fill=\"clear\" slot='end' onClick={e => this.fetchData(this.props.match.params.path)}>\n              <IonIcon icon={refreshCircle} slot='icon-only' />\n            </IonButton>\n\n            <IonButton hidden={this.isTopCatalog} fill=\"clear\" color={this.hasBookmark ? 'warning' : 'primary'} slot='end' onClick={e => this.hasBookmark ? this.delBookmarkHandler() : this.addBookmarkHandler()}>\n              <IonIcon icon={bookmark} slot='icon-only' />\n            </IonButton>\n\n            <IonButton hidden={this.isTopCatalog} fill=\"clear\" slot='end' onClick={e => this.props.history.push(`/${this.props.match.params.tab}`)}>\n              <IonIcon icon={home} slot='icon-only' />\n            </IonButton>\n\n            <IonButton fill=\"clear\" slot='end' onClick={e => this.setState({ showSearchAlert: true })}>\n              <IonIcon icon={search} slot='icon-only' />\n            </IonButton>\n\n            <IonButton fill=\"clear\" slot='end' onClick={e => {\n              this.props.dispatch({\n                type: \"TMP_SET_KEY_VAL\",\n                key: 'shareTextModal',\n                val: {\n                  show: true,\n                  text: decodeURIComponent(window.location.href),\n                },\n              });\n            }}>\n              <IonIcon icon={shareSocial} slot='icon-only' />\n            </IonButton>\n          </IonToolbar>\n        </IonHeader>\n        <IonContent>\n          {this.state.fetchError ? Globals.fetchErrorContent :\n            <>\n              <div className='uiFontX2' style={{ color: 'var(--ion-color-primary)' }}>{this.state.pathLabel}</div>\n              {list}\n            </>\n          }\n\n          <SearchAlert\n            {...{\n              showSearchAlert: this.state.showSearchAlert,\n              finish: () => { this.setState({ showSearchAlert: false }) }, ...this.props\n            }}\n          />\n\n          <div style={{ fontSize: 'var(--ui-font-size)', textAlign: 'center' }}><a href=\"https://github.com/MrMYHuang/cbetar2#search\" target=\"_new\"></a></div>\n\n          <IonLoading\n            cssClass='uiFont'\n            isOpen={this.state.isLoading}\n            onDidDismiss={() => this.setState({ isLoading: false })}\n            message={'...'}\n          />\n        </IonContent>\n      </IonPage>\n    );\n  }\n};\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n    bookmarks: state.settings.bookmarks,\n    topCatalogsType: state.settings.topCatalogsType,\n    state: state,\n  }\n};\n\n//const mapDispatchToProps = {};\n\nconst CatalogPage = withIonLifeCycle(_CatalogPage);\n\nexport default connect(\n  mapStateToProps,\n)(CatalogPage);\n","import React from 'react';\nimport { IonContent, IonHeader, IonPage, IonToolbar, IonList, IonItem, IonLabel, withIonLifeCycle, IonButton, IonIcon, IonToast, IonLoading } from '@ionic/react';\nimport { RouteComponentProps } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport './WorkPage.css';\nimport { Work, WorkChapter, WorkListType } from '../models/Work';\nimport Globals from '../Globals';\nimport { bookmark, arrowBack, home, search, shareSocial, refreshCircle } from 'ionicons/icons';\nimport { Bookmark, BookmarkType } from '../models/Bookmark';\nimport SearchAlert from '../components/SearchAlert';\n\ninterface Props {\n  dispatch: Function;\n  bookmarks: [Bookmark];\n  workListType: WorkListType;\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n  tab: string;\n  path: string;\n  label: string;\n}> { }\n\ninterface State {\n  work: Work | null;\n  showSearchAlert: boolean;\n  showAddBookmarkDone: boolean;\n  isLoading: boolean;\n  fetchError: boolean;\n}\n\nclass _WorkPage extends React.Component<PageProps, State> {\n  constructor(props: any) {\n    super(props);\n    this.state = {\n      work: null,\n      showSearchAlert: false,\n      showAddBookmarkDone: false,\n      isLoading: false,\n      fetchError: false,\n    }\n  }\n\n  ionViewWillEnter() {\n    //console.log( 'view will enter' );\n    this.fetchWork(this.props.match.params.path);\n  }\n\n  async fetchWork(path: string) {\n    this.setState({ isLoading: true });\n    let work: Work | null;\n    if (this.hasBookmark) {\n      work = this.bookmark!.work!;\n    } else {\n      try {\n        const res = await Globals.axiosInstance.get(`/works?work=${path}`, {\n          responseType: 'arraybuffer',\n        });\n        const data = JSON.parse(new TextDecoder().decode(res.data));\n        const works = data.results as [Work];\n        work = works[0];\n\n        const resToc = await Globals.axiosInstance.get(`/toc?work=${path}`) as any;\n        work.mulu = (resToc.data.results[0].mulu as WorkChapter[]).map((wc) => new WorkChapter(wc));\n\n      } catch (err) {\n        console.error(err);\n        console.error(new Error().stack);\n        this.setState({ fetchError: true, isLoading: false });\n        return false;\n      }\n    }\n\n    this.setState({ fetchError: false, isLoading: false, work: work });\n    return true;\n  }\n\n  fetchJuan = '';\n  async saveJuans() {\n    let work = this.state.work!;\n    let juans = work.juan_list.split(',');\n    for (let i = 0; i < juans.length; i++) {\n      this.fetchJuan = juans[i];\n      try {\n        const res = await Globals.fetchJuan(work.work, this.fetchJuan, null);\n        Globals.saveFileToIndexedDB(Globals.getFileName(work.work, this.fetchJuan), res.htmlStr);\n      } catch (err) {\n        console.error(`Fetching juan ${i} failed! ${err}`);\n        console.error(new Error().stack);\n      }\n    }\n    this.setState({ showAddBookmarkDone: true });\n  }\n\n  async addBookmarkHandler() {\n    await this.saveJuans();\n    this.props.dispatch({\n      type: \"ADD_BOOKMARK\",\n      bookmark: new Bookmark({\n        type: BookmarkType.WORK,\n        uuid: this.props.match.params.path,\n        selectedText: this.state.work!.title,\n        epubcfi: '',\n        fileName: '',\n        work: this.state.work!,\n      }),\n    });\n  }\n\n  delBookmarkHandler() {\n    this.props.dispatch({\n      type: \"DEL_BOOKMARK\",\n      uuid: this.props.match.params.path,\n    });\n  }\n\n  get isTopPage() {\n    return this.props.match.url === '/catalog';\n  }\n\n  get bookmark() {\n    return this.props.bookmarks.find(\n      (e) => e.type === BookmarkType.WORK && e.uuid === this.props.match.params.path);\n  }\n\n  get hasBookmark() {\n    return this.bookmark != null;\n  }\n\n  getRowsByChapter() {\n    let work = this.state.work;\n    const mulu = work?.mulu;\n    let rows = Array<object>();\n    for (let i = 0; i < (mulu?.length || -1); i++) {\n      let routeLink = `/catalog/juan/${work?.work}/${mulu![i].juan}`;\n      rows.push(\n        <IonItem key={`chapterItem` + i} button={true} onClick={async event => {\n          event.preventDefault();\n          this.props.history.push({\n            pathname: routeLink,\n          });\n        }}>\n          <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n          <IonLabel className='ion-text-wrap uiFont' key={`chapterLabel` + i}>\n            {mulu![i].title}\n          </IonLabel>\n        </IonItem>\n      );\n    }\n    return rows;\n  }\n\n  getRowsByJuan() {\n    let work = this.state.work;\n    let rows = Array<object>();\n    let juans = work?.juan_list.split(',');\n    for (let i = 0; i < (juans?.length || -1); i++) {\n      //if (work.nodeType == 'html')\n      let routeLink = `/catalog/juan/${work?.work}/${juans![i]}`;\n      rows.push(\n        <IonItem key={`juanItem` + i} button={true} onClick={async event => {\n          event.preventDefault();\n          this.props.history.push({\n            pathname: routeLink,\n          });\n        }}>\n          <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n          <IonLabel className='ion-text-wrap uiFont' key={`juanLabel` + i}>\n            {juans![i]}\n          </IonLabel>\n        </IonItem>\n      );\n    }\n    return rows;\n  }\n\n  //work = this.works[0] as Work;\n  render() {\n    return (\n      <IonPage>\n        <IonHeader>\n          <IonToolbar>\n            <IonButton hidden={this.isTopPage} fill=\"clear\" slot='start' onClick={e => this.props.history.goBack()}>\n              <IonIcon icon={arrowBack} slot='icon-only' />\n            </IonButton>\n\n            <IonButton slot='start' onClick={ev => {\n              const newWorkListType = this.props.workListType === WorkListType.BY_CHAPTER ? WorkListType.BY_JUAN : WorkListType.BY_CHAPTER;\n              this.props.dispatch({\n                type: \"TMP_SET_KEY_VAL\",\n                key: 'workListType',\n                val: newWorkListType\n              });\n            }}>\n              <span className='uiFont' style={{ color: 'var(--color)' }}>{this.props.workListType === WorkListType.BY_CHAPTER ? '' : ''}</span>\n            </IonButton>\n\n            <IonButton hidden={!this.state.fetchError} fill=\"clear\" slot='end' onClick={e => this.fetchWork(this.props.match.params.path)}>\n              <IonIcon icon={refreshCircle} slot='icon-only' />\n            </IonButton>\n\n            <IonButton fill=\"clear\" color={this.hasBookmark ? 'warning' : 'primary'} slot='end' onClick={e => this.hasBookmark ? this.delBookmarkHandler() : this.addBookmarkHandler()}>\n              <IonIcon icon={bookmark} slot='icon-only' />\n            </IonButton>\n\n            <IonButton fill=\"clear\" slot='end' onClick={e => this.props.history.push(`/${this.props.match.params.tab}`)}>\n              <IonIcon icon={home} slot='icon-only' />\n            </IonButton>\n\n            <IonButton fill=\"clear\" slot='end' onClick={e => this.setState({ showSearchAlert: true })}>\n              <IonIcon icon={search} slot='icon-only' />\n            </IonButton>\n\n            <IonButton fill=\"clear\" slot='end' onClick={e => {\n              this.props.dispatch({\n                type: \"TMP_SET_KEY_VAL\",\n                key: 'shareTextModal',\n                val: {\n                  show: true,\n                  text: decodeURIComponent(window.location.href),\n                },\n              });\n            }}>\n              <IonIcon icon={shareSocial} slot='icon-only' />\n            </IonButton>\n          </IonToolbar>\n        </IonHeader>\n        <IonContent>\n          <div className='uiFontX2' style={{ color: 'var(--ion-color-primary)' }}>{this.state.work?.title}</div>\n          {\n            this.state.fetchError ? Globals.fetchErrorContent :\n              <IonList>\n                {this.props.workListType === WorkListType.BY_CHAPTER ? this.getRowsByChapter() : this.getRowsByJuan()}\n              </IonList>\n          }\n\n          <SearchAlert\n            {...{\n              showSearchAlert: (this.state as any).showSearchAlert,\n              finish: () => { this.setState({ showSearchAlert: false }) }, ...this.props\n            }}\n          />\n\n          <IonToast\n            cssClass='uiFont'\n            isOpen={this.state.showAddBookmarkDone}\n            onDidDismiss={() => this.setState({ showAddBookmarkDone: false })}\n            message={``}\n            duration={2000}\n          />\n\n          <IonLoading\n            cssClass='uiFont'\n            isOpen={this.state.isLoading}\n            onDidDismiss={() => this.setState({ isLoading: false })}\n            message={'...'}\n          />\n        </IonContent>\n      </IonPage>\n    );\n  }\n};\n\nconst WorkPage = withIonLifeCycle(_WorkPage);\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n    bookmarks: state.settings.bookmarks,\n    // Default to WorkListType.BY_JUAN, because work list by chapter might be empty.\n    workListType: state.tmpSettings.workListType !== undefined ? state.tmpSettings.workListType : WorkListType.BY_JUAN,\n  }\n};\n\n//const mapDispatchToProps = {};\n\nexport default connect(\n  mapStateToProps,\n)(WorkPage);\n","export enum WordType {\n    NOUN = '',\n    VERB = ''\n}\n\nexport class DictWordDefItem {\n    def: string;\n    quote: Array<string> | null;\n    example: Array<string> | null;\n    link: Array<string> | null;\n    type: WordType | undefined;\n\n    constructor(json: DictWordDefItem) {\n        this.def = json.def;\n        this.quote = json.quote;\n        this.example = json.example;\n        this.link = json.link;\n        this.type = json.type;\n    }\n}\n\nexport class DictWordItem {\n    bopomofo: string;\n    bopomofo2: string;\n    pinyin: string;\n    definitions: Array<DictWordDefItem>;\n\n    constructor(json: any) {\n        this.bopomofo = json.bopomofo;\n        this.bopomofo2 = json.bopomofo2;\n        this.pinyin = json.pinyin;\n        this.definitions = json.definitions;\n    }\n}\n","import React from 'react';\nimport { IonContent, IonHeader, IonPage, IonTitle, IonToolbar, IonList, IonItem, IonRange, IonIcon, IonLabel, IonToggle, IonButton, IonAlert, IonSelect, IonSelectOption, IonProgressBar, IonToast } from '@ionic/react';\nimport { connect } from 'react-redux';\nimport { RouteComponentProps } from 'react-router-dom';\nimport Globals from '../Globals';\nimport { helpCircle, text, documentText, refreshCircle, musicalNotes, colorPalette, shareSocial, bug, download } from 'ionicons/icons';\nimport './SettingsPage.css';\nimport PackageInfos from '../../package.json';\nimport { Bookmark, BookmarkType } from '../models/Bookmark';\n\ninterface StateProps {\n  showFontLicense: boolean;\n  juansDownloadedRatio: number;\n  showUpdateAllJuansDone: boolean;\n}\n\ninterface Props {\n  dispatch: Function;\n  hasAppLog: boolean;\n  theme: number;\n  uiFontSize: number;\n  scrollbarSize: number;\n  settings: any;\n  showComments: boolean;\n  paginated: boolean;\n  rtlVerticalLayout: boolean;\n  useFontKai: boolean;\n  speechRate: number;\n  bookmarks: [Bookmark];\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n  tab: string;\n  path: string;\n  label: string;\n}> { }\n\nclass SettingsPage extends React.Component<PageProps, StateProps> {\n  constructor(props: any) {\n    super(props);\n\n    this.state = {\n      showFontLicense: false,\n      juansDownloadedRatio: 0,\n      showUpdateAllJuansDone: false,\n    }\n  }\n\n  updateBookmark(newBookmarks: Array<Bookmark>, newBookmark: Bookmark) {\n    const updateIndex = newBookmarks.findIndex((b: Bookmark) => b.uuid === newBookmark.uuid);\n    if (updateIndex === -1) {\n      console.error(`Update bookmark fails! Can't find the original bookmark with UUID: ${newBookmark.uuid}`);\n    } else {\n      newBookmarks[updateIndex] = newBookmark;\n    }\n    return;\n  }\n\n  async updateAllJuans() {\n    this.setState({ juansDownloadedRatio: 0 });\n    const workBookmarksWithHtml = this.props.bookmarks.filter((b) => b.type === BookmarkType.WORK);\n    const juanBookmarksWithHtml = this.props.bookmarks.filter((b) => b.type === BookmarkType.JUAN);\n    const juanBookmarksNotInWorkBookmarksWithHtml = juanBookmarksWithHtml.filter((b) => workBookmarksWithHtml.findIndex((wb) => wb.work?.work === b.work?.work) === -1);\n\n    // Total juans to download.\n    let juansToDownload = juanBookmarksNotInWorkBookmarksWithHtml.length;\n    for (let i = 0; i < workBookmarksWithHtml.length; i++) {\n      const work = workBookmarksWithHtml[i].work!;\n      juansToDownload += work.juan_list.split(',').length;\n    }\n\n    let juansDownloaded = 0;\n    for (let i = 0; i < workBookmarksWithHtml.length; i++) {\n      const bookmarkWithHtml = workBookmarksWithHtml[i];\n      const work = bookmarkWithHtml.work!;\n      const juans = work.juan_list.split(',');\n      for (let j = 0; j < juans.length; j++) {\n        const fetchJuan = juans[j];\n        juansDownloaded += 1;\n        this.setState({ juansDownloadedRatio: juansDownloaded / juansToDownload });\n        const res = await Globals.fetchJuan(work.work, fetchJuan, null, true);\n        const fileName = Globals.getFileName(work.work, fetchJuan);\n        // Update HTML.\n        Globals.saveFileToIndexedDB(fileName, res.htmlStr);\n        if (j === 0) {\n          // Update bookmarks for once.\n          this.updateBookmark(this.props.bookmarks, Object.assign(bookmarkWithHtml, { work: res.workInfo }));\n        }\n        console.log(`File saved: ${fileName}`);\n      }\n    }\n    for (let i = 0; i < juanBookmarksNotInWorkBookmarksWithHtml.length; i++) {\n      juansDownloaded += 1;\n      this.setState({ juansDownloadedRatio: juansDownloaded / juansToDownload });\n      const bookmarkWithHtml = juanBookmarksNotInWorkBookmarksWithHtml[i];\n      const work = bookmarkWithHtml.work!;\n      const res = await Globals.fetchJuan(work.work, `${work.juan}`, null, true);\n      const fileName = Globals.getFileName(work.work, `${work.juan}`);\n      let newWork = res.workInfo;\n      newWork.juan = work.juan;\n      // Update HTML.\n      Globals.saveFileToIndexedDB(fileName, res.htmlStr);\n      // Update bookmarks\n      this.updateBookmark(this.props.bookmarks, Object.assign(bookmarkWithHtml, { work: newWork }));\n      console.log(`File saved: ${fileName}`);\n    }\n\n    this.props.dispatch({\n      type: \"UPDATE_BOOKMARKS\",\n      bookmarks: this.props.bookmarks,\n    });\n    this.setState({ showUpdateAllJuansDone: true });\n  }\n\n  render() {\n    return (\n      <IonPage>\n        <IonHeader>\n          <IonToolbar>\n            <IonTitle className='uiFont'></IonTitle>\n          </IonToolbar>\n        </IonHeader>\n        <IonContent>\n          <IonList>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={shareSocial} slot='start' />\n              <IonLabel className='ion-text-wrap uiFont'>app: <a href=\"https://github.com/MrMYHuang/cbetar2#history\" target=\"_new\">{PackageInfos.version}</a></IonLabel>\n              <IonButton slot='end' size='large' style={{ fontSize: 'var(--ui-font-size)' }} onClick={e => {\n                this.props.dispatch({\n                  type: \"TMP_SET_KEY_VAL\",\n                  key: 'shareTextModal',\n                  val: {\n                    show: true,\n                    text: window.location.origin,\n                  },\n                });\n              }}></IonButton>\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={refreshCircle} slot='start' />\n              <IonLabel className='ion-text-wrap uiFont'>app ()</IonLabel>\n              <IonButton slot='end' size='large' style={{ fontSize: 'var(--ui-font-size)' }} onClick={e => {\n                Globals.updateApp();\n              }}></IonButton>\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={bug} slot='start' />\n              <IonLabel className='ion-text-wrap uiFont'><a href=\"https://github.com/MrMYHuang/cbetar2#report\" target=\"_new\">app</a></IonLabel>\n              <IonToggle slot='end' checked={this.props.hasAppLog} onIonChange={e => {\n                const isChecked = e.detail.checked;\n                isChecked ? Globals.enableAppLog() : Globals.disableAppLog();\n                this.props.dispatch({\n                  type: \"SET_KEY_VAL\",\n                  key: 'hasAppLog',\n                  val: isChecked\n                });\n              }} />\n            </IonItem>\n            <IonItem hidden={!this.props.hasAppLog}>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={bug} slot='start' />\n              <IonLabel className='ion-text-wrap uiFont'>app</IonLabel>\n              <IonButton slot='end' size='large' style={{ fontSize: 'var(--ui-font-size)' }} onClick={e => {\n                window.open(`mailto:myh@live.com?subject=&body=${encodeURIComponent(\"()\\n\\n\" + navigator.userAgent + \"\\n\\nApp\" + PackageInfos.version + \"\\n\\nApp\" + JSON.stringify(this.props.settings) + \"\\n\\nLog\\n\" + Globals.getLog())}`);\n              }}></IonButton>\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={download} slot='start' />\n              <IonLabel className='ion-text-wrap uiFont'>App</IonLabel>\n              <IonButton size='large' style={{ fontSize: 'var(--ui-font-size)' }} onClick={async (e) => {\n                const settingsJsonUri = `data:text/json;charset=utf-8,${encodeURIComponent(localStorage.getItem('Settings.json') || '')}`;\n                const a = document.createElement('a');\n                a.href = settingsJsonUri;\n                a.download = 'Settings.json';\n                a.click();\n                a.remove();\n              }}></IonButton>\n              <input id='importJsonInput' type='file' accept='.json' style={{ display: 'none' }} onChange={async (ev) => {\n                const file = ev.target.files?.item(0);\n                const fileText = await file?.text() || '';\n                try {\n                  // JSON text validation.\n                  JSON.parse(fileText);\n                  localStorage.setItem('Settings.json', fileText);\n                  this.props.dispatch({type: 'LOAD_SETTINGS'});\n                  this.updateAllJuans();\n                } catch (e) {\n                  console.error(e);\n                  console.error(new Error().stack);\n                }\n                (document.getElementById('importJsonInput') as HTMLInputElement).value = '';\n              }} />\n              <IonButton size='large' style={{ fontSize: 'var(--ui-font-size)' }} onClick={(e) => {\n                (document.querySelector('#importJsonInput') as HTMLInputElement).click();\n              }}></IonButton>\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={refreshCircle} slot='start' />\n              <div style={{ width: '100%' }}>\n                <IonLabel className='ion-text-wrap uiFont'></IonLabel>\n                <IonProgressBar value={this.state.juansDownloadedRatio} />\n              </div>\n              <IonButton slot='end' size='large' style={{ fontSize: 'var(--ui-font-size)' }} onClick={async (e) => this.updateAllJuans()}></IonButton>\n              <IonToast\n                cssClass='uiFont'\n                isOpen={this.state.showUpdateAllJuansDone}\n                onDidDismiss={() => this.setState({ showUpdateAllJuansDone: false })}\n                message={``}\n                duration={2000}\n              />\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={colorPalette} slot='start' />\n              <IonLabel className='ion-text-wrap uiFont'></IonLabel>\n              <IonSelect slot='end'\n                value={this.props.theme}\n                style={{ fontSize: 'var(--ui-font-size)' }}\n                interface='popover'\n                interfaceOptions={{ cssClass: 'cbetar2themes' }}\n                onIonChange={e => {\n                  const value = e.detail.value;\n                  this.props.dispatch({\n                    type: \"SET_KEY_VAL\",\n                    key: 'theme',\n                    val: value,\n                  });\n                  document.body.classList.forEach((val) => document.body.classList.remove(val));\n                  document.body.classList.toggle(`theme${value}`, true);\n                }}>\n                <IonSelectOption className='cbeta' value={0}>CBETA</IonSelectOption>\n                <IonSelectOption className='dark' value={1}></IonSelectOption>\n                <IonSelectOption className='light' value={2}></IonSelectOption>\n                <IonSelectOption className='oldPaper' value={3}></IonSelectOption>\n                <IonSelectOption className='marble' value={4}></IonSelectOption>\n              </IonSelect>\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={documentText} slot='start' />\n              <IonLabel className='ion-text-wrap uiFont'></IonLabel>\n              <IonToggle slot='end' checked={this.props.rtlVerticalLayout} onIonChange={e => {\n                const isChecked = e.detail.checked;\n                this.props.dispatch({\n                  type: \"SET_KEY_VAL\",\n                  key: 'rtlVerticalLayout',\n                  val: isChecked\n                });\n              }} />\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={documentText} slot='start' />\n              <IonLabel className='ion-text-wrap uiFont'>/</IonLabel>\n              <IonToggle slot='end' checked={this.props.paginated} onIonChange={e => {\n                const isChecked = e.detail.checked;\n                this.props.dispatch({\n                  type: \"SET_KEY_VAL\",\n                  key: 'paginated',\n                  val: isChecked\n                });\n              }} />\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={documentText} slot='start' />\n              <IonLabel className='ion-text-wrap uiFont'></IonLabel>\n              <IonSelect slot='end'\n                value={this.props.scrollbarSize}\n                style={{ fontSize: 'var(--ui-font-size)' }}\n                interface='popover'\n                interfaceOptions={{ cssClass: 'uiFont' }}\n                onIonChange={e => {\n                  const value = e.detail.value;\n                  this.props.dispatch({\n                    type: \"SET_KEY_VAL\",\n                    key: 'scrollbarSize',\n                    val: value,\n                  });\n                  Globals.updateCssVars(this.props.settings);\n                }}>\n                <IonSelectOption value={0}></IonSelectOption>\n                <IonSelectOption value={1}></IonSelectOption>\n                <IonSelectOption value={2}></IonSelectOption>\n              </IonSelect>\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={documentText} slot='start' />\n              <IonLabel className='ion-text-wrap uiFont'></IonLabel>\n              <IonToggle slot='end' checked={this.props.showComments} onIonChange={e => {\n                const isChecked = e.detail.checked;\n                (this.props as any).dispatch({\n                  type: \"SET_KEY_VAL\",\n                  key: 'showComments',\n                  val: isChecked\n                });\n              }} />\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={text} slot='start' />\n              <IonLabel className='ion-text-wrap uiFont'>/()</IonLabel>\n              <IonToggle slot='end' checked={this.props.useFontKai} onIonChange={e => {\n                const isChecked = e.detail.checked;\n                (this.props as any).dispatch({\n                  type: \"SET_KEY_VAL\",\n                  key: 'useFontKai',\n                  val: isChecked\n                });\n                Globals.updateCssVars(this.props.settings);\n              }} />\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={text} slot='start' />\n              <div className=\"contentBlock\">\n                <div style={{ flexDirection: \"column\" }}>\n                  <IonLabel className='ion-text-wrap uiFont'>UI: {this.props.uiFontSize}</IonLabel>\n                  <IonRange min={10} max={128} pin={true} snaps={true} value={this.props.uiFontSize} onIonChange={e => {\n                    this.props.dispatch({\n                      type: \"SET_KEY_VAL\",\n                      key: 'uiFontSize',\n                      val: e.detail.value,\n                    });\n                    Globals.updateCssVars(this.props.settings);\n                  }} />\n                </div>\n              </div>\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={text} slot='start' />\n              <div className=\"contentBlock\">\n                <IonLabel className='ion-text-wrap uiFont'>: <span className='textFont'>{this.props.settings.fontSize}</span></IonLabel>\n                <IonRange min={10} max={128} pin={true} snaps={true} value={this.props.settings.fontSize} onIonChange={e => {\n                  this.props.dispatch({\n                    type: \"SET_KEY_VAL\",\n                    key: 'fontSize',\n                    val: e.detail.value,\n                  });                  \n                  Globals.updateCssVars(this.props.settings);\n                }} />\n              </div>\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={musicalNotes} slot='start' />\n              <div className=\"contentBlock\">\n                <div style={{ flexDirection: \"column\" }}>\n                  <IonLabel className='ion-text-wrap uiFont'><a href=\"https://github.com/MrMYHuang/cbetar2#text2speech\" target=\"_new\"></a>: {this.props.speechRate}</IonLabel>\n                  <IonRange min={0.1} max={1.5} step={0.1} snaps={true} value={this.props.speechRate} onIonChange={e => {\n                    this.props.dispatch({\n                      type: \"SET_KEY_VAL\",\n                      key: 'speechRate',\n                      val: (e.detail.value as number).toFixed(1),\n                    });\n                  }} />\n                </div>\n              </div>\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={helpCircle} slot='start' />\n              <div style={{ fontSize: 'var(--ui-font-size)' }}>\n                <div></div>\n                <div><a href=\"https://github.com/MrMYHuang/cbetar2#web-app\" target=\"_new\"></a></div>\n                <div><a href=\"https://github.com/MrMYHuang/cbetar2\" target=\"_new\"></a></div>\n                <div>CBETA API: {Globals.apiVersion}</div>\n                <div><a href=\"http://cbdata.dila.edu.tw/v1.2/\" target=\"_new\">CBETA API</a></div>\n                <div><a href=\"http://glossaries.dila.edu.tw/?locale=zh-TW\" target=\"_new\">DILA </a></div>\n                <div>: Meng-Yuan Huang</div>\n                <div><a href=\"mailto:myh@live.com\" target=\"_new\">myh@live.com</a></div>\n                <div><a href=\"https://github.com/MrMYHuang/cbetar2#contributors\" target=\"_new\">App</a></div>\n                <div><a href='/' onClick={e => {\n                  e.preventDefault();\n                  this.setState({ showFontLicense: true });\n                }}></a></div>\n              </div>\n            </IonItem>\n            <IonAlert\n              cssClass='uiFont'\n              isOpen={this.state.showFontLicense}\n              backdropDismiss={false}\n              message=\"app(2020-08-18) (Open Government Data License) https://data.gov.tw/license\"\n              buttons={[\n                {\n                  text: '',\n                  cssClass: 'primary uiFont',\n                  handler: (value) => {\n                    this.setState({\n                      showFontLicense: false,\n                    });\n                  },\n                },\n                {\n                  text: '',\n                  cssClass: 'secondary uiFont',\n                  handler: (value) => {\n                    this.setState({\n                      showFontLicense: false,\n                    });\n                    window.open('https://data.gov.tw/license');\n                  },\n                }\n              ]}\n            />\n          </IonList>\n        </IonContent>\n      </IonPage >\n    );\n  }\n};\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n    settings: state.settings,\n    hasAppLog: state.settings.hasAppLog,\n    theme: state.settings.theme,\n    showComments: state.settings.showComments,\n    paginated: state.settings.paginated,\n    rtlVerticalLayout: state.settings.rtlVerticalLayout,\n    scrollbarSize: state.settings.scrollbarSize,\n    useFontKai: state.settings.useFontKai,\n    uiFontSize: state.settings.uiFontSize,\n    speechRate: state.settings.speechRate,\n    bookmarks: state.settings.bookmarks,\n  }\n};\n\nexport default connect(\n  mapStateToProps,\n)(SettingsPage);\n","import React from 'react';\nimport { IonContent, IonHeader, IonPage, IonTitle, IonToolbar, IonList, IonReorderGroup, IonReorder, IonItem, IonLabel, withIonLifeCycle, IonItemSliding, IonItemOptions, IonItemOption, IonIcon, IonButton, IonToast } from '@ionic/react';\nimport { ItemReorderEventDetail } from '@ionic/core';\nimport { RouteComponentProps } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport './WorkPage.css';\nimport { Bookmark, BookmarkType } from '../models/Bookmark';\nimport { download, swapVertical } from 'ionicons/icons';\nimport queryString from 'query-string';\n\ninterface Props {\n  dispatch: Function;\n  bookmarks: [Bookmark];\n  fontSize: number;\n}\n\ninterface State {\n  reorder: boolean;\n  showToast: boolean;\n  toastMessage: string;\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n  tab: string;\n  path: string;\n}> { }\n\nconst helpDoc = <>\n  <div style={{ fontSize: 'var(--ui-font-size)', textAlign: 'center' }}> <IonIcon icon={download} /></div>\n  <div style={{ fontSize: 'var(--ui-font-size)', textAlign: 'center' }}><a href=\"https://github.com/MrMYHuang/cbetar2#bookmark\" target=\"_new\"></a></div>\n  <div style={{ fontSize: 'var(--ui-font-size)', textAlign: 'center' }}><a href=\"https://github.com/MrMYHuang/cbetar2#web-app\" target=\"_new\"></a></div>\n  <div style={{ fontSize: 'var(--ui-font-size)', textAlign: 'center' }}><a href=\"https://github.com/MrMYHuang/cbetar2#shortcuts\" target=\"_new\"></a></div>\n</>;\n\nclass _BookmarkPage extends React.Component<PageProps, State> {\n  bookmarkListRef: React.RefObject<HTMLIonListElement>;\n  constructor(props: any) {\n    super(props);\n    this.state = {\n      reorder: false,\n      showToast: false,\n      toastMessage: '',\n    }\n    this.bookmarkListRef = React.createRef<HTMLIonListElement>();\n  }\n\n  ionViewWillEnter() {\n    let queryParams = queryString.parse(this.props.location.search) as any;\n    if (queryParams.item && queryParams.item < this.props.bookmarks.length) {\n      const bookmark = this.props.bookmarks[queryParams.item];\n      this.props.history.push(`/catalog/juan/${bookmark.work?.work}/${bookmark.work?.juan}`);\n    }\n    //console.log( 'view will enter' );\n  }\n\n  get hasBookmark() {\n    return this.props.bookmarks.length > 0;\n  }\n\n  delBookmarkHandler(uuidStr: string) {\n    this.props.dispatch({\n      type: \"DEL_BOOKMARK\",\n      uuid: uuidStr,\n    });\n  }\n\n  reorderBookmarks(event: CustomEvent<ItemReorderEventDetail>) {\n    const bookmarks = event.detail.complete(this.props.bookmarks);\n    this.props.dispatch({\n      type: \"UPDATE_BOOKMARKS\",\n      bookmarks: bookmarks,\n    });\n  }\n\n  render() {\n    let bookmarks = this.props.bookmarks;\n    let rows = Array<object>();\n    bookmarks.forEach((bookmark, i) => {\n      let routeLink = ``;\n      let label = `${bookmark.selectedText}`;\n      let isHtmlNode = false;\n      switch (bookmark.type) {\n        case BookmarkType.CATALOG:\n          routeLink = `/catalog/catalog/${bookmark.uuid}`; break;\n        case BookmarkType.WORK:\n          routeLink = `/catalog/work/${bookmark.uuid}`; break;\n        case BookmarkType.JUAN:\n          routeLink = `/catalog/juan/${bookmark.work?.work}/${bookmark.work?.juan}`;\n          label = `${bookmark.work?.title}${bookmark.work?.juan} - ${label}`; break;\n        case BookmarkType.HTML:\n          isHtmlNode = true;\n          routeLink = `/catalog/juan/${bookmark.work?.work}/1`;\n          label = `${bookmark.work?.title} - ${label}`; break;\n      }\n      rows.push(\n        <IonItemSliding key={`bookmarkItemSliding_` + i}>\n          <IonItem key={`bookmarkItem_` + i} button={true} onClick={async event => {\n            if (this.state.reorder) {\n              this.setState({showToast: true, toastMessage: ''});\n              return;\n            }\n\n            event.preventDefault();\n            this.props.history.push({\n              pathname: routeLink,\n              state: {\n                uuid: bookmark.uuid,\n              },\n              search: queryString.stringify(isHtmlNode ? { file: bookmark.fileName, title: bookmark.work?.title } : {}),\n            });\n          }}>\n            <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n            <IonLabel className='ion-text-wrap uiFont' key={`bookmarkItemLabel_` + i}>\n              {label}\n            </IonLabel>\n            {bookmark.type === BookmarkType.CATALOG ? '' : <IonIcon icon={download} slot='end' />}\n            <IonReorder slot='end' />\n          </IonItem>\n\n          <IonItemOptions side=\"end\">\n            <IonItemOption style={{ fontSize: 'var(--ui-font-size)' }} color='danger' onClick={(e) => {\n              this.delBookmarkHandler(bookmark.uuid);\n              this.bookmarkListRef.current?.closeSlidingItems();\n            }}></IonItemOption>\n          </IonItemOptions>\n        </IonItemSliding>\n      );\n    });\n    return (\n      <IonPage>\n        <IonHeader>\n          <IonToolbar>\n            <IonTitle style={{ fontSize: 'var(--ui-font-size)' }}></IonTitle>\n\n            <IonButton fill={this.state.reorder ? 'solid' : 'clear'} slot='end'\n              onClick={ev => this.setState({ reorder: !this.state.reorder })}>\n              <IonIcon icon={swapVertical} slot='icon-only' />\n            </IonButton>\n          </IonToolbar>\n        </IonHeader>\n        <IonContent>\n          {this.hasBookmark ?\n            <>\n              <IonList ref={this.bookmarkListRef}>\n                <IonReorderGroup disabled={!this.state.reorder} onIonItemReorder={(event: CustomEvent<ItemReorderEventDetail>) => { this.reorderBookmarks(event); }}>\n                  {rows}\n                </IonReorderGroup>\n              </IonList>\n              {helpDoc}\n            </> :\n            <IonLabel className='contentCenter'>\n              <div>\n                <div></div>\n                <div style={{ fontSize: 'var(--ui-font-size)', paddingTop: 24, paddingBottom: 24 }}><a href=\"/catalog\" target=\"_self\"></a></div>\n                {helpDoc}\n              </div>\n            </IonLabel>\n          }\n\n          <IonToast\n            cssClass='uiFont'\n            isOpen={this.state.showToast}\n            onDidDismiss={() => this.setState({ showToast: false })}\n            message={this.state.toastMessage}\n            duration={2000}\n          />\n        </IonContent>\n      </IonPage>\n    );\n  }\n};\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n    bookmarks: state.settings.bookmarks,\n  }\n};\n\n//const mapDispatchToProps = {};\n\nconst BookmarkPage = withIonLifeCycle(_BookmarkPage);\n\nexport default connect(\n  mapStateToProps,\n)(BookmarkPage);\n","export class Search {\n    type: string;\n    n: string;\n    label: string;\n    work: string;\n    title: string;\n    creators: string;\n\n    constructor(json: any) {\n        this.type = json[\"type\"];\n        this.n = json[\"n\"];\n        this.label = json[\"label\"];\n        this.work = json[\"work\"];\n        this.title = json[\"title\"];\n        this.creators = json[\"creators\"] ?? '';\n    }\n}\n","import React from 'react';\nimport { IonContent, IonHeader, IonPage, IonTitle, IonToolbar, IonList, IonItem, IonLabel, withIonLifeCycle, IonButton, IonIcon, IonLoading } from '@ionic/react';\nimport { RouteComponentProps } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport Globals from '../Globals';\nimport { Search } from '../models/Search';\nimport SearchAlert from '../components/SearchAlert';\nimport { home, search, arrowBack, shareSocial, refreshCircle } from 'ionicons/icons';\n\ninterface Props {\n  dispatch: Function;\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n  tab: string;\n  path: string;\n  label: string;\n  keyword: string;\n}> { }\n\ninterface State {\n  fetchError: boolean;\n  showSearchAlert: boolean;\n  searches: Array<Search>;\n  isLoading: boolean;\n}\n\nclass _SearchPage extends React.Component<PageProps, State> {\n  constructor(props: any) {\n    super(props);\n    this.state = {\n      fetchError: false,\n      showSearchAlert: false,\n      searches: [],\n      isLoading: false,\n    }\n  }\n\n  ionViewWillEnter() {\n    //console.log( 'view will enter' );\n    this.search(this.props.match.params.keyword);\n  }\n\n  async search(keyword: string) {\n    this.setState({ isLoading: true });\n    try {\n      const res = await Globals.axiosInstance.get(`/toc?q=${keyword}`, {\n        responseType: 'arraybuffer',\n      });\n      const data = JSON.parse(new TextDecoder().decode(res.data)).results as [any];\n      const searches = data.map((json) => new Search(json));\n\n      this.setState({ fetchError: false, isLoading: false, searches: searches });\n      return true;\n    } catch (e) {\n      console.error(e);\n      console.error(new Error().stack);\n      this.setState({ fetchError: true, isLoading: false });\n      return false;\n    }\n  }\n\n  get isTopPage() {\n    return this.props.match.url === '/catalog';\n  }\n\n  getRows() {\n    let rows = Array<object>();\n    const searches = this.state.searches;\n    searches.forEach((search, i) => {\n      const isCatalog = search.type === 'catalog';\n      let label = isCatalog ? search.label : `${search.title}\\n:${search.creators}`;\n      let routeLink = `/${this.props.match.params.tab}` + (isCatalog ? `/catalog/${search.n}` : `/work/${search.work}`);\n      rows.push(\n        <IonItem key={`searchItem_` + i} button={true} onClick={async event => {\n          event.preventDefault();\n          this.props.history.push({\n            pathname: routeLink,\n          });\n        }}>\n          <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n          <IonLabel className='ion-text-wrap uiFont' key={`searchLabel_` + i}>\n            {label}\n          </IonLabel>\n        </IonItem>\n      );\n    });\n    return rows;\n  }\n\n  render() {\n    let rows = this.getRows();\n    return (\n      <IonPage>\n        <IonHeader>\n          <IonToolbar>\n            <IonTitle style={{ fontSize: 'var(--ui-font-size)' }}> - {this.props.match.params.keyword}</IonTitle>\n            <IonButton hidden={this.isTopPage} fill=\"clear\" slot='start' onClick={e => this.props.history.goBack()}>\n              <IonIcon icon={arrowBack} slot='icon-only' />\n            </IonButton>\n\n            <IonButton hidden={!this.state.fetchError} fill=\"clear\" slot='end' onClick={e => this.search(this.props.match.params.keyword)}>\n              <IonIcon icon={refreshCircle} slot='icon-only' />\n            </IonButton>\n\n            <IonButton fill=\"clear\" slot='end' onClick={e => this.props.history.push(`/${this.props.match.params.tab}`)}>\n              <IonIcon icon={home} slot='icon-only' />\n            </IonButton>\n\n            <IonButton fill=\"clear\" slot='end' onClick={e => this.setState({ showSearchAlert: true })}>\n              <IonIcon icon={search} slot='icon-only' />\n            </IonButton>\n\n            <IonButton fill=\"clear\" slot='end' onClick={e => {\n              this.props.dispatch({\n                type: \"TMP_SET_KEY_VAL\",\n                key: 'shareTextModal',\n                val: {\n                  show: true,\n                  text: decodeURIComponent(window.location.href),\n                },\n              });\n            }}>\n              <IonIcon icon={shareSocial} slot='icon-only' />\n            </IonButton>\n          </IonToolbar>\n        </IonHeader>\n        <IonContent>\n          {\n            this.state.fetchError ?\n              Globals.fetchErrorContent :\n              <IonList>\n                {rows}\n              </IonList>\n          }\n\n          <IonLoading\n            cssClass='uiFont'\n            isOpen={this.state.isLoading}\n            onDidDismiss={() => this.setState({ isLoading: false })}\n            message={'...'}\n          />\n\n          <SearchAlert\n            {...{\n              showSearchAlert: this.state.showSearchAlert,\n              finish: () => { this.setState({ showSearchAlert: false }) }, ...this.props\n            }}\n          />\n        </IonContent>\n      </IonPage>\n    );\n  }\n};\n\nconst SearchPage = withIonLifeCycle(_SearchPage);\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n  }\n};\n\n//const mapDispatchToProps = {};\n\nexport default connect(\n  mapStateToProps,\n)(SearchPage);\n","import React from 'react';\nimport { IonContent, IonHeader, IonPage, IonToolbar, withIonLifeCycle, IonButton, IonIcon, IonSearchbar, IonAlert, IonPopover, IonList, IonItem, IonLabel, IonLoading } from '@ionic/react';\nimport { RouteComponentProps } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport Globals from '../Globals';\nimport { home, arrowBack, shareSocial, book, ellipsisHorizontal, ellipsisVertical, refreshCircle } from 'ionicons/icons';\nimport { DictItem } from '../models/DictItem';\n\ninterface Props {\n  dispatch: Function;\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n  tab: string;\n  path: string;\n  keyword: string;\n}> { }\n\ninterface State {\n  keyword: string;\n  fetchError: boolean;\n  searches: Array<DictItem>;\n  showNoSelectedTextAlert: boolean;\n  popover: any;\n  isLoading: boolean;\n}\n\nclass _DictionaryPage extends React.Component<PageProps, State> {\n  searchBarRef: React.RefObject<HTMLIonSearchbarElement>;\n  constructor(props: any) {\n    super(props);\n    this.state = {\n      keyword: '',\n      fetchError: false,\n      searches: [],\n      showNoSelectedTextAlert: false,\n      popover: {\n        show: false,\n        event: null,\n      },\n      isLoading: false,\n    }\n    this.searchBarRef = React.createRef<HTMLIonSearchbarElement>();\n  }\n\n  ionViewWillEnter() {\n    //console.log( 'view will enter' );\n    if (this.props.match.params.keyword) {\n      this.setState({ keyword: this.props.match.params.keyword });\n      this.lookupDict(this.props.match.params.keyword);\n    }\n  }\n\n  ionViewWillLeave() {\n  }\n\n  get isTopPage() {\n    return this.props.match.url === `/${this.props.match.params.tab}`;\n  }\n\n  async lookupDict(keyword: string) {\n    this.setState({ isLoading: true });\n    try {\n      const res = await Globals.axiosInstance.get(\n        `${Globals.dilaDictApiUrl}/?type=match&dicts=dila&term=${keyword}`,\n        {\n          responseType: 'json',\n        });\n      this.setState({ fetchError: false, isLoading: false, searches: res.data });\n    } catch (e) {\n      console.error(e);\n      console.error(new Error().stack);\n      this.setState({ fetchError: true, isLoading: false });\n      return false;\n    }\n  }\n\n  getSelectedString() {\n    const sel = document.getSelection();\n    if ((sel?.rangeCount || 0) > 0 && sel!.getRangeAt(0).toString().length > 0) {\n      return sel!.getRangeAt(0).toString();\n    } else {\n      return '';\n    }\n  }\n\n  getRows() {\n    const data = this.state.searches as [DictItem];\n    let rows = Array<object>();\n    data.forEach((item: DictItem, index: number) => {\n      rows.push(\n        <div style={{ display: 'table-row' }} key={`dictItem` + index}>\n          <div className='tableCell'>\n            <div className='ion-text-wrap textFont' style={{ color: 'var(--ion-color-primary)', paddingBottom: '18pt' }} dangerouslySetInnerHTML={{ __html: item.dict_name_zh }}></div>\n            <div className='ion-text-wrap textFont' key={`dictItemLabel` + index} dangerouslySetInnerHTML={{ __html: item.desc }}>\n            </div>\n          </div>\n        </div>\n      );\n    });\n    return rows;\n  }\n\n  selectedTextBeforeIonPopover = '';\n  render() {\n    return (\n      <IonPage>\n        <IonHeader>\n          <IonToolbar>\n            <IonButton hidden={this.isTopPage} fill=\"clear\" slot='start' onClick={e => this.props.history.goBack()}>\n              <IonIcon icon={arrowBack} slot='icon-only' />\n            </IonButton>\n\n            <IonButton slot='start' onClick={ev => {\n              this.props.history.push({\n                pathname: `/dictionary/searchWord/`,\n              });\n            }}>\n              <span className='uiFont' style={{ color: 'var(--color)' }}></span>\n            </IonButton>\n\n            <IonButton hidden={!this.state.fetchError} fill=\"clear\" slot='end' onClick={e => this.lookupDict(this.props.match.params.keyword)}>\n              <IonIcon icon={refreshCircle} slot='icon-only' />\n            </IonButton>\n\n            <IonButton fill=\"clear\" slot='end' onClick={e => {\n              this.props.dispatch({\n                type: \"TMP_SET_KEY_VAL\",\n                key: 'shareTextModal',\n                val: {\n                  show: true,\n                  text: decodeURIComponent(window.location.href),\n                },\n              });\n            }}>\n              <IonIcon icon={shareSocial} slot='icon-only' />\n            </IonButton>\n\n            <IonButton fill=\"clear\" slot='end' onClick={e => {\n              // Because after showing IonPopover, document.getSelection() changes.\n              // Thus, we must capture the selected text in advance.\n              this.selectedTextBeforeIonPopover = this.getSelectedString();\n              this.setState({ popover: { show: true, event: e.nativeEvent } });\n            }}>\n              <IonIcon ios={ellipsisHorizontal} md={ellipsisVertical} slot='icon-only' />\n            </IonButton>\n\n            <IonPopover\n              isOpen={this.state.popover.show}\n              event={this.state.popover.event}\n              onDidDismiss={e => {\n                this.selectedTextBeforeIonPopover = '';\n                this.setState({ popover: { show: false, event: null } });\n              }}\n            >\n              <IonList>\n                <IonItem button onClick={e => {\n                  this.props.history.push(`/${this.props.match.params.tab}`);\n                  this.setState({ popover: { show: false, event: null } });\n                }}>\n                  <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                  <IonIcon icon={home} slot='start' />\n                  <IonLabel className='ion-text-wrap uiFont'></IonLabel>\n                </IonItem>\n\n                <IonItem button onClick={e => {\n                  this.setState({ popover: { show: false, event: null } });\n                  if (this.selectedTextBeforeIonPopover === '') {\n                    this.setState({ showNoSelectedTextAlert: true });\n                    return;\n                  }\n\n                  this.props.history.push({\n                    pathname: `/dictionary/search/${this.selectedTextBeforeIonPopover}`,\n                  });\n                }}>\n                  <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                  <IonIcon icon={book} slot='start' />\n                  <IonLabel className='ion-text-wrap uiFont'></IonLabel>\n                </IonItem>\n\n                <IonItem button onClick={e => {\n                  this.setState({ popover: { show: false, event: null } });\n                  if (this.selectedTextBeforeIonPopover === '') {\n                    this.setState({ showNoSelectedTextAlert: true });\n                    return;\n                  }\n\n                  this.props.history.push({\n                    pathname: `/dictionary/searchWord/${this.selectedTextBeforeIonPopover}`,\n                  });\n                }}>\n                  <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                  <IonIcon icon={book} slot='start' />\n                  <IonLabel className='ion-text-wrap uiFont'></IonLabel>\n                </IonItem>\n              </IonList>\n            </IonPopover>\n          </IonToolbar>\n        </IonHeader>\n        <IonContent>\n          <IonSearchbar ref={this.searchBarRef} placeholder='Enter' value={this.state.keyword}\n            onIonChange={ev => {\n              this.setState({ keyword: ev.detail.value! })\n            }}\n            onIonClear={ev => {\n              this.setState({ searches: [] });\n            }}\n            onKeyUp={ev => {\n              if (ev.key === 'Enter') {\n                this.props.history.push({\n                  pathname: `/dictionary/search/${this.state.keyword}`,\n                });\n              }\n            }} />\n          {/*\n              <IonButton slot='end' size='large' style={{ fontSize: 'var(--ui-font-size)' }} onClick={e => {\n                this.lookupDict(this.state.keyword);\n              }}></IonButton>*/}\n\n          {this.state.fetchError ?\n            Globals.fetchErrorContent :\n            <div style={{ display: 'table' }}>\n              {this.getRows()}\n            </div>\n          }\n\n          <div style={{ fontSize: 'var(--ui-font-size)', textAlign: 'center' }}><a href=\"https://github.com/MrMYHuang/cbetar2#dictionary\" target=\"_new\"></a></div>\n\n          <IonAlert\n            cssClass='uiFont'\n            isOpen={this.state.showNoSelectedTextAlert}\n            backdropDismiss={false}\n            header=''\n            message='!'\n            buttons={[\n              {\n                text: '',\n                cssClass: 'primary uiFont',\n                handler: (value) => {\n                  this.setState({\n                    showNoSelectedTextAlert: false,\n                  });\n                },\n              }\n            ]}\n          />\n\n          <IonLoading\n            cssClass='uiFont'\n            isOpen={this.state.isLoading}\n            onDidDismiss={() => this.setState({ isLoading: false })}\n            message={'...'}\n          />\n        </IonContent>\n      </IonPage>\n    );\n  }\n};\n\nconst DictionaryPage = withIonLifeCycle(_DictionaryPage);\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n  }\n};\n\n//const mapDispatchToProps = {};\n\nexport default connect(\n  mapStateToProps,\n)(DictionaryPage);\n","export class FullTextSearch {\n    id: number;\n    term_hits: number;\n    work: string;\n    juan: number;\n    title: string;\n    creators: string;\n\n    constructor(json: any) {\n        this.id = json.id;\n        this.term_hits = json.term_hits;\n        this.work = json.work;\n        this.juan = json.juan;\n        this.title = json.title;\n        this.creators = json.creators;\n    }\n}\n","import React from 'react';\nimport { IonContent, IonHeader, IonPage, IonTitle, IonToolbar, IonList, IonItem, IonLabel, withIonLifeCycle, IonButton, IonIcon, IonLoading } from '@ionic/react';\nimport { RouteComponentProps } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport Globals from '../Globals';\nimport SearchAlert from '../components/SearchAlert';\nimport { home, search, arrowBack, shareSocial, refreshCircle } from 'ionicons/icons';\nimport { FullTextSearch } from '../models/FullTextSearch';\n\ninterface Props {\n  dispatch: Function;\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n  tab: string;\n  path: string;\n  label: string;\n  keyword: string;\n}> { }\n\ninterface State {\n  showSearchAlert: boolean;\n  searches: Array<FullTextSearch>;\n  isLoading: boolean;\n  fetchError: boolean;\n}\n\nclass _SearchPage extends React.Component<PageProps, State> {\n  constructor(props: any) {\n    super(props);\n    this.state = {\n      showSearchAlert: false,\n      searches: [],\n      isLoading: false,\n      fetchError: false,\n    }\n  }\n\n  ionViewWillEnter() {\n    //console.log( 'view will enter' );\n    this.search(this.props.match.params.keyword);\n  }\n\n  async search(keyword: string) {\n    this.setState({ isLoading: true });\n    try {\n      const res = await Globals.axiosInstance.get(`/sphinx?q=${keyword}`, {\n        responseType: 'arraybuffer',\n      });\n      const data = JSON.parse(new TextDecoder().decode(res.data)).results as [any];\n      const searches = data.map((json) => new FullTextSearch(json));\n\n      this.setState({ fetchError: false, isLoading: false, searches: searches });\n      return true;\n    } catch (e) {\n      console.error(e);\n      console.error(new Error().stack);\n      this.setState({ fetchError: true, isLoading: false });\n      return false;\n    }\n  }\n\n  get isTopPage() {\n    return this.props.match.url === '/catalog';\n  }\n\n  getRows() {\n    let rows = Array<object>();\n    const searches = (this.state as any).searches as [FullTextSearch];\n    searches.forEach((search, i) => {\n      let label = `${search.title}${search.juan}\\n:${search.creators}`;\n      let routeLink = `/catalog/juan/${search.work}/${search.juan}`;\n      rows.push(\n        <IonItem key={`searchItem_` + i} button={true} onClick={async event => {\n          event.preventDefault();\n          this.props.history.push({\n            pathname: routeLink,\n          });\n        }}>\n          <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n          <IonLabel className='ion-text-wrap uiFont' key={`searchLabel_` + i}>\n            {label}\n          </IonLabel>\n        </IonItem>\n      );\n    });\n    return rows;\n  }\n\n  render() {\n    let rows = this.getRows();\n    return (\n      <IonPage>\n        <IonHeader>\n          <IonToolbar>\n            <IonTitle style={{ fontSize: 'var(--ui-font-size)' }}> - {this.props.match.params.keyword}</IonTitle>\n            <IonButton hidden={this.isTopPage} fill=\"clear\" slot='start' onClick={e => this.props.history.goBack()}>\n              <IonIcon icon={arrowBack} slot='icon-only' />\n            </IonButton>\n\n            <IonButton hidden={!this.state.fetchError} fill=\"clear\" slot='end' onClick={e => this.search(this.props.match.params.keyword)}>\n              <IonIcon icon={refreshCircle} slot='icon-only' />\n            </IonButton>\n\n            <IonButton fill=\"clear\" slot='end' onClick={e => this.props.history.push(`/${this.props.match.params.tab}`)}>\n              <IonIcon icon={home} slot='icon-only' />\n            </IonButton>\n            \n            <IonButton fill=\"clear\" slot='end' onClick={e => this.setState({ showSearchAlert: true })}>\n              <IonIcon icon={search} slot='icon-only' />\n            </IonButton>\n\n            <IonButton fill=\"clear\" slot='end' onClick={e => {\n              this.props.dispatch({\n                type: \"TMP_SET_KEY_VAL\",\n                key: 'shareTextModal',\n                val: {\n                  show: true,\n                  text: decodeURIComponent(window.location.href),\n                },\n              });\n            }}>\n              <IonIcon icon={shareSocial} slot='icon-only' />\n            </IonButton>\n          </IonToolbar>\n        </IonHeader>\n        <IonContent>\n          {\n            this.state.fetchError ?\n              Globals.fetchErrorContent :\n              <IonList>\n                {rows}\n              </IonList>\n          }\n\n          <IonLoading\n            cssClass='uiFont'\n            isOpen={this.state.isLoading}\n            onDidDismiss={() => this.setState({ isLoading: false })}\n            message={'...'}\n          />\n\n          <SearchAlert\n            {...{\n              showSearchAlert: (this.state as any).showSearchAlert,\n              finish: () => { this.setState({ showSearchAlert: false }) }, ...this.props\n            }}\n          />\n        </IonContent>\n      </IonPage>\n    );\n  }\n};\n\nconst SearchPage = withIonLifeCycle(_SearchPage);\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n  }\n};\n\n//const mapDispatchToProps = {};\n\nexport default connect(\n  mapStateToProps,\n)(SearchPage);\n","import React from 'react';\nimport { IonButton, IonContent, IonLabel, IonModal } from '@ionic/react';\nimport { RouteComponentProps } from 'react-router-dom';\nimport * as qrcode from 'qrcode';\n\ninterface Props {\n  showModal: boolean;\n  text: string;\n  finish: Function;\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n  tab: string;\n  path: string;\n}> { }\n\nclass _ShareTextModal extends React.Component<PageProps> {\n  /*constructor(props: any) {\n    super(props);\n  }*/\n\n  updateQrCode() {\n    navigator.clipboard && navigator.clipboard.writeText(this.props.text);\n    const qrcCanvas = document.getElementById('qrcCanvas');\n    qrcode.toCanvas(qrcCanvas, this.props.text);\n    return qrcCanvas;\n  }\n\n  render() {\n    return (\n      <IonModal\n        isOpen={this.props.showModal}\n        cssClass='uiFont'\n        swipeToClose={true}\n        //presentingElement={router || undefined}\n        onWillPresent={() => this.updateQrCode()}\n        onDidDismiss={() => this.props.finish()}>\n        <IonContent>\n          <div style={{display: 'flex', flexDirection: 'column', height: '100%', alignItems: 'center'}}>\n            <div>\n              <IonLabel className='uiFont'>app</IonLabel>\n            </div>\n            <div>\n              <IonLabel className='uiFont'>QR Code:</IonLabel>\n            </div>\n            <div style={{flexGrow: 1, display: 'flex', alignItems: 'center'}}>\n              <canvas id='qrcCanvas' width='500' height='500' style={{margin: '0px auto'}} />\n            </div>\n            <div>\n              <IonButton size='large' onClick={() => this.props.finish()}></IonButton>\n            </div>\n          </div>\n        </IonContent>\n      </IonModal>\n    );\n  }\n};\n\nconst ShareTextModal = (_ShareTextModal);\nexport default ShareTextModal;\n","import React from 'react';\nimport { IonContent, IonHeader, IonPage, IonToolbar, withIonLifeCycle, IonButton, IonIcon, IonSearchbar, IonAlert, IonPopover, IonList, IonItem, IonLabel, IonLoading } from '@ionic/react';\nimport { RouteComponentProps } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport * as uuid from 'uuid';\nimport Globals from '../Globals';\nimport { home, arrowBack, shareSocial, book, ellipsisHorizontal, ellipsisVertical, refreshCircle } from 'ionicons/icons';\nimport { DictWordDefItem, DictWordItem, WordType } from '../models/DictWordItem';\n\ninterface Props {\n  dispatch: Function;\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n  tab: string;\n  path: string;\n  keyword: string;\n}> { }\n\ninterface State {\n  keyword: string;\n  search: [DictWordItem] | null;\n  showNoSelectedTextAlert: boolean;\n  popover: any;\n  isLoading: boolean;\n  fetchError: boolean;\n}\n\nclass _WordDictionaryPage extends React.Component<PageProps, State> {\n  searchBarRef: React.RefObject<HTMLIonSearchbarElement>;\n  constructor(props: any) {\n    super(props);\n    this.state = {\n      keyword: '',\n      search: null,\n      showNoSelectedTextAlert: false,\n      popover: {\n        show: false,\n        event: null,\n      },\n      isLoading: false,\n      fetchError: false,\n    }\n    this.searchBarRef = React.createRef<HTMLIonSearchbarElement>();\n  }\n\n  ionViewWillEnter() {\n    //console.log( 'view will enter' );\n    if (this.props.match.params.keyword) {\n      this.setState({ keyword: this.props.match.params.keyword });\n      this.lookupDict(this.props.match.params.keyword);\n    }\n  }\n\n  ionViewWillLeave() {\n  }\n\n  get isTopPage() {\n    return this.props.match.url === `/${this.props.match.params.tab}`;\n  }\n\n  async lookupDict(keyword: string) {\n    this.setState({ isLoading: true });\n    try {\n      const res = await Globals.axiosInstance.get(\n        `https://www.moedict.tw/uni/${keyword.substring(0, 1)}`,\n        {\n          responseType: 'json',\n        });\n      this.setState({ fetchError: false, isLoading: false, search: res.data.heteronyms });\n    } catch (e) {\n      console.error(e);\n      console.error(new Error().stack);\n      this.setState({ fetchError: true, isLoading: false });\n      return false;\n    }\n  }\n\n  getSelectedString() {\n    const sel = document.getSelection();\n    if ((sel?.rangeCount || 0) > 0 && sel!.getRangeAt(0).toString().length > 0) {\n      return sel!.getRangeAt(0).toString();\n    } else {\n      return '';\n    }\n  }\n\n  defToView(defs: Array<DictWordDefItem> | undefined, title: string) {\n    return defs !== undefined && defs.length > 0 ? <>\n      <div key={uuid.v4()} style={{ color: 'var(--ion-color-primary)' }}>{title}</div>\n      <ol key={uuid.v4()}>{\n        defs?.map((d) =>\n          <li key={uuid.v4()}>\n            <div key={uuid.v4()}>{d.def}</div>\n            {d.quote?.map((q) => <div key={uuid.v4()}>{q}</div>)}\n            {d.example?.map((e) => <div key={uuid.v4()}>{e}</div>)}\n            {d.link?.map((l) => <div key={uuid.v4()}>{l}</div>)}\n          </li>\n        )}\n      </ol>\n    </> : <></>;\n  }\n\n  selectedTextBeforeIonPopover = '';\n  render() {\n    let dictView: any = [];\n    if (this.props.match.params.keyword) {\n      this.state.search?.forEach((data) => {\n        const nouns = data?.definitions.filter((d) => d.type === WordType.NOUN);\n        const verbs = data?.definitions.filter((d) => d.type === WordType.VERB);\n        const others = data?.definitions.filter((d) => d.type === undefined);\n\n        const nounsView = this.defToView(nouns, '');\n        const verbsView = this.defToView(verbs, '');\n        const othersView = this.defToView(others, '');\n\n        dictView.push(\n          <div key={uuid.v4()} className='textFont textSelectable'>\n            <div key={uuid.v4()} className='textFontX3'>{this.props.match.params.keyword.substring(0, 1)}</div>\n            {data?.bopomofo ? <div>{data?.bopomofo}</div> : null}\n            {data?.pinyin ? <div>{data?.pinyin}</div> : null}\n            {nounsView}\n            {verbsView}\n            {othersView}\n          </div>);\n      });\n    }\n\n    return (\n      <IonPage>\n        <IonHeader>\n          <IonToolbar>\n            <IonButton hidden={this.isTopPage} fill=\"clear\" slot='start' onClick={e => this.props.history.goBack()}>\n              <IonIcon icon={arrowBack} slot='icon-only' />\n            </IonButton>\n\n            <IonButton slot='start' onClick={ev => {\n              this.props.history.push({\n                pathname: `/dictionary/`,\n              });\n            }}>\n              <span className='uiFont' style={{ color: 'var(--color)' }}></span>\n            </IonButton>\n\n            <IonButton hidden={!this.state.fetchError} fill=\"clear\" slot='end' onClick={e => this.lookupDict(this.props.match.params.keyword)}>\n              <IonIcon icon={refreshCircle} slot='icon-only' />\n            </IonButton>\n\n            <IonButton fill=\"clear\" slot='end' onClick={e => {\n              this.props.dispatch({\n                type: \"TMP_SET_KEY_VAL\",\n                key: 'shareTextModal',\n                val: {\n                  show: true,\n                  text: decodeURIComponent(window.location.href),\n                },\n              });\n            }}>\n              <IonIcon icon={shareSocial} slot='icon-only' />\n            </IonButton>\n\n            <IonButton fill=\"clear\" slot='end' onClick={e => {\n              // Because after showing IonPopover, document.getSelection() changes.\n              // Thus, we must capture the selected text in advance.\n              this.selectedTextBeforeIonPopover = this.getSelectedString();\n              this.setState({ popover: { show: true, event: e.nativeEvent } });\n            }}>\n              <IonIcon ios={ellipsisHorizontal} md={ellipsisVertical} slot='icon-only' />\n            </IonButton>\n\n            <IonPopover\n              isOpen={this.state.popover.show}\n              event={this.state.popover.event}\n              onDidDismiss={e => {\n                this.setState({ popover: { show: false, event: null } });\n                this.selectedTextBeforeIonPopover = '';\n              }}\n            >\n              <IonList>\n                <IonItem button onClick={e => {\n                  this.props.history.push(`/${this.props.match.params.tab}`);\n                  this.setState({ popover: { show: false, event: null } });\n                }}>\n                  <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                  <IonIcon icon={home} slot='start' />\n                  <IonLabel className='ion-text-wrap uiFont'></IonLabel>\n                </IonItem>\n\n                <IonItem button onClick={e => {\n                  this.setState({ popover: { show: false, event: null } });\n                  if (this.selectedTextBeforeIonPopover === '') {\n                    this.setState({ showNoSelectedTextAlert: true });\n                    return;\n                  }\n\n                  this.props.history.push({\n                    pathname: `/dictionary/search/${this.selectedTextBeforeIonPopover}`,\n                  });\n                }}>\n                  <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                  <IonIcon icon={book} slot='start' />\n                  <IonLabel className='ion-text-wrap uiFont'></IonLabel>\n                </IonItem>\n\n                <IonItem button onClick={e => {\n                  this.setState({ popover: { show: false, event: null } });\n                  if (this.selectedTextBeforeIonPopover === '') {\n                    this.setState({ showNoSelectedTextAlert: true });\n                    return;\n                  }\n\n                  this.props.history.push({\n                    pathname: `/dictionary/searchWord/${this.selectedTextBeforeIonPopover}`,\n                  });\n                }}>\n                  <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                  <IonIcon icon={book} slot='start' />\n                  <IonLabel className='ion-text-wrap uiFont'></IonLabel>\n                </IonItem>\n              </IonList>\n            </IonPopover>\n          </IonToolbar>\n        </IonHeader>\n        <IonContent>\n          <IonSearchbar ref={this.searchBarRef} placeholder='Enter' value={this.state.keyword}\n            onIonChange={ev => {\n              this.setState({ keyword: ev.detail.value! })\n            }}\n            onIonClear={ev => {\n              this.setState({ search: null });\n            }}\n            onKeyUp={ev => {\n              if (ev.key === 'Enter') {\n                this.props.history.push({\n                  pathname: `/dictionary/searchWord/${this.state.keyword}`,\n                });\n              }\n            }} />\n          {/*\n              <IonButton slot='end' size='large' style={{ fontSize: 'var(--ui-font-size)' }} onClick={e => {\n                this.lookupDict(this.state.keyword);\n              }}></IonButton>*/}\n\n          {this.state.fetchError ? Globals.fetchErrorContent : dictView}\n\n          {/*\n          <div style={{ fontSize: 'var(--ui-font-size)', textAlign: 'center' }}><a href=\"https://github.com/MrMYHuang/cbetar2#WordDictionary\" target=\"_new\"></a></div>\n          */}\n\n          <IonAlert\n            cssClass='uiFont'\n            isOpen={this.state.showNoSelectedTextAlert}\n            backdropDismiss={false}\n            header=''\n            message='!'\n            buttons={[\n              {\n                text: '',\n                cssClass: 'primary uiFont',\n                handler: (value) => {\n                  this.setState({\n                    showNoSelectedTextAlert: false,\n                  });\n                },\n              }\n            ]}\n          />\n\n          <IonLoading\n            cssClass='uiFont'\n            isOpen={this.state.isLoading}\n            onDidDismiss={() => this.setState({ isLoading: false })}\n            message={'...'}\n          />\n        </IonContent>\n      </IonPage>\n    );\n  }\n};\n\nconst WordDictionaryPage = withIonLifeCycle(_WordDictionaryPage);\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n  }\n};\n\n//const mapDispatchToProps = {};\n\nexport default connect(\n  mapStateToProps,\n)(WordDictionaryPage);\n","import React from 'react';\nimport { Redirect, Route, RouteComponentProps, withRouter } from 'react-router-dom';\nimport {\n  setupConfig,\n  IonApp,\n  IonIcon,\n  IonRouterOutlet,\n  IonTabBar,\n  IonTabButton,\n  IonTabs,\n  IonAlert,\n} from '@ionic/react';\nimport { IonReactRouter } from '@ionic/react-router';\nimport { connect, Provider } from 'react-redux';\nimport getSavedStore from './redux/store';\nimport { bookmark, settings, library, book } from 'ionicons/icons';\nimport CatalogPage from './pages/CatalogPage';\nimport WorkPage from './pages/WorkPage';\nimport EPubViewPage from './pages/EPubViewPage';\n\n/* Core CSS required for Ionic components to work properly */\nimport '@ionic/react/css/core.css';\n\n/* Basic CSS for apps built with Ionic */\nimport '@ionic/react/css/normalize.css';\nimport '@ionic/react/css/structure.css';\nimport '@ionic/react/css/typography.css';\n\n/* Optional CSS utils that can be commented out */\nimport '@ionic/react/css/padding.css';\nimport '@ionic/react/css/float-elements.css';\nimport '@ionic/react/css/text-alignment.css';\nimport '@ionic/react/css/text-transformation.css';\nimport '@ionic/react/css/flex-utils.css';\nimport '@ionic/react/css/display.css';\n\n/* Theme variables */\nimport './theme/variables.css';\nimport SettingsPage from './pages/SettingsPage';\nimport BookmarkPage from './pages/BookmarkPage';\nimport SearchPage from './pages/SearchPage';\nimport Globals from './Globals';\nimport DictionaryPage from './pages/DictionaryPage';\nimport FullTextSearchPage from './pages/FullTextSearchPage';\nimport ShareTextModal from './components/ShareTextModal';\nimport WordDictionaryPage from './pages/WordDictionaryPage';\n\nlet store = getSavedStore();\n/*\nclass DebugRouter extends IonReactRouter {\n  constructor(props: any) {\n    super(props);\n    console.log('initial history is: ', JSON.stringify(this.history, null, 2))\n    this.history.listen((location, action) => {\n      console.log(\n        `The current URL is ${location.pathname}${location.search}${location.hash}`\n      )\n      console.log(`The last navigation action was ${action}`, JSON.stringify(this.history, null, 2));\n    });\n  }\n}\n*/\n\nconst state = store.getState();\n\nif (!state.settings.hasAppLog) {\n  Globals.disableAppLog();\n}\n\nsetupConfig({\n  mode: 'md',\n  swipeBackEnabled: false,\n});\n\nexport var serviceWorkCallbacks = {\n  onSuccess: function (registration: ServiceWorkerRegistration) { },\n  onUpdate: function (registration: ServiceWorkerRegistration) { },\n};\n\ninterface Props {\n  shareTextModal: any;\n}\n\ninterface PageProps extends RouteComponentProps<{\n  tab: string;\n  path: string;\n}> { }\n\ninterface AppOrigProps extends Props, RouteComponentProps<{\n  tab: string;\n  path: string;\n}> { }\n\ninterface State {\n  showUpdateAlert: boolean;\n}\n\nclass _App extends React.Component<PageProps, State> {\n  render() {\n    return (\n      <Provider store={store}>\n        <AppOrig {...this.props} />\n      </Provider>\n    );\n  }\n}\n\nclass _AppOrig extends React.Component<AppOrigProps, State> {\n  registrationNew: ServiceWorkerRegistration | null;\n\n  constructor(props: any) {\n    super(props);\n    this.registrationNew = null;\n    // ----- Initializing UI settings -----\n    // Apply the theme setting.\n    document.body.classList.forEach((val) => document.body.classList.remove(val));\n    document.body.classList.toggle(`theme${state.settings.theme}`, true);\n    Globals.updateCssVars(state.settings);\n\n    this.state = {\n      showUpdateAlert: false,\n    };\n\n    serviceWorkCallbacks.onUpdate = (registration: ServiceWorkerRegistration) => {\n      this.registrationNew = registration;\n      this.setState({ showUpdateAlert: true });\n    };\n\n    serviceWorkCallbacks.onSuccess = (registration: ServiceWorkerRegistration) => {\n    };\n\n    // Preload speechSynthesis.\n    speechSynthesis.getVoices();\n    speechSynthesis.cancel();\n\n    this.wakeLockScreen();\n    this.loadTwKaiFont();\n  }\n\n  async loadTwKaiFont() {\n    const dbOpenReq = indexedDB.open(Globals.cbetardb);\n    dbOpenReq.onupgradeneeded = function (event: IDBVersionChangeEvent) {\n      var db = (event.target as any).result;\n      db.createObjectStore('store');\n    };\n\n    let fontData: any;\n    await new Promise((ok, fail) => {\n      dbOpenReq.onsuccess = async (ev: Event) => {\n        const db = dbOpenReq.result;\n\n        const trans = db.transaction([\"store\"], 'readwrite');\n        let req = trans.objectStore('store').get(Globals.twKaiFontKey);\n        req.onsuccess = async (_ev: any) => {\n          fontData = req.result;\n          if (!fontData) {\n            const res = await Globals.axiosInstance.get(`${window.location.origin}/${Globals.twKaiFontPath}`, {\n              responseType: 'arraybuffer',\n              timeout: 0,\n            });\n            const transWrite = db.transaction([\"store\"], 'readwrite');\n            fontData = res.data;\n            const reqWrite = transWrite.objectStore('store').put(fontData, Globals.twKaiFontKey);\n            reqWrite.onsuccess = (_ev: any) => {\n              return ok();\n            };\n          }\n          return ok();\n        };\n      };\n    });\n    const fontFace = new (window as any).FontFace('Kai', fontData);\n    await fontFace.load();\n    (document as any).fonts.add(fontFace);\n    console.log('[Main] TW-Kai font loading success!');\n  }\n\n  // Prevent from device sleeping.\n  wakeLock: any;\n  async wakeLockScreen() {\n    try {\n      const wakeLock = (navigator as any).wakeLock;\n      if (wakeLock !== undefined) {\n        this.wakeLock = await wakeLock.request('screen');\n        console.log('Auto screen lock is disabled.');\n      }\n    } catch (err) {\n      // the wake lock request fails - usually system related, such low as battery\n      console.error(`${err.name}, ${err.message}`);\n      console.error(new Error().stack);\n    }\n  }\n\n  routeByQueryString() {\n    // This app uses client side routing. \n    // Without the first loading of this app,\n    // any client side route becomes a server side route!\n    // These invalid server side routings cause 404 errors.\n    // To workaround these errors, we can use GitHub 404.html redirection\n    // to pass the client side routes to this app by using query string.\n    // After this app loads, it can use the query string to correctly redirect to\n    // a client side route!\n    console.log(window.location.search);\n    const routeMatches = /route=([^&]*)/.exec(window.location.search);\n    const queryMatches = /query=([^&]*)/.exec(window.location.search);\n    if (routeMatches !== null) {\n      let query = ''\n      if (queryMatches !== null) {\n        query = decodeURIComponent(queryMatches[1]);\n      }\n      return <Redirect to={routeMatches[1] + query} />;\n    } else if (window.location.pathname === '/') {\n      return <Redirect to=\"/bookmarks\" />;\n    }\n  }\n\n  render() {\n    return (\n      <IonApp style={\n        // Without this, window height shrinks after Android soft keyboard poping up.\n        Globals.isTouchDevice() ? { height: `${window.innerHeight}px` } : {}\n      }>\n        <IonReactRouter>\n          <IonTabs>\n            <IonRouterOutlet animated={false}>\n              {/* The following route is for backward compatibility. */}\n              <Route path=\"/:tab(catalog)/webview/:work/:path/:label\" render={(props: any) => <EPubViewPage {...props} />} exact={true} />\n              <Route path=\"/:tab(catalog)/juan/:work/:path/\" render={(props: any) => <EPubViewPage {...props} />} exact={true} />\n              {/* The following route is for backward compatibility. */}\n              <Route path=\"/:tab(catalog)/work/:path/:label\" component={(props: any) => <WorkPage {...props} />} exact={true} />\n              <Route path=\"/:tab(catalog)/work/:path\" component={(props: any) => <WorkPage {...props} />} exact={true} />\n              <Route path=\"/:tab(catalog)/search/:keyword\" render={props => <SearchPage {...props} />} exact={true} />\n              <Route path=\"/:tab(catalog)/fulltextsearch/:keyword\" render={props => <FullTextSearchPage {...props} />} exact={true} />\n              {/* The following route is for backward compatibility. */}\n              <Route path=\"/:tab(catalog)/catalog/:path/:label\" component={(props: any) => <CatalogPage {...props} />} exact={true} />\n              <Route path=\"/:tab(catalog)/catalog/:path\" component={(props: any) => <CatalogPage key={props.match.url} {...props} />} exact={true} />\n              <Route path=\"/:tab(catalog)\" component={(props: any) => <CatalogPage {...props} />} exact={true} />\n              <Route path=\"/:tab(bookmarks)\" component={BookmarkPage} exact={true} />\n              <Route path={`/:tab(bookmarks)/search/:keyword`} render={props => <SearchPage {...props} />} exact={true} />\n              <Route path={`/:tab(dictionary)`} render={props => <DictionaryPage {...props} />} exact={true} />\n              <Route path={`/:tab(dictionary)/search/:keyword`} render={props => <DictionaryPage key={props.match.url} {...props} />} exact={true} />\n              <Route path={`/:tab(dictionary)/searchWord`} render={props => <WordDictionaryPage key={props.match.url} {...props} />} exact={true} />\n              <Route path={`/:tab(dictionary)/searchWord/:keyword`} render={props => <WordDictionaryPage key={props.match.url} {...props} />} exact={true} />\n              <Route path=\"/settings\" component={SettingsPage} />\n              <Route path=\"/\" render={() => { return this.routeByQueryString(); }} exact={true} />\n            </IonRouterOutlet>\n            <IonTabBar slot=\"bottom\">\n              <IonTabButton tab=\"bookmarks\" href=\"/bookmarks\">\n                <IonIcon icon={bookmark} />\n              </IonTabButton>\n              <IonTabButton tab=\"catalog\" href=\"/catalog\">\n                <IonIcon icon={library} />\n              </IonTabButton>\n              <IonTabButton tab=\"dictionay\" href=\"/dictionary\">\n                <IonIcon icon={book} />\n              </IonTabButton>\n              <IonTabButton tab=\"settings\" href=\"/settings\">\n                <IonIcon icon={settings} />\n              </IonTabButton>\n            </IonTabBar>\n          </IonTabs>\n        </IonReactRouter>\n        <IonAlert\n          cssClass='uiFont'\n          isOpen={this.state.showUpdateAlert}\n          backdropDismiss={false}\n          onDidPresent={(ev) => {\n            // Run SKIP_WAITING at onDidPresent event to avoid a race condition of\n            // an old page fetching old JS chunks with a new service worker!\n            this.registrationNew?.installing?.postMessage({ type: 'SKIP_WAITING' });\n            this.registrationNew?.waiting?.postMessage({ type: 'SKIP_WAITING' });\n          }}\n          header={'appapp!'}\n          buttons={[\n            {\n              text: '',\n              cssClass: 'primary uiFont',\n              handler: (value) => {\n                this.setState({\n                  showUpdateAlert: false,\n                });\n              },\n            },\n            {\n              text: '',\n              cssClass: 'secondary uiFont',\n              handler: (value) => {\n                window.open('https://github.com/MrMYHuang/cbetar2#history');\n              },\n            }\n          ]}\n        />\n\n        <ShareTextModal\n          {...{\n            text: this.props.shareTextModal?.text,\n            showModal: this.props.shareTextModal?.show || false,\n            finish: () => {\n              store.dispatch({\n                type: \"TMP_SET_KEY_VAL\",\n                key: 'shareTextModal',\n                val: { show: false },\n              });\n            }, ...this.props\n          }}\n        />\n      </IonApp>\n    );\n  }\n}\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n    shareTextModal: state.tmpSettings.shareTextModal,\n  }\n};\n\nconst AppOrig = connect(\n  mapStateToProps,\n)(_AppOrig);\n\n\nconst App = withRouter(_App);\n\nexport default App;\n","import { /*applyMiddleware,*/ createStore, Store } from \"redux\";\n\n//import { logger } from \"redux-logger\"\n//import thunk from \"redux-thunk\"\n//import promise from \"redux-promise-middleware\"\n\nimport reducer from \"./reducers\";\nimport Globals from \"../Globals\";\n\n//const middleware = applyMiddleware(promise(), thunk, logger)\n\nvar savedStore: Store;\n\nexport default function getSavedStore() {\n    var savedSettingsStr = localStorage.getItem(Globals.storeFile);\n    if (savedSettingsStr != null) {\n        savedStore = createStore(reducer, JSON.parse(savedSettingsStr));//, middleware)\n    }\n    else {\n        savedStore = createStore(reducer);//, middleware)\n    }\n\n    return savedStore;\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      /*\n      if(registration.waiting) {\n        const reg = registration.waiting;\n        reg.postMessage({ type: 'SKIP_WAITING' });\n        alert('Skip waiting.');\n      }*/\n\n      registration.onupdatefound = () => {\n        //alert('onupdatefound.');\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          console.log(`installingWorker stage changed: ${installingWorker.state}`);\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { BrowserRouter } from \"react-router-dom\";\nimport App, {serviceWorkCallbacks} from './App';\nimport Globals from './Globals';\nimport * as serviceWorker from './serviceWorker';\n\n// Enable at the very start for logging most messages.\nGlobals.enableAppLog();\n\nReactDOM.render(<BrowserRouter><App /></BrowserRouter>, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.register({\n    onSuccess: (registration: ServiceWorkerRegistration) => { console.log('Precache app loaded!'); serviceWorkCallbacks.onSuccess(registration); },\n    onUpdate: (registration: ServiceWorkerRegistration) => { console.log('Found app updated!'); serviceWorkCallbacks.onUpdate(registration); },\n});\n"],"sourceRoot":""}