(this.webpackJsonpcbetar2=this.webpackJsonpcbetar2||[]).push([[2],{109:function(e){e.exports=JSON.parse('{"name":"cbetar2","homepage":"/","productName":"\u96fb\u5b50\u4f5b\u5178","pwaVersion":"4.26.6","version":"13.2.2","license":"MIT","keywords":["CBETA","\u96fb\u5b50\u4f5b\u5178","\u4f5b\u5178","\u4f5b\u7d93","\u5927\u85cf\u7d93","Tripitaka","Buddhist Canon","Buddhist text"],"description":"CBETA\u96fb\u5b50\u4f5b\u5178\u95b1\u8b80\u56682(\u975e\u5b98\u65b9)\uff0c\u4f7f\u7528CBETA API\u5b58\u53d6\u96fb\u5b50\u4f5b\u7d93\u3002","repository":"https://github.com/MrMYHuang/cbetar2","author":{"name":"Meng-Yuan Huang","email":"myh@live.com"},"private":false,"files":["README.md"],"main":"buildElectron/main.js","scripts":{"postinstall":"electron-builder install-app-deps","start":"react-app-rewired start","build":"react-app-rewired build && powershell -file CopyBuild.ps1","build_linux":"react-app-rewired build && ./CopyBuild.sh","test":"react-app-rewired test","eject":"react-scripts eject","build-electron":"tsc -b tsconfigElectron.json","build-electron-store":"tsc -b tsconfigElectron.json && mv buildElectron/mainStore.js buildElectron/main.js","start-electron":"npm run build-electron && electron .","dist-win":"npm run build-electron && electron-builder -w -c electronBuilderConfigs/win.json","dist-deb":"npm run build-electron && electron-builder -l deb -c electronBuilderConfigs/deb.json","dist-rpm":"npm run build-electron && electron-builder -l rpm -c electronBuilderConfigs/rpm.json","dist-snap":"npm run build-electron && rm -f dist/*.snap && electron-builder -l snap -c electronBuilderConfigs/snap.json","dist-snap-arm64":"export SNAPCRAFT_BUILD_ENVIRONMENT=lxd && npm run build-electron-store && rm -f dist/*.snap && electron-builder -l snap -c electronBuilderConfigs/snap.json --arm64","publish-snap":"snapcraft upload --release=stable dist/*.snap","prepare-flatpak":"./flatpak-node-generator.py --xdg-layout -o flatpak/generated-sources.json npm package-lock.json && flatpak run org.freedesktop.appstream-glib validate ./buildElectron/io.github.mrmyhuang.cbetar2.metainfo.xml","dist-flatpak-local":"flatpak-builder build flatpak/io.github.mrmyhuang.cbetar2.yml --install --force-clean --user","dist-flatpak":"electron-builder -l --dir -c electronBuilderConfigs/flatpak.json","dist-mac":"npm run build-electron && electron-builder -m pkg -c electronBuilderConfigs/mac.json","icons-mas":"cd buildElectron && iconutil -c icns icon.iconset","dist-mas":"npm run build-electron-store && electron-builder -m mas --universal -c electronBuilderConfigs/mas.json","dist-mas-dev":"npm run build-electron-store && electron-builder -m mas-dev --arm64 -c electronBuilderConfigs/masDev.json"},"eslintConfig":{"extends":"react-app"},"dependencies":{"@types/semver":"^7.3.8","axios":"^0.21.4","electron-window-state":"^5.0.3","libxslt-myh":"^0.9.12","node-downloader-helper":"^1.0.18","semver":"^7.3.5"},"devDependencies":{"@ionic/react":"^6.0.10","@ionic/react-router":"^6.0.10","@testing-library/jest-dom":"^5.14.1","@testing-library/react":"^12.1.0","@testing-library/user-event":"^13.2.1","@types/jest":"^27.0.1","@types/libxmljs":"^0.18.7","@types/node":"^16.9.1","@types/qrcode":"^1.4.1","@types/react":"^17.0.21","@types/react-dom":"^17.0.9","@types/react-redux":"^7.1.18","@types/react-router":"^5.1.16","@types/react-router-dom":"^5.1.9","@types/uuid":"^8.3.1","axios":"^0.21.4","customize-cra":"^1.0.0","electron":"^14.0.1","electron-builder":"22.14.2","electron-builder-notarize-pkg":"^1.2.0","epubjs-myh":"^0.3.113","history":"^4.10.1","ionicons":"^5.5.3","memfs":"^3.2.4","nodepub":"^3.0.2","qrcode":"^1.4.4","query-string":"^7.0.1","react":"^17.0.2","react-app-rewired":"^2.1.8","react-dom":"^17.0.2","react-redux":"^7.2.5","react-router":"^5.2.1","react-router-dom":"^5.3.0","react-scripts":"^4.0.3","redux":"^4.1.1","swiped-events-myh":"^1.2.0","typescript":"^4.4.3","uuid":"^8.3.2","workbox-background-sync":"^5.1.4","workbox-broadcast-update":"^5.1.4","workbox-cacheable-response":"^5.1.4","workbox-core":"^5.1.4","workbox-expiration":"^5.1.4","workbox-google-analytics":"^5.1.4","workbox-navigation-preload":"^5.1.4","workbox-precaching":"^5.1.4","workbox-range-requests":"^5.1.4","workbox-routing":"^5.1.4","workbox-strategies":"^5.1.4","workbox-streams":"^5.1.4"},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]}}')},158:function(e,t,n){},249:function(e,t){function n(e){return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=249},250:function(e,t,n){var s={"./ion-accordion_2.entry.js":[479,26],"./ion-action-sheet.entry.js":[480,6],"./ion-alert.entry.js":[481,7],"./ion-app_8.entry.js":[482,14],"./ion-avatar_3.entry.js":[483,27],"./ion-back-button.entry.js":[484,18],"./ion-backdrop.entry.js":[485,51],"./ion-breadcrumb_2.entry.js":[486,19],"./ion-button_2.entry.js":[487,28],"./ion-card_5.entry.js":[488,29],"./ion-checkbox.entry.js":[489,30],"./ion-chip.entry.js":[490,31],"./ion-col_3.entry.js":[491,52],"./ion-datetime_3.entry.js":[492,5],"./ion-fab_3.entry.js":[493,20],"./ion-img.entry.js":[494,53],"./ion-infinite-scroll_2.entry.js":[495,54],"./ion-input.entry.js":[496,32],"./ion-item-option_3.entry.js":[497,33],"./ion-item_8.entry.js":[498,21],"./ion-loading.entry.js":[499,34],"./ion-menu_3.entry.js":[500,22],"./ion-modal.entry.js":[501,10],"./ion-nav_2.entry.js":[502,24],"./ion-picker-column-internal.entry.js":[503,17],"./ion-picker-internal.entry.js":[504,55],"./ion-popover.entry.js":[505,15],"./ion-progress-bar.entry.js":[506,35],"./ion-radio_2.entry.js":[507,36],"./ion-range.entry.js":[508,12],"./ion-refresher_2.entry.js":[509,11],"./ion-reorder_2.entry.js":[510,16],"./ion-ripple-effect.entry.js":[511,56],"./ion-route_4.entry.js":[512,37],"./ion-searchbar.entry.js":[513,9],"./ion-segment_2.entry.js":[514,13],"./ion-select_3.entry.js":[515,38],"./ion-slide_2.entry.js":[516,57],"./ion-spinner.entry.js":[517,23],"./ion-split-pane.entry.js":[518,58],"./ion-tab-bar_2.entry.js":[519,39],"./ion-tab_2.entry.js":[520,25],"./ion-text.entry.js":[521,40],"./ion-textarea.entry.js":[522,41],"./ion-toast.entry.js":[523,42],"./ion-toggle.entry.js":[524,8],"./ion-virtual-scroll.entry.js":[525,59]};function o(e){if(!n.o(s,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=s[e],o=t[0];return n.e(t[1]).then((function(){return n(o)}))}o.keys=function(){return Object.keys(s)},o.id=250,e.exports=o},251:function(e,t){function n(e){return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=251},287:function(e,t,n){},288:function(e,t,n){},333:function(e,t){},335:function(e,t){},379:function(e,t){},381:function(e,t){},389:function(e,t){},391:function(e,t){},399:function(e,t){},401:function(e,t){},423:function(e,t){},425:function(e,t){},431:function(e,t){},433:function(e,t){},456:function(e,t,n){},457:function(e,t,n){},478:function(e,t,n){"use strict";n.r(t);var s,o=n(8),r=n.n(o),a=n(61),i=n.n(a),c=n(104),l=n(2),h=n.n(l),u=n(7),p=n(24),d=n(5),b=n(6),j=n(10),f=n(11),x=n(26),v=n(4),m=n(235),g=n(31),k=n(54),y=n.n(k),w=n(93),O=n(18),S=n(237),T=n.n(S);!function(e){e[e.BY_CHAPTER=0]="BY_CHAPTER",e[e.BY_JUAN=1]="BY_JUAN"}(s||(s={}));var C=function e(t){Object(d.a)(this,e),this.title=void 0,this.juan=void 0,this.title=t.title,this.juan=t.juan},A=function e(t){Object(d.a)(this,e),this.title=void 0,this.juan=void 0,this.juan_list=void 0,this.mulu=void 0,this.work=void 0,this.vol=void 0,this.title=t.title,this.juan=t.juan,this.juan_list=t.juan_list,this.mulu=t.mulu,this.work=t.work,this.vol=t.vol},I=n(15),E=n(1),F="v1.2",N="https://cbdata.dila.edu.tw/".concat(F),L="cbetardb",D="Settings.json",B="".concat("/","/assets/TW-Kai-98_1.woff"),P="",R=T.a.create({baseURL:N,timeout:1e4});function _(e){switch(e){case 0:return 0;case 1:return 20;case 2:return 40}}function M(e,t){return"".concat(e,"_juan").concat(t,".html")}function V(e){return U.apply(this,arguments)}function U(){return U=Object(u.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=indexedDB.open(L),e.abrupt("return",new Promise((function(e,s){n.onsuccess=function(){var o=Object(u.a)(h.a.mark((function o(r){var a,i,c;return h.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:a=n.result,i=a.transaction(["store"],"readwrite"),(c=i.objectStore("store").get(t)).onsuccess=function(){var n=Object(u.a)(h.a.mark((function n(o){var r;return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=c.result){n.next=5;break}return console.error("".concat(t," loading failed!")),console.error((new Error).stack),n.abrupt("return",s());case 5:return n.abrupt("return",e(r));case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();case 4:case"end":return o.stop()}}),o)})));return function(e){return o.apply(this,arguments)}}()})));case 2:case"end":return e.stop()}}),e)}))),U.apply(this,arguments)}function K(){return K=Object(u.a)(h.a.mark((function e(t,n){var s;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=indexedDB.open(L),e.abrupt("return",new Promise((function(e,o){s.onsuccess=function(){var r=Object(u.a)(h.a.mark((function r(a){var i,c,l;return h.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:i=s.result,c=i.transaction(["store"],"readwrite"),(l=c.objectStore("store").put(n,t)).onsuccess=function(t){return e()},l.onerror=function(e){return o()};case 5:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()})));case 2:case"end":return e.stop()}}),e)}))),K.apply(this,arguments)}function H(){return(H=Object(u.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=indexedDB.open(L),e.abrupt("return",new Promise((function(e,s){try{n.onsuccess=function(o){var r=n.result.transaction(["store"],"readwrite");try{var a=r.objectStore("store").delete(t);a.onsuccess=function(t){return e()},a.onerror=function(e){return s()}}catch(i){console.error(i)}}}catch(o){s(o)}})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(){return J.apply(this,arguments)}function J(){return J=Object(u.a)(h.a.mark((function e(){var t;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=indexedDB.open(L),e.abrupt("return",new Promise((function(e,n){t.onsuccess=function(){var s=Object(u.a)(h.a.mark((function s(o){var r,a,i;return h.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:r=t.result,a=r.transaction(["store"],"readwrite"),(i=a.objectStore("store").clear()).onsuccess=function(t){return e()},i.onerror=function(e){return n()};case 5:case"end":return s.stop()}}),s)})));return function(e){return s.apply(this,arguments)}}()})));case 2:case"end":return e.stop()}}),e)}))),J.apply(this,arguments)}function W(){return(W=Object(u.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return localStorage.clear(),e.next=3,z();case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Y=window.electronBackendApi;function G(){return G=Object(u.a)(h.a.mark((function e(t,n,s){var o,r,a,i,c,l,u,p,d,b,j,f,x,v,m=arguments;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=m.length>3&&void 0!==m[3]&&m[3],r=m.length>4&&void 0!==m[4]&&m[4],a=s||M(t,n),i=null,e.prev=4,e.next=7,V(a);case 7:i=e.sent,e.next=12;break;case 10:e.prev=10,e.t0=e.catch(4);case 12:if(c=localStorage.getItem(D),l=new A({}),c&&(p=JSON.parse(c).settings.bookmarks,u=p.find((function(e){return e.fileName===a||e.uuid===t}))),null===i||void 0===u||o){e.next=19;break}l=u.work,e.next=46;break;case 19:if(!s){e.next=28;break}return e.next=22,R.get("/".concat(s),{responseType:"arraybuffer"});case 22:d=e.sent,b=new TextDecoder,j=b.decode(d.data),i=j.includes("charset=big5")?new TextDecoder("big5").decode(d.data):j,e.next=41;break;case 28:if(!r){e.next=35;break}return null===Y||void 0===Y||Y.send("toMain",{event:"fetchJuan",work:t,juan:n}),e.next=32,new Promise((function(e,t){null===Y||void 0===Y||Y.receiveOnce("fromMain",(function(t){if("fetchJuan"===t.event)e(t)}))}));case 32:f=e.sent,e.next=39;break;case 35:return e.next=37,R.get("/juans?edition=CBETA&work_info=1&work=".concat(t,"&juan=").concat(n),{responseType:"arraybuffer"});case 37:x=e.sent,f=JSON.parse((new TextDecoder).decode(x.data));case 39:i=f.results[0],l=f.work_info;case 41:(v=document.implementation.createHTMLDocument("")).body.innerHTML=i,i=(i=(i=(new XMLSerializer).serializeToString(v.body)).replace("<body","<div")).replace("/body>","/div>");case 46:return e.abrupt("return",{htmlStr:i,workInfo:l});case 47:case"end":return e.stop()}}),e,null,[[4,10]])}))),G.apply(this,arguments)}var q=console.log.bind(console),X=console.error.bind(console);function $(){return Object(v.S)("ios")&&"MacIntel"===navigator.platform}var Q,Z={storeFile:D,fontSizeNorm:24,fontSizeLarge:48,getLog:function(){return P},enableAppLog:function(){console.log=function(){P+="----- Info ----\n",P+=Array.from(arguments)+"\n",q.apply(console,arguments)},console.error=function(){P+="----- Error ----\n",P+=Array.from(arguments)+"\n",arguments[0].isAxiosError&&(P+="URL: ".concat(arguments[0].config.url,"\n")),X.apply(console,arguments)}},disableAppLog:function(){P="",console.log=q,console.error=X},cbetardb:L,pwaUrl:"/",bugReportApiUrl:"https://vh6ud1o56g.execute-api.ap-northeast-1.amazonaws.com/bugReportMailer",apiVersion:F,cbetaApiUrl:N,dilaDictApiUrl:"https://glossaries.dila.edu.tw/search.json",twKaiFontKey:"twKaiFont",twKaiFontPath:B,axiosInstance:R,topCatalogsByCat:{CBETA:"CBETA \u90e8\u985e","Cat-T":"\u5927\u6b63\u85cf","Cat-X":"\u534d\u7e8c\u85cf","Cat-N":"\u5357\u50b3\u5927\u85cf\u7d93",others:"\u6b77\u4ee3\u85cf\u7d93\u88dc\u8f2f",modern:"\u8fd1\u4ee3\u65b0\u7de8\u6587\u737b"},topCatalogsByVol:{"Vol-T":"T \u5927\u6b63\u85cf","Vol-X":"X \u534d\u7e8c\u85cf","Vol-A":"A \u8d99\u57ce\u91d1\u85cf","Vol-K":"K \u9ad8\u9e97\u5927\u85cf\u7d93-\u65b0\u6587\u8c50\u7248","Vol-S":"S \u5b8b\u85cf\u907a\u73cd-\u65b0\u6587\u8c50\u7248","Vol-F":"F \u623f\u5c71\u77f3\u7d93","Vol-C":"C \u4e2d\u83ef\u5927\u85cf\u7d93-\u4e2d\u83ef\u66f8\u5c40\u7248","Vol-U":"U \u6d2a\u6b66\u5357\u85cf","Vol-P":"P \u6c38\u6a02\u5317\u85cf","Vol-J":"J \u5609\u8208\u85cf","Vol-L":"L \u4e7e\u9686\u5927\u85cf\u7d93-\u65b0\u6587\u8c50\u7248","Vol-G":"G \u4f5b\u6559\u5927\u85cf\u7d93","Vol-M":"M \u534d\u6b63\u85cf\u7d93-\u65b0\u6587\u8c50\u7248","Vol-D":"D \u570b\u5716\u5584\u672c","Vol-N":"N \u5357\u50b3\u5927\u85cf\u7d93(\u518a\u5225)","Vol-ZS":"ZS \u6b63\u53f2\u4f5b\u6559\u8cc7\u6599\u985e\u7de8","Vol-I":"I \u5317\u671d\u4f5b\u6559\u77f3\u523b\u62d3\u7247\u767e\u54c1","Vol-ZW":"ZW \u85cf\u5916\u4f5b\u6559\u6587\u737b","Vol-B":"B \u5927\u85cf\u7d93\u88dc\u7de8","Vol-GA":"GA \u4e2d\u570b\u4f5b\u5bfa\u53f2\u5fd7\u5f59\u520a","Vol-GB":"GB \u4e2d\u570b\u4f5b\u5bfa\u5fd7\u53e2\u520a","Vol-Y":"Y \u5370\u9806\u6cd5\u5e2b\u4f5b\u5b78\u8457\u4f5c\u96c6","Vol-LC":"LC \u5442\u6f82\u4f5b\u5b78\u8457\u4f5c\u96c6"},appSettings:{theme:"\u4f48\u666f\u4e3b\u984c",rtlVerticalLayout:"\u7d93\u6587\u76f4\u6392\u3001\u53f3\u81f3\u5de6\u66f8\u5beb",paginated:"\u55ae\u9801/\u5206\u9801",showComments:"\u986f\u793a\u7d93\u6587\u8a3b\u89e3\u3001\u7248\u6b0a",useFontKai:"\u9ed1\u9ad4/\u6977\u66f8\u5b57\u9ad4",uiFontSize:"UI\u5b57\u578b\u5927\u5c0f",fontSize:"\u7d93\u6587\u5b57\u578b\u5927\u5c0f",printStyle:"\u7d93\u6587\u5217\u5370\u6a23\u5f0f"},fetchErrorContent:Object(E.jsx)("div",{className:"contentCenter",children:Object(E.jsx)(v.o,{children:Object(E.jsxs)("div",{children:[Object(E.jsx)("div",{children:"\u9023\u7dda\u5931\u6557!"}),Object(E.jsxs)("div",{style:{fontSize:"var(--ui-font-size)",paddingTop:24},children:["\u8acb\u8a66\u4e0a\u65b9\u91cd\u65b0\u6574\u7406\u6309\u9215",Object(E.jsx)(v.h,{icon:I.v,slot:"icon-only"}),"\u3002"]}),Object(E.jsxs)("div",{style:{fontSize:"var(--ui-font-size)",paddingTop:24},children:["\u5982\u679c\u554f\u984c\u6301\u7e8c\u767c\u751f\uff0c\u8acb\u57f7\u884c",Object(E.jsx)("a",{href:"/settings",target:"_self",children:"\u8a2d\u5b9a\u9801"}),"\u7684app\u7570\u5e38\u56de\u5831\u529f\u80fd\u3002"]})]})})}),searchNoResultMessage:Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u67e5\u7121\u7d50\u679c\u3002\u8acb\u78ba\u8a8d\u8f38\u5165\u540d\u7a31\u662f\u5426\u6b63\u78ba\u3002"},"searchLabelNone"),updateApp:function(){return new Promise(function(){var e=Object(u.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:navigator.serviceWorker.getRegistrations().then(function(){var e=Object(u.a)(h.a.mark((function e(n){var s;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(n.map((function(e){return e.update().then((function(e){return null!==e.installing||null!==e.waiting}))})));case 2:s=e.sent,t(s.reduce((function(e,t){return e||t}),!1));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},scrollbarSizeIdToValue:_,updateCssVars:function(e){var t=_(e.scrollbarSize);document.documentElement.style.cssText="--ion-font-family: ".concat(e.useFontKai?"Times, HeitiScoped, Kai":"Times, Heiti TC, Noto Sans CJK TC","; --scrollbar-size: ").concat(t,"px; --ui-font-size: ").concat(e.uiFontSize,"px; --text-font-size: ").concat(e.fontSize,"px")},isMacCatalyst:$,isTouchDevice:function(){return Object(v.S)("ios")&&!$()||Object(v.S)("android")},isStoreApps:function(){return Object(v.S)("pwa")||Object(v.S)("electron")},fetchJuan:function(e,t,n){return G.apply(this,arguments)},getFileName:M,getFileFromIndexedDB:V,saveFileToIndexedDB:function(e,t){return K.apply(this,arguments)},removeFileFromIndexedDB:function(e){return H.apply(this,arguments)},clearAppData:function(){return W.apply(this,arguments)},removeElementsByClassName:function(e,t){for(var n=e.getElementsByClassName(t);n.length>0;){var s;null===(s=n[0].parentNode)||void 0===s||s.removeChild(n[0])}},disableAndroidChromeCallout:function(e){return e.preventDefault(),e.stopPropagation(),!1},disableIosSafariCallout:function(e){var t=this.getSelection();if(((null===t||void 0===t?void 0:t.rangeCount)||0)>0){var n=null===t||void 0===t?void 0:t.getRangeAt(0);null===t||void 0===t||t.removeAllRanges(),setTimeout((function(){null===t||void 0===t||t.addRange(n)}),50)}},copyToClipboard:function(e){try{navigator.clipboard&&navigator.clipboard.writeText(e)}catch(t){console.error(t)}},zhVoices:function(){return speechSynthesis.getVoices().filter((function(e){return["zh-TW","zh_TW","zh-CN","zh_CN","zh-HK","zh_HK"].some((function(t){return e.localService&&e.lang.indexOf(t)>-1}))}))}},ee=Z;!function(e){e[e.CATALOG=0]="CATALOG",e[e.WORK=1]="WORK",e[e.JUAN=2]="JUAN",e[e.HTML=3]="HTML"}(Q||(Q={}));var te=function e(t){Object(d.a)(this,e),this.type=Q.CATALOG,this.uuid="",this.work=null,this.selectedText="",this.epubcfi="",this.fileName="",this.type=t.type,this.uuid=t.uuid,this.work=t.work,this.selectedText=t.selectedText,this.epubcfi=t.epubcfi,this.fileName=t.fileName},ne=function e(){Object(d.a)(this,e),this.version=1,this.hasAppLog=!0,this.theme=0,this.paginated=!0,this.rtlVerticalLayout=!0,this.scrollbarSize=0,this.useFontKai=!0,this.fontSize=32,this.uiFontSize=24,this.showComments=!1,this.printStyle=0,this.voiceURI="",this.speechRate=.8,this.bookmarks=[],this.dictionaryHistory=[],this.wordDictionaryHistory=[]};var se=function e(){Object(d.a)(this,e),this.shareTextModal=null,this.workListType=void 0,this.mainVersion=null,this.cbetaOfflineDbMode=!1};var oe=Object(w.a)({settings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ne,t=arguments.length>1?arguments[1]:void 0,n=Object(p.a)({},e);switch(t.type){case"LOAD_SETTINGS":n=JSON.parse(localStorage.getItem(ee.storeFile)).settings;break;case"SET_KEY_VAL":var s=t.key,o=t.val;switch(s){case"theme":document.body.classList.forEach((function(e){/theme/.test(e)&&document.body.classList.remove(e)})),document.body.classList.toggle("theme".concat(o),!0);break;case"printStyle":document.body.classList.forEach((function(e){/print/.test(e)&&document.body.classList.remove(e)})),document.body.classList.toggle("print".concat(o),!0)}n[s]=o,localStorage.setItem(ee.storeFile,JSON.stringify({settings:n}));break;case"ADD_BOOKMARK":var r=n.bookmarks,a=t.bookmark.fileName;null===a||""===a||r.some((function(e){return e.fileName===a}))||ee.saveFileToIndexedDB(a,t.htmlStr),n.bookmarks=[].concat(Object(O.a)(n.bookmarks),[t.bookmark]),localStorage.setItem(ee.storeFile,JSON.stringify({settings:n}));break;case"DEL_BOOKMARK":var i=n.bookmarks,c=i.findIndex((function(e){return e.uuid===t.uuid}));if(-1!==c){var l=i.splice(c,1);if(1===l.length){var h=l[0],u=null==i.find((function(e){var t,n;return e.type===Q.WORK&&(null===(t=e.work)||void 0===t?void 0:t.work)===(null===(n=h.work)||void 0===n?void 0:n.work)}));if(u)switch(h.type){case Q.WORK:var d=h.work;if(null==d)break;for(var b=d.juan_list.split(","),j=function(e){var t=ee.getFileName(d.work,b[e]);if(null==i.find((function(e){return e.type===Q.JUAN&&e.fileName===t})))try{ee.removeFileFromIndexedDB(t)}catch(n){console.error(n)}},f=0;f<b.length;f++)j(f);break;case Q.JUAN:var x=h.fileName,v=null==i.find((function(e){return e.type===Q.JUAN&&e.fileName===x}));if(v)try{ee.removeFileFromIndexedDB(x)}catch(m){console.error(m)}}}}n.bookmarks=Object(O.a)(i),localStorage.setItem(ee.storeFile,JSON.stringify({settings:n}));break;case"UPDATE_BOOKMARKS":n.bookmarks=t.bookmarks,localStorage.setItem(ee.storeFile,JSON.stringify({settings:n}));break;case"DEFAULT_SETTINGS":n=new ne;default:0===Object.keys(n).length&&(n=new ne)}return n},tmpSettings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new se,t=arguments.length>1?arguments[1]:void 0,n=Object(p.a)({},e),s=t.key,o=t.val;return n[s]=o,"TMP_SET_KEY_VAL"===t.type?n:e}});n(287);var re,ae=function e(t){Object(d.a)(this,e),this.n=void 0,this.nodeType=void 0,this.label=void 0,this.work=void 0,this.file=void 0,this.n=t.n,this.nodeType=t.node_type,this.label=t.label,this.work=t.work,this.file=t.file},ie=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(b.a)(n,[{key:"render",value:function(){var e=this;return Object(E.jsx)(v.a,{cssClass:"uiFont",backdropDismiss:!1,isOpen:this.props.showSearchAlert,header:"\u641c\u5c0b\u7d93\u66f8",subHeader:"\u8f38\u5165\u641c\u5c0b",inputs:[{name:"name0",type:"search",placeholder:"\u4f8b:\u91d1\u525b\u822c\u82e5"}],buttons:[{text:"\u641c\u5c0b\u76ee\u9304",cssClass:"primary uiFont",handler:function(t){e.props.finish(),e.props.history.push("/catalog/search/".concat(t.name0))}},{text:"\u5168\u6587\u6aa2\u7d22",cssClass:"primary uiFont",handler:function(t){e.props.finish(),e.props.history.push("/catalog/fulltextsearch/".concat(t.name0))}},{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary uiFont",handler:function(){return e.props.finish()}}]})}}]),n}(r.a.Component),ce=ie,le=[{title:"\u822c\u82e5\u6ce2\u7f85\u871c\u591a\u5fc3\u7d93",url:"/catalog/juan/T0251/1"},{title:"\u91d1\u525b\u822c\u82e5\u6ce2\u7f85\u871c\u7d93",url:"/catalog/juan/T0235/1"},{title:"\u4f5b\u8aaa\u963f\u5f4c\u9640\u7d93",url:"/catalog/juan/T0366/1"},{title:"\u4f5b\u8aaa\u7121\u91cf\u58fd\u7d93\u5377\u4e0a",url:"/catalog/juan/T0360/1"},{title:"\u4f5b\u8aaa\u89c0\u7121\u91cf\u58fd\u4f5b\u7d93",url:"/catalog/juan/T0365/1"},{title:"\u85e5\u5e2b\u7409\u7483\u5149\u5982\u4f86\u672c\u9858\u529f\u5fb7\u7d93",url:"/catalog/juan/T0450/1"},{title:"\u4f5b\u8aaa\u89c0\u5f4c\u52d2\u83e9\u85a9\u4e0a\u751f\u515c\u7387\u5929\u7d93",url:"/catalog/juan/T0452/1"},{title:"\u4f5b\u8aaa\u5f4c\u52d2\u4e0b\u751f\u6210\u4f5b\u7d93",url:"/catalog/juan/T0454/1"},{title:"\u5730\u85cf\u83e9\u85a9\u672c\u9858\u7d93",url:"/catalog/juan/T0412/1"},{title:"\u5999\u6cd5\u84ee\u83ef\u7d93\u89c0\u4e16\u97f3\u83e9\u85a9\u666e\u9580\u54c1\u7d93",url:"/catalog/juan/T0262/7"},{title:"\u5927\u4f5b\u9802\u5982\u4f86\u5bc6\u56e0\u4fee\u8b49\u4e86\u7fa9\u8af8\u83e9\u85a9\u842c\u884c\u9996\u695e\u56b4\u7d93\u5377\u7b2c\u4e00",url:"/catalog/juan/T0945/1"},{title:"\u4f5b\u8aaa\u6cd5\u6ec5\u76e1\u7d93",url:"/catalog/juan/T0396/1"}],he=window.electronBackendApi,ue=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e){var s;return Object(d.a)(this,n),(s=t.call(this,e)).state={topCatalogsType:0,fetchError:!1,catalogs:[],pathLabel:"",showSearchAlert:!1,isLoading:!1},s}return Object(b.a)(n,[{key:"ionViewWillEnter",value:function(){console.log("".concat(this.props.match.url," will enter."));var e=-1;switch(this.props.match.url){case"/catalog":e=0;break;case"/catalog/volumes":e=1;break;case"/catalog/famous":e=2;break;default:e=-1}this.setState({topCatalogsType:e}),this.fetchData(this.props.match.params.path)}},{key:"fetchData",value:function(){var e=Object(u.a)(h.a.mark((function e(t){var n,s,o,r,a,i;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({isLoading:!0}),n=new Array,s="",e.t0=this.state.topCatalogsType,e.next=0===e.t0||1===e.t0?6:-1===e.t0?7:2===e.t0?33:35;break;case 6:return e.abrupt("return",this.fetchTopCatalogs(this.state.topCatalogsType));case 7:if(e.prev=7,!this.props.tmpSettings.cbetaOfflineDbMode){e.next=15;break}return null===he||void 0===he||he.send("toMain",{event:"fetchCatalog",path:t}),e.next=12,new Promise((function(e,t){null===he||void 0===he||he.receiveOnce("fromMain",(function(t){if("fetchCatalog"===t.event)e(t)}))}));case 12:o=e.sent,e.next=19;break;case 15:return e.next=17,ee.axiosInstance.get("/catalog_entry?q=".concat(t),{responseType:"arraybuffer"});case 17:r=e.sent,o=JSON.parse((new TextDecoder).decode(r.data));case 19:return a=o.results,n=a.map((function(e){return new ae(e)})),""!==this.parentPath(t)?s=o.label:(i=ee.topCatalogsByCat[t],s=void 0!==i?i:ee.topCatalogsByVol[t]),this.setState({fetchError:!1,isLoading:!1,catalogs:n,pathLabel:s}),e.abrupt("return",!0);case 27:return e.prev=27,e.t1=e.catch(7),console.error(e.t1),console.error((new Error).stack),this.setState({fetchError:!0,isLoading:!1,pathLabel:""}),e.abrupt("return",!1);case 33:return this.setState({fetchError:!1,isLoading:!1,pathLabel:""}),e.abrupt("break",35);case 35:case"end":return e.stop()}}),e,this,[[7,27]])})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchTopCatalogs",value:function(e){var t=Array(),n=e?ee.topCatalogsByVol:ee.topCatalogsByCat;return Object.keys(n).forEach((function(e){var s={n:e,nodeType:null,work:null,label:n[e],file:null};t.push(s)})),this.setState({fetchError:!1,isLoading:!1,catalogs:t,pathLabel:""}),!0}},{key:"isTopCatalog",get:function(){var e=this;return["/catalog","/catalog/volumes","/catalog/famous"].reduce((function(t,n){return t||n===e.props.match.url}),!1)}},{key:"parentPath",value:function(e){var t=e.split(".");return t.pop(),t.join(".")}},{key:"addBookmarkHandler",value:function(){this.props.dispatch({type:"ADD_BOOKMARK",bookmark:new te({type:Q.CATALOG,uuid:this.props.match.params.path,selectedText:this.state.pathLabel,epubcfi:"",fileName:"",work:null})})}},{key:"delBookmarkHandler",value:function(){this.props.dispatch({type:"DEL_BOOKMARK",uuid:this.props.match.params.path})}},{key:"hasBookmark",get:function(){var e=this;return null!=this.props.bookmarks.find((function(t){return t.type===Q.CATALOG&&t.uuid===e.props.match.params.path}))}},{key:"getRows",value:function(){var e=this,t=Array();return this.state.catalogs.forEach((function(n,s){var o="",r="html"===n.nodeType;o=r?"/catalog/juan/".concat(n.n,"/1"):null==n.work?"/catalog/catalog/".concat(n.n):"/catalog/work/".concat(n.work),t.push(Object(E.jsxs)(v.k,{button:!0,onClick:function(){var t=Object(u.a)(h.a.mark((function t(s){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:s.preventDefault(),e.props.history.push({pathname:o,search:y.a.stringify(r?{file:n.file,title:n.label}:{})});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:n.label},"".concat(n.n,"label")+s)]},"".concat(n.n,"item")+s))})),t}},{key:"getFamousJuanRows",value:function(){var e=this,t=Array();return le.forEach((function(n,s){var o=n.title,r=n.url;t.push(Object(E.jsxs)(v.k,{button:!0,onClick:function(){var t=Object(u.a)(h.a.mark((function t(n){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.props.history.push(r);case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:o},"famousItemLabel_"+s)]},"famousJuanItem_"+s))})),t}},{key:"render",value:function(){var e=this,t=Object(E.jsx)(v.p,{children:2===this.state.topCatalogsType?this.getFamousJuanRows():this.getRows()});return Object(E.jsxs)(v.s,{children:[Object(E.jsx)(v.g,{children:Object(E.jsxs)(v.J,{children:[Object(E.jsx)(v.c,{hidden:this.isTopCatalog,fill:"clear",slot:"start",onClick:function(t){return e.props.history.goBack()},children:Object(E.jsx)(v.h,{icon:I.a,slot:"icon-only"})}),Object(E.jsxs)(v.B,{hidden:!this.isTopCatalog,slot:"start",value:this.state.topCatalogsType,className:"buttonRounded",interface:"popover",interfaceOptions:{cssClass:"cbetar2themes"},onIonChange:function(t){var n=+t.detail.value;n!==e.state.topCatalogsType&&e.setState({topCatalogsType:n});var s="";switch(n){case 0:s="/catalog";break;case 1:s="/catalog/volumes";break;case 2:s="/catalog/famous";break;case-1:s=e.props.match.url}e.props.match.url!==s&&e.props.history.push(s)},children:[Object(E.jsx)(v.C,{className:"uiFont",value:0,children:"\u90e8\u5206\u985e"}),Object(E.jsx)(v.C,{className:"uiFont",value:1,children:"\u518a\u5206\u985e"}),Object(E.jsx)(v.C,{className:"uiFont",value:2,children:"\u77e5\u540d\u7d93\u5178"})]}),Object(E.jsx)(v.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(t){return e.fetchData(e.props.match.params.path)},children:Object(E.jsx)(v.h,{icon:I.v,slot:"icon-only"})}),Object(E.jsx)(v.c,{hidden:this.isTopCatalog,fill:this.hasBookmark?"solid":"clear",slot:"end",onClick:function(t){return e.hasBookmark?e.delBookmarkHandler():e.addBookmarkHandler()},children:Object(E.jsx)(v.h,{icon:I.f,slot:"icon-only"})}),Object(E.jsx)(v.c,{hidden:this.isTopCatalog,fill:"clear",slot:"end",onClick:function(t){return e.props.history.push("/".concat(e.props.match.params.tab))},children:Object(E.jsx)(v.h,{icon:I.o,slot:"icon-only"})}),Object(E.jsx)(v.c,{fill:"clear",slot:"end",onClick:function(t){return e.setState({showSearchAlert:!0})},children:Object(E.jsx)(v.h,{icon:I.w,slot:"icon-only"})}),Object(E.jsx)(v.c,{fill:"clear",slot:"end",onClick:function(t){e.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})},children:Object(E.jsx)(v.h,{icon:I.y,slot:"icon-only"})})]})}),Object(E.jsxs)(v.d,{children:[this.state.fetchError?ee.fetchErrorContent:Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)("div",{className:"uiFontX2",style:{color:"var(--ion-color-primary)"},children:this.state.pathLabel}),t]}),Object(E.jsx)(ce,Object(p.a)({},Object(p.a)({showSearchAlert:this.state.showSearchAlert,finish:function(){e.setState({showSearchAlert:!1})}},this.props))),Object(E.jsx)("div",{style:{fontSize:"var(--ui-font-size)",textAlign:"center"},children:Object(E.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2#bookmark",target:"_new",children:"\u66f8\u7c64\u8207\u96e2\u7dda\u700f\u89bd\u8aaa\u660e"})}),Object(E.jsx)("div",{style:{fontSize:"var(--ui-font-size)",textAlign:"center"},children:Object(E.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2#search",target:"_new",children:"\u641c\u5c0b\u7d93\u66f8\u6559\u5b78"})}),Object(E.jsx)(v.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return e.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."})]})]})}}]),n}(r.a.Component),pe=Object(v.U)(ue),de=Object(g.b)((function(e){return{bookmarks:e.settings.bookmarks,state:e,tmpSettings:e.tmpSettings}}))(pe),be=(n(158),window.electronBackendApi),je=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e){var o;return Object(d.a)(this,n),(o=t.call(this,e)).fetchJuan="",o.workListType=void 0!==o.props.tmpSettings.workListType?o.props.tmpSettings.workListType:s.BY_JUAN,o.state={work:null,showSearchAlert:!1,showAddBookmarkDone:!1,isLoading:!1,fetchError:!1},o}return Object(b.a)(n,[{key:"ionViewWillEnter",value:function(){this.fetchWork(this.props.match.params.path)}},{key:"componentDidMount",value:function(){}},{key:"fetchWork",value:function(){var e=Object(u.a)(h.a.mark((function e(t){var n,s,o,r,a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setState({isLoading:!0}),!this.hasBookmark){e.next=5;break}n=this.bookmark.work,e.next=32;break;case 5:if(e.prev=5,!this.props.tmpSettings.cbetaOfflineDbMode){e.next=13;break}return null===be||void 0===be||be.send("toMain",{event:"fetchWork",path:t}),e.next=10,new Promise((function(e,t){null===be||void 0===be||be.receiveOnce("fromMain",(function(t){if("fetchWork"===t.event)e(t)}))}));case 10:s=e.sent,e.next=17;break;case 13:return e.next=15,ee.axiosInstance.get("/works?work=".concat(t),{responseType:"arraybuffer"});case 15:o=e.sent,s=JSON.parse((new TextDecoder).decode(o.data));case 17:if(r=s.results,n=r[0],this.props.tmpSettings.cbetaOfflineDbMode){e.next=24;break}return e.next=22,ee.axiosInstance.get("/toc?work=".concat(t));case 22:a=e.sent,n.mulu=a.data.results[0].mulu.map((function(e){return new C(e)}));case 24:e.next=32;break;case 26:return e.prev=26,e.t0=e.catch(5),console.error(e.t0),console.error((new Error).stack),this.setState({fetchError:!0,isLoading:!1}),e.abrupt("return",!1);case 32:return this.setState({fetchError:!1,isLoading:!1,work:n}),e.abrupt("return",!0);case 34:case"end":return e.stop()}}),e,this,[[5,26]])})));return function(t){return e.apply(this,arguments)}}()},{key:"saveJuans",value:function(){var e=Object(u.a)(h.a.mark((function e(){var t,n,s,o;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.state.work,n=t.juan_list.split(","),s=0;case 3:if(!(s<n.length)){e.next=19;break}return this.fetchJuan=n[s],e.prev=5,e.next=8,ee.fetchJuan(t.work,this.fetchJuan,null);case 8:o=e.sent,ee.saveFileToIndexedDB(ee.getFileName(t.work,this.fetchJuan),o.htmlStr),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(5),console.error("Fetching juan ".concat(s," failed! ").concat(e.t0)),console.error((new Error).stack);case 16:s++,e.next=3;break;case 19:case"end":return e.stop()}}),e,this,[[5,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"addBookmarkHandler",value:function(){var e=Object(u.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.tmpSettings.cbetaOfflineDbMode){e.next=3;break}return e.next=3,this.saveJuans();case 3:this.setState({showAddBookmarkDone:!0}),this.props.dispatch({type:"ADD_BOOKMARK",bookmark:new te({type:Q.WORK,uuid:this.props.match.params.path,selectedText:this.state.work.title,epubcfi:"",fileName:"",work:this.state.work})});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"delBookmarkHandler",value:function(){this.props.dispatch({type:"DEL_BOOKMARK",uuid:this.props.match.params.path})}},{key:"bookmark",get:function(){var e=this;return this.props.bookmarks.find((function(t){return t.type===Q.WORK&&t.uuid===e.props.match.params.path}))}},{key:"hasBookmark",get:function(){return null!=this.bookmark}},{key:"getRowsByChapter",value:function(){for(var e=this,t=this.state.work,n=null===t||void 0===t?void 0:t.mulu,s=Array(),o=function(o){var r="/catalog/juan/".concat(null===t||void 0===t?void 0:t.work,"/").concat(n[o].juan);s.push(Object(E.jsxs)(v.k,{button:!0,onClick:function(){var t=Object(u.a)(h.a.mark((function t(n){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.preventDefault(),e.props.history.push({pathname:r});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:n[o].title},"chapterLabel"+o)]},"chapterItem"+o))},r=0;r<((null===n||void 0===n?void 0:n.length)||-1);r++)o(r);return s}},{key:"getRowsByJuan",value:function(){for(var e=this,t=this.state.work,n=Array(),s=null===t||void 0===t?void 0:t.juan_list.split(","),o=function(o){var r="/catalog/juan/".concat(null===t||void 0===t?void 0:t.work,"/").concat(s[o]);n.push(Object(E.jsxs)(v.k,{button:!0,onClick:function(){var t=Object(u.a)(h.a.mark((function t(n){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.preventDefault(),e.props.history.push({pathname:r});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsxs)(v.o,{className:"ion-text-wrap uiFont",children:["\u5377",s[o]]},"juanLabel"+o)]},"juanItem"+o))},r=0;r<((null===s||void 0===s?void 0:s.length)||-1);r++)o(r);return n}},{key:"render",value:function(){var e,t=this;return Object(E.jsxs)(v.s,{children:[Object(E.jsx)(v.g,{children:Object(E.jsxs)(v.J,{children:[Object(E.jsx)(v.c,{fill:"clear",slot:"start",onClick:function(e){return t.props.history.goBack()},children:Object(E.jsx)(v.h,{icon:I.a,slot:"icon-only"})}),Object(E.jsx)(v.c,{fill:"outline",shape:"round",size:"large",slot:"start",onClick:function(e){var n=t.workListType===s.BY_CHAPTER?s.BY_JUAN:s.BY_CHAPTER;t.props.dispatch({type:"TMP_SET_KEY_VAL",key:"workListType",val:n})},children:Object(E.jsx)("span",{className:"uiFont",style:{color:"var(--color)"},children:this.workListType===s.BY_CHAPTER?"\u5206\u54c1":"\u5206\u5377"})}),Object(E.jsx)(v.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(e){return t.fetchWork(t.props.match.params.path)},children:Object(E.jsx)(v.h,{icon:I.v,slot:"icon-only"})}),Object(E.jsx)(v.c,{fill:this.hasBookmark?"solid":"clear",slot:"end",onClick:function(e){return t.hasBookmark?t.delBookmarkHandler():t.addBookmarkHandler()},children:Object(E.jsx)(v.h,{icon:I.f,slot:"icon-only"})}),Object(E.jsx)(v.c,{fill:"clear",slot:"end",onClick:function(e){return t.props.history.push("/".concat(t.props.match.params.tab))},children:Object(E.jsx)(v.h,{icon:I.o,slot:"icon-only"})}),Object(E.jsx)(v.c,{fill:"clear",slot:"end",onClick:function(e){return t.setState({showSearchAlert:!0})},children:Object(E.jsx)(v.h,{icon:I.w,slot:"icon-only"})}),Object(E.jsx)(v.c,{fill:"clear",slot:"end",onClick:function(e){t.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})},children:Object(E.jsx)(v.h,{icon:I.y,slot:"icon-only"})})]})}),Object(E.jsxs)(v.d,{children:[Object(E.jsx)("div",{className:"uiFontX2",style:{color:"var(--ion-color-primary)"},children:null===(e=this.state.work)||void 0===e?void 0:e.title}),this.state.fetchError?ee.fetchErrorContent:Object(E.jsx)(v.p,{children:this.workListType===s.BY_CHAPTER?this.getRowsByChapter():this.getRowsByJuan()}),Object(E.jsx)(ce,Object(p.a)({},Object(p.a)({showSearchAlert:this.state.showSearchAlert,finish:function(){t.setState({showSearchAlert:!1})}},this.props))),Object(E.jsx)(v.H,{cssClass:"uiFont",isOpen:this.state.showAddBookmarkDone,onDidDismiss:function(){return t.setState({showAddBookmarkDone:!1})},message:"\u66f8\u7c64\u65b0\u589e\u6210\u529f\uff01",duration:2e3}),Object(E.jsx)(v.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return t.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."})]})]})}}]),n}(r.a.Component),fe=Object(v.U)(je),xe=Object(g.b)((function(e){return{bookmarks:e.settings.bookmarks,tmpSettings:e.tmpSettings}}))(fe),ve=n(9),me=n(528),ge=(n(288),n(108)),ke=n(241),ye=n(53);function we(){return Oe.apply(this,arguments)}function Oe(){return(Oe=Object(u.a)(h.a.mark((function e(){var t,n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ee.getFileFromIndexedDB(ee.twKaiFontKey);case 2:return t=e.sent,n=new window.FontFace("Kai",t),e.next=6,n.load();case 6:this.document.fonts.add(n);case 7:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function Se(){var e=this;this.document.querySelectorAll(".pre .lb").forEach((function(t){var n=e.document.createElement("br");t.before(n)}))}function Te(){n(445)(this.window,this.document)}!function(e){e[e.UNINITIAL=0]="UNINITIAL",e[e.SPEAKING=1]="SPEAKING",e[e.PAUSE=2]="PAUSE"}(re||(re={}));var Ce,Ae=function(e){Object(j.a)(s,e);var t=Object(f.a)(s);function s(e){var n;return Object(d.a)(this,s),(n=t.call(this,e)).htmlFile=void 0,n.htmlTitle=void 0,n.book=void 0,n.rendition=void 0,n.epub=void 0,n.displayed=void 0,n.cfiRange=void 0,n.speechSynthesisUtterance=void 0,n.currentWork="",n.uuidStr="",n.epubcfiFromUrl="",n.lastPage=0,n.epubcfiFromSelectedString="",n.bookCreated=!1,n.ePubIframe=null,n.selectedString="",n.clearSelectedStringTimer=void 0,n.selectedRange=void 0,n.pageWidth=0,n.pagesWidth=0,n.searchTextRanges=[],n.visibleTextNodes=[],n.visibleChars=[],n.isPageSearched=[],n.allTexts="",n.ePubIframeOffset=0,n.showedSearchTextIndex=0,n.maxCharsPerUtterance=1e3,n.workTexts=[],n.workTextsIndex=0,n.speechRepeatStart=void 0,n.speechRepeatEnd=void 0,n.state={isLoading:!1,fetchError:!1,workInfo:new A({}),htmlStr:null,currentPage:1,pageCount:1,showJumpPageAlert:!1,showNoSelectedTextAlert:!1,showSearchTextAlert:!1,searchText:"",showSearchTextToast:!1,showToast:!1,toastMessage:"",showSearchAlert:!1,popover:{show:!1,event:null},lookupDictPopover:{show:!1,data:[]},canTextToSpeech:"undefined"!==typeof SpeechSynthesisUtterance,speechState:re.UNINITIAL,isSpeechRepeatMode:!1,showSpeechRepeatStart:!1,showSpeechRepeatEnd:!1},n.htmlFile="",n.htmlTitle="",n.book=null,n.rendition=null,n.cfiRange="",n.speechSynthesisUtterance=null,n.state.canTextToSpeech&&(n.speechSynthesisUtterance=new SpeechSynthesisUtterance,n.speechSynthesisUtterance.onend=function(e){if(speechSynthesis.cancel(),n.state.speechState!==re.UNINITIAL){var t,s=n.workTextsIndex<n.workTexts.length-1,o=!n.state.isSpeechRepeatMode&&n.props.paginated&&n.state.currentPage<n.state.pageCount;if(s)n.workTextsIndex+=1;else{if(!o)return n.setState({speechState:re.UNINITIAL}),console.log("Stop work text to speech."),void(n.state.isSpeechRepeatMode&&n.playText2Speech());n.pageNext(),n.findTextsInPageAndChunking()}t=n.workTexts[n.workTextsIndex],n.speechSynthesisUtterance.text=t,speechSynthesis.speak(n.speechSynthesisUtterance),console.log("Play work text to speech part / page: ".concat(s?n.workTextsIndex:n.state.currentPage))}}),document.addEventListener("keydown",n.keyListener.bind(Object(ve.a)(n)),!1),n}return Object(b.a)(s,[{key:"loadEpubCoverToMemFs",value:function(){var e=Object(u.a)(h.a.mark((function e(){var t,s,o;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(t=new Uint8Array(JSON.parse(localStorage.getItem("logo.png")||"[]"))).length){e.next=8;break}return e.next=4,ee.axiosInstance.get("".concat(window.location.origin,"/").concat(ee.pwaUrl,"/assets/icon/icon.png"),{responseType:"arraybuffer"});case 4:s=e.sent,t=new Uint8Array(s.data),o=JSON.stringify(Array.from(t)),localStorage.setItem("logo.png",o);case 8:n(51).writeFileSync("logo.png",t);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"workJuanId",get:function(){return"".concat(this.props.match.params.work,"/").concat(this.props.match.params.path)}},{key:"ionViewWillEnter",value:function(){var e=y.a.parse(this.props.location.search);this.htmlFile=e.file,this.htmlTitle=e.title,this.epubcfiFromUrl=e.bookmark||"";var t=this.props.location.state;this.uuidStr=t?t.uuid:"",this.currentWork!==this.workJuanId&&(this.currentWork=this.workJuanId,this.lastPage=0),this.fetchData()}},{key:"ionViewDidEnter",value:function(){}},{key:"ionViewWillLeave",value:function(){var e;this.state.canTextToSpeech&&speechSynthesis.cancel(),this.lastPage=this.state.currentPage,this.setState({htmlStr:null,currentPage:1,speechState:re.UNINITIAL,showSearchTextToast:!1}),null===(e=this.book)||void 0===e||e.destroy(),this.book=null,this.bookCreated=!1}},{key:"fileName",get:function(){return ee.getFileName(this.props.match.params.work,this.props.match.params.path)}},{key:"fetchData",value:function(){var e=Object(u.a)(h.a.mark((function e(){var t;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({isLoading:!0}),e.prev=1,e.next=4,ee.fetchJuan(this.props.match.params.work,this.props.match.params.path,this.htmlFile,!1,this.props.tmpSettings.cbetaOfflineDbMode);case 4:return t=e.sent,e.next=7,this.loadEpubCoverToMemFs();case 7:this.setState({fetchError:!1,workInfo:t.workInfo,htmlStr:t.htmlStr}),e.next=15;break;case 10:e.prev=10,e.t0=e.catch(1),console.error(e.t0),console.error((new Error).stack),this.setState({isLoading:!1,fetchError:!0});case 15:case"end":return e.stop()}}),e,this,[[1,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"addBookmarkHandler",value:function(){var e=this.selectedString;if(""!==e){var t=me.a();this.props.dispatch({type:"ADD_BOOKMARK",htmlStr:this.state.htmlStr,bookmark:new te({type:this.htmlFile?Q.HTML:Q.JUAN,uuid:t,selectedText:e,epubcfi:this.epubcfiFromSelectedString,fileName:this.props.tmpSettings.cbetaOfflineDbMode?null:this.htmlFile||"".concat(this.props.match.params.work,"_juan").concat(this.props.match.params.path,".html"),work:Object.assign(this.state.workInfo,{title:this.htmlFile?this.htmlTitle:this.state.workInfo.title,juan:this.props.match.params.path})})}),this.setState({showToast:!0,toastMessage:"\u66f8\u7c64\u65b0\u589e\u6210\u529f\uff01"})}else this.setState({showNoSelectedTextAlert:!0})}},{key:"bookmark",get:function(){var e=this;return this.props.bookmarks.find((function(t){return t.type===Q.JUAN&&t.uuid===e.uuidStr}))}},{key:"hasBookmark",get:function(){return""!==this.epubcfiFromUrl||null!=this.bookmark}},{key:"epubcfi",get:function(){return""!==this.epubcfiFromUrl?this.epubcfiFromUrl:null!=this.bookmark?this.bookmark.epubcfi:"epubcfi(/6/6[s1]!/4/4/2/6[body]/6,/1:0,/1:1)"}},{key:"pagePrev",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.props.paginated&&this.state.currentPage>1&&(null===(e=this.rendition)||void 0===e||e.prev(t),this.setState({currentPage:this.state.currentPage-t}))}},{key:"pageNext",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.props.paginated&&this.state.currentPage<this.state.pageCount&&(null===(e=this.rendition)||void 0===e||e.next(t),this.setState({currentPage:this.state.currentPage+t}))}},{key:"jumpToPage",value:function(e){if(0!==e){e=isNaN(e)?1:Math.max(Math.min(this.state.pageCount,e),1);var t=this.state.currentPage,n=t<e?1:-1,s=Math.abs(e-t);1===n?this.pageNext(s):this.pagePrev(s)}}},{key:"keyListener",value:function(e){var t=e.keyCode||e.which;console.log(e.type),t===(this.props.rtlVerticalLayout?37:40)&&this.buttonNext(),t===(this.props.rtlVerticalLayout?39:38)&&this.buttonPrev(),("F3"===e.code||e.ctrlKey&&"f"===e.key.toLowerCase())&&(e.preventDefault(),this.setState({showSearchTextToast:!1,showSearchTextAlert:!0}))}},{key:"html2Epub",value:function(){var e=Object(u.a)(h.a.mark((function e(){var t,s,o,r,a,i,c,l,u=this;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.bookCreated=!0,this.epub=ke.document({id:"123-123456789",cover:"./logo.png",title:"Title",series:"",sequence:1,author:"Author",fileAs:"",genre:"genre",tags:"",copyright:"",publisher:"",published:"",language:"en",description:"A temp book.",contents:this.state.workInfo.title,source:"",images:["logo.png"]}),t=this.state.htmlStr,this.props.rtlVerticalLayout&&(t=(t=(t=(t=(t=t.replace(/(margin|border)-left/g,"$1-temp")).replace(/(margin|border)-bottom/g,"$1-left")).replace(/(margin|border)-right/g,"$1-bottom")).replace(/(margin|border)-top/g,"$1-right")).replace(/(margin|border)-temp/g,"$1-top")),s=t+"\n    <script>\n    <\/script>\n    ",this.epub.addSection("",s,!0,!1),"\n    html {\n      writing-mode: vertical-rl;\n      direction: ltr;\n    }\n    ",this.epub.addCSS("\n    @page {\n      size: A4;\n      margin: 0.5in;\n    }\n\n    /* For double side printing for book bundling. */\n    @page :left {\n      margin-right: 1in;\n    }\n\n    @page :right {\n      margin-left: 1in;\n    }\n\n    @media print {\n      body {\n        color: ".concat(getComputedStyle(document.body).getPropertyValue("--print-text-color")," !important;\n        background: ").concat(getComputedStyle(document.body).getPropertyValue("--print-background")," !important;\n        padding: 0 !important;\n        width: 100% !important;\n        height: 100% !important;\n        column-gap: unset !important;\n        column-width: unset !important;\n      }\n    }\n\n    html {\n      /*\n      Because different fonts have different line heights with 'line-height: normal,'\n      the content size of epubjs iframe changes after the fallback font is swapped with the web font.\n      Unfortunately, epubjs can't detect the size change and update the iframe.\n      This problem causes the total page count is incorrect.\n      Fortunately, we can set the line height based on the same font size as below.\n      */\n      line-height: 1.2;\n      -webkit-text-size-adjust: none;\n      text-size-adjust: none;\n    }\n\n    body {\n      color: ").concat(getComputedStyle(document.body).getPropertyValue("--ion-text-color"),";\n      background: ").concat(getComputedStyle(document.body).getPropertyValue("--ion-background-color"),";\n      /* Disable browser's swipe to forward / backward page navigation. */\n      overscroll-behavior-x: none;\n    }\n\n    @font-face {\n        font-family: 'Times';\n        src: local('Times New Roman');\n        unicode-range: U+0-007F;\n    }\n\n    /* Workaround parenthesis orientation problem of TW-Kai-98_1 on iOS Safari. */\n    @font-face {\n        font-family: HeitiScoped;\n        src: local('Heiti TC');\n        unicode-range: U+3008-301B, U+FF01-FF60;\n    }\n\n    .lb {\n      display: none\n    }\n\n    /* In-HTML anchor jumps don't update this.state.currentPage.\n    Thus, we disable them. */\n    .noteAnchor {\n      pointer-events: none;\n      text-decoration: inherit;\n      color: inherit;\n      cursor: auto;\n    }\n\n    .doube-line-note, .doube-line-note .t {\n      font-size: ").concat(.8*this.props.fontSize,'px;\n    }\n\n    .doube-line-note::before {\n      content: "\uff08";\n    }\n\n    .doube-line-note::after {\n      content: "\uff09";\n    }\n\n    .bip-table {\n      display: table;\n    }\n\n    .bip-table-row {\n      display: table-row;\n    }\n\n    .bip-table-cell {\n      display: table-cell;\n      border: 1px solid ').concat(getComputedStyle(document.body).getPropertyValue("--ion-text-color"),";\n      text-align: center;\n    }\n  \n    ").concat(this.props.rtlVerticalLayout?"\n    html {\n      writing-mode: vertical-rl;\n      direction: ltr;\n    }\n    ":"","\n\n    .t, p, div {\n      font-family: ").concat(getComputedStyle(document.body).getPropertyValue("--ion-font-family"),";\n      font-size: ").concat(this.props.fontSize,"px;\n    }\n\n    .bold {\n      font-weight: 700;\n    }\n    \n    #back, #cbeta-copyright {\n      display: ").concat(this.props.showComments?"block":"none",";\n    }\n    ")),e.prev=8,e.next=11,this.epub.writeEPUB(".","temp");case 11:return r=n(51),a=r.readFileSync("temp.epub"),this.book=Object(ge.b)(a.buffer,{openAs:"binary"}),this.rendition=this.book.renderTo("cbetarEPubView",{width:"100%",height:"100%",spread:"none",flow:this.props.paginated?"paginated":"scrolled",scrollbarWidth:ee.scrollbarSizeIdToValue(this.props.scrollbarSize),defaultDirection:this.props.rtlVerticalLayout?"rtl":"ltr",afterScrolledTimeout:500}),this.rendition.on("selected",(function(e,t){u.epubcfiFromSelectedString=e;var n=u.setSelectedString(),s=u.setSelectedRange();""===n?u.clearSelectedStringTimer=setTimeout((function(){u.selectedString=n,u.selectedRange=s}),500):(u.selectedString=n,u.selectedRange=s)})),this.rendition.on(ge.a.RENDITION.DISPLAYED,(function(){u.updatePageInfos()})),this.rendition.on(ge.a.VIEWS.RENDERED,(function(){u.updateEPubIframe()})),e.next=20,this.rendition.display(this.props.paginated?this.epubcfi:void 0);case 20:if(this.props.paginated){e.next=26;break}return e.next=23,null===(i=this.rendition)||void 0===i?void 0:i.next();case 23:return e.next=25,null===(c=this.rendition)||void 0===c?void 0:c.next();case 25:this.updateEPubIframe();case 26:if(0!==this.lastPage&&null==this.bookmark&&this.lastPage!==this.state.currentPage&&this.jumpToPage(this.lastPage),this.setState({isLoading:!1}),this.hasBookmark)try{null===(l=this.rendition)||void 0===l||l.annotations.highlight(this.epubcfi)}catch(h){console.error(h)}null===(o=this.book)||void 0===o||o.locations.generate(150),e.next=35;break;case 32:e.prev=32,e.t0=e.catch(8),console.log(e.t0);case 35:case"end":return e.stop()}}),e,this,[[8,32]])})));return function(){return e.apply(this,arguments)}}()},{key:"updateEPubIframe",value:function(){var e=this,t=document.getElementsByTagName("iframe");if(1===t.length){var n;this.ePubIframe=t[0],null===(n=this.ePubIframe.contentDocument)||void 0===n||n.addEventListener("keydown",this.keyListener.bind(this),!1);var s=this.ePubIframe.contentWindow;Object(v.S)("android")?s.window.oncontextmenu=ee.disableAndroidChromeCallout:Object(v.S)("ios")&&(s.document.ontouchend=ee.disableIosSafariCallout.bind(s)),this.props.useFontKai&&(s.loadTwKaiFont=we,s.loadTwKaiFont()),s.addCbetaLineBreaks=Se,s.addCbetaLineBreaks(),s.addSwpiedEvents=Te,s.addSwpiedEvents(),s.document.addEventListener("swiped",(function(t){if(e.props.paginated)if(e.props.rtlVerticalLayout)switch(t.detail.dir){case"left":e.pagePrev();break;case"right":e.pageNext()}else switch(t.detail.dir){case"down":e.pagePrev();break;case"up":e.pageNext()}})),this.findVisibleTexts()}else t.length>1?alert("Error! This component locates ePub iframe by the only iframe."):console.error("ePub iframes count is 0.")}},{key:"updatePageInfos",value:function(){var e,t=(null===(e=this.rendition)||void 0===e?void 0:e.currentLocation()).start.displayed;this.setState({currentPage:t.page,pageCount:t.total})}},{key:"setSelectedString",value:function(){var e,t,n="",s=null===(e=this.ePubIframe)||void 0===e||null===(t=e.contentDocument)||void 0===t?void 0:t.getSelection();return((null===s||void 0===s?void 0:s.rangeCount)||0)>0&&s.getRangeAt(0).toString().length>0&&(n=s.toString()),n}},{key:"setSelectedRange",value:function(){var e,t,n;return null===(e=this.ePubIframe)||void 0===e||null===(t=e.contentDocument)||void 0===t||null===(n=t.getSelection())||void 0===n?void 0:n.getRangeAt(0)}},{key:"getRemainingWorkTextFromSelectedRange",value:function(){var e,t=this.ePubIframe.contentWindow.getSelection();if("Range"===t.type){var n=this.ePubIframe.contentDocument.getElementById("back"),s=t.getRangeAt(0);s.setEnd(n,0);var o=s.cloneContents();null===t||void 0===t||t.removeAllRanges();var r=new Document,a=r.createElement("html");r.appendChild(a),a.appendChild(o),ee.removeElementsByClassName(r,"lb"),ee.removeElementsByClassName(r,"doube-line-note"),e=r.getElementById("body").innerText}return e}},{key:"getAllTextNodes",value:function(e){return document.createTreeWalker(e,NodeFilter.SHOW_TEXT)}},{key:"visibleCharToRange",value:function(e){var t=this.visibleChars[e],n=new Range;return n.setStart(t.node,t.offset),n.setEnd(t.node,t.offset+1),n}},{key:"rectBinDirSize",value:function(e){return this.props.rtlVerticalLayout?e.y:e.x}},{key:"findBinBoundaryVisibleCharIndex",value:function(e,t,n){var s=t+Math.floor((n-t)/2);if(0===s)return 0;if(s===this.visibleChars.length-1)return this.visibleChars.length-1;var o=this.visibleCharToRange(s),r=this.visibleCharToRange(s+1),a=o.getBoundingClientRect(),i=r.getBoundingClientRect(),c=this.rectBinDirSize(a)-this.ePubIframeOffset,l=this.rectBinDirSize(i)-this.ePubIframeOffset;return c<e&&e<=l?s:c<e&&e>l?this.findBinBoundaryVisibleCharIndex(e,s+1,n):c>=e&&e<=l?this.findBinBoundaryVisibleCharIndex(e,t,s):(console.error("Unreasonable case!"),-1)}},{key:"findTextsInPage",value:function(e){var t=new Date,n=e-1;if(!this.isPageSearched[n]){var s=this.pageWidth*(e-1),o=this.pageWidth*e,r=0;1!==e&&(r=this.isPageSearched[n-1]?this.visibleChars.length-1-this.visibleChars.slice().reverse().findIndex((function(t){return t.page===e-1}))+1:this.findBinBoundaryVisibleCharIndex(s,0,this.visibleChars.length-1)+1);var a=this.visibleChars.length-1,i=this.visibleChars.length-1;e!==this.state.pageCount&&(i=this.isPageSearched[n+1]?this.visibleChars.findIndex((function(t){return t.page===e+1}))-1:this.findBinBoundaryVisibleCharIndex(o,r,a));for(var c=r;c<=i;c++)this.visibleChars[c].page=e;this.isPageSearched[n]=!0}var l=this.visibleChars.filter((function(t){return t.page===e})).map((function(e){return e.char})).join(""),h=(new Date).getTime()-t.getTime();return console.log("findTextsInPage spends: ".concat(h/1e3,"s")),l}},{key:"findVisibleTexts",value:function(){var e=this,t=this.ePubIframe.contentDocument.getElementById("body");if(t){var n,s=this.getAllTextNodes(t);this.visibleTextNodes=[],this.visibleChars=[],this.isPageSearched=[];for(var o=function(){var t=n;if(["t","pc","gaijiAnchor"].reduce((function(e,n){var s;return e&&n!==(null===(s=t.parentElement)||void 0===s?void 0:s.className)}),!0))return"continue";e.visibleTextNodes.push(n)};null!=(n=s.nextNode());)o();this.allTexts=this.visibleTextNodes.map((function(e){return e.textContent})).join("");for(var r=0,a=0;a<this.visibleTextNodes.length;a++)for(var i=this.visibleTextNodes[a],c=0;c<i.length;c++)this.visibleChars.push({node:i,offset:c,page:0,char:this.allTexts[r]}),r++;var l=document.querySelector(".epub-container");this.pageWidth=this.props.rtlVerticalLayout?l.clientHeight:l.clientWidth,this.pagesWidth=this.pageWidth*this.state.pageCount,this.isPageSearched=new Array(this.state.pageCount);for(var h=0;h<this.isPageSearched.length;h++)this.isPageSearched[h]=!1;var u=this.visibleCharToRange(0).getBoundingClientRect();this.ePubIframeOffset=this.props.rtlVerticalLayout?u.y:u.x}}},{key:"findSearchTextRanges",value:function(e){this.searchTextRanges=[],this.showedSearchTextIndex=0;var t=[],n=0,s=1;do{if(-1===(s=this.allTexts.indexOf(e,n)))break;n=s+e.length,t.push(s),t.push(s+e.length)}while(s<this.allTexts.length-1);if(0!==t.length){var o=[],r=0;s=t.shift();for(var a=0;a<this.visibleTextNodes.length;a++){for(var i=this.visibleTextNodes[a],c=0;c<i.length&&(r!==s||(o.push({node:i,offset:c}),-1!==(s=t.shift()||-1)));c++)r++;if(-1===s)break}for(var l=0;l<o.length/2;l+=1){var h=new Range,u=o[2*l],p=o[2*l+1];h.setStart(u.node,u.offset),h.setEnd(p.node,p.offset),this.searchTextRanges.push(h)}}}},{key:"findVisibleCharIndex",value:function(e,t){for(var n=0;n<this.visibleChars.length;n++){var s=this.visibleChars[n];if(s.node===e&&s.offset===t)return n}return-1}},{key:"searchTextPrev",value:function(){this.showedSearchTextIndex>0&&this.showedSearchTextIndex--,this.moveToSearchText(this.showedSearchTextIndex)}},{key:"searchTextNext",value:function(){this.showedSearchTextIndex<this.searchTextRanges.length-1&&this.showedSearchTextIndex++,this.moveToSearchText(this.showedSearchTextIndex)}},{key:"moveToSearchText",value:function(e){var t=this;this.epubcfiFromSelectedString="";var n=this.ePubIframe.contentWindow.getSelection();n.removeAllRanges(),setTimeout((function(){var s,o,r=t.searchTextRanges[e];(t.ePubIframe.contentWindow.focus(),n.addRange(r),t.props.paginated)?s=setInterval((function(){var e;""!==t.epubcfiFromSelectedString&&(clearInterval(s),null===(e=t.rendition)||void 0===e||e.display(t.epubcfiFromSelectedString).then((function(){var e,n;null===(e=t.rendition)||void 0===e||e.annotations.removeAll(),null===(n=t.rendition)||void 0===n||n.annotations.highlight(t.epubcfiFromSelectedString,{},(function(e){}))})))}),100):null===(o=r.startContainer.parentElement)||void 0===o||o.scrollIntoView()}),100)}},{key:"buttonPrev",value:function(){this.state.showSearchTextToast?this.searchTextPrev():this.pagePrev()}},{key:"buttonNext",value:function(){this.state.showSearchTextToast?this.searchTextNext():this.pageNext()}},{key:"findCbetaHtmlLine",value:function(e){var t=e.parentElement;do{var n,s;if(null===(s=t)||void 0===s?void 0:s.getAttribute("l"))break}while(t=null===(n=t)||void 0===n?void 0:n.parentElement);return t}},{key:"findTextsInPageAndChunking",value:function(){var e,t,n,s;if(this.state.isSpeechRepeatMode){var o=this.findVisibleCharIndex(this.speechRepeatStart.startContainer,this.speechRepeatStart.startOffset),r=this.findVisibleCharIndex(this.speechRepeatEnd.endContainer,this.speechRepeatEnd.endOffset-1);s="";for(var a=o;a<r+1;a++)s+=this.visibleChars[a].char}else s=this.props.paginated?this.findTextsInPage(this.state.currentPage):this.getRemainingWorkTextFromSelectedRange();var i=s||(null===(e=this.ePubIframe)||void 0===e||null===(t=e.contentDocument)||void 0===t||null===(n=t.getElementById("body"))||void 0===n?void 0:n.innerText)||"\u7121\u6cd5\u53d6\u5f97\u7d93\u6587\u5167\u5bb9";this.workTexts=[];for(var c=0;c<Math.ceil(i.length/this.maxCharsPerUtterance);c++)this.workTexts.push(i.substring(c*this.maxCharsPerUtterance,(c+1)*this.maxCharsPerUtterance));this.workTextsIndex=0}},{key:"playText2Speech",value:function(){var e=this,t=ee.zhVoices();switch(this.state.speechState){case re.UNINITIAL:var n=t.find((function(t){return t.voiceURI===e.props.voiceURI}))||t[0];void 0!==n&&(this.speechSynthesisUtterance.lang=n.lang,this.speechSynthesisUtterance.voice=n),this.findTextsInPageAndChunking(),this.speechSynthesisUtterance.text=this.workTexts[this.workTextsIndex],this.speechSynthesisUtterance.rate=this.props.speechRate,speechSynthesis.cancel(),speechSynthesis.speak(this.speechSynthesisUtterance),this.setState({speechState:re.SPEAKING,showToast:!0,toastMessage:"\u7d93\u6587\u5538\u8aa6\u975e\u771f\u4eba\u767c\u97f3\uff0c\u50c5\u4f5c\u53c3\u8003\uff01"});break;case re.SPEAKING:speechSynthesis.cancel(),this.setState({speechState:re.UNINITIAL,isSpeechRepeatMode:!1});break;case re.PAUSE:speechSynthesis.resume(),this.setState({speechState:re.SPEAKING})}}},{key:"render",value:function(){var e=this,t=Object(E.jsx)(v.g,{children:Object(E.jsxs)(v.J,{children:[Object(E.jsx)(v.G,{className:"uiFont"}),Object(E.jsx)(v.c,{fill:"clear",slot:"start",onClick:function(t){return e.props.history.goBack()},children:Object(E.jsx)(v.h,{icon:I.a,slot:"icon-only"})}),Object(E.jsx)(v.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(t){return e.fetchData()},children:Object(E.jsx)(v.h,{icon:I.v,slot:"icon-only"})}),Object(E.jsx)(v.c,{fill:"outline",shape:"round",hidden:!this.props.paginated,slot:"end",onClick:function(t){e.setState({showJumpPageAlert:!0})},children:Object(E.jsx)(v.o,{className:"uiFont",children:this.state.currentPage})}),Object(E.jsx)(v.c,{hidden:this.state.fetchError||!this.state.canTextToSpeech,fill:"clear",slot:"end",onClick:function(t){e.playText2Speech()},children:Object(E.jsx)(v.h,{icon:this.state.speechState===re.SPEAKING?I.z:I.s,slot:"icon-only"})}),Object(E.jsx)(v.c,{hidden:this.state.fetchError,fill:"clear",slot:"end",onClick:function(t){Object(ye.clearTimeout)(e.clearSelectedStringTimer),e.addBookmarkHandler()},children:Object(E.jsx)(v.h,{icon:I.f,slot:"icon-only"})}),Object(E.jsx)(v.c,{fill:"clear",slot:"end",onClick:function(t){Object(ye.clearTimeout)(e.clearSelectedStringTimer),e.setState({popover:{show:!0,event:t.nativeEvent}})},children:Object(E.jsx)(v.h,{ios:I.l,md:I.m,slot:"icon-only"})}),Object(E.jsx)(v.t,{isOpen:this.state.popover.show,event:this.state.popover.event,onDidDismiss:function(t){e.setState({popover:{show:!1,event:null}})},children:Object(E.jsxs)(v.p,{children:[Object(E.jsxs)(v.k,{button:!0,onClick:function(t){e.setState({showSpeechRepeatStart:!0,popover:{show:!1,event:null}})},children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.t,slot:"start"}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u5faa\u74b0\u64ad\u653e"})]}),Object(E.jsxs)(v.k,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}}),e.props.history.push("/catalog/work/".concat(e.props.match.params.work))},children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.o,slot:"start"}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u56de\u7d93\u76ee\u9304"})]}),Object(E.jsxs)(v.k,{button:!0,onClick:function(t){e.props.history.push("/".concat(e.props.match.params.tab)),e.setState({popover:{show:!1,event:null}})},children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.o,slot:"start"}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u56de\u9996\u9801"})]}),Object(E.jsxs)(v.k,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}});var n=e.selectedString;ee.copyToClipboard(n),e.setState({showToast:!0,toastMessage:"\u8907\u88fd\u6587\u5b57\u6210\u529f\uff01"})},children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.i,slot:"start"}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u8907\u88fd\u6587\u5b57"})]}),Object(E.jsxs)(v.k,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}}),e.setState({showSearchTextToast:!1,showSearchTextAlert:!0})},children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.w,slot:"start"}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u641c\u5c0b\u6587\u5b57"})]}),Object(E.jsxs)(v.k,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}}),e.setState({showSearchAlert:!0})},children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.w,slot:"start"}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u641c\u5c0b\u7d93\u66f8"})]}),Object(E.jsxs)(v.k,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}});var n=e.selectedString;""!==n?e.props.history.push({pathname:"/dictionary/search/".concat(n)}):e.setState({showNoSelectedTextAlert:!0})},children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.e,slot:"start"}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u67e5\u8a5e\u5178"})]}),Object(E.jsxs)(v.k,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}});var n=e.selectedString;""!==n?e.props.history.push({pathname:"/dictionary/searchWord/".concat(n)}):e.setState({showNoSelectedTextAlert:!0})},children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.e,slot:"start"}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u67e5\u5b57\u5178"})]}),Object(E.jsxs)(v.k,{button:!0,onClick:function(t){var n,s;e.setState({popover:{show:!1,event:null}}),null===(n=e.ePubIframe)||void 0===n||null===(s=n.contentWindow)||void 0===s||s.print()},children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.u,slot:"start"}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u5217\u5370"})]}),Object(E.jsxs)(v.k,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}}),window.open("https://cbetaonline.dila.edu.tw/zh/".concat(e.props.match.params.work,"_").concat(e.props.match.params.path.padStart(3,"0")),"_bank")},children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.r,slot:"start"}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"CBETA Online"})]}),Object(E.jsxs)(v.k,{button:!0,onClick:function(t){var n,s;e.setState({popover:{show:!1,event:null}});var o=e.selectedString;if(""!==o){var r=e.selectedRange,a=null===(n=e.findCbetaHtmlLine(r.startContainer))||void 0===n?void 0:n.getAttribute("l"),i=null===(s=e.findCbetaHtmlLine(r.endContainer))||void 0===s?void 0:s.getAttribute("l");if(null!=a&&null!=i){var c=/0*([1-9]*)([a-z])0*([1-9]*)/.exec(a),l="".concat(c[1]).concat(c[2]).concat(c[3]),h=/0*([1-9]*)([a-z])0*([1-9]*)/.exec(i)[3],u="".concat(l);a!==i&&(u+="-".concat(h));var p="\u300a".concat(e.state.workInfo.title,"\u300b\u5377").concat(e.props.match.params.path,"\uff1a\u300c").concat(o,"\u300d(CBETA, ").concat(e.state.workInfo.vol,", no. ").concat(+/[^0-9]*(.*)/.exec(e.state.workInfo.work)[1],", p. ").concat(u,")");ee.copyToClipboard(p),e.setState({showToast:!0,toastMessage:"\u5df2\u8907\u88fd\u5230\u526a\u8cbc\u7c3f\uff01"})}else e.setState({showToast:!0,toastMessage:"\u6240\u9078\u6587\u5b57\u7121\u6cd5\u5f15\u7528\uff01"})}else e.setState({showNoSelectedTextAlert:!0})},children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.y,slot:"start"}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u5f15\u7528\u6587\u7ae0"})]}),Object(E.jsxs)(v.k,{button:!0,onClick:function(t){var n=window.location.href.split("?")[0];""!==e.selectedString&&(n+="?bookmark=".concat(e.epubcfiFromSelectedString)),e.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(n)}})},children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.y,slot:"start"}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u5206\u4eab\u6b64\u9801"})]})]})}),Object(E.jsx)(v.u,{reversed:this.props.rtlVerticalLayout,value:this.state.currentPage/this.state.pageCount})]})}),n=.2,s=Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)(v.e,{vertical:"center",horizontal:"start",slot:"fixed",children:Object(E.jsx)(v.f,{style:{opacity:n},onClick:function(t){return e.props.rtlVerticalLayout?e.buttonNext():e.buttonPrev()},onPointerDown:function(e){e.currentTarget.style.setProperty("opacity","1")},onPointerEnter:function(e){e.currentTarget.style.setProperty("opacity","1")},onPointerUp:function(e){ee.isTouchDevice()&&e.currentTarget.style.setProperty("opacity","".concat(n))},onPointerLeave:function(e){e.currentTarget.style.setProperty("opacity","".concat(n))},children:Object(E.jsx)(v.h,{icon:this.props.rtlVerticalLayout?I.a:I.d})})}),Object(E.jsx)(v.e,{vertical:"center",horizontal:"end",slot:"fixed",children:Object(E.jsx)(v.f,{style:{opacity:n},onClick:function(t){return e.props.rtlVerticalLayout?e.buttonPrev():e.buttonNext()},onPointerDown:function(e){e.currentTarget.style.setProperty("opacity","1")},onPointerEnter:function(e){e.currentTarget.style.setProperty("opacity","1")},onPointerUp:function(e){ee.isTouchDevice()&&e.currentTarget.style.setProperty("opacity","".concat(n))},onPointerLeave:function(e){e.currentTarget.style.setProperty("opacity","".concat(n))},children:Object(E.jsx)(v.h,{icon:this.props.rtlVerticalLayout?I.c:I.b})})})]});return this.bookCreated||null==this.state.htmlStr||this.html2Epub(),Object(E.jsxs)(v.s,{children:[t,Object(E.jsxs)(v.d,{children:[this.props.paginated||this.state.showSearchTextToast?s:Object(E.jsx)(E.Fragment,{}),Object(E.jsx)(v.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return e.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."}),this.state.fetchError?ee.fetchErrorContent:Object(E.jsx)(E.Fragment,{}),Object(E.jsx)("div",{id:"cbetarEPubView",style:{width:"100%",height:"100%",userSelect:"text",WebkitUserSelect:"text"}}),Object(E.jsx)(v.a,{cssClass:"uiFont",isOpen:this.state.showJumpPageAlert,header:"\u8df3\u9801",subHeader:"\u8acb\u8f38\u5165\u9801\u78bc(1 - ".concat(this.state.pageCount,")"),inputs:[{name:"name0",type:"number",min:1,max:this.state.pageCount,value:this.state.currentPage}],buttons:[{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary uiFont",handler:function(){return e.setState({showJumpPageAlert:!1})}},{text:"\u78ba\u5b9a",cssClass:"primary uiFont",handler:function(t){e.setState({showJumpPageAlert:!1}),e.jumpToPage(t.name0)}}]}),Object(E.jsx)(ce,Object(p.a)({},Object(p.a)({showSearchAlert:this.state.showSearchAlert,finish:function(){e.setState({showSearchAlert:!1})}},this.props))),Object(E.jsx)(v.a,{cssClass:"uiFont",isOpen:this.state.showNoSelectedTextAlert,backdropDismiss:!1,header:"\u5931\u6557",message:"\u8acb\u78ba\u8a8d\u662f\u5426\u5df2\u9078\u64c7\u4e00\u6bb5\u6587\u5b57\uff0c\u7136\u5f8c\u518d\u57f7\u884c\u6240\u9078\u7684\u529f\u80fd!",buttons:[{text:"\u78ba\u5b9a",cssClass:"primary uiFont",handler:function(t){e.setState({showNoSelectedTextAlert:!1})}}]}),Object(E.jsx)(v.a,{cssClass:"uiFont",isOpen:this.state.showSearchTextAlert,header:"\u641c\u5c0b\u6587\u5b57",subHeader:"\u6309\u4e0b\u641c\u5c0b\u5f8c\uff0c\u5de6\u53f3\u65b9\u5411\u9215\u8b8a\u70ba\u641c\u5c0b\u6587\u5b57\u65b9\u5411\u9215\u3002\u6309\u4e0b\u65b9\u901a\u77e5UI\u95dc\u9589\u9215\uff0c\u96e2\u958b\u641c\u5c0b\u6587\u5b57\u6a21\u5f0f\u3002",inputs:[{name:"name0",type:"search",placeholder:"\u4f8b:\u5982\u662f\u6211\u805e"}],buttons:[{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary uiFont",handler:function(){return e.setState({showSearchTextAlert:!1})}},{text:"\u641c\u5c0b",cssClass:"primary uiFont",handler:function(t){""!==t.name0?(e.findSearchTextRanges(t.name0),0===e.searchTextRanges.length?e.setState({showSearchTextAlert:!1,showToast:!0,toastMessage:"\u627e\u4e0d\u5230\u6587\u5b57\uff1a".concat(t.name0)}):(e.setState({showSearchTextAlert:!1,showSearchTextToast:!0,searchText:t.name0}),e.searchTextPrev())):e.setState({showSearchTextAlert:!1})}}]}),Object(E.jsx)(v.H,{cssClass:"uiFont",isOpen:this.state.showSearchTextToast,onDidDismiss:function(){return e.setState({showSearchTextToast:!1})},message:"\u641c\u5c0b\uff1a".concat(this.state.searchText),buttons:[{text:"\u95dc\u9589",role:"cancel",handler:function(){return e.setState({showSearchTextToast:!1})}}]}),Object(E.jsx)(v.H,{cssClass:"uiFont",isOpen:this.state.showSpeechRepeatStart,onDidDismiss:function(){return e.setState({showSpeechRepeatStart:!1})},message:"\u8acb\u9078\u64c7\u5071\u74b0\u64ad\u653e\u6587\u5b57\u8d77\u9ede\uff0c\u518d\u6309\u78ba\u5b9a",buttons:[{text:"\u78ba\u5b9a",role:"ok",handler:function(){Object(ye.clearTimeout)(e.clearSelectedStringTimer),e.speechRepeatStart=e.selectedRange,e.setState({showSpeechRepeatStart:!1,showSpeechRepeatEnd:!0})}}]}),Object(E.jsx)(v.H,{cssClass:"uiFont",isOpen:this.state.showSpeechRepeatEnd,onDidDismiss:function(){return e.setState({showSpeechRepeatEnd:!1})},message:"\u8acb\u9078\u64c7\u5071\u74b0\u64ad\u653e\u6587\u5b57\u7d42\u9ede\uff0c\u518d\u6309\u78ba\u5b9a",buttons:[{text:"\u78ba\u5b9a",role:"ok",handler:function(){Object(ye.clearTimeout)(e.clearSelectedStringTimer),e.speechRepeatEnd=e.selectedRange,e.setState({isSpeechRepeatMode:!0,showSpeechRepeatEnd:!1}),e.playText2Speech()}}]}),Object(E.jsx)(v.H,{cssClass:"uiFont",isOpen:this.state.showToast,onDidDismiss:function(){return e.setState({showToast:!1})},message:this.state.toastMessage,duration:2e3})]})]})}}]),s}(r.a.Component),Ie=Object(v.U)(Ae),Ee=Object(g.b)((function(e){return{settings:e.settings,bookmarks:e.settings.bookmarks,fontSize:e.settings.fontSize,showComments:e.settings.showComments,paginated:e.settings.paginated,rtlVerticalLayout:e.settings.rtlVerticalLayout,useFontKai:e.settings.useFontKai,scrollbarSize:e.settings.scrollbarSize,voiceURI:e.settings.voiceURI,speechRate:e.settings.speechRate,tmpSettings:e.tmpSettings}}))(Ie),Fe=(n(446),n(447),n(448),n(449),n(450),n(451),n(452),n(453),n(454),n(455),n(456),n(457),n(109)),Ne=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e){var s;return Object(d.a)(this,n),(s=t.call(this,e)).reportText="",s.state={showFontLicense:!1,juansDownloadedRatio:0,showBugReportAlert:!1,showUpdateAllJuansDone:!1,showClearAlert:!1,showToast:!1,toastMessage:""},s}return Object(b.a)(n,[{key:"ionViewWillEnter",value:function(){}},{key:"updateBookmark",value:function(e,t){var n=e.findIndex((function(e){return e.uuid===t.uuid}));-1===n?console.error("Update bookmark fails! Can't find the original bookmark with UUID: ".concat(t.uuid)):e[n]=t}},{key:"updateAllJuans",value:function(){var e=Object(u.a)(h.a.mark((function e(){var t,n,s,o,r,a,i,c,l,u,p,d,b,j,f,x,v,m,g,k,y;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(this.setState({juansDownloadedRatio:0}),t=this.props.settings.bookmarks.filter((function(e){return e.type===Q.WORK})),n=this.props.settings.bookmarks.filter((function(e){return e.type===Q.JUAN})),s=n.filter((function(e){return-1===t.findIndex((function(t){var n,s;return(null===(n=t.work)||void 0===n?void 0:n.work)===(null===(s=e.work)||void 0===s?void 0:s.work)}))})),o=s.length,r=0;r<t.length;r++)a=t[r].work,o+=a.juan_list.split(",").length;i=0,c=0;case 8:if(!(c<t.length)){e.next=30;break}l=t[c],u=l.work,p=u.juan_list.split(","),d=0;case 13:if(!(d<p.length)){e.next=27;break}return b=p[d],i+=1,this.setState({juansDownloadedRatio:i/o}),e.next=19,ee.fetchJuan(u.work,b,null,!0);case 19:j=e.sent,f=ee.getFileName(u.work,b),this.props.tmpSettings.cbetaOfflineDbMode||ee.saveFileToIndexedDB(f,j.htmlStr),0===d&&this.updateBookmark(this.props.settings.bookmarks,Object.assign(l,{work:j.workInfo})),console.log("File saved: ".concat(f));case 24:d++,e.next=13;break;case 27:c++,e.next=8;break;case 30:x=0;case 31:if(!(x<s.length)){e.next=48;break}return i+=1,this.setState({juansDownloadedRatio:i/o}),v=s[x],m=v.work,e.next=38,ee.fetchJuan(m.work,"".concat(m.juan),null,!0);case 38:g=e.sent,k=ee.getFileName(m.work,"".concat(m.juan)),(y=g.workInfo).juan=m.juan,this.props.tmpSettings.cbetaOfflineDbMode||ee.saveFileToIndexedDB(k,g.htmlStr),this.updateBookmark(this.props.settings.bookmarks,Object.assign(v,{work:y})),console.log("File saved: ".concat(k));case 45:x++,e.next=31;break;case 48:this.props.dispatch({type:"UPDATE_BOOKMARKS",bookmarks:this.props.settings.bookmarks}),this.setState({showUpdateAllJuansDone:!0});case 50:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return Object(E.jsxs)(v.s,{children:[Object(E.jsx)(v.g,{children:Object(E.jsx)(v.J,{children:Object(E.jsx)(v.G,{className:"uiFont",children:"\u8a2d\u5b9a"})})}),Object(E.jsxs)(v.d,{children:[Object(E.jsxs)(v.p,{children:[Object(E.jsxs)(v.k,{hidden:!this.props.tmpSettings.mainVersion,children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.p,slot:"start"}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u4f7f\u7528CBETA\u96e2\u7dda\u7d93\u6587\u8cc7\u6599\u6a94"}),Object(E.jsx)(v.I,{slot:"end",disabled:!0,checked:this.props.tmpSettings.cbetaOfflineDbMode})]}),Object(E.jsxs)(v.k,{children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.g,slot:"start"}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:Object(E.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2#report",target:"_new",children:"\u555f\u7528app\u7570\u5e38\u8a18\u9304"})}),Object(E.jsx)(v.I,{slot:"end",checked:this.props.settings.hasAppLog,onIonChange:function(t){var n=t.detail.checked;e.props.settings.hasAppLog!==n&&(n?ee.enableAppLog():ee.disableAppLog(),e.props.dispatch({type:"SET_KEY_VAL",key:"hasAppLog",val:n}))}})]}),Object(E.jsxs)(v.k,{hidden:!this.props.settings.hasAppLog,children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.g,slot:"start"}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u56de\u5831app\u7570\u5e38\u8a18\u9304"}),Object(E.jsx)(v.c,{fill:"outline",shape:"round",slot:"end",size:"large",className:"uiFont",onClick:function(t){e.reportText="\u700f\u89bd\u5668\uff1a"+navigator.userAgent+"\n\nApp\u7248\u672c\uff1a"+Fe.pwaVersion+"\n\nApp\u8a2d\u5b9a\uff1a"+JSON.stringify(e.props.settings)+"\n\nLog\uff1a\n"+ee.getLog(),e.setState({showBugReportAlert:!0})},children:"\u56de\u5831"}),Object(E.jsx)(v.a,{cssClass:"uiFont",backdropDismiss:!1,isOpen:this.state.showBugReportAlert,header:"\u7570\u5e38\u56de\u5831",subHeader:"\u8f38\u5165\u60a8\u7684 E-mail\uff0c\u4ee5\u5f8c\u7e8c\u806f\u7d61",inputs:[{name:"name0",type:"email",placeholder:"abc@example.com"},{name:"name1",type:"textarea",placeholder:"\u8acb\u63cf\u8ff0\u767c\u751f\u6b65\u9a5f"}],buttons:[{text:"\u9001\u51fa",cssClass:"primary uiFont",handler:function(){var t=Object(u.a)(h.a.mark((function t(n){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(/^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(n.name0)){t.next=3;break}return e.setState({showBugReportAlert:!1,showToast:!0,toastMessage:"\u932f\u8aa4\uff0cE-mail \u4e0d\u7b26\u683c\u5f0f\uff01"}),t.abrupt("return");case 3:return t.prev=3,t.next=6,ee.axiosInstance.post(ee.bugReportApiUrl,{subject:"".concat(Fe.productName,"\u7570\u5e38\u8a18\u9304\u56de\u5831"),text:"E-mail: ".concat(n.name0,"\n\n\u767c\u751f\u6b65\u9a5f: ").concat(n.name1,"\n\n").concat(e.reportText)});case 6:e.setState({showBugReportAlert:!1,showToast:!0,toastMessage:"\u7570\u5e38\u56de\u5831\u6210\u529f"}),t.next=13;break;case 9:t.prev=9,t.t0=t.catch(3),console.error(t.t0),e.setState({showBugReportAlert:!1,showToast:!0,toastMessage:"\u7570\u5e38\u56de\u5831\u5931\u6557"});case 13:case"end":return t.stop()}}),t,null,[[3,9]])})));return function(e){return t.apply(this,arguments)}}()},{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary uiFont",handler:function(){return e.setState({showBugReportAlert:!1})}}]})]}),Object(E.jsxs)(v.k,{children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.k,slot:"start"}),Object(E.jsx)("div",{className:"contentBlock",children:Object(E.jsxs)("div",{style:{flexDirection:"column"},children:[Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"App\u8a2d\u5b9a\u8207\u66f8\u7c64"}),Object(E.jsxs)("div",{style:{textAlign:"right"},children:[Object(E.jsx)(v.c,{fill:"outline",shape:"round",size:"large",className:"uiFont",onClick:function(){var e=Object(u.a)(h.a.mark((function e(t){var n,s;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n="data:text/json;charset=utf-8,".concat(encodeURIComponent(localStorage.getItem(ee.storeFile)||"")),(s=document.createElement("a")).href=n,s.download=ee.storeFile,s.click(),s.remove();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:"\u532f\u51fa"}),Object(E.jsx)("input",{id:"importJsonInput",type:"file",accept:".json",style:{display:"none"},onChange:function(){var t=Object(u.a)(h.a.mark((function t(n){var s,o,r;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=null===(s=n.target.files)||void 0===s?void 0:s.item(0),t.next=3,null===o||void 0===o?void 0:o.text();case 3:if(t.t0=t.sent,t.t0){t.next=6;break}t.t0="";case 6:r=t.t0;try{JSON.parse(r),localStorage.setItem(ee.storeFile,r),e.props.dispatch({type:"LOAD_SETTINGS"}),e.updateAllJuans()}catch(a){console.error(a),console.error((new Error).stack)}document.getElementById("importJsonInput").value="";case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}),Object(E.jsx)(v.c,{fill:"outline",shape:"round",size:"large",className:"uiFont",onClick:function(e){document.querySelector("#importJsonInput").click()},children:"\u532f\u5165"}),Object(E.jsx)(v.c,{fill:"outline",shape:"round",size:"large",className:"uiFont",onClick:function(t){e.setState({showClearAlert:!0})},children:"\u91cd\u7f6e"}),Object(E.jsx)(v.a,{cssClass:"uiFont",isOpen:this.state.showClearAlert,backdropDismiss:!1,onDidPresent:function(e){},header:"\u91cd\u7f6e\u6703\u9084\u539fapp\u8a2d\u5b9a\u9810\u8a2d\u503c\u4e26\u6e05\u9664\u66f8\u7c64\u3001\u5b57\u578b\u6a94\uff01\u78ba\u5b9a\u91cd\u7f6e\uff1f",buttons:[{text:"\u53d6\u6d88",cssClass:"primary uiFont",handler:function(t){e.setState({showClearAlert:!1})}},{text:"\u91cd\u7f6e",cssClass:"secondary uiFont",handler:function(){var t=Object(u.a)(h.a.mark((function t(n){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ee.clearAppData();case 2:for(e.props.dispatch({type:"DEFAULT_SETTINGS"});document.body.classList.length>0;)document.body.classList.remove(document.body.classList.item(0));document.body.classList.toggle("theme".concat(e.props.settings.theme),!0),document.body.classList.toggle("print".concat(e.props.settings.printStyle),!0),e.setState({showClearAlert:!1,showToast:!0,toastMessage:"\u6e05\u9664\u6210\u529f!"});case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]})]})]})})]}),Object(E.jsxs)(v.k,{children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.v,slot:"start"}),Object(E.jsxs)("div",{style:{width:"100%"},children:[Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u66f4\u65b0\u96e2\u7dda\u7d93\u6587\u6a94"}),Object(E.jsx)(v.u,{value:this.state.juansDownloadedRatio})]}),Object(E.jsx)(v.c,{fill:"outline",shape:"round",slot:"end",size:"large",className:"uiFont",onClick:function(){var t=Object(u.a)(h.a.mark((function t(n){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.updateAllJuans());case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),children:"\u66f4\u65b0"}),Object(E.jsx)(v.H,{cssClass:"uiFont",isOpen:this.state.showUpdateAllJuansDone,onDidDismiss:function(){return e.setState({showUpdateAllJuansDone:!1})},message:"\u96e2\u7dda\u7d93\u6587\u6a94\u66f4\u65b0\u5b8c\u7562\uff01",duration:2e3})]}),Object(E.jsxs)(v.k,{children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.h,slot:"start"}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:ee.appSettings.theme}),Object(E.jsxs)(v.B,{slot:"end",value:this.props.settings.theme,className:"uiFont",interface:"popover",interfaceOptions:{cssClass:"cbetar2themes"},onIonChange:function(t){var n=+t.detail.value;e.props.settings.theme!==n&&e.props.dispatch({type:"SET_KEY_VAL",key:"theme",val:n})},children:[Object(E.jsx)(v.C,{className:"uiFont cbeta",value:0,children:"CBETA"}),Object(E.jsx)(v.C,{className:"uiFont dark",value:1,children:"\u6697\u8272"}),Object(E.jsx)(v.C,{className:"uiFont light",value:2,children:"\u4eae\u8272"}),Object(E.jsx)(v.C,{className:"uiFont oldPaper",value:3,children:"\u820a\u66f8"}),Object(E.jsx)(v.C,{className:"uiFont marble",value:4,children:"\u5927\u7406\u77f3"})]})]}),Object(E.jsxs)(v.k,{children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.j,slot:"start"}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:ee.appSettings.rtlVerticalLayout}),Object(E.jsx)(v.I,{slot:"end",checked:this.props.settings.rtlVerticalLayout,onIonChange:function(t){var n=t.detail.checked;e.props.settings.rtlVerticalLayout!==n&&e.props.dispatch({type:"SET_KEY_VAL",key:"rtlVerticalLayout",val:n})}})]}),Object(E.jsxs)(v.k,{children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.j,slot:"start"}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:ee.appSettings.paginated}),Object(E.jsx)(v.I,{slot:"end",checked:this.props.settings.paginated,onIonChange:function(t){var n=t.detail.checked;e.props.settings.paginated!==n&&e.props.dispatch({type:"SET_KEY_VAL",key:"paginated",val:n})}})]}),Object(E.jsxs)(v.k,{children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.j,slot:"start"}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u55ae\u9801\u7d93\u6587\u6372\u8ef8\u5927\u5c0f"}),Object(E.jsxs)(v.B,{slot:"end",value:this.props.settings.scrollbarSize,className:"uiFont",interface:"popover",interfaceOptions:{cssClass:"uiFont"},onIonChange:function(t){var n=+t.detail.value;e.props.settings.scrollbarSize!==n&&(e.props.dispatch({type:"SET_KEY_VAL",key:"scrollbarSize",val:n}),ee.updateCssVars(e.props.settings))},children:[Object(E.jsx)(v.C,{className:"uiFont",value:0,children:"\u7121"}),Object(E.jsx)(v.C,{className:"uiFont",value:1,children:"\u4e2d"}),Object(E.jsx)(v.C,{className:"uiFont",value:2,children:"\u5927"})]})]}),Object(E.jsxs)(v.k,{children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.j,slot:"start"}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:ee.appSettings.showComments}),Object(E.jsx)(v.I,{slot:"end",checked:this.props.settings.showComments,onIonChange:function(t){var n=t.detail.checked;e.props.settings.showComments!==n&&e.props.dispatch({type:"SET_KEY_VAL",key:"showComments",val:n})}})]}),Object(E.jsxs)(v.k,{children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.B,slot:"start"}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:ee.appSettings.useFontKai}),Object(E.jsx)(v.I,{slot:"end",checked:this.props.settings.useFontKai,onIonChange:function(t){var n=t.detail.checked;e.props.settings.useFontKai!==n&&(e.props.dispatch({type:"SET_KEY_VAL",key:"useFontKai",val:n}),ee.updateCssVars(e.props.settings))}})]}),Object(E.jsxs)(v.k,{children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.B,slot:"start"}),Object(E.jsx)("div",{className:"contentBlock",children:Object(E.jsxs)("div",{style:{flexDirection:"column"},children:[Object(E.jsxs)(v.o,{className:"ion-text-wrap uiFont",children:[ee.appSettings.uiFontSize,": ",this.props.settings.uiFontSize]}),Object(E.jsx)(v.v,{min:10,max:128,pin:!0,snaps:!0,value:this.props.settings.uiFontSize,onIonChange:function(t){e.props.dispatch({type:"SET_KEY_VAL",key:"uiFontSize",val:+t.detail.value}),ee.updateCssVars(e.props.settings)}})]})})]}),Object(E.jsxs)(v.k,{children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.B,slot:"start"}),Object(E.jsxs)("div",{className:"contentBlock",children:[Object(E.jsxs)(v.o,{className:"ion-text-wrap uiFont",children:[ee.appSettings.fontSize,": ",Object(E.jsx)("span",{className:"textFont",children:this.props.settings.fontSize})]}),Object(E.jsx)(v.v,{min:10,max:128,pin:!0,snaps:!0,value:this.props.settings.fontSize,onIonChange:function(t){e.props.dispatch({type:"SET_KEY_VAL",key:"fontSize",val:t.detail.value}),ee.updateCssVars(e.props.settings)}})]})]}),Object(E.jsxs)(v.k,{children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.u,slot:"start"}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:ee.appSettings.printStyle}),Object(E.jsxs)(v.B,{slot:"end",value:this.props.settings.printStyle,className:"uiFont",interface:"popover",interfaceOptions:{cssClass:"cbetar2themes"},onIonChange:function(t){var n=+t.detail.value;e.props.settings.printStyle!==n&&e.props.dispatch({type:"SET_KEY_VAL",key:"printStyle",val:n})},children:[Object(E.jsx)(v.C,{className:"uiFont blackWhite printVar",value:0,children:"\u767d\u5e95\u9ed1\u5b57"}),Object(E.jsx)(v.C,{className:"uiFont manuscript printVar",value:1,children:"\u6284\u7d93\u672c"})]})]}),Object(E.jsxs)(v.k,{children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.u,slot:"start"}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u5408\u6210\u8a9e\u97f3"}),Object(E.jsx)(v.B,{slot:"end",value:this.props.settings.voiceURI,className:"uiFont",interface:"action-sheet",cancelText:"\u53d6\u6d88",onIonChange:function(t){var n=t.detail.value;e.props.settings.voiceURI!==n&&e.props.dispatch({type:"SET_KEY_VAL",key:"voiceURI",val:n})},children:ee.zhVoices().map((function(e,t){return Object(E.jsx)(v.C,{className:"uiFont blackWhite printVar",value:e.voiceURI,children:e.name},t)}))})]}),Object(E.jsxs)(v.k,{children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.t,slot:"start"}),Object(E.jsx)("div",{className:"contentBlock",children:Object(E.jsxs)("div",{style:{flexDirection:"column"},children:[Object(E.jsxs)(v.o,{className:"ion-text-wrap uiFont",children:[Object(E.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2#text2speech",target:"_new",children:"\u5408\u6210\u8a9e\u97f3\u8a9e\u901f"}),": ",this.props.settings.speechRate]}),Object(E.jsx)(v.v,{min:.1,max:1.5,step:.1,snaps:!0,value:this.props.settings.speechRate,onIonChange:function(t){e.props.dispatch({type:"SET_KEY_VAL",key:"speechRate",val:t.detail.value.toFixed(1)})}})]})})]}),Object(E.jsxs)(v.k,{children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.n,slot:"start"}),Object(E.jsxs)("div",{className:"uiFont",children:[Object(E.jsx)("div",{children:"\u95dc\u65bc"}),Object(E.jsx)("div",{children:Object(E.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2",target:"_new",children:"\u64cd\u4f5c\u8aaa\u660e"})}),Object(E.jsxs)("div",{children:["\u7248\u672c\uff1a",Fe.pwaVersion]}),Object(E.jsxs)("div",{children:["CBETA API \u7248\u672c: ",ee.apiVersion]}),Object(E.jsx)("div",{children:Object(E.jsx)("a",{href:"http://cbdata.dila.edu.tw/v1.2/",target:"_new",children:"CBETA API \u53c3\u8003\u6587\u4ef6"})}),Object(E.jsx)("div",{children:Object(E.jsx)("a",{href:"http://glossaries.dila.edu.tw/?locale=zh-TW",target:"_new",children:"DILA \u4f5b\u5b78\u8853\u8a9e\u5b57\u8fad\u5178"})}),Object(E.jsx)("div",{children:"\u4f5c\u8005: Meng-Yuan Huang"}),Object(E.jsx)("div",{children:Object(E.jsx)("a",{href:"mailto:myh@live.com",target:"_new",children:"myh@live.com"})}),Object(E.jsx)("div",{children:Object(E.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2#contributors",target:"_new",children:"App \u76f8\u95dc\u8ca2\u737b\u8005"})}),Object(E.jsx)("div",{children:Object(E.jsx)("a",{href:"/",onClick:function(t){t.preventDefault(),e.setState({showFontLicense:!0})},children:"\u5168\u5b57\u5eab\u5b57\u578b\u7248\u6b0a\u8072\u660e"})})]})]}),Object(E.jsx)(v.a,{cssClass:"uiFont",isOpen:this.state.showFontLicense,backdropDismiss:!1,message:"\u6b64 app \u4f7f\u7528\u7684\u5168\u5b57\u5eab\u5b57\u578b(2020-08-18\u7248)\u7531\u570b\u5bb6\u767c\u5c55\u59d4\u54e1\u6703\u63d0\u4f9b\u3002\u6b64\u958b\u653e\u8cc7\u6599\u4f9d\u653f\u5e9c\u8cc7\u6599\u958b\u653e\u6388\u6b0a\u689d\u6b3e (Open Government Data License) \u9032\u884c\u516c\u773e\u91cb\u51fa\uff0c\u4f7f\u7528\u8005\u65bc\u9075\u5b88\u672c\u689d\u6b3e\u5404\u9805\u898f\u5b9a\u4e4b\u524d\u63d0\u4e0b\uff0c\u5f97\u5229\u7528\u4e4b\u3002\u653f\u5e9c\u8cc7\u6599\u958b\u653e\u6388\u6b0a\u689d\u6b3e\uff1ahttps://data.gov.tw/license",buttons:[{text:"\u95dc\u9589",cssClass:"primary uiFont",handler:function(t){e.setState({showFontLicense:!1})}},{text:"\u958b\u555f\u6388\u6b0a",cssClass:"secondary uiFont",handler:function(t){e.setState({showFontLicense:!1}),window.open("https://data.gov.tw/license")}}]})]}),Object(E.jsx)(v.H,{cssClass:"uiFont",isOpen:this.state.showToast,onDidDismiss:function(){return e.setState({showToast:!1})},message:this.state.toastMessage,duration:2e3})]})]})}}]),n}(r.a.Component),Le=Object(v.U)(Ne),De=Object(g.b)((function(e){return{settings:e.settings,tmpSettings:e.tmpSettings}}))(Le),Be=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e){var s;return Object(d.a)(this,n),(s=t.call(this,e)).bookmarkListRef=void 0,s.state={reorder:!1,showToast:!1,toastMessage:""},s.bookmarkListRef=r.a.createRef(),s}return Object(b.a)(n,[{key:"ionViewWillEnter",value:function(){var e=y.a.parse(this.props.location.search);if(e.item&&e.item<this.props.bookmarks.length){var t,n,s=this.props.bookmarks[e.item];this.props.history.push("/catalog/juan/".concat(null===(t=s.work)||void 0===t?void 0:t.work,"/").concat(null===(n=s.work)||void 0===n?void 0:n.juan))}else this.hasBookmark||(this.setState({showToast:!0,toastMessage:"\u7121\u66f8\u7c64\uff01\u8acb\u5f9e\u76ee\u9304\u9801\u65b0\u589e\u66f8\u7c64\u3002"}),this.props.history.push("/catalog/famous"))}},{key:"componentDidMount",value:function(){console.log("did mount: ".concat(this.props.match.url))}},{key:"hasBookmark",get:function(){return this.props.bookmarks.length>0}},{key:"isFamousPage",get:function(){return"/catalog/famous"===this.props.match.url}},{key:"delBookmarkHandler",value:function(e){this.props.dispatch({type:"DEL_BOOKMARK",uuid:e}),this.hasBookmark||this.props.history.push("/catalog/famous")}},{key:"reorderBookmarks",value:function(e){var t=e.detail.complete(this.props.bookmarks);this.props.dispatch({type:"UPDATE_BOOKMARKS",bookmarks:t})}},{key:"getBookmarkRows",value:function(){var e=this,t=this.props.bookmarks,n=Array();return t.forEach((function(t,s){var o,r,a,i,c,l,p="",d="".concat(t.selectedText),b=!1;switch(t.type){case Q.CATALOG:p="/catalog/catalog/".concat(t.uuid);break;case Q.WORK:p="/catalog/work/".concat(t.uuid);break;case Q.JUAN:p="/catalog/juan/".concat(null===(o=t.work)||void 0===o?void 0:o.work,"/").concat(null===(r=t.work)||void 0===r?void 0:r.juan),d="".concat(null===(a=t.work)||void 0===a?void 0:a.title,"\u7b2c").concat(null===(i=t.work)||void 0===i?void 0:i.juan,"\u5377 - ").concat(d);break;case Q.HTML:b=!0,p="/catalog/juan/".concat(null===(c=t.work)||void 0===c?void 0:c.work,"/1"),d="".concat(null===(l=t.work)||void 0===l?void 0:l.title," - ").concat(d)}n.push(Object(E.jsxs)(v.n,{children:[Object(E.jsxs)(v.k,{button:!0,onClick:function(){var n=Object(u.a)(h.a.mark((function n(s){var o;return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!e.state.reorder){n.next=3;break}return e.setState({showToast:!0,toastMessage:"\u8acb\u5148\u95dc\u9589\u6392\u5217\u529f\u80fd\uff0c\u624d\u53ef\u9ede\u64ca\u66f8\u7c64\uff01"}),n.abrupt("return");case 3:s.preventDefault(),e.props.history.push({pathname:p,state:{uuid:t.uuid},search:y.a.stringify(b?{file:t.fileName,title:null===(o=t.work)||void 0===o?void 0:o.title}:{})});case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:d},"bookmarkItemLabel_"+s),t.type===Q.CATALOG?"":Object(E.jsx)(v.h,{icon:I.k,slot:"end"}),Object(E.jsx)(v.w,{slot:"end"})]},"bookmarkItem_"+s),Object(E.jsx)(v.m,{side:"end",children:Object(E.jsx)(v.l,{className:"uiFont",color:"danger",onClick:function(n){var s;e.delBookmarkHandler(t.uuid),null===(s=e.bookmarkListRef.current)||void 0===s||s.closeSlidingItems()},children:"\u522a\u9664"})})]},"bookmarkItemSliding_"+s))})),n}},{key:"render",value:function(){var e=this,t=this.getBookmarkRows();return Object(E.jsxs)(v.s,{children:[Object(E.jsx)(v.g,{children:Object(E.jsxs)(v.J,{children:[Object(E.jsx)(v.G,{className:"uiFont",children:"\u66f8\u7c64"}),Object(E.jsx)(v.c,{fill:this.state.reorder?"solid":"clear",slot:"end",onClick:function(t){return e.setState({reorder:!e.state.reorder})},children:Object(E.jsx)(v.h,{icon:I.A,slot:"icon-only"})})]})}),Object(E.jsxs)(v.d,{children:[this.hasBookmark?Object(E.jsx)(E.Fragment,{children:Object(E.jsx)(v.p,{ref:this.bookmarkListRef,children:Object(E.jsx)(v.x,{disabled:!this.state.reorder,onIonItemReorder:function(t){e.reorderBookmarks(t)},children:t})},"bookmarkList0")}):Object(E.jsx)(E.Fragment,{children:Object(E.jsx)(v.p,{children:t},"bookmarkList1")}),Object(E.jsx)(v.H,{cssClass:"uiFont",isOpen:this.state.showToast,onDidDismiss:function(){return e.setState({showToast:!1})},message:this.state.toastMessage,duration:2e3})]})]},"bookmarksPage".concat(this.isFamousPage))}}]),n}(r.a.Component),Pe=Object(v.U)(Be),Re=Object(g.b)((function(e){return{bookmarks:e.settings.bookmarks}}))(Pe),_e=function e(t){var n;Object(d.a)(this,e),this.type=void 0,this.n=void 0,this.label=void 0,this.work=void 0,this.title=void 0,this.creators=void 0,this.type=t.type,this.n=t.n,this.label=t.label,this.work=t.work,this.title=t.title,this.creators=null!==(n=t.creators)&&void 0!==n?n:"\u7121"},Me=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e){var s;return Object(d.a)(this,n),(s=t.call(this,e)).state={fetchError:!1,showSearchAlert:!1,searches:[],isLoading:!1},s}return Object(b.a)(n,[{key:"ionViewWillEnter",value:function(){this.search(this.props.match.params.keyword)}},{key:"componentDidMount",value:function(){}},{key:"search",value:function(){var e=Object(u.a)(h.a.mark((function e(t){var n,s,o;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({isLoading:!0}),e.prev=1,e.next=4,ee.axiosInstance.get("/toc?q=".concat(t),{responseType:"arraybuffer"});case 4:return n=e.sent,s=JSON.parse((new TextDecoder).decode(n.data)).results,o=s.map((function(e){return new _e(e)})),this.setState({fetchError:!1,isLoading:!1,searches:o}),e.abrupt("return",!0);case 11:return e.prev=11,e.t0=e.catch(1),console.error(e.t0),console.error((new Error).stack),this.setState({fetchError:!0,isLoading:!1}),e.abrupt("return",!1);case 17:case"end":return e.stop()}}),e,this,[[1,11]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getRows",value:function(){var e=this,t=Array(),n=this.state.searches;return 0!==n.length||this.state.isLoading?(n.forEach((function(n,s){var o="catalog"===n.type,r=o?n.label:"".concat(n.title,"\n\u4f5c\u8005:").concat(n.creators),a="/".concat(e.props.match.params.tab)+(o?"/catalog/".concat(n.n):"/work/".concat(n.work));t.push(Object(E.jsxs)(v.k,{button:!0,onClick:function(){var t=Object(u.a)(h.a.mark((function t(n){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.preventDefault(),e.props.history.push({pathname:a});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:r},"searchLabel_"+s)]},"searchItem_"+s))})),t):ee.searchNoResultMessage}},{key:"render",value:function(){var e=this,t=this.getRows();return Object(E.jsxs)(v.s,{children:[Object(E.jsx)(v.g,{children:Object(E.jsxs)(v.J,{children:[Object(E.jsx)(v.G,{className:"uiFont",children:"\u641c\u5c0b"}),Object(E.jsx)(v.c,{fill:"clear",slot:"start",onClick:function(t){return e.props.history.goBack()},children:Object(E.jsx)(v.h,{icon:I.a,slot:"icon-only"})}),Object(E.jsx)(v.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(t){return e.search(e.props.match.params.keyword)},children:Object(E.jsx)(v.h,{icon:I.v,slot:"icon-only"})}),Object(E.jsx)(v.c,{fill:"clear",slot:"end",onClick:function(t){return e.props.history.push("/".concat(e.props.match.params.tab))},children:Object(E.jsx)(v.h,{icon:I.o,slot:"icon-only"})}),Object(E.jsx)(v.c,{fill:"clear",slot:"end",onClick:function(t){return e.setState({showSearchAlert:!0})},children:Object(E.jsx)(v.h,{icon:I.w,slot:"icon-only"})}),Object(E.jsx)(v.c,{fill:"clear",slot:"end",onClick:function(t){e.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})},children:Object(E.jsx)(v.h,{icon:I.y,slot:"icon-only"})})]})}),Object(E.jsxs)(v.d,{children:[this.state.fetchError?ee.fetchErrorContent:Object(E.jsxs)(E.Fragment,{children:[Object(E.jsxs)("div",{className:"uiFontX2",style:{color:"var(--ion-color-primary)"},children:[" ",this.props.match.params.keyword]}),Object(E.jsx)(v.p,{children:t})]}),Object(E.jsx)(v.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return e.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."}),Object(E.jsx)(ce,Object(p.a)({},Object(p.a)({showSearchAlert:this.state.showSearchAlert,finish:function(){e.setState({showSearchAlert:!1})}},this.props)))]})]})}}]),n}(r.a.Component),Ve=Object(v.U)(Me),Ue=Object(g.b)((function(e){return{}}))(Ve),Ke=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e){var s;return Object(d.a)(this,n),(s=t.call(this,e)).searchBarRef=void 0,s.selectedTextBeforeIonPopover="",s.state={keyword:"",searches:[],showNoSelectedTextAlert:!1,popover:{show:!1,event:null},isLoading:!1,fetchError:!1,showToast:!1,toastMessage:""},s.searchBarRef=r.a.createRef(),s}return Object(b.a)(n,[{key:"ionViewWillEnter",value:function(){this.setState({keyword:this.props.match.params.keyword}),this.props.match.params.keyword?this.lookupDict(this.props.match.params.keyword):this.setState({searches:[]})}},{key:"isTopPage",get:function(){return void 0===this.props.match.params.keyword}},{key:"lookupDict",value:function(){var e=Object(u.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({isLoading:!0}),e.prev=1,e.next=4,ee.axiosInstance.get("".concat(ee.dilaDictApiUrl,"/?type=match&dicts=dila&term=").concat(t),{responseType:"json"});case 4:n=e.sent,this.props.dictionaryHistory.unshift(t),this.props.dictionaryHistory.splice(10),this.props.dispatch({type:"SET_KEY_VAL",key:"dictionaryHistory",val:this.props.dictionaryHistory}),this.setState({fetchError:!1,isLoading:!1,searches:n.data}),e.next=17;break;case 11:return e.prev=11,e.t0=e.catch(1),console.error(e.t0),console.error((new Error).stack),this.setState({fetchError:!0,isLoading:!1}),e.abrupt("return",!1);case 17:case"end":return e.stop()}}),e,this,[[1,11]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getSelectedString",value:function(){var e=document.getSelection();return((null===e||void 0===e?void 0:e.rangeCount)||0)>0&&e.getRangeAt(0).toString().length>0?e.getRangeAt(0).toString():""}},{key:"getRows",value:function(){var e=this.state.searches,t=Array();return e.forEach((function(e,n){t.push(Object(E.jsx)("div",{style:{display:"table-row"},children:Object(E.jsxs)("div",{className:"tableCell",children:[Object(E.jsx)("div",{className:"textFont",style:{color:"var(--ion-color-primary)",paddingBottom:"18pt"},dangerouslySetInnerHTML:{__html:e.dict_name_zh}}),Object(E.jsx)("div",{className:"textFont",style:{padding:"0 5px",textAlign:"justify",overflowWrap:"normal"},dangerouslySetInnerHTML:{__html:e.desc}},"dictItemLabel"+n)]})},"dictItem"+n))})),t}},{key:"render",value:function(){var e=this;return Object(E.jsxs)(v.s,{children:[Object(E.jsx)(v.g,{children:Object(E.jsxs)(v.J,{children:[Object(E.jsx)(v.c,{hidden:this.isTopPage,fill:"clear",slot:"start",onClick:function(t){return e.props.history.goBack()},children:Object(E.jsx)(v.h,{icon:I.a,slot:"icon-only"})}),Object(E.jsx)(v.c,{fill:"outline",shape:"round",slot:"start",onClick:function(t){e.props.history.push("/dictionary/searchWord")},children:Object(E.jsx)("span",{className:"uiFont",style:{color:"var(--color)"},children:"\u4f5b\u5b78\u8a5e\u5178"})}),Object(E.jsx)(v.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(t){return e.lookupDict(e.props.match.params.keyword)},children:Object(E.jsx)(v.h,{icon:I.v,slot:"icon-only"})}),Object(E.jsx)(v.c,{fill:"clear",slot:"end",onClick:function(t){e.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})},children:Object(E.jsx)(v.h,{icon:I.y,slot:"icon-only"})}),Object(E.jsx)(v.c,{fill:"clear",slot:"end",onPointerDown:function(t){e.selectedTextBeforeIonPopover=e.getSelectedString()},onClick:function(t){e.setState({popover:{show:!0,event:t.nativeEvent}})},children:Object(E.jsx)(v.h,{ios:I.l,md:I.m,slot:"icon-only"})}),Object(E.jsx)(v.t,{isOpen:this.state.popover.show,event:this.state.popover.event,onDidDismiss:function(t){e.selectedTextBeforeIonPopover="",e.setState({popover:{show:!1,event:null}})},children:Object(E.jsxs)(v.p,{children:[Object(E.jsxs)(v.k,{button:!0,onClick:function(t){e.props.history.push("/".concat(e.props.match.params.tab,"/search")),e.setState({popover:{show:!1,event:null}})},children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.o,slot:"start"}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u56de\u9996\u9801"})]}),Object(E.jsxs)(v.k,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}}),ee.copyToClipboard(e.selectedTextBeforeIonPopover),e.setState({showToast:!0,toastMessage:"\u8907\u88fd\u6587\u5b57\u6210\u529f"})},children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.i,slot:"start"}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u8907\u88fd\u6587\u5b57"})]}),Object(E.jsxs)(v.k,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}}),""!==e.selectedTextBeforeIonPopover?e.props.history.push({pathname:"/dictionary/search/".concat(e.selectedTextBeforeIonPopover)}):e.setState({showNoSelectedTextAlert:!0})},children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.e,slot:"start"}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u67e5\u8a5e\u5178"})]}),Object(E.jsxs)(v.k,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}}),""!==e.selectedTextBeforeIonPopover?e.props.history.push({pathname:"/dictionary/searchWord/".concat(e.selectedTextBeforeIonPopover)}):e.setState({showNoSelectedTextAlert:!0})},children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.e,slot:"start"}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u67e5\u5b57\u5178"})]})]})})]})}),Object(E.jsxs)(v.d,{children:[Object(E.jsx)(v.A,{ref:this.searchBarRef,placeholder:"\u8f38\u5165\u5f8c\u6309 Enter",value:this.state.keyword,onIonClear:function(t){e.setState({searches:[],keyword:""})},onKeyUp:function(t){var n=t.target.value;""===n?e.setState({searches:[],keyword:n}):"Enter"===t.key&&(n===e.props.match.params.keyword?(e.setState({keyword:n}),e.lookupDict(n)):e.props.history.push("/dictionary/search/".concat(n)))}}),this.state.fetchError?ee.fetchErrorContent:""===this.state.keyword||void 0===this.state.keyword?Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)("div",{className:"uiFont",style:{color:"var(--ion-color-primary)"},children:"\u641c\u5c0b\u6b77\u53f2"}),Object(E.jsx)(v.p,{children:this.props.dictionaryHistory.map((function(t,n){return Object(E.jsx)(v.k,{button:!0,onClick:function(){var n=Object(u.a)(h.a.mark((function n(s){return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t===e.props.match.params.keyword?(e.setState({keyword:t}),e.lookupDict(t)):e.props.history.push("/dictionary/search/".concat(t));case 1:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),children:Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:t},"dictHistoryLabel_"+n)},"dictHistoryItem_".concat(n))}))}),Object(E.jsx)("div",{style:{textAlign:"center"},children:Object(E.jsx)(v.c,{fill:"outline",shape:"round",size:"large",onClick:function(t){e.setState({keyword:""}),e.props.dispatch({type:"SET_KEY_VAL",key:"dictionaryHistory",val:[]})},children:"\u6e05\u9664\u6b77\u53f2"})})]}):0!==this.state.searches.length||this.state.isLoading?Object(E.jsx)("div",{style:{display:"table",tableLayout:"fixed",width:"100%"},children:this.getRows()}):ee.searchNoResultMessage,Object(E.jsx)("div",{style:{fontSize:"var(--ui-font-size)",textAlign:"center"},children:Object(E.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2#dictionary",target:"_new",children:"\u4f5b\u5b78\u8a5e\u5178\u8aaa\u660e"})}),Object(E.jsx)(v.a,{cssClass:"uiFont",isOpen:this.state.showNoSelectedTextAlert,backdropDismiss:!1,header:"\u5931\u6557",message:"\u8acb\u78ba\u8a8d\u662f\u5426\u5df2\u9078\u64c7\u4e00\u6bb5\u6587\u5b57\uff0c\u7136\u5f8c\u518d\u57f7\u884c\u6240\u9078\u7684\u529f\u80fd!",buttons:[{text:"\u78ba\u5b9a",cssClass:"primary uiFont",handler:function(t){e.setState({showNoSelectedTextAlert:!1})}}]}),Object(E.jsx)(v.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return e.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."}),Object(E.jsx)(v.H,{cssClass:"uiFont",isOpen:this.state.showToast,onDidDismiss:function(){return e.setState({showToast:!1})},message:this.state.toastMessage,duration:2e3})]})]})}}]),n}(r.a.Component),He=Object(v.U)(Ke),ze=Object(g.b)((function(e){return{dictionaryHistory:e.settings.dictionaryHistory}}))(He),Je=function e(t){Object(d.a)(this,e),this.id=void 0,this.term_hits=void 0,this.work=void 0,this.juan=void 0,this.title=void 0,this.creators=void 0,this.id=t.id,this.term_hits=t.term_hits,this.work=t.work,this.juan=t.juan,this.title=t.title,this.creators=t.creators},We=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e){var s;return Object(d.a)(this,n),(s=t.call(this,e)).page=0,s.rows=20,s.state={showSearchAlert:!1,searches:[],isScrollOn:!1,isLoading:!1,fetchError:!1},s}return Object(b.a)(n,[{key:"ionViewWillEnter",value:function(){this.search(this.props.match.params.keyword,!0)}},{key:"componentDidMount",value:function(){}},{key:"search",value:function(){var e=Object(u.a)(h.a.mark((function e(t){var n,s,o,r,a=arguments;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]&&a[1],this.setState({isLoading:!0}),n&&(this.page=0,this.setState({searches:[]})),e.prev=3,console.log("Loading page ".concat(this.page)),e.next=7,ee.axiosInstance.get("/sphinx?q=".concat(t,"&start=").concat(this.page*this.rows,"&rows=").concat(this.rows),{responseType:"arraybuffer"});case 7:return s=e.sent,o=JSON.parse((new TextDecoder).decode(s.data)).results,r=o.map((function(e){return new Je(e)})),this.setState({fetchError:!1,isLoading:!1,searches:[].concat(Object(O.a)(this.state.searches),Object(O.a)(r)),isScrollOn:r.length===this.rows}),this.page+=1,e.abrupt("return",!0);case 15:return e.prev=15,e.t0=e.catch(3),console.error(e.t0),console.error((new Error).stack),this.setState({fetchError:!0,isLoading:!1,isScrollOn:!1}),e.abrupt("return",!1);case 21:case"end":return e.stop()}}),e,this,[[3,15]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getRows",value:function(){var e=this,t=Array(),n=this.state.searches;return 0!==n.length||this.state.isLoading?(n.forEach((function(n,s){var o="".concat(n.title,"\u5377").concat(n.juan,"\n\u4f5c\u8005:").concat(n.creators),r="/catalog/juan/".concat(n.work,"/").concat(n.juan);t.push(Object(E.jsxs)(v.k,{button:!0,onClick:function(){var t=Object(u.a)(h.a.mark((function t(n){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.preventDefault(),e.props.history.push({pathname:r});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:o},"searchLabel_"+s)]},"searchItem_"+s))})),t):ee.searchNoResultMessage}},{key:"render",value:function(){var e=this,t=this.getRows();return Object(E.jsxs)(v.s,{children:[Object(E.jsx)(v.g,{children:Object(E.jsxs)(v.J,{children:[Object(E.jsx)(v.G,{className:"uiFont",children:"\u5168\u6587\u6aa2\u7d22"}),Object(E.jsx)(v.c,{fill:"clear",slot:"start",onClick:function(t){return e.props.history.goBack()},children:Object(E.jsx)(v.h,{icon:I.a,slot:"icon-only"})}),Object(E.jsx)(v.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(t){return e.search(e.props.match.params.keyword)},children:Object(E.jsx)(v.h,{icon:I.v,slot:"icon-only"})}),Object(E.jsx)(v.c,{fill:"clear",slot:"end",onClick:function(t){return e.props.history.push("/".concat(e.props.match.params.tab))},children:Object(E.jsx)(v.h,{icon:I.o,slot:"icon-only"})}),Object(E.jsx)(v.c,{fill:"clear",slot:"end",onClick:function(t){return e.setState({showSearchAlert:!0})},children:Object(E.jsx)(v.h,{icon:I.w,slot:"icon-only"})}),Object(E.jsx)(v.c,{fill:"clear",slot:"end",onClick:function(t){e.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})},children:Object(E.jsx)(v.h,{icon:I.y,slot:"icon-only"})})]})}),Object(E.jsxs)(v.d,{children:[this.state.fetchError?ee.fetchErrorContent:Object(E.jsxs)(E.Fragment,{children:[Object(E.jsxs)("div",{className:"uiFontX2",style:{color:"var(--ion-color-primary)"},children:[" ",this.props.match.params.keyword]}),Object(E.jsxs)(v.p,{children:[t,Object(E.jsx)(v.i,{threshold:"100px",disabled:!this.state.isScrollOn,onIonInfinite:function(t){e.search(e.props.match.params.keyword),t.target.complete()},children:Object(E.jsx)(v.j,{loadingText:"\u8f09\u5165\u4e2d..."})})]})]}),Object(E.jsx)(v.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return e.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."}),Object(E.jsx)(ce,Object(p.a)({},Object(p.a)({showSearchAlert:this.state.showSearchAlert,finish:function(){e.setState({showSearchAlert:!1})}},this.props)))]})]})}}]),n}(r.a.Component),Ye=Object(v.U)(We),Ge=Object(g.b)((function(e){return{}}))(Ye),qe=n(242),Xe=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e){var s;return Object(d.a)(this,n),(s=t.call(this,e)).state={isAppSettingsExport:Array(Object.keys(ee.appSettings).length)},s}return Object(b.a)(n,[{key:"updateQrCode",value:function(){var e=this,t=Object.keys(ee.appSettings).filter((function(t,n){return e.state.isAppSettingsExport[n]})).map((function(t,n){return{key:t,val:e.props.settings[t]}})).map((function(e){return"".concat(e.key,"=").concat(+e.val)})).join(",");t=""!==t?"settings=".concat(t):null;var n=this.props.text,s=/\?/.test(n);t&&(n+=s?"&".concat(t):"?".concat(t)),ee.copyToClipboard(n);var o=document.getElementById("qrcCanvas");return qe.toCanvas(o,n),o}},{key:"render",value:function(){var e=this;return Object(E.jsx)(v.r,{isOpen:this.props.showModal,swipeToClose:!0,onWillPresent:function(){for(var t=[],n=0;n<e.state.isAppSettingsExport.length;n++)t.push(!1);e.setState({isAppSettingsExport:t}),e.updateQrCode()},onDidDismiss:function(){return e.props.finish()},children:Object(E.jsx)(v.d,{children:Object(E.jsxs)("div",{style:{display:"flex",flexDirection:"column",height:"100%",alignItems:"center"},children:[Object(E.jsx)("div",{children:Object(E.jsx)(v.o,{className:"uiFont",children:"\u6b64\u9801app\u9023\u7d50\u5df2\u8907\u88fd\u81f3\u526a\u8cbc\u7c3f\uff01"})}),Object(E.jsx)("div",{children:Object(E.jsx)(v.o,{className:"uiFont",children:"\u4e5f\u53ef\u4ee5\u4f7f\u7528QR Code\u5206\u4eab:"})}),Object(E.jsx)("div",{style:{flexGrow:1,flexShrink:0,display:"flex",alignItems:"center",margin:10},children:Object(E.jsx)("canvas",{id:"qrcCanvas",width:"500",height:"500",style:{margin:"0px auto"}})}),Object(E.jsxs)("div",{children:[Object(E.jsx)(v.o,{className:"uiFont",children:"\u5305\u62ecapp\u8a2d\u5b9a:"}),Object(E.jsx)(v.p,{children:Object.keys(ee.appSettings).map((function(t,n){return Object(E.jsxs)(v.k,{children:[Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:ee.appSettings[t]}),Object(E.jsx)(v.I,{slot:"end",onIonChange:function(t){var s=e.state.isAppSettingsExport;s[n]=t.detail.checked,e.setState({isAppSettingsExport:s}),e.updateQrCode()}})]},"appSettingExportItem_".concat(n))}))})]}),Object(E.jsx)("div",{children:Object(E.jsx)(v.c,{fill:"outline",shape:"round",size:"large",onClick:function(){return e.props.finish()},children:"\u95dc\u9589"})})]})})})}}]),n}(r.a.Component),$e=Object(g.b)((function(e){return{settings:e.settings}}))(Xe);!function(e){e.NOUN="\u540d",e.VERB="\u52d5"}(Ce||(Ce={}));var Qe=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e){var s;return Object(d.a)(this,n),(s=t.call(this,e)).searchBarRef=void 0,s.selectedTextBeforeIonPopover="",s.state={keyword:"",search:null,showNoSelectedTextAlert:!1,popover:{show:!1,event:null},isLoading:!1,fetchError:!1,showToast:!1,toastMessage:""},s.searchBarRef=r.a.createRef(),s}return Object(b.a)(n,[{key:"ionViewWillEnter",value:function(){this.props.match.params.keyword&&(this.setState({keyword:this.props.match.params.keyword}),this.lookupDict(this.props.match.params.keyword))}},{key:"componentDidMount",value:function(){}},{key:"ionViewWillLeave",value:function(){}},{key:"isTopPage",get:function(){return this.props.match.url==="/".concat(this.props.match.params.tab)}},{key:"lookupDict",value:function(){var e=Object(u.a)(h.a.mark((function e(t){var n,s,o;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({isLoading:!0}),e.prev=1,e.next=4,ee.axiosInstance.get("https://www.moedict.tw/uni/".concat(t.substring(0,1)),{responseType:"json"});case 4:n=e.sent,this.props.wordDictionaryHistory.unshift(t),this.props.wordDictionaryHistory.splice(10),this.props.dispatch({type:"SET_KEY_VAL",key:"wordDictionaryHistory",val:this.props.wordDictionaryHistory}),this.setState({fetchError:!1,isLoading:!1,search:n.data.heteronyms}),e.next=16;break;case 11:return e.prev=11,e.t0=e.catch(1),o=e.t0,404===(null===(s=o.response)||void 0===s?void 0:s.status)?this.setState({fetchError:!1,isLoading:!1,search:[]}):(console.error(e.t0),console.error((new Error).stack),this.setState({fetchError:!0,isLoading:!1})),e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,this,[[1,11]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getSelectedString",value:function(){var e=document.getSelection();return((null===e||void 0===e?void 0:e.rangeCount)||0)>0&&e.getRangeAt(0).toString().length>0?e.getRangeAt(0).toString():""}},{key:"defToView",value:function(e,t){return void 0!==e&&e.length>0?Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)("div",{style:{color:"var(--ion-color-primary)"},children:t},me.a()),Object(E.jsx)("ol",{children:null===e||void 0===e?void 0:e.map((function(e){var t,n,s;return Object(E.jsxs)("li",{children:[Object(E.jsx)("div",{children:e.def},me.a()),null===(t=e.quote)||void 0===t?void 0:t.map((function(e){return Object(E.jsx)("div",{children:e},me.a())})),null===(n=e.example)||void 0===n?void 0:n.map((function(e){return Object(E.jsx)("div",{children:e},me.a())})),null===(s=e.link)||void 0===s?void 0:s.map((function(e){return Object(E.jsx)("div",{children:e},me.a())}))]},me.a())}))},me.a())]}):Object(E.jsx)(E.Fragment,{})}},{key:"render",value:function(){var e,t,n=this,s=[];this.props.match.params.keyword&&(null===(t=this.state.search)||void 0===t||t.forEach((function(e){var t=null===e||void 0===e?void 0:e.definitions.filter((function(e){return e.type===Ce.NOUN})),o=null===e||void 0===e?void 0:e.definitions.filter((function(e){return e.type===Ce.VERB})),r=null===e||void 0===e?void 0:e.definitions.filter((function(e){return void 0===e.type})),a=n.defToView(t,"\u540d\u8a5e"),i=n.defToView(o,"\u52d5\u8a5e"),c=n.defToView(r,"");s.push(Object(E.jsxs)("div",{className:"textFont textSelectable",style:{padding:"0 5px"},children:[Object(E.jsx)("div",{className:"textFontX3",children:n.props.match.params.keyword.substring(0,1)},me.a()),(null===e||void 0===e?void 0:e.bopomofo)?Object(E.jsxs)("div",{children:["\u6ce8\u97f3\uff1a",null===e||void 0===e?void 0:e.bopomofo]}):null,(null===e||void 0===e?void 0:e.pinyin)?Object(E.jsxs)("div",{children:["\u62fc\u97f3\uff1a",null===e||void 0===e?void 0:e.pinyin]}):null,a,i,c]},me.a()))})));return Object(E.jsxs)(v.s,{children:[Object(E.jsx)(v.g,{children:Object(E.jsxs)(v.J,{children:[Object(E.jsx)(v.c,{fill:"clear",slot:"start",onClick:function(e){return n.props.history.goBack()},children:Object(E.jsx)(v.h,{icon:I.a,slot:"icon-only"})}),Object(E.jsx)(v.c,{fill:"outline",shape:"round",slot:"start",onClick:function(e){n.props.history.push("/dictionary/search")},children:Object(E.jsx)("span",{className:"uiFont",children:"\u840c\u5178\u5b57\u5178"})}),Object(E.jsx)(v.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(e){return n.lookupDict(n.props.match.params.keyword)},children:Object(E.jsx)(v.h,{icon:I.v,slot:"icon-only"})}),Object(E.jsx)(v.c,{fill:"clear",slot:"end",onClick:function(e){n.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})},children:Object(E.jsx)(v.h,{icon:I.y,slot:"icon-only"})}),Object(E.jsx)(v.c,{fill:"clear",slot:"end",onPointerDown:function(e){n.selectedTextBeforeIonPopover=n.getSelectedString()},onClick:function(e){n.setState({popover:{show:!0,event:e.nativeEvent}})},children:Object(E.jsx)(v.h,{ios:I.l,md:I.m,slot:"icon-only"})}),Object(E.jsx)(v.t,{isOpen:this.state.popover.show,event:this.state.popover.event,onDidDismiss:function(e){n.setState({popover:{show:!1,event:null}}),n.selectedTextBeforeIonPopover=""},children:Object(E.jsxs)(v.p,{children:[Object(E.jsxs)(v.k,{button:!0,onClick:function(e){n.props.history.push("/".concat(n.props.match.params.tab,"/searchWord")),n.setState({popover:{show:!1,event:null}})},children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.o,slot:"start"}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u56de\u9996\u9801"})]}),Object(E.jsxs)(v.k,{button:!0,onClick:function(e){n.setState({popover:{show:!1,event:null}}),ee.copyToClipboard(n.selectedTextBeforeIonPopover),n.setState({showToast:!0,toastMessage:"\u8907\u88fd\u6587\u5b57\u6210\u529f"})},children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.i,slot:"start"}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u8907\u88fd\u6587\u5b57"})]}),Object(E.jsxs)(v.k,{button:!0,onClick:function(e){n.setState({popover:{show:!1,event:null}}),""!==n.selectedTextBeforeIonPopover?n.props.history.push("/dictionary/search/".concat(n.selectedTextBeforeIonPopover)):n.setState({showNoSelectedTextAlert:!0})},children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.e,slot:"start"}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u67e5\u8a5e\u5178"})]}),Object(E.jsxs)(v.k,{button:!0,onClick:function(e){n.setState({popover:{show:!1,event:null}}),""!==n.selectedTextBeforeIonPopover?n.props.history.push({pathname:"/dictionary/searchWord/".concat(n.selectedTextBeforeIonPopover)}):n.setState({showNoSelectedTextAlert:!0})},children:[Object(E.jsx)("div",{tabIndex:0}),Object(E.jsx)(v.h,{icon:I.e,slot:"start"}),Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:"\u67e5\u5b57\u5178"})]})]})})]})}),Object(E.jsx)(v.d,{children:Object(E.jsxs)("div",{style:{display:"flex",flexFlow:"column",height:"100%"},children:[Object(E.jsx)(v.A,{ref:this.searchBarRef,placeholder:"\u8acb\u8f38\u5165\u5b57\uff0c\u518d\u6309\u9375\u76e4Enter\u9375",value:this.state.keyword,onIonClear:function(e){n.setState({search:null,keyword:""})},onKeyUp:function(e){var t=e.target.value;""===t?n.setState({search:null,keyword:t}):"Enter"===e.key&&(t===n.props.match.params.keyword?(n.setState({keyword:t}),n.lookupDict(t)):n.props.history.push("/dictionary/searchWord/".concat(t)))}}),this.state.fetchError?ee.fetchErrorContent:""===this.state.keyword||void 0===this.state.keyword?Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)("div",{className:"uiFont",style:{color:"var(--ion-color-primary)"},children:"\u641c\u5c0b\u6b77\u53f2"}),Object(E.jsx)(v.p,{children:this.props.wordDictionaryHistory.map((function(e,t){return Object(E.jsx)(v.k,{button:!0,onClick:function(){var t=Object(u.a)(h.a.mark((function t(s){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e===n.props.match.params.keyword?(n.setState({keyword:e}),n.lookupDict(e)):n.props.history.push("/dictionary/searchWord/".concat(e));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),children:Object(E.jsx)(v.o,{className:"ion-text-wrap uiFont",children:e},"wordDictHistoryLabel_"+t)},"wordDictHistoryItem_".concat(t))}))}),Object(E.jsx)("div",{style:{textAlign:"center"},children:Object(E.jsx)(v.c,{fill:"outline",shape:"round",size:"large",className:"uiFont",onClick:function(e){n.setState({keyword:""}),n.props.dispatch({type:"SET_KEY_VAL",key:"wordDictionaryHistory",val:[]})},children:"\u6e05\u9664\u6b77\u53f2"})})]}):0!==((null===(e=this.state.search)||void 0===e?void 0:e.length)||0)||this.state.isLoading?s:ee.searchNoResultMessage,Object(E.jsx)(v.a,{cssClass:"uiFont",isOpen:this.state.showNoSelectedTextAlert,backdropDismiss:!1,header:"\u5931\u6557",message:"\u8acb\u78ba\u8a8d\u662f\u5426\u5df2\u9078\u64c7\u4e00\u6bb5\u6587\u5b57\uff0c\u7136\u5f8c\u518d\u57f7\u884c\u6240\u9078\u7684\u529f\u80fd!",buttons:[{text:"\u78ba\u5b9a",cssClass:"primary uiFont",handler:function(e){n.setState({showNoSelectedTextAlert:!1})}}]}),Object(E.jsx)(v.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return n.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."}),Object(E.jsx)(v.H,{cssClass:"uiFont",isOpen:this.state.showToast,onDidDismiss:function(){return n.setState({showToast:!1})},message:this.state.toastMessage,duration:2e3})]})})]})}}]),n}(r.a.Component),Ze=Object(v.U)(Qe),et=Object(g.b)((function(e){return{wordDictionaryHistory:e.settings.wordDictionaryHistory}}))(Ze),tt=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e){var s;return Object(d.a)(this,n),(s=t.call(this,e)).state={isAppSettingsExport:Array(Object.keys(ee.appSettings).length)},s}return Object(b.a)(n,[{key:"render",value:function(){return Object(E.jsx)(v.r,{isOpen:this.props.showModal,backdropDismiss:!1,swipeToClose:!1,children:Object(E.jsx)(v.d,{children:Object(E.jsxs)("div",{style:{display:"flex",flexDirection:"column",height:"100%",alignItems:"center"},children:[Object(E.jsx)("div",{style:{marginBottom:"50px"},children:Object(E.jsx)(v.o,{className:"uiFont",children:"\u5f8c\u7aefapp\u4e0b\u8f09\u9032\u5ea6"})}),Object(E.jsx)(v.u,{style:{height:"40px"},value:this.props.progress}),Object(E.jsxs)(v.o,{className:"uiFont",children:[Math.floor(100*this.props.progress),"%"]})]})})})}}]),n}(r.a.Component),nt=Object(g.b)((function(e){return{}}))(tt),st=window.electronBackendApi,ot=function(){var e=localStorage.getItem(ee.storeFile);return null!=e?Object(w.b)(oe,JSON.parse(e)):Object(w.b)(oe)}();Object(v.T)({mode:"md",swipeBackEnabled:!1});var rt={onSuccess:function(e){},onUpdate:function(e){}},at=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(b.a)(n,[{key:"render",value:function(){return Object(E.jsx)(g.a,{store:ot,children:Object(E.jsx)(ct,Object(p.a)({},this.props))})}}]),n}(r.a.Component),it=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e){var s;for(Object(d.a)(this,n),(s=t.call(this,e)).registrationNew=void 0,s.originalAppSettingsStr=void 0,s.wakeLock=void 0,s.props.settings.hasAppLog||ee.disableAppLog(),null===st||void 0===st||st.receive("fromMain",(function(e){switch(e.event){case"version":ot.dispatch({type:"TMP_SET_KEY_VAL",key:"mainVersion",val:e.version});break;case"cbetaOfflineDbMode":ot.dispatch({type:"TMP_SET_KEY_VAL",key:"cbetaOfflineDbMode",val:e.isOn});break;case"DownloadingBackend":s.setState({downloadModal:{show:!0,progress:e.progress/100}});break;case"DownloadingBackendDone":s.setState({downloadModal:{show:!1,progress:s.state.downloadModal.progress}})}})),null===st||void 0===st||st.send("toMain",{event:"ready"}),s.registrationNew=null,Object(v.S)("android")?window.oncontextmenu=ee.disableAndroidChromeCallout:Object(v.S)("ios")&&(document.ontouchend=ee.disableIosSafariCallout.bind(window)),ee.isTouchDevice()&&(window.onorientationchange=function(e){setTimeout((function(){s.forceUpdate()}),500)});document.body.classList.length>0;)document.body.classList.remove(document.body.classList.item(0));document.body.classList.toggle("theme".concat(s.props.settings.theme),!0),document.body.classList.toggle("print".concat(s.props.settings.printStyle),!0);var o=y.a.parse(s.props.location.search);return o.settings&&(s.originalAppSettingsStr=localStorage.getItem(ee.storeFile),o.settings.split(",").forEach((function(e){var t=e.split("=");s.props.dispatch({type:"SET_KEY_VAL",key:t[0],val:+t[1]})}))),ee.updateCssVars(s.props.settings),s.state={showUpdateAlert:!1,showRestoreAppSettingsToast:null!=o.settings&&null!=s.originalAppSettingsStr||!1,showToast:!1,toastMessage:"",downloadModal:{progress:0,show:!1}},rt.onUpdate=function(e){s.registrationNew=e,s.setState({showUpdateAlert:!0})},rt.onSuccess=function(e){},"undefined"!==typeof speechSynthesis&&(speechSynthesis.getVoices(),speechSynthesis.cancel()),navigator.wakeLock&&(s.wakeLockScreen(),document.addEventListener("visibilitychange",Object(u.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"visible"===document.visibilityState?s.wakeLockScreen():s.wakeLockScreenRelease();case 1:case"end":return e.stop()}}),e)}))))),indexedDB.open(ee.cbetardb).onupgradeneeded=function(e){e.target.result.createObjectStore("store")},s.loadTwKaiFont(),s}return Object(b.a)(n,[{key:"restoreAppSettings",value:function(){for(localStorage.setItem(ee.storeFile,this.originalAppSettingsStr),this.props.dispatch({type:"LOAD_SETTINGS"});document.body.classList.length>0;)document.body.classList.remove(document.body.classList.item(0));document.body.classList.toggle("theme".concat(this.props.settings.theme),!0),document.body.classList.toggle("print".concat(this.props.settings.printStyle),!0),ee.updateCssVars(this.props.settings)}},{key:"loadTwKaiFont",value:function(){var e=Object(u.a)(h.a.mark((function e(){var t,n,s;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ee.getFileFromIndexedDB(ee.twKaiFontKey);case 3:t=e.sent,e.next=13;break;case 6:return e.prev=6,e.t0=e.catch(0),e.next=10,ee.axiosInstance.get("".concat(window.location.origin,"/").concat(ee.twKaiFontPath),{responseType:"arraybuffer",timeout:0});case 10:n=e.sent,t=n.data,ee.saveFileToIndexedDB(ee.twKaiFontKey,t);case 13:return s=new window.FontFace("Kai",t),e.next=16,s.load();case 16:document.fonts.add(s),console.log("[Main] TW-Kai font loading success!");case 18:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"wakeLockScreen",value:function(){var e=Object(u.a)(h.a.mark((function e(){var t;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,null==(t=navigator.wakeLock)){e.next=9;break}return e.next=5,t.request("screen");case 5:this.wakeLock=e.sent,console.log("Screen wake lock is requested."),e.next=10;break;case 9:console.error("navigator.wakeLock is undefined.");case 10:e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.log("".concat(e.t0.name,", ").concat(e.t0.message)),console.log((new Error).stack);case 16:case"end":return e.stop()}}),e,this,[[0,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"wakeLockScreenRelease",value:function(){var e=Object(u.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.wakeLock){e.next=5;break}return e.next=3,this.wakeLock.release();case 3:this.wakeLock=null,console.log("Screen wake lock is released.");case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"routeByQueryString",value:function(){console.log("path: ".concat(window.location.pathname,", search ").concat(window.location.search));var e=/route=([^&]*)/.exec(window.location.search),t=/query=([^&]*)/.exec(window.location.search);if(null!==e){var n="";return null!==t&&(n=decodeURIComponent(t[1])),Object(E.jsx)(x.a,{to:e[1]+n})}if(window.location.pathname==="".concat(ee.pwaUrl,"/")||window.location.pathname==="".concat(ee.pwaUrl)||""===window.location.pathname)return Object(E.jsx)(x.a,{to:"/bookmarks"})}},{key:"render",value:function(){var e,t,n=this;return Object(E.jsxs)(v.b,{style:ee.isTouchDevice()?{height:"".concat(window.innerHeight,"px")}:{},children:[Object(E.jsx)(m.a,{basename:ee.pwaUrl,children:Object(E.jsxs)(v.F,{children:[Object(E.jsxs)(v.z,{animated:!1,children:[Object(E.jsx)(x.b,{path:"/:tab(catalog)/webview/:work/:path/:label",render:function(e){return Object(E.jsx)(Ee,Object(p.a)({},e))},exact:!0}),Object(E.jsx)(x.b,{path:"/:tab(catalog)/juan/:work/:path/",render:function(e){return Object(E.jsx)(Ee,Object(p.a)({},e))},exact:!0}),Object(E.jsx)(x.b,{path:"/:tab(catalog)/work/:path/:label",render:function(e){return Object(E.jsx)(xe,Object(p.a)({},e))},exact:!0}),Object(E.jsx)(x.b,{path:"/:tab(catalog)/work/:path",render:function(e){return Object(E.jsx)(xe,Object(p.a)({},e))},exact:!0}),Object(E.jsx)(x.b,{path:"/:tab(catalog)/search/:keyword",render:function(e){return Object(E.jsx)(Ue,Object(p.a)({},e))},exact:!0}),Object(E.jsx)(x.b,{path:"/:tab(catalog)/fulltextsearch/:keyword",render:function(e){return Object(E.jsx)(Ge,Object(p.a)({},e))},exact:!0}),Object(E.jsx)(x.b,{path:"/:tab(catalog)/catalog/:path/:label",render:function(e){return Object(E.jsx)(de,Object(p.a)({},e))},exact:!0}),Object(E.jsx)(x.b,{path:"/:tab(catalog)/:type(catalog|volumes|famous)?/:path?",render:function(e){return Object(E.jsx)(de,Object(p.a)({},e))},exact:!0}),Object(E.jsx)(x.b,{path:"/:tab(bookmarks)",render:function(e){return Object(E.jsx)(Re,Object(p.a)({},e))},exact:!0}),Object(E.jsx)(x.b,{path:"/:tab(dictionary)/search/:keyword?",render:function(e){return Object(E.jsx)(ze,Object(p.a)({},e))},exact:!0}),Object(E.jsx)(x.b,{path:"/:tab(dictionary)/searchWord/:keyword?",render:function(e){return Object(E.jsx)(et,Object(p.a)({},e))},exact:!0}),Object(E.jsx)(x.b,{path:"/settings",render:function(e){return Object(E.jsx)(De,Object(p.a)({},e))}}),Object(E.jsx)(x.b,{path:"/",render:function(){return n.routeByQueryString()},exact:!0})]}),Object(E.jsxs)(v.D,{slot:"bottom",children:[Object(E.jsx)(v.E,{tab:"bookmarks",href:"/bookmarks",children:Object(E.jsx)(v.h,{icon:I.f})}),Object(E.jsx)(v.E,{tab:"catalog",href:"/catalog",children:Object(E.jsx)(v.h,{icon:I.q})}),Object(E.jsx)(v.E,{tab:"dictionay",href:"/dictionary/search",children:Object(E.jsx)(v.h,{icon:I.e})}),Object(E.jsx)(v.E,{tab:"settings",href:"/settings",children:Object(E.jsx)(v.h,{icon:I.x})})]})]})}),Object(E.jsx)(v.a,{cssClass:"uiFont",isOpen:this.state.showUpdateAlert,backdropDismiss:!1,onDidPresent:function(e){var t,s,o,r;null===(t=n.registrationNew)||void 0===t||null===(s=t.installing)||void 0===s||s.postMessage({type:"SKIP_WAITING"}),null===(o=n.registrationNew)||void 0===o||null===(r=o.waiting)||void 0===r||r.postMessage({type:"SKIP_WAITING"})},header:"App \u5df2\u66f4\u65b0\uff0c\u8acb\u91cd\u555f!",buttons:[{text:"\u95dc\u9589",cssClass:"primary uiFont",handler:function(e){n.setState({showUpdateAlert:!1})}}]}),Object(E.jsx)($e,Object(p.a)({},Object(p.a)({text:null===(e=this.props.tmpSettings.shareTextModal)||void 0===e?void 0:e.text,showModal:(null===(t=this.props.tmpSettings.shareTextModal)||void 0===t?void 0:t.show)||!1,finish:function(){ot.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!1}})}},this.props))),Object(E.jsx)(nt,Object(p.a)({},Object(p.a)({progress:this.state.downloadModal.progress,showModal:this.state.downloadModal.show},this.props))),Object(E.jsx)(v.H,{cssClass:"uiFont",isOpen:this.state.showRestoreAppSettingsToast,onDidDismiss:function(){return n.setState({showRestoreAppSettingsToast:!1})},message:"\u5df2\u5957\u7528app\u9023\u7d50\u4e2d\u7684\u8a2d\u5b9a\uff0c\u662f\u5426\u9084\u539f\u8a2d\u5b9a\uff1f",buttons:[{text:"\u53d6\u6d88",role:"cancel",handler:function(){return n.setState({showRestoreAppSettingsToast:!1})}},{text:"\u9084\u539f",handler:function(){return n.restoreAppSettings()}}]}),Object(E.jsx)(v.H,{cssClass:"uiFont",isOpen:this.state.showToast,onDidDismiss:function(){return n.setState({showToast:!1})},message:this.state.toastMessage,duration:2e3})]})}}]),n}(r.a.Component),ct=Object(g.b)((function(e){return{tmpSettings:e.tmpSettings,settings:e.settings}}))(it),lt=Object(x.f)(at),ht=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ut(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){console.log("installingWorker stage changed: ".concat(n.state)),"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}ee.enableAppLog(),i.a.render(Object(E.jsx)(c.a,{children:Object(E.jsx)(lt,{})}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("","/service-worker.js");ht?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var s=n.headers.get("content-type");404===n.status||null!=s&&-1===s.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):ut(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):ut(t,e)}))}}({onSuccess:function(e){console.log("Precache app loaded!"),rt.onSuccess(e)},onUpdate:function(e){console.log("Found app updated!"),rt.onUpdate(e)}})}},[[478,3,4]]]);
//# sourceMappingURL=main.3682d889.chunk.js.map