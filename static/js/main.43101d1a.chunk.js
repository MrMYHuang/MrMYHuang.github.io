(this.webpackJsonpcbetar2=this.webpackJsonpcbetar2||[]).push([[1],{121:function(e){e.exports=JSON.parse('{"name":"cbetar2","version":"4.5.0","private":true,"dependencies":{"@ionic/react":"^5.3.4","@ionic/react-router":"^5.3.4","@testing-library/jest-dom":"^4.2.4","@testing-library/react":"^9.4.0","@testing-library/user-event":"^8.0.3","@types/jest":"^24.0.25","@types/node":"^12.12.24","@types/react":"^16.9.17","@types/react-dom":"^16.9.4","@types/react-router":"^5.1.8","@types/react-router-dom":"^5.1.5","axios":"^0.19.2","epubjs-myh":"^0.3.109","history":"^4.10.1","ionicons":"^5.0.0","memfs":"^3.2.0","nodepub":"^2.2.0","qrcode":"^1.4.4","query-string":"^6.13.1","react":"^16.13.0","react-dom":"^16.13.0","react-redux":"^7.2.1","react-router":"^5.2.0","react-router-dom":"^5.2.0","react-scripts":"^3.4.3","redux":"^4.0.5","typescript":"3.8.3","uuid":"^8.3.0"},"scripts":{"start":"react-app-rewired start","build":"react-app-rewired build && powershell -file CopyBuild.ps1","build_linux":"react-app-rewired build && ./CopyBuild.sh","test":"react-app-rewired test","eject":"react-scripts eject","android":"npx cap open android","sync":"npx cap sync android"},"eslintConfig":{"extends":"react-app"},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]},"devDependencies":{"@types/qrcode":"^1.3.5","@types/react-redux":"^7.1.9","@types/uuid":"^8.3.0","customize-cra":"^1.0.0","react-app-rewired":"^2.1.6"},"description":"An Ionic project"}')},138:function(e,t,n){},211:function(e,t,n){e.exports=n(429)},217:function(e,t,n){var a={"./ion-action-sheet.entry.js":[431,5],"./ion-alert.entry.js":[432,6],"./ion-app_8.entry.js":[433,7],"./ion-avatar_3.entry.js":[434,18],"./ion-back-button.entry.js":[435,19],"./ion-backdrop.entry.js":[436,43],"./ion-button_2.entry.js":[437,20],"./ion-card_5.entry.js":[438,21],"./ion-checkbox.entry.js":[439,22],"./ion-chip.entry.js":[440,23],"./ion-col_3.entry.js":[441,44],"./ion-datetime_3.entry.js":[442,10],"./ion-fab_3.entry.js":[443,24],"./ion-img.entry.js":[444,45],"./ion-infinite-scroll_2.entry.js":[445,46],"./ion-input.entry.js":[446,25],"./ion-item-option_3.entry.js":[447,26],"./ion-item_8.entry.js":[448,27],"./ion-loading.entry.js":[449,28],"./ion-menu_3.entry.js":[450,29],"./ion-modal.entry.js":[451,8],"./ion-nav_2.entry.js":[452,15],"./ion-popover.entry.js":[453,9],"./ion-progress-bar.entry.js":[454,30],"./ion-radio_2.entry.js":[455,31],"./ion-range.entry.js":[456,32],"./ion-refresher_2.entry.js":[457,11],"./ion-reorder_2.entry.js":[458,17],"./ion-ripple-effect.entry.js":[459,47],"./ion-route_4.entry.js":[460,33],"./ion-searchbar.entry.js":[461,34],"./ion-segment_2.entry.js":[462,35],"./ion-select_3.entry.js":[463,36],"./ion-slide_2.entry.js":[464,48],"./ion-spinner.entry.js":[465,13],"./ion-split-pane.entry.js":[466,49],"./ion-tab-bar_2.entry.js":[467,37],"./ion-tab_2.entry.js":[468,16],"./ion-text.entry.js":[469,38],"./ion-textarea.entry.js":[470,39],"./ion-toast.entry.js":[471,40],"./ion-toggle.entry.js":[472,12],"./ion-virtual-scroll.entry.js":[473,50]};function r(e){if(!n.o(a,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=a[e],r=t[0];return n.e(t[1]).then((function(){return n(r)}))}r.keys=function(){return Object.keys(a)},r.id=217,e.exports=r},219:function(e,t,n){var a={"./ion-icon.entry.js":[477,57]};function r(e){if(!n.o(a,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=a[e],r=t[0];return n.e(t[1]).then((function(){return n(r)}))}r.keys=function(){return Object.keys(a)},r.id=219,e.exports=r},241:function(e,t,n){},253:function(e,t,n){},296:function(e,t){},298:function(e,t){},330:function(e,t){},332:function(e,t){},338:function(e,t){},340:function(e,t){},348:function(e,t){},350:function(e,t){},360:function(e,t){},362:function(e,t){},407:function(e,t,n){},408:function(e,t,n){},429:function(e,t,n){"use strict";n.r(t);var a,r=n(0),o=n.n(r),s=n(57),i=n.n(s),c=n(88),l=n(31),u=n(5),p=n.n(u),h=n(9),d=n(3),m=n(4),f=n(11),v=n(12),y=n(19),k=n(1),g=n(200),b=n(25),w=n(58),E=n(24),S=n(202),x=n.n(S);!function(e){e[e.BY_CHAPTER=0]="BY_CHAPTER",e[e.BY_JUAN=1]="BY_JUAN"}(a||(a={}));var T=function e(t){Object(d.a)(this,e),this.title=void 0,this.juan=void 0,this.title=t.title,this.juan=t.juan},C=function e(t){Object(d.a)(this,e),this.title=void 0,this.juan=void 0,this.juan_list=void 0,this.mulu=void 0,this.work=void 0,this.vol=void 0,this.title=t.title,this.juan=t.juan,this.juan_list=t.juan_list,this.mulu=t.mulu,this.work=t.work,this.vol=t.vol},j="https://cbdata.dila.edu.tw/".concat("v1.2"),A="",I=x.a.create({baseURL:j,timeout:3e3});function O(e){switch(e){case 0:return 0;case 1:return 20;case 2:return 40}}function N(e,t){return"".concat(e,"_juan").concat(t,".html")}function z(e){return F.apply(this,arguments)}function F(){return(F=Object(h.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=indexedDB.open("cbetardb"),e.abrupt("return",new Promise((function(e,a){n.onsuccess=function(){var r=Object(h.a)(p.a.mark((function r(o){var s,i,c;return p.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:s=n.result,i=s.transaction(["store"],"readwrite"),(c=i.objectStore("store").get(t)).onsuccess=function(){var n=Object(h.a)(p.a.mark((function n(r){var o;return p.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=c.result){n.next=4;break}return console.error("".concat(t," loading failed!")),n.abrupt("return",a());case 4:return n.abrupt("return",e(o));case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();case 4:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(){return(_=Object(h.a)(p.a.mark((function e(t,n){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=indexedDB.open("cbetardb"),e.abrupt("return",new Promise((function(e,r){a.onsuccess=function(){var r=Object(h.a)(p.a.mark((function r(o){var s,i;return p.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:s=a.result,i=s.transaction(["store"],"readwrite"),i.objectStore("store").put(n,t).onsuccess=function(t){return e()};case 4:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(){return(B=Object(h.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=indexedDB.open("cbetardb"),e.abrupt("return",new Promise((function(e,a){n.onsuccess=function(){var a=Object(h.a)(p.a.mark((function a(r){var o,s;return p.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:o=n.result,s=o.transaction(["store"],"readwrite"),s.objectStore("store").delete(t).onsuccess=function(t){return e()};case 4:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}()})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(){return(P=Object(h.a)(p.a.mark((function e(t,n,a){var r,o,s,i,c,l,u,h,d,m,f,v=arguments;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=v.length>3&&void 0!==v[3]&&v[3],o=a||N(t,n),s=null,e.prev=3,e.next=6,z(o);case 6:s=e.sent,e.next=11;break;case 9:e.prev=9,e.t0=e.catch(3);case 11:if(i=new C({}),null===s||r){e.next=17;break}c=JSON.parse(localStorage.getItem("Settings.json")).settings.bookmarks,i=c.find((function(e){return e.fileName===o||e.uuid===t})).work,e.next=37;break;case 17:if(!a){e.next=26;break}return e.next=20,I.get("/".concat(a),{responseType:"arraybuffer"});case 20:l=e.sent,u=new TextDecoder,h=u.decode(l.data),s=h.includes("charset=big5")?new TextDecoder("big5").decode(l.data):h,e.next=32;break;case 26:return e.next=28,I.get("/juans?edition=CBETA&work_info=1&work=".concat(t,"&juan=").concat(n),{responseType:"arraybuffer"});case 28:d=e.sent,m=JSON.parse((new TextDecoder).decode(d.data)),s=m.results[0],i=m.work_info;case 32:(f=document.implementation.createHTMLDocument("")).body.innerHTML=s,s=(s=(s=(new XMLSerializer).serializeToString(f.body)).replace("<body","<div")).replace("/body>","/div>");case 37:return e.abrupt("return",{htmlStr:s,workInfo:i});case 38:case"end":return e.stop()}}),e,null,[[3,9]])})))).apply(this,arguments)}var L=console.log.bind(console),D=console.error.bind(console);var R,V={storeFile:"Settings.json",fontSizeNorm:24,fontSizeLarge:48,getLog:function(){return A},enableAppLog:function(){console.log=function(){A+="----- Info ----\n",A+=Array.from(arguments)+"\n",L.apply(console,arguments)},console.error=function(){A+="----- Error ----\n",A+=Array.from(arguments)+"\n",D.apply(console,arguments)}},disableAppLog:function(){A="",console.log=L,console.error=D},cbetardb:"cbetardb",apiVersion:"v1.2",cbetaApiUrl:j,dilaDictApiUrl:"https://glossaries.dila.edu.tw/search.json",twKaiFontKey:"twKaoFont",twKaiFontPath:"/assets/TW-Kai-98_1.woff",axiosInstance:I,topCatalogsByCat:{CBETA:"CBETA \u90e8\u985e","Cat-T":"\u5927\u6b63\u85cf","Cat-X":"\u534d\u7e8c\u85cf","Cat-N":"\u5357\u50b3\u5927\u85cf\u7d93",others:"\u6b77\u4ee3\u85cf\u7d93\u88dc\u8f2f",modern:"\u8fd1\u4ee3\u65b0\u7de8\u6587\u737b"},topCatalogsByVol:{"Vol-T":"T \u5927\u6b63\u85cf","Vol-X":"X \u534d\u7e8c\u85cf","Vol-A":"A \u8d99\u57ce\u91d1\u85cf","Vol-K":"K \u9ad8\u9e97\u5927\u85cf\u7d93-\u65b0\u6587\u8c50\u7248","Vol-S":"S \u5b8b\u85cf\u907a\u73cd-\u65b0\u6587\u8c50\u7248","Vol-F":"F \u623f\u5c71\u77f3\u7d93","Vol-C":"C \u4e2d\u83ef\u5927\u85cf\u7d93-\u4e2d\u83ef\u66f8\u5c40\u7248","Vol-U":"U \u6d2a\u6b66\u5357\u85cf","Vol-P":"P \u6c38\u6a02\u5317\u85cf","Vol-J":"J \u5609\u8208\u85cf","Vol-L":"L \u4e7e\u9686\u5927\u85cf\u7d93-\u65b0\u6587\u8c50\u7248","Vol-G":"G \u4f5b\u6559\u5927\u85cf\u7d93","Vol-M":"M \u534d\u6b63\u85cf\u7d93-\u65b0\u6587\u8c50\u7248","Vol-D":"D \u570b\u5716\u5584\u672c","Vol-N":"N \u5357\u50b3\u5927\u85cf\u7d93(\u518a\u5225)","Vol-ZS":"ZS \u6b63\u53f2\u4f5b\u6559\u8cc7\u6599\u985e\u7de8","Vol-I":"I \u5317\u671d\u4f5b\u6559\u77f3\u523b\u62d3\u7247\u767e\u54c1","Vol-ZW":"ZW \u85cf\u5916\u4f5b\u6559\u6587\u737b","Vol-B":"B \u5927\u85cf\u7d93\u88dc\u7de8","Vol-GA":"GA \u4e2d\u570b\u4f5b\u5bfa\u53f2\u5fd7\u5f59\u520a","Vol-GB":"GB \u4e2d\u570b\u4f5b\u5bfa\u5fd7\u53e2\u520a","Vol-Y":"Y \u5370\u9806\u6cd5\u5e2b\u4f5b\u5b78\u8457\u4f5c\u96c6","Vol-LC":"LC \u5442\u6f82\u4f5b\u5b78\u8457\u4f5c\u96c6"},fetchErrorContent:o.a.createElement(k.m,{className:"contentCenter"},o.a.createElement("div",null,o.a.createElement("div",null,"\u9023\u7dda\u5931\u6557!"),o.a.createElement("div",{style:{fontSize:"var(--ui-font-size)",paddingTop:24}},"\u5982\u679c\u554f\u984c\u6301\u7e8c\u767c\u751f\uff0c\u8acb\u57f7\u884c",o.a.createElement("a",{href:"/settings",target:"_self"},"\u8a2d\u5b9a\u9801"),"\u7684app\u7570\u5e38\u56de\u5831\u529f\u80fd\u3002"))),updateApp:function(){navigator.serviceWorker.getRegistrations().then((function(e){return Promise.all(e.map((function(e){return e.update()})))}))},scrollbarSizeIdToValue:O,updateCssVars:function(e){var t=O(e.scrollbarSize);document.documentElement.style.cssText="--ion-font-family: ".concat(e.useFontKai?"Heiti, Times, Kai":"Times, Heiti",";\n        --scrollbar-size: ").concat(t,"px; --ui-font-size: ").concat(e.uiFontSize,"px; --text-font-size: ").concat(e.fontSize,"px")},isTouchDevice:function(){return Object(k.Q)("ios")||Object(k.Q)("android")},fetchJuan:function(e,t,n){return P.apply(this,arguments)},getFileName:N,getFileFromIndexedDB:z,saveFileToIndexedDB:function(e,t){return _.apply(this,arguments)},removeFileFromIndexedDB:function(e){return B.apply(this,arguments)},removeElementsByClassName:function(e,t){for(var n=e.getElementsByClassName(t);n.length>0;){var a;null===(a=n[0].parentNode)||void 0===a||a.removeChild(n[0])}}};!function(e){e[e.CATALOG=0]="CATALOG",e[e.WORK=1]="WORK",e[e.JUAN=2]="JUAN",e[e.HTML=3]="HTML"}(R||(R={}));var U=function e(t){Object(d.a)(this,e),this.type=R.CATALOG,this.uuid="",this.work=null,this.selectedText="",this.epubcfi="",this.fileName="",this.type=t.type,this.uuid=t.uuid,this.work=t.work,this.selectedText=t.selectedText,this.epubcfi=t.epubcfi,this.fileName=t.fileName};var K=Object(w.b)({settings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=Object(l.a)({},e);switch(t.type){case"LOAD_SETTINGS":n=JSON.parse(localStorage.getItem(V.storeFile)).settings;break;case"SET_KEY_VAL":var a=t.key,r=t.val;n[a]=r,localStorage.setItem(V.storeFile,JSON.stringify({settings:n}));break;case"ADD_BOOKMARK":var o=n.bookmarks,s=t.bookmark.fileName;null===s||""===s||o.some((function(e){return e.fileName===s}))||V.saveFileToIndexedDB(s,t.htmlStr),n.bookmarks=[].concat(Object(E.a)(n.bookmarks),[t.bookmark]),localStorage.setItem(V.storeFile,JSON.stringify({settings:n}));break;case"DEL_BOOKMARK":var i=n.bookmarks,c=i.findIndex((function(e){return e.uuid===t.uuid}));if(-1!==c){var u=i.splice(c,1);if(1===u.length){var p=u[0],h=p.fileName,d=null==i.find((function(e){return e.type===R.JUAN&&e.uuid===p.uuid})),m=null==i.find((function(e){var t,n;return e.type===R.WORK&&(null===(t=e.work)||void 0===t?void 0:t.work)===(null===(n=p.work)||void 0===n?void 0:n.work)}));if(m)switch(p.type){case R.WORK:var f=p.work;if(null==f)break;for(var v=f.juan_list.split(","),y=function(e){var t=V.getFileName(f.work,v[e]);(d=null==i.find((function(e){return e.type===R.JUAN&&e.fileName===t})))&&V.removeFileFromIndexedDB(t)},k=0;k<v.length;k++)y(k);break;case R.JUAN:d&&V.removeFileFromIndexedDB(h)}}}n.bookmarks=Object(E.a)(i),localStorage.setItem(V.storeFile,JSON.stringify({settings:n}));break;case"UPDATE_BOOKMARKS":n.bookmarks=t.bookmarks,localStorage.setItem(V.storeFile,JSON.stringify({settings:n}));break;default:0===Object.keys(n).length&&(n={});for(var g=["version","topCatalogsType","hasAppLog","theme","paginated","rtlVerticalLayout","scrollbarSize","useFontKai","fontSize","uiFontSize","showComments","speechRate","bookmarks"],b=[1,0,1,0,1,1,2,1,32,24,0,.8,[]],w=0;w<g.length;w++)void 0===n[g[w]]&&(n[g[w]]=b[w])}return n},tmpSettings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=Object(l.a)({},e),a=t.key,r=t.val;switch(n[a]=r,t.type){case"TMP_SET_KEY_VAL":return n}return e}});var M,W=n(7),J=(n(241),function e(t){Object(d.a)(this,e),this.n=void 0,this.nodeType=void 0,this.label=void 0,this.work=void 0,this.file=void 0,this.n=t.n,this.nodeType=t.node_type,this.label=t.label,this.work=t.work,this.file=t.file}),H=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(m.a)(n,[{key:"render",value:function(){var e=this;return o.a.createElement(k.a,{cssClass:"uiFont",isOpen:this.props.showSearchAlert,header:"\u641c\u5c0b\u7d93\u66f8",subHeader:"\u8f38\u5165\u641c\u5c0b",inputs:[{name:"name0",type:"search",placeholder:"\u4f8b:\u91d1\u525b\u822c\u82e5"}],buttons:[{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary uiFont",handler:function(){return e.props.finish()}},{text:"\u641c\u5c0b\u76ee\u9304",cssClass:"primary uiFont",handler:function(t){e.props.finish(),e.props.history.push("/catalog/search/".concat(t.name0))}},{text:"\u5168\u6587\u6aa2\u7d22",cssClass:"primary uiFont",handler:function(t){e.props.finish(),e.props.history.push("/catalog/fulltextsearch/".concat(t.name0))}}]})}}]),n}(o.a.Component),Y=n(59),G=n.n(Y),q=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).state={fetchError:!1,catalogs:[],pathLabel:"",showSearchAlert:!1},a}return Object(m.a)(n,[{key:"ionViewWillEnter",value:function(){console.log("view will enter: ".concat(this.props.match.url))}},{key:"componentDidMount",value:function(){console.log("did mount: ".concat(this.props.match.url)),this.fetchData(this.props.match.params.path)}},{key:"fetchData",value:function(){var e=Object(h.a)(p.a.mark((function e(t){var n,a,r,o,s,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new Array,a="",null!=t){e.next=6;break}return e.abrupt("return",this.fetchTopCatalogs(this.props.topCatalogsType));case 6:return e.prev=6,e.next=9,V.axiosInstance.get("/catalog_entry?q=".concat(t),{responseType:"arraybuffer"});case 9:return r=e.sent,o=JSON.parse((new TextDecoder).decode(r.data)),s=o.results,n=s.map((function(e){return new J(e)})),""!==this.parentPath(t)?a=o.label:(i=V.topCatalogsByCat[t],a=void 0!==i?i:V.topCatalogsByVol[t]),this.setState({catalogs:n,pathLabel:a}),e.abrupt("return",!0);case 19:return e.prev=19,e.t0=e.catch(6),console.error(e.t0),console.error((new Error).stack),this.setState({fetchError:!0}),e.abrupt("return",!1);case 25:case"end":return e.stop()}}),e,this,[[6,19]])})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchTopCatalogs",value:function(e){var t=Array(),n=e?V.topCatalogsByVol:V.topCatalogsByCat;return Object.keys(n).forEach((function(e){var a={n:e,nodeType:null,work:null,label:n[e],file:null};t.push(a)})),this.setState({catalogs:t}),!0}},{key:"parentPath",value:function(e){var t=e.split(".");return t.pop(),t.join(".")}},{key:"addBookmarkHandler",value:function(){this.props.dispatch({type:"ADD_BOOKMARK",bookmark:new U({type:R.CATALOG,uuid:this.props.match.params.path,selectedText:this.state.pathLabel,epubcfi:"",fileName:"",work:null})})}},{key:"delBookmarkHandler",value:function(){this.props.dispatch({type:"DEL_BOOKMARK",uuid:this.props.match.params.path})}},{key:"getRows",value:function(){var e=this,t=Array();return this.state.catalogs.forEach((function(n,a){var r="",s="html"===n.nodeType;r=s?"/catalog/juan/".concat(n.n,"/1"):null==n.work?"/catalog/catalog/".concat(n.n):"/catalog/work/".concat(n.work),t.push(o.a.createElement(k.i,{key:"".concat(n.n,"item")+a,button:!0,onClick:function(){var t=Object(h.a)(p.a.mark((function t(a){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a.preventDefault(),e.props.history.push({pathname:r,search:G.a.stringify(s?{file:n.file,title:n.label}:{})});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"},key:"".concat(n.n,"label")+a},n.label)))})),t}},{key:"render",value:function(){var e=this,t=o.a.createElement(k.n,null,this.getRows());return o.a.createElement(k.q,null,o.a.createElement(k.g,null,o.a.createElement(k.H,null,o.a.createElement(k.E,{style:{fontSize:"var(--ui-font-size)"}},"\u76ee\u9304"),o.a.createElement(k.c,{hidden:this.isTopCatalog,fill:"clear",slot:"start",onClick:function(t){return e.props.history.goBack()}},o.a.createElement(k.h,{icon:W.a,slot:"icon-only"})),o.a.createElement(k.c,{hidden:!this.isTopCatalog,slot:"end",onClick:function(t){var n=(e.props.topCatalogsType+1)%2;e.fetchTopCatalogs(n),e.props.dispatch({type:"SET_KEY_VAL",key:"topCatalogsType",val:n})}},o.a.createElement("span",{className:"uiFont",style:{color:"var(--color)"}},this.props.topCatalogsType?"\u518a\u5206\u985e":"\u90e8\u5206\u985e")),o.a.createElement(k.c,{hidden:this.isTopCatalog,fill:"clear",color:this.hasBookmark?"warning":"primary",slot:"end",onClick:function(t){return e.hasBookmark?e.delBookmarkHandler():e.addBookmarkHandler()}},o.a.createElement(k.h,{icon:W.e,slot:"icon-only"})),o.a.createElement(k.c,{hidden:this.isTopCatalog,fill:"clear",slot:"end",onClick:function(t){return e.props.history.push("/".concat(e.props.match.params.tab))}},o.a.createElement(k.h,{icon:W.s,slot:"icon-only"})),o.a.createElement(k.c,{fill:"clear",slot:"end",onClick:function(t){return e.setState({showSearchAlert:!0})}},o.a.createElement(k.h,{icon:W.B,slot:"icon-only"})),o.a.createElement(k.c,{fill:"clear",slot:"end",onClick:function(t){e.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})}},o.a.createElement(k.h,{icon:W.F,slot:"icon-only"})))),o.a.createElement(k.d,null,this.state.fetchError?V.fetchErrorContent:t,o.a.createElement(H,Object(l.a)({showSearchAlert:this.state.showSearchAlert,finish:function(){e.setState({showSearchAlert:!1})}},this.props)),o.a.createElement("div",{style:{fontSize:"var(--ui-font-size)",textAlign:"center"}},o.a.createElement("a",{href:"https://github.com/MrMYHuang/cbetar2#search",target:"_new"},"\u641c\u5c0b\u7d93\u66f8\u6559\u5b78"))))}},{key:"isTopCatalog",get:function(){return"/catalog"===this.props.match.url}},{key:"hasBookmark",get:function(){var e=this;return null!=this.props.bookmarks.find((function(t){return t.type===R.CATALOG&&t.uuid===e.props.match.params.path}))}}]),n}(o.a.Component),Q=Object(k.S)(q),X=Object(b.b)((function(e){return{bookmarks:e.settings.bookmarks,topCatalogsType:e.settings.topCatalogsType,state:e}}))(Q),Z=(n(138),function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).fetchJuan="",a.state={work:null,showSearchAlert:!1,showAddBookmarkDone:!1},a}return Object(m.a)(n,[{key:"ionViewWillEnter",value:function(){this.fetchWork(this.props.match.params.path)}},{key:"fetchWork",value:function(){var e=Object(h.a)(p.a.mark((function e(t){var n,a,r,o,s;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasBookmark){e.next=4;break}n=this.bookmark.work,e.next=21;break;case 4:return e.prev=4,e.next=7,V.axiosInstance.get("/works?work=".concat(t),{responseType:"arraybuffer"});case 7:return a=e.sent,r=JSON.parse((new TextDecoder).decode(a.data)),o=r.results,n=o[0],e.next=13,V.axiosInstance.get("/toc?work=".concat(t));case 13:s=e.sent,n.mulu=s.data.results[0].mulu.map((function(e){return new T(e)})),e.next=21;break;case 17:return e.prev=17,e.t0=e.catch(4),console.error(e.t0),e.abrupt("return",!1);case 21:return this.setState({work:n}),e.abrupt("return",!0);case 23:case"end":return e.stop()}}),e,this,[[4,17]])})));return function(t){return e.apply(this,arguments)}}()},{key:"saveJuans",value:function(){var e=Object(h.a)(p.a.mark((function e(){var t,n,a,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.state.work,n=t.juan_list.split(","),a=0;case 3:if(!(a<n.length)){e.next=18;break}return this.fetchJuan=n[a],e.prev=5,e.next=8,V.fetchJuan(t.work,this.fetchJuan,null);case 8:r=e.sent,V.saveFileToIndexedDB(V.getFileName(t.work,this.fetchJuan),r.htmlStr),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(5),console.error("Fetching juan ".concat(a," failed! ").concat(e.t0));case 15:a++,e.next=3;break;case 18:this.setState({showAddBookmarkDone:!0});case 19:case"end":return e.stop()}}),e,this,[[5,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"addBookmarkHandler",value:function(){var e=Object(h.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveJuans();case 2:this.props.dispatch({type:"ADD_BOOKMARK",bookmark:new U({type:R.WORK,uuid:this.props.match.params.path,selectedText:this.state.work.title,epubcfi:"",fileName:"",work:this.state.work})});case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"delBookmarkHandler",value:function(){this.props.dispatch({type:"DEL_BOOKMARK",uuid:this.props.match.params.path})}},{key:"getRowsByChapter",value:function(){for(var e=this,t=this.state.work,n=t.mulu,a=Array(),r=function(r){var s="/catalog/juan/".concat(t.work,"/").concat(n[r].juan);a.push(o.a.createElement(k.i,{key:"chapterItem"+r,button:!0,onClick:function(){var t=Object(h.a)(p.a.mark((function t(n){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.preventDefault(),e.props.history.push({pathname:s});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"},key:"chapterLabel"+r},n[r].title)))},s=0;s<n.length;s++)r(s);return a}},{key:"getRowsByJuan",value:function(){for(var e=this,t=this.state.work,n=Array(),a=t.juan_list.split(","),r=function(r){var s="/catalog/juan/".concat(t.work,"/").concat(a[r]);n.push(o.a.createElement(k.i,{key:"juanItem"+r,button:!0,onClick:function(){var t=Object(h.a)(p.a.mark((function t(n){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.preventDefault(),e.props.history.push({pathname:s});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"},key:"juanLabel"+r},"\u5377",a[r])))},s=0;s<a.length;s++)r(s);return n}},{key:"render",value:function(){var e,t=this;if(null==this.state.work)return o.a.createElement(k.q,null);var n=this.props.workListType===a.BY_CHAPTER?this.getRowsByChapter():this.getRowsByJuan();return o.a.createElement(k.q,null,o.a.createElement(k.g,null,o.a.createElement(k.H,null,o.a.createElement(k.c,{hidden:this.isTopPage,fill:"clear",slot:"start",onClick:function(e){return t.props.history.goBack()}},o.a.createElement(k.h,{icon:W.a,slot:"icon-only"})),o.a.createElement(k.c,{slot:"end",onClick:function(e){var n=t.props.workListType===a.BY_CHAPTER?a.BY_JUAN:a.BY_CHAPTER;t.props.dispatch({type:"TMP_SET_KEY_VAL",key:"workListType",val:n})}},o.a.createElement("span",{className:"uiFont",style:{color:"var(--color)"}},this.props.workListType===a.BY_CHAPTER?"\u5206\u54c1":"\u5206\u5377")),o.a.createElement(k.c,{fill:"clear",color:this.hasBookmark?"warning":"primary",slot:"end",onClick:function(e){return t.hasBookmark?t.delBookmarkHandler():t.addBookmarkHandler()}},o.a.createElement(k.h,{icon:W.e,slot:"icon-only"})),o.a.createElement(k.c,{fill:"clear",slot:"end",onClick:function(e){return t.props.history.push("/".concat(t.props.match.params.tab))}},o.a.createElement(k.h,{icon:W.s,slot:"icon-only"})),o.a.createElement(k.c,{fill:"clear",slot:"end",onClick:function(e){return t.setState({showSearchAlert:!0})}},o.a.createElement(k.h,{icon:W.B,slot:"icon-only"})),o.a.createElement(k.c,{fill:"clear",slot:"end",onClick:function(e){t.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})}},o.a.createElement(k.h,{icon:W.F,slot:"icon-only"})))),o.a.createElement(k.d,null,o.a.createElement("div",{className:"uiFontX2",style:{color:"var(--ion-color-primary)"}},null===(e=this.state.work)||void 0===e?void 0:e.title),o.a.createElement(k.n,null,n),o.a.createElement(H,Object(l.a)({showSearchAlert:this.state.showSearchAlert,finish:function(){t.setState({showSearchAlert:!1})}},this.props)),o.a.createElement(k.F,{cssClass:"uiFont",isOpen:this.state.showAddBookmarkDone,onDidDismiss:function(){return t.setState({showAddBookmarkDone:!1})},message:"\u66f8\u7c64\u65b0\u589e\u6210\u529f\uff01",duration:2e3})))}},{key:"isTopPage",get:function(){return"/catalog"===this.props.match.url}},{key:"bookmark",get:function(){var e=this;return this.props.bookmarks.find((function(t){return t.type===R.WORK&&t.uuid===e.props.match.params.path}))}},{key:"hasBookmark",get:function(){return null!=this.bookmark}}]),n}(o.a.Component)),$=Object(k.S)(Z),ee=Object(b.b)((function(e){return{bookmarks:e.settings.bookmarks,workListType:void 0!==e.tmpSettings.workListType?e.tmpSettings.workListType:a.BY_JUAN}}))($),te=n(16),ne=n(479),ae=(n(253),n(92)),re=n(206);function oe(){return se.apply(this,arguments)}function se(){return(se=Object(h.a)(p.a.mark((function e(){var t,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V.getFileFromIndexedDB(V.twKaiFontKey);case 2:return t=e.sent,n=new window.FontFace("Kai",t),e.next=6,n.load();case 6:this.document.fonts.add(n);case 7:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}!function(e){e[e.UNINITIAL=0]="UNINITIAL",e[e.SPEAKING=1]="SPEAKING",e[e.PAUSE=2]="PAUSE"}(M||(M={}));var ie,ce=function(e){Object(f.a)(a,e);var t=Object(v.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).htmlFile=void 0,n.htmlTitle=void 0,n.book=void 0,n.rendition=void 0,n.epub=void 0,n.displayed=void 0,n.cfiRange=void 0,n.speechSynthesisUtterance=void 0,n.uuidStr="",n.epubcfiFromUrl="",n.epubcfiFromSelectedString="",n.bookCreated=!1,n.ePubIframe=null,n.searchTextRanges=[],n.showedSearchTextIndex=0,n.maxCharsPerUtterance=1e3,n.workTexts=[],n.workTextsIndex=0,n.state={isLoading:!0,fetchError:!1,workInfo:new C({}),htmlStr:null,currentPage:1,pageCount:1,showJumpPageAlert:!1,showNoSelectedTextAlert:!1,showAddBookmarkSuccess:!1,showsCopyToClipboardSuccess:!1,showsCitationFail:!1,showSearchTextAlert:!1,searchText:"",showSearchTextToast:!1,showToast:!1,toastMessage:"",showSearchAlert:!1,popover:{show:!1,event:null},lookupDictPopover:{show:!1,data:[]},speechState:M.UNINITIAL},n.htmlFile="",n.htmlTitle="",n.book=null,n.rendition=null,n.cfiRange="",n.speechSynthesisUtterance=new SpeechSynthesisUtterance,n.speechSynthesisUtterance.lang="zh-TW",n.speechSynthesisUtterance.onend=function(e){n.state.speechState!==M.UNINITIAL&&(n.workTextsIndex<n.workTexts.length-1?(n.workTextsIndex+=1,n.speechSynthesisUtterance.text=n.workTexts[n.workTextsIndex],speechSynthesis.speak(n.speechSynthesisUtterance),console.log("Play work text to speech part: ".concat(n.workTextsIndex))):(n.setState({speechState:M.UNINITIAL}),console.log("Stop work text to speech.")))},document.addEventListener("keyup",n.keyListener.bind(Object(te.a)(n)),!1),n}return Object(m.a)(a,[{key:"loadEpubCoverToMemFs",value:function(){var e=Object(h.a)(p.a.mark((function e(){var t,a,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(t=new Uint8Array(JSON.parse(localStorage.getItem("logo.png")||"[]"))).length){e.next=8;break}return e.next=4,V.axiosInstance.get("".concat(window.location.origin,"/assets/icon/icon.png"),{responseType:"arraybuffer"});case 4:a=e.sent,t=new Uint8Array(a.data),r=JSON.stringify(Array.from(t)),localStorage.setItem("logo.png",r);case 8:n(49).writeFileSync("logo.png",t);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"ionViewWillEnter",value:function(){this.setState({isLoading:!0});var e=G.a.parse(this.props.location.search);this.htmlFile=e.file,this.htmlTitle=e.title,this.epubcfiFromUrl=e.bookmark||"";var t=this.props.location.state;this.uuidStr=t?t.uuid:"",this.fetchData()}},{key:"ionViewDidEnter",value:function(){}},{key:"fetchData",value:function(){var e=Object(h.a)(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.fetchJuan(this.props.match.params.work,this.props.match.params.path,this.htmlFile);case 3:return t=e.sent,e.next=6,this.loadEpubCoverToMemFs();case 6:this.setState({workInfo:t.workInfo,htmlStr:t.htmlStr}),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0),this.setState({isLoading:!1,fetchError:!0});case 13:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"addBookmarkHandler",value:function(){var e=this.getSelectedString();if(""!==e){var t=ne.a();this.props.dispatch({type:"ADD_BOOKMARK",htmlStr:this.state.htmlStr,bookmark:new U({type:this.htmlFile?R.HTML:R.JUAN,uuid:t,selectedText:e,epubcfi:this.epubcfiFromSelectedString,fileName:this.htmlFile||"".concat(this.props.match.params.work,"_juan").concat(this.props.match.params.path,".html"),work:Object.assign(this.state.workInfo,{title:this.htmlFile?this.htmlTitle:this.state.workInfo.title,juan:this.props.match.params.path})})}),this.setState({showAddBookmarkSuccess:!0})}else this.setState({showNoSelectedTextAlert:!0})}},{key:"ionViewWillLeave",value:function(){var e;speechSynthesis.cancel(),this.setState({htmlStr:null,currentPage:1,speechState:M.UNINITIAL,showSearchTextToast:!1}),null===(e=this.book)||void 0===e||e.destroy(),this.book=null,this.bookCreated=!1}},{key:"pagePrev",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.props.paginated&&this.state.currentPage>1&&(null===(e=this.rendition)||void 0===e||e.prev(t),this.setState({currentPage:this.state.currentPage-t}))}},{key:"pageNext",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.props.paginated&&this.state.currentPage<this.state.pageCount&&(null===(e=this.rendition)||void 0===e||e.next(t),this.setState({currentPage:this.state.currentPage+t}))}},{key:"jumpToPage",value:function(e){if(0!==e){e=isNaN(e)?1:Math.max(Math.min(this.state.pageCount,e),1);var t=this.state.currentPage,n=t<e?1:-1,a=Math.abs(e-t);1===n?this.pageNext(a):this.pagePrev(a)}}},{key:"keyListener",value:function(e){var t=e.keyCode||e.which;console.log(e.type),t===(this.props.rtlVerticalLayout?37:40)&&this.buttonNext(),t===(this.props.rtlVerticalLayout?39:38)&&this.buttonPrev()}},{key:"html2Epub",value:function(){var e=Object(h.a)(p.a.mark((function e(){var t,a,r=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.bookCreated=!0,this.epub=re.document({id:"123-123456789",title:"Title",series:"",sequence:1,author:"Author",fileAs:"",genre:"genre",tags:"",copyright:"",publisher:"",published:"",language:"en",description:"A temp book.",contents:this.state.workInfo.title,source:"",images:["logo.png"]},"logo.png"),t=this.state.htmlStr,this.props.rtlVerticalLayout&&(t=t.replace(/margin-left/g,"margin-top")),a=t+"\n    <script>\n    <\/script>\n    ",this.epub.addSection("",a,!0,!1),"\n    html {\n      writing-mode: vertical-rl;\n      direction: ltr;\n    }\n    ",this.epub.addCSS("\n    @page {\n      size: A4;\n      margin: 0.5in;\n    }\n\n    @page :left {\n      margin-right: 1in;\n    }\n\n    @page :right {\n      margin-left: 1in;\n    }\n\n    @media print {\n      body {\n        padding: 0 !important;\n        width: 100% !important;\n        height: 100% !important;\n        column-gap: unset !important;\n        column-width: unset !important;\n      }\n      #back {\n        display: none;\n      }\n    }\n\n    html {\n      background: ".concat(getComputedStyle(document.body).getPropertyValue("--ion-background-color"),";\n      /*\n      Because different fonts have different line heights with 'line-height: normal,'\n      the content size of epubjs iframe changes after the fallback font is swapped with the web font.\n      Unfortunately, epubjs can't detect the size change and update the iframe.\n      This problem causes the total page count is incorrect.\n      Fortunately, we can set the line height based on the same font size as below.\n      */\n      line-height: 1.2;\n    }\n\n    @font-face {\n        font-family: 'Times';\n        src: local('Times New Roman');\n        unicode-range: U+0-007F;\n    }\n\n    /* Workaround parenthesis orientation problem of TW-Kai-98_1 on iOS Safari. */\n    @font-face {\n        font-family: 'Heiti';\n        src: local('Heiti TC');\n        unicode-range: U+3008-301B, U+FF01-FF60;\n    }\n\n    .lb {\n      display: none\n    }\n\n    /* In-HTML anchor jumps don't update this.state.currentPage.\n    Thus, we disable thems. */\n    .noteAnchor {\n      pointer-events: none;\n      text-decoration: inherit;\n      color: inherit;\n      cursor: auto;\n    }\n\n    .doube-line-note, .doube-line-note .t {\n      font-size: ").concat(.8*this.props.fontSize,'px;\n    }\n\n    .doube-line-note::before {\n      content: "\uff08";\n    }\n\n    .doube-line-note::after {\n      content: "\uff09";\n    }\n\n    .bip-table {\n      display: table;\n    }\n\n    .bip-table-row {\n      display: table-row;\n    }\n\n    .bip-table-cell {\n      display: table-cell;\n      border: 1px solid ').concat(getComputedStyle(document.body).getPropertyValue("--ion-text-color"),";\n      text-align: center;\n    }\n  \n    ").concat(this.props.rtlVerticalLayout?"\n    html {\n      writing-mode: vertical-rl;\n      direction: ltr;\n    }\n    ":"","\n\n    .t, p, div {\n      color: ").concat(getComputedStyle(document.body).getPropertyValue("--ion-text-color"),";\n      font-family: ").concat(getComputedStyle(document.body).getPropertyValue("--ion-font-family"),";\n      font-size: ").concat(this.props.fontSize,"px;\n    }\n    \n    /* Disable this to workaround epubjs page counting problem.\n    #back, #cbeta-copyright {\n      display: ").concat(this.props.showComments?"block":"none",";\n    }*/\n    ")),this.epub.writeEPUB((function(e){console.log("Error: ".concat(e))}),".","temp",Object(h.a)(p.a.mark((function e(){var t,a,o,s,i,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n(49),o=a.readFileSync("temp.epub"),r.book=Object(ae.b)(o.buffer,{openAs:"binary"}),r.rendition=r.book.renderTo("cbetarEPubView",{width:"100%",height:"100%",spread:"none",flow:r.props.paginated?"paginated":"scrolled",scrollbarWidth:V.scrollbarSizeIdToValue(r.props.scrollbarSize),defaultDirection:r.props.rtlVerticalLayout?"rtl":"ltr"}),r.rendition.on("selected",(function(e,t){r.epubcfiFromSelectedString=e})),r.rendition.on(ae.a.RENDITION.DISPLAYED,(function(){r.updatePageInfos()})),r.rendition.on(ae.a.VIEWS.RENDERED,(function(){r.updateEPubIframe()})),e.next=9,r.rendition.display(r.props.paginated?r.epubcfi:void 0);case 9:if(r.props.paginated){e.next=15;break}return e.next=12,null===(s=r.rendition)||void 0===s?void 0:s.next();case 12:return e.next=14,null===(i=r.rendition)||void 0===i?void 0:i.next();case 14:r.updateEPubIframe();case 15:if(r.setState({isLoading:!1}),r.hasBookmark)try{null===(c=r.rendition)||void 0===c||c.annotations.highlight(r.epubcfi)}catch(l){console.error(l)}null===(t=r.book)||void 0===t||t.locations.generate(150);case 18:case"end":return e.stop()}}),e)}))));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateEPubIframe",value:function(){var e,t=document.getElementsByTagName("iframe");1===t.length?(this.ePubIframe=t[0],null===(e=this.ePubIframe.contentDocument)||void 0===e||e.addEventListener("keyup",this.keyListener.bind(this),!1),this.ePubIframe.contentWindow.loadTwKaiFont=oe,this.ePubIframe.contentWindow.loadTwKaiFont()):t.length>1?alert("Error! This component locates ePub iframe by the only iframe."):console.error("ePub iframes count is 0.")}},{key:"updatePageInfos",value:function(){var e,t=(null===(e=this.rendition)||void 0===e?void 0:e.currentLocation()).start.displayed;this.setState({currentPage:t.page,pageCount:t.total})}},{key:"getSelectedString",value:function(){var e,t,n="",a=null===(e=this.ePubIframe)||void 0===e||null===(t=e.contentDocument)||void 0===t?void 0:t.getSelection();return((null===a||void 0===a?void 0:a.rangeCount)||0)>0&&a.getRangeAt(0).toString().length>0&&(n=a.toString(),null===a||void 0===a||a.removeAllRanges()),n}},{key:"getRemainingWorkTextFromSelectedRange",value:function(){var e,t=this.ePubIframe.contentWindow.getSelection();if("Range"===t.type){var n=this.ePubIframe.contentDocument.getElementById("back"),a=t.getRangeAt(0);a.setEnd(n,0);var r=a.cloneContents();null===t||void 0===t||t.removeAllRanges();var o=new Document,s=o.createElement("html");o.appendChild(s),s.appendChild(r),V.removeElementsByClassName(o,"lb"),V.removeElementsByClassName(o,"doube-line-note"),e=o.getElementById("body").innerText}return e}},{key:"getAllTextNodes",value:function(e){return document.createTreeWalker(e,NodeFilter.SHOW_TEXT)}},{key:"findSearchTextRanges",value:function(e){this.searchTextRanges=[],this.showedSearchTextIndex=0;for(var t,n=this.ePubIframe.contentDocument.getElementById("body"),a=this.ePubIframe.contentWindow.getSelection(),r=this.getAllTextNodes(n),o=[];null!=(t=r.nextNode());){var s,i;"lb"!==(null===(s=t.parentElement)||void 0===s?void 0:s.className)&&""!==(null===(i=t.textContent)||void 0===i?void 0:i.replace(/[\r\n\t ]*/g,""))&&o.push(t)}var c=new Range;c.setStart(o[0],0);var l=o[o.length-1];c.setEnd(l,l.length),a.removeAllRanges(),a.addRange(c);var u=a.toString().replace(/[\n]/g,"");a.removeAllRanges();var p=[],h=0,d=1;do{if(-1===(d=u.indexOf(e,h)))break;h=d+e.length,p.push(d),p.push(d+e.length)}while(d<u.length-1);if(0!==p.length){var m=[],f=0;d=p.shift();for(var v=0;v<o.length;v++){for(var y=o[v],k=0;k<y.length&&(f!==d||(m.push({node:y,offset:k}),-1!==(d=p.shift()||-1)));k++)f++;if(-1===d)break}for(var g=0;g<m.length/2;g+=1){var b=new Range,w=m[2*g],E=m[2*g+1];b.setStart(w.node,w.offset),b.setEnd(E.node,E.offset),this.searchTextRanges.push(b)}}}},{key:"searchTextPrev",value:function(){this.showedSearchTextIndex>0&&this.showedSearchTextIndex--,this.moveToSearchText(this.showedSearchTextIndex)}},{key:"searchTextNext",value:function(){this.showedSearchTextIndex<this.searchTextRanges.length-1&&this.showedSearchTextIndex++,this.moveToSearchText(this.showedSearchTextIndex)}},{key:"moveToSearchText",value:function(e){var t=this;this.epubcfiFromSelectedString="";var n=this.ePubIframe.contentWindow.getSelection();n.removeAllRanges(),setTimeout((function(){var a,r,o=t.searchTextRanges[e];(t.ePubIframe.contentWindow.focus(),n.addRange(o),t.props.paginated)?a=setInterval((function(){var e;""!==t.epubcfiFromSelectedString&&(clearInterval(a),null===(e=t.rendition)||void 0===e||e.display(t.epubcfiFromSelectedString).then((function(){})))}),100):null===(r=o.startContainer.parentElement)||void 0===r||r.scrollIntoView()}),100)}},{key:"buttonPrev",value:function(){this.state.showSearchTextToast?this.searchTextPrev():this.pagePrev()}},{key:"buttonNext",value:function(){this.state.showSearchTextToast?this.searchTextNext():this.pageNext()}},{key:"render",value:function(){var e=this,t=o.a.createElement(k.g,null,o.a.createElement(k.H,null,o.a.createElement(k.E,{style:{fontSize:"var(--ui-font-size)"}}),o.a.createElement(k.c,{hidden:this.isTopPage,fill:"clear",slot:"start",onClick:function(t){return e.props.history.goBack()}},o.a.createElement(k.h,{icon:W.a,slot:"icon-only"})),o.a.createElement(k.c,{slot:"end",onClick:function(t){e.setState({showJumpPageAlert:!0})}},o.a.createElement("span",{className:"uiFont",style:{color:"var(--color)"}},"\u9801",this.state.currentPage,"/",this.state.pageCount)),o.a.createElement(k.c,{fill:"clear",slot:"end",onClick:function(t){var n,a,r,o=speechSynthesis.getVoices();if(0!==o.length)switch(e.state.speechState){case M.UNINITIAL:var s=o.find((function(e){return e.lang.indexOf("zh-TW")>-1||e.lang.indexOf("zh_TW")>-1}));void 0!==s&&(e.speechSynthesisUtterance.voice=s);var i=e.getRemainingWorkTextFromSelectedRange()||(null===(n=e.ePubIframe)||void 0===n||null===(a=n.contentDocument)||void 0===a||null===(r=a.getElementById("body"))||void 0===r?void 0:r.innerText)||"\u7121\u6cd5\u53d6\u5f97\u7d93\u6587\u5167\u5bb9";e.workTexts=[];for(var c=0;c<Math.ceil(i.length/e.maxCharsPerUtterance);c++)e.workTexts.push(i.substring(c*e.maxCharsPerUtterance,(c+1)*e.maxCharsPerUtterance));e.workTextsIndex=0,e.speechSynthesisUtterance.text=e.workTexts[e.workTextsIndex],e.speechSynthesisUtterance.rate=e.props.speechRate,speechSynthesis.cancel(),speechSynthesis.speak(e.speechSynthesisUtterance),e.setState({speechState:M.SPEAKING});break;case M.SPEAKING:speechSynthesis.cancel(),e.setState({speechState:M.UNINITIAL});break;case M.PAUSE:speechSynthesis.resume(),e.setState({speechState:M.SPEAKING})}}},o.a.createElement(k.h,{icon:this.state.speechState===M.SPEAKING?W.G:W.w,slot:"icon-only"})),o.a.createElement(k.c,{fill:"clear",slot:"end",onClick:function(t){return e.setState({popover:{show:!0,event:t.nativeEvent}})}},o.a.createElement(k.h,{ios:W.p,md:W.q,slot:"icon-only"})),o.a.createElement(k.r,{isOpen:this.state.popover.show,event:this.state.popover.event,onDidDismiss:function(t){e.setState({popover:{show:!1,event:null}})}},o.a.createElement(k.n,null,o.a.createElement(k.i,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}}),e.props.history.push("/catalog/work/".concat(e.props.match.params.work))}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.s,slot:"start"}),o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"}},"\u56de\u7d93\u76ee\u9304")),o.a.createElement(k.i,{button:!0,onClick:function(t){e.props.history.push("/".concat(e.props.match.params.tab)),e.setState({popover:{show:!1,event:null}})}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.s,slot:"start"}),o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"}},"\u56de\u9996\u9801")),o.a.createElement(k.i,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}}),e.addBookmarkHandler()}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.e,slot:"start"}),o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"}},"\u65b0\u589e\u66f8\u7c64")),o.a.createElement(k.i,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}}),e.setState({showSearchTextToast:!1,showSearchTextAlert:!0})}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.B,slot:"start"}),o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"}},"\u641c\u5c0b\u6587\u5b57")),o.a.createElement(k.i,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}}),e.setState({showSearchAlert:!0})}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.B,slot:"start"}),o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"}},"\u641c\u5c0b\u7d93\u66f8")),o.a.createElement(k.i,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}});var n=e.getSelectedString();""!==n?e.props.history.push({pathname:"/dictionary/search/".concat(n)}):e.setState({showNoSelectedTextAlert:!0})}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.d,slot:"start"}),o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"}},"\u67e5\u8a5e\u5178")),o.a.createElement(k.i,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}});var n=e.getSelectedString();""!==n?e.props.history.push({pathname:"/dictionary/searchWord/".concat(n)}):e.setState({showNoSelectedTextAlert:!0})}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.d,slot:"start"}),o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"}},"\u67e5\u5b57\u5178")),o.a.createElement(k.i,{button:!0,onClick:function(t){var n,a;e.setState({popover:{show:!1,event:null}}),null===(n=e.ePubIframe)||void 0===n||null===(a=n.contentWindow)||void 0===a||a.print()}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.x,slot:"start"}),o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"}},"\u5217\u5370")),o.a.createElement(k.i,{button:!0,onClick:function(t){var n,a;e.setState({popover:{show:!1,event:null}});var r=null===(n=e.ePubIframe)||void 0===n||null===(a=n.contentDocument)||void 0===a?void 0:a.getSelection();if((r.rangeCount||0)>0&&r.getRangeAt(0).toString().length>0){var o,s,i=r.toString(),c=r.getRangeAt(0),l=null===(o=c.startContainer.parentElement)||void 0===o?void 0:o.getAttribute("l"),u=null===(s=c.endContainer.parentElement)||void 0===s?void 0:s.getAttribute("l");if(null===r||void 0===r||r.removeAllRanges(),null==l||null==u)return void e.setState({showsCitationFail:!0});l=/0*(.*)/.exec(l)[1],u=/0*(.*)/.exec(u)[1];var p="".concat(l);l!==u&&(p+="-".concat(/.*a(.*)/.exec(u)[1]));var h="\u300a".concat(e.state.workInfo.title,"\u300b\u5377").concat(e.props.match.params.path,"\uff1a\u300c").concat(i,"\u300d(CBETA, ").concat(e.state.workInfo.vol,", no. ").concat(/[^0-9]*(.*)/.exec(e.state.workInfo.work)[1],", p. ").concat(p,")");navigator.clipboard&&navigator.clipboard.writeText(h),e.setState({showsCopyToClipboardSuccess:!0})}else e.setState({showNoSelectedTextAlert:!0})}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.F,slot:"start"}),o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"}},"\u5f15\u7528\u6587\u7ae0")),o.a.createElement(k.i,{button:!0,onClick:function(t){var n=window.location.href.split("?")[0];""!==e.getSelectedString()&&(n+="?bookmark=".concat(e.epubcfiFromSelectedString)),e.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(n)}})}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.F,slot:"start"}),o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"}},"\u5206\u4eab\u6b64\u9801")))))),n=o.a.createElement(o.a.Fragment,null,o.a.createElement(k.e,{vertical:"center",horizontal:"start",slot:"fixed"},o.a.createElement(k.f,{style:{opacity:.2},onClick:function(t){return e.props.rtlVerticalLayout?e.buttonNext():e.buttonPrev()},onTouchStart:function(e){e.currentTarget.style.setProperty("opacity","1")},onMouseOver:function(e){V.isTouchDevice()||e.currentTarget.style.setProperty("opacity","1")},onTouchEnd:function(e){e.currentTarget.style.setProperty("opacity","".concat(.2))},onMouseLeave:function(e){V.isTouchDevice()||e.currentTarget.style.setProperty("opacity","".concat(.2))}},o.a.createElement(k.h,{icon:W.a}))),o.a.createElement(k.e,{vertical:"center",horizontal:"end",slot:"fixed"},o.a.createElement(k.f,{style:{opacity:.2},onClick:function(t){return e.props.rtlVerticalLayout?e.buttonPrev():e.buttonNext()},onTouchStart:function(e){e.currentTarget.style.setProperty("opacity","1")},onMouseOver:function(e){V.isTouchDevice()||e.currentTarget.style.setProperty("opacity","1")},onTouchEnd:function(e){e.currentTarget.style.setProperty("opacity","".concat(.2))},onMouseLeave:function(e){V.isTouchDevice()||e.currentTarget.style.setProperty("opacity","".concat(.2))}},o.a.createElement(k.h,{icon:W.c}))));return this.bookCreated||null==this.state.htmlStr||this.html2Epub(),o.a.createElement(k.q,null,t,o.a.createElement(k.d,null,this.props.paginated||this.state.showSearchTextToast?n:o.a.createElement(o.a.Fragment,null),o.a.createElement(k.o,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return e.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."}),this.state.fetchError?V.fetchErrorContent:o.a.createElement(o.a.Fragment,null),o.a.createElement("div",{id:"cbetarEPubView",style:{width:"100%",height:"100%",userSelect:"text",WebkitUserSelect:"text"},dangerouslySetInnerHTML:{__html:"\n            ".concat(this.props.rtlVerticalLayout&&!this.props.paginated?"\n    <style>\n    .epub-view {\n      height: 100% !important;\n    }\n    </style>\n    ":"","\n            ")}}),o.a.createElement(k.a,{cssClass:"uiFont",isOpen:this.state.showJumpPageAlert,header:"\u8df3\u9801",subHeader:"\u8acb\u8f38\u5165\u9801\u78bc(1 - ".concat(this.state.pageCount,")"),inputs:[{name:"name0",type:"number",min:1,max:this.state.pageCount,value:this.state.currentPage}],buttons:[{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary uiFont",handler:function(){return e.setState({showJumpPageAlert:!1})}},{text:"\u78ba\u5b9a",cssClass:"primary uiFont",handler:function(t){e.setState({showJumpPageAlert:!1}),e.jumpToPage(t.name0)}}]}),o.a.createElement(H,Object(l.a)({showSearchAlert:this.state.showSearchAlert,finish:function(){e.setState({showSearchAlert:!1})}},this.props)),o.a.createElement(k.a,{cssClass:"uiFont",isOpen:this.state.showNoSelectedTextAlert,backdropDismiss:!1,header:"\u5931\u6557",message:"\u8acb\u78ba\u8a8d\u662f\u5426\u5df2\u9078\u64c7\u4e00\u6bb5\u6587\u5b57\uff0c\u7136\u5f8c\u518d\u57f7\u884c\u6240\u9078\u7684\u529f\u80fd!",buttons:[{text:"\u78ba\u5b9a",cssClass:"primary uiFont",handler:function(t){e.setState({showNoSelectedTextAlert:!1})}}]}),o.a.createElement(k.F,{cssClass:"uiFont",isOpen:this.state.showAddBookmarkSuccess,onDidDismiss:function(){return e.setState({showAddBookmarkSuccess:!1})},message:"\u66f8\u7c64\u65b0\u589e\u6210\u529f\uff01",duration:2e3}),o.a.createElement(k.F,{cssClass:"uiFont",isOpen:this.state.showsCopyToClipboardSuccess,onDidDismiss:function(){return e.setState({showsCopyToClipboardSuccess:!1})},message:"\u5df2\u8907\u88fd\u5230\u526a\u8cbc\u7c3f\uff01",duration:2e3}),o.a.createElement(k.F,{cssClass:"uiFont",isOpen:this.state.showsCitationFail,onDidDismiss:function(){return e.setState({showsCitationFail:!1})},message:"\u6240\u9078\u6587\u5b57\u7121\u6cd5\u5f15\u7528\uff01",duration:2e3}),o.a.createElement(k.a,{cssClass:"uiFont",isOpen:this.state.showSearchTextAlert,header:"\u641c\u5c0b\u6587\u5b57",subHeader:"\u6309\u4e0b\u641c\u5c0b\u5f8c\uff0c\u5de6\u53f3\u65b9\u5411\u9215\u8b8a\u70ba\u641c\u5c0b\u6587\u5b57\u65b9\u5411\u9215\u3002\u6309\u4e0b\u65b9\u901a\u77e5UI\u95dc\u9589\u9215\uff0c\u96e2\u958b\u641c\u5c0b\u6587\u5b57\u6a21\u5f0f\u3002",inputs:[{name:"name0",type:"search",placeholder:"\u4f8b:\u5982\u662f\u6211\u805e"}],buttons:[{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary uiFont",handler:function(){return e.setState({showSearchTextAlert:!1})}},{text:"\u641c\u5c0b",cssClass:"primary uiFont",handler:function(t){""!==t.name0?(e.findSearchTextRanges(t.name0),0===e.searchTextRanges.length?e.setState({showSearchTextAlert:!1,showToast:!0,toastMessage:"\u627e\u4e0d\u5230\u6587\u5b57\uff1a".concat(t.name0)}):(e.setState({showSearchTextAlert:!1,showSearchTextToast:!0,searchText:t.name0}),e.searchTextPrev())):e.setState({showSearchTextAlert:!1})}}]}),o.a.createElement(k.F,{cssClass:"uiFont",isOpen:this.state.showSearchTextToast,onDidDismiss:function(){return e.setState({showSearchTextToast:!1})},message:"\u641c\u5c0b\uff1a".concat(this.state.searchText),buttons:[{text:"\u95dc\u9589",role:"cancel",handler:function(){return e.setState({showSearchTextToast:!1})}}]}),o.a.createElement(k.F,{cssClass:"uiFont",isOpen:this.state.showToast,onDidDismiss:function(){return e.setState({showToast:!1})},message:this.state.toastMessage,duration:2e3})))}},{key:"fileName",get:function(){return V.getFileName(this.props.match.params.work,this.props.match.params.path)}},{key:"isTopPage",get:function(){return"/catalog"===this.props.match.url}},{key:"bookmark",get:function(){var e=this;return this.props.bookmarks.find((function(t){return t.type===R.JUAN&&t.uuid===e.uuidStr}))}},{key:"hasBookmark",get:function(){return""!==this.epubcfiFromUrl||null!=this.bookmark}},{key:"epubcfi",get:function(){return""!==this.epubcfiFromUrl?this.epubcfiFromUrl:null!=this.bookmark?this.bookmark.epubcfi:"epubcfi(/6/6[s1]!/4/4/2/6[body]/6,/1:0,/1:1)"}}]),a}(o.a.Component),le=Object(k.S)(ce),ue=Object(b.b)((function(e){return{bookmarks:e.settings.bookmarks,fontSize:e.settings.fontSize,showComments:e.settings.showComments,paginated:e.settings.paginated,rtlVerticalLayout:e.settings.rtlVerticalLayout,settings:e.settings,scrollbarSize:e.settings.scrollbarSize,speechRate:e.settings.speechRate}}))(le),pe=(n(397),n(398),n(399),n(400),n(401),n(402),n(403),n(404),n(405),n(406),n(407),n(408),n(121)),he=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).state={showFontLicense:!1,juansDownloadedRatio:0,showUpdateAllJuansDone:!1},a}return Object(m.a)(n,[{key:"updateBookmark",value:function(e,t){var n=e.findIndex((function(e){return e.uuid===t.uuid}));-1===n?console.error("Update bookmark fails! Can't find the original bookmark with UUID: ".concat(t.uuid)):e[n]=t}},{key:"updateAllJuans",value:function(){var e=Object(h.a)(p.a.mark((function e(){var t,n,a,r,o,s,i,c,l,u,h,d,m,f,v,y,k,g,b,w,E;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(this.setState({juansDownloadedRatio:0}),t=this.props.bookmarks.filter((function(e){return e.type===R.WORK})),n=this.props.bookmarks.filter((function(e){return e.type===R.JUAN})),a=n.filter((function(e){return-1===t.findIndex((function(t){var n,a;return(null===(n=t.work)||void 0===n?void 0:n.work)===(null===(a=e.work)||void 0===a?void 0:a.work)}))})),r=a.length,o=0;o<t.length;o++)s=t[o].work,r+=s.juan_list.split(",").length;i=0,c=0;case 8:if(!(c<t.length)){e.next=30;break}l=t[c],u=l.work,h=u.juan_list.split(","),d=0;case 13:if(!(d<h.length)){e.next=27;break}return m=h[d],i+=1,this.setState({juansDownloadedRatio:i/r}),e.next=19,V.fetchJuan(u.work,m,null,!0);case 19:f=e.sent,v=V.getFileName(u.work,m),V.saveFileToIndexedDB(v,f.htmlStr),0===d&&this.updateBookmark(this.props.bookmarks,Object.assign(l,{work:f.workInfo})),console.log("File saved: ".concat(v));case 24:d++,e.next=13;break;case 27:c++,e.next=8;break;case 30:y=0;case 31:if(!(y<a.length)){e.next=48;break}return i+=1,this.setState({juansDownloadedRatio:i/r}),k=a[y],g=k.work,e.next=38,V.fetchJuan(g.work,"".concat(g.juan),null,!0);case 38:b=e.sent,w=V.getFileName(g.work,"".concat(g.juan)),(E=b.workInfo).juan=g.juan,V.saveFileToIndexedDB(w,b.htmlStr),this.updateBookmark(this.props.bookmarks,Object.assign(k,{work:E})),console.log("File saved: ".concat(w));case 45:y++,e.next=31;break;case 48:this.props.dispatch({type:"UPDATE_BOOKMARKS",bookmarks:this.props.bookmarks}),this.setState({showUpdateAllJuansDone:!0});case 50:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return o.a.createElement(k.q,null,o.a.createElement(k.g,null,o.a.createElement(k.H,null,o.a.createElement(k.E,{style:{fontSize:"var(--ui-font-size)"}},"\u8a2d\u5b9a"))),o.a.createElement(k.d,null,o.a.createElement(k.n,null,o.a.createElement(k.i,null,o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.F,slot:"start"}),o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"}},"\u96fb\u5b50\u4f5b\u5178app\u7248\u672c: ",pe.version),o.a.createElement(k.c,{slot:"end",size:"large",style:{fontSize:"var(--ui-font-size)"},onClick:function(t){e.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:window.location.origin}})}},"\u5206\u4eab")),o.a.createElement(k.i,null,o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.y,slot:"start"}),o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"}},"\u6aa2\u67e5app\u66f4\u65b0 (\u82e5\u7121\u66f4\u65b0\u5247\u7121\u56de\u61c9)"),o.a.createElement(k.c,{slot:"end",size:"large",style:{fontSize:"var(--ui-font-size)"},onClick:function(e){V.updateApp()}},"\u6aa2\u67e5")),o.a.createElement(k.i,null,o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.f,slot:"start"}),o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"}},"\u555f\u7528app\u7570\u5e38\u8a18\u9304"),o.a.createElement(k.G,{slot:"end",checked:this.props.hasAppLog,onIonChange:function(t){var n=t.detail.checked;n?V.enableAppLog():V.disableAppLog(),e.props.dispatch({type:"SET_KEY_VAL",key:"hasAppLog",val:n})}})),o.a.createElement(k.i,{hidden:!this.props.hasAppLog},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.f,slot:"start"}),o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"}},"\u56de\u5831app\u7570\u5e38\u8a18\u9304"),o.a.createElement(k.c,{slot:"end",size:"large",style:{fontSize:"var(--ui-font-size)"},onClick:function(t){window.open("mailto:myh@live.com?subject=\u96fb\u5b50\u4f5b\u5178\u7570\u5e38\u8a18\u9304\u56de\u5831&body=".concat(encodeURIComponent("\u554f\u984c\u63cf\u8ff0(\u5efa\u8b70\u586b\u5beb)\uff1a\n\n\u700f\u89bd\u5668\uff1a"+navigator.userAgent+"\n\nApp\u7248\u672c\uff1a"+pe.version+"\n\nApp\u8a2d\u5b9a\uff1a"+JSON.stringify(e.props.settings)+"\n\nLog\uff1a\n"+V.getLog())))}},"\u56de\u5831")),o.a.createElement(k.i,null,o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.o,slot:"start"}),o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"}},"App\u8a2d\u5b9a"),o.a.createElement(k.c,{size:"large",style:{fontSize:"var(--ui-font-size)"},onClick:function(){var e=Object(h.a)(p.a.mark((function e(t){var n,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n="data:text/json;charset=utf-8,".concat(encodeURIComponent(localStorage.getItem("Settings.json")||"")),(a=document.createElement("a")).href=n,a.download="Settings.json",a.click(),a.remove();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},"\u532f\u51fa"),o.a.createElement("input",{id:"importJsonInput",type:"file",accept:".json",style:{display:"none"},onChange:function(){var t=Object(h.a)(p.a.mark((function t(n){var a,r,o;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=null===(a=n.target.files)||void 0===a?void 0:a.item(0),t.next=3,null===r||void 0===r?void 0:r.text();case 3:if(t.t0=t.sent,t.t0){t.next=6;break}t.t0="";case 6:o=t.t0;try{JSON.parse(o),localStorage.setItem("Settings.json",o),e.props.dispatch({type:"LOAD_SETTINGS"}),e.updateAllJuans()}catch(s){console.error(s),console.error((new Error).stack)}document.getElementById("importJsonInput").value="";case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}),o.a.createElement(k.c,{size:"large",style:{fontSize:"var(--ui-font-size)"},onClick:function(e){document.querySelector("#importJsonInput").click()}},"\u532f\u5165")),o.a.createElement(k.i,null,o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.y,slot:"start"}),o.a.createElement("div",{style:{width:"100%"}},o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"}},"\u66f4\u65b0\u96e2\u7dda\u7d93\u6587\u6a94"),o.a.createElement(k.s,{value:this.state.juansDownloadedRatio})),o.a.createElement(k.c,{slot:"end",size:"large",style:{fontSize:"var(--ui-font-size)"},onClick:function(){var t=Object(h.a)(p.a.mark((function t(n){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.updateAllJuans());case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},"\u66f4\u65b0"),o.a.createElement(k.F,{cssClass:"uiFont",isOpen:this.state.showUpdateAllJuansDone,onDidDismiss:function(){return e.setState({showUpdateAllJuansDone:!1})},message:"\u96e2\u7dda\u7d93\u6587\u6a94\u66f4\u65b0\u5b8c\u7562\uff01",duration:2e3})),o.a.createElement(k.i,null,o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.m,slot:"start"}),o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"}},"\u4f48\u666f\u4e3b\u984c"),o.a.createElement(k.z,{slot:"end",value:this.props.theme,style:{fontSize:"var(--ui-font-size)"},interface:"popover",interfaceOptions:{cssClass:"cbetar2themes"},onIonChange:function(t){var n=t.detail.value;e.props.dispatch({type:"SET_KEY_VAL",key:"theme",val:n}),document.body.classList.forEach((function(e){return document.body.classList.remove(e)})),document.body.classList.toggle("theme".concat(n),!0)}},o.a.createElement(k.A,{className:"cbeta",value:0},"CBETA"),o.a.createElement(k.A,{className:"dark",value:1},"\u6697\u8272"),o.a.createElement(k.A,{className:"light",value:2},"\u4eae\u8272"),o.a.createElement(k.A,{className:"oldPaper",value:3},"\u820a\u66f8"),o.a.createElement(k.A,{className:"marble",value:4},"\u5927\u7406\u77f3"))),o.a.createElement(k.i,null,o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.n,slot:"start"}),o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"}},"\u7d93\u6587\u76f4\u5f0f\u3001\u53f3\u81f3\u5de6\u66f8\u5beb"),o.a.createElement(k.G,{slot:"end",checked:this.props.rtlVerticalLayout,onIonChange:function(t){var n=t.detail.checked;e.props.dispatch({type:"SET_KEY_VAL",key:"rtlVerticalLayout",val:n})}})),o.a.createElement(k.i,null,o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.n,slot:"start"}),o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"}},"\u55ae\u9801/\u5206\u9801"),o.a.createElement(k.G,{slot:"end",checked:this.props.paginated,onIonChange:function(t){var n=t.detail.checked;e.props.dispatch({type:"SET_KEY_VAL",key:"paginated",val:n})}})),o.a.createElement(k.i,null,o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.n,slot:"start"}),o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"}},"\u55ae\u9801\u7d93\u6587\u6372\u8ef8\u5927\u5c0f"),o.a.createElement(k.z,{slot:"end",value:this.props.scrollbarSize,style:{fontSize:"var(--ui-font-size)"},interface:"popover",interfaceOptions:{cssClass:"uiFont"},onIonChange:function(t){var n=t.detail.value;e.props.dispatch({type:"SET_KEY_VAL",key:"scrollbarSize",val:n}),V.updateCssVars(e.props.settings)}},o.a.createElement(k.A,{value:0},"\u7121"),o.a.createElement(k.A,{value:1},"\u4e2d"),o.a.createElement(k.A,{value:2},"\u5927"))),o.a.createElement(k.i,null,o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.I,slot:"start"}),o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"}},"\u9ed1\u9ad4/\u6977\u66f8\u5b57\u9ad4(\u521d\u6b21\u8f09\u5165\u8981\u7b49\u5f85)"),o.a.createElement(k.G,{slot:"end",checked:this.props.useFontKai,onIonChange:function(t){var n=t.detail.checked;e.props.dispatch({type:"SET_KEY_VAL",key:"useFontKai",val:n}),V.updateCssVars(e.props.settings)}})),o.a.createElement(k.i,null,o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.I,slot:"start"}),o.a.createElement("div",{className:"contentBlock"},o.a.createElement("div",{style:{flexDirection:"column"}},o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"}},"UI\u5b57\u578b\u5927\u5c0f: ",this.props.uiFontSize),o.a.createElement(k.t,{min:10,max:64,value:this.props.uiFontSize,onIonChange:function(t){e.props.dispatch({type:"SET_KEY_VAL",key:"uiFontSize",val:t.detail.value}),V.updateCssVars(e.props.settings)}})))),o.a.createElement(k.i,null,o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.I,slot:"start"}),o.a.createElement("div",{className:"contentBlock"},o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"}},"\u7d93\u6587\u5b57\u578b\u5927\u5c0f: ",this.props.settings.fontSize),o.a.createElement(k.t,{min:10,max:64,value:this.props.settings.fontSize,onIonChange:function(t){e.props.dispatch({type:"SET_KEY_VAL",key:"fontSize",val:t.detail.value})}}))),o.a.createElement(k.i,null,o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.w,slot:"start"}),o.a.createElement("div",{className:"contentBlock"},o.a.createElement("div",{style:{flexDirection:"column"}},o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"}},"\u5408\u6210\u8a9e\u97f3\u8a9e\u901f: ",this.props.speechRate),o.a.createElement(k.t,{min:.1,max:1.5,step:.1,value:this.props.speechRate,onIonChange:function(t){e.props.dispatch({type:"SET_KEY_VAL",key:"speechRate",val:t.detail.value.toFixed(1)})}})))),o.a.createElement(k.i,null,o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.r,slot:"start"}),o.a.createElement("div",{style:{fontSize:"var(--ui-font-size)"}},o.a.createElement("div",null,"\u95dc\u65bc"),o.a.createElement("div",null,o.a.createElement("a",{href:"https://github.com/MrMYHuang/cbetar2#web-app",target:"_new"},"\u7a0b\u5f0f\u5b89\u88dd\u8aaa\u660e")),o.a.createElement("div",null,o.a.createElement("a",{href:"https://github.com/MrMYHuang/cbetar2",target:"_new"},"\u64cd\u4f5c\u8aaa\u660e\u8207\u958b\u653e\u539f\u59cb\u78bc")),o.a.createElement("div",null,"CBETA API\u7248\u672c: ",V.apiVersion),o.a.createElement("div",null,o.a.createElement("a",{href:"http://cbdata.dila.edu.tw/v1.2/",target:"_new"},"CBETA API\u53c3\u8003\u6587\u4ef6")),o.a.createElement("div",null,o.a.createElement("a",{href:"http://glossaries.dila.edu.tw/?locale=zh-TW",target:"_new"},"DILA \u4f5b\u5b78\u8853\u8a9e\u5b57\u8fad\u5178")),o.a.createElement("div",null,"\u4f5c\u8005: Meng-Yuan Huang"),o.a.createElement("div",null,o.a.createElement("a",{href:"mailto:myh@live.com",target:"_new"},"myh@live.com")),o.a.createElement("div",null,o.a.createElement("a",{href:"https://github.com/MrMYHuang/cbetar2#contributors",target:"_new"},"App\u76f8\u95dc\u8ca2\u737b\u8005")),o.a.createElement("div",null,o.a.createElement("a",{href:"/",onClick:function(t){t.preventDefault(),e.setState({showFontLicense:!0})}},"\u5168\u5b57\u5eab\u5b57\u578b\u7248\u6b0a\u8072\u660e")))),o.a.createElement(k.a,{cssClass:"uiFont",isOpen:this.state.showFontLicense,backdropDismiss:!1,message:"\u6b64app\u4f7f\u7528\u7684\u5168\u5b57\u5eab\u5b57\u578b(2020-08-18\u7248)\u7531\u570b\u5bb6\u767c\u5c55\u59d4\u54e1\u6703\u63d0\u4f9b\u3002\u6b64\u958b\u653e\u8cc7\u6599\u4f9d\u653f\u5e9c\u8cc7\u6599\u958b\u653e\u6388\u6b0a\u689d\u6b3e (Open Government Data License) \u9032\u884c\u516c\u773e\u91cb\u51fa\uff0c\u4f7f\u7528\u8005\u65bc\u9075\u5b88\u672c\u689d\u6b3e\u5404\u9805\u898f\u5b9a\u4e4b\u524d\u63d0\u4e0b\uff0c\u5f97\u5229\u7528\u4e4b\u3002\u653f\u5e9c\u8cc7\u6599\u958b\u653e\u6388\u6b0a\u689d\u6b3e\uff1ahttps://data.gov.tw/license",buttons:[{text:"\u95dc\u9589",cssClass:"primary uiFont",handler:function(t){e.setState({showFontLicense:!1})}},{text:"\u958b\u555f\u6388\u6b0a",cssClass:"secondary uiFont",handler:function(t){e.setState({showFontLicense:!1}),window.open("https://data.gov.tw/license")}}]}))))}}]),n}(o.a.Component),de=Object(b.b)((function(e){return{settings:e.settings,hasAppLog:e.settings.hasAppLog,theme:e.settings.theme,showComments:e.settings.showComments,paginated:e.settings.paginated,rtlVerticalLayout:e.settings.rtlVerticalLayout,scrollbarSize:e.settings.scrollbarSize,useFontKai:e.settings.useFontKai,uiFontSize:e.settings.uiFontSize,speechRate:e.settings.speechRate,bookmarks:e.settings.bookmarks}}))(he),me=o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{style:{fontSize:"var(--ui-font-size)",textAlign:"center"}},"\u53ef\u96e2\u7dda\u700f\u89bd\u5716\u793a ",o.a.createElement(k.h,{icon:W.o})),o.a.createElement("div",{style:{fontSize:"var(--ui-font-size)",textAlign:"center"}},o.a.createElement("a",{href:"https://github.com/MrMYHuang/cbetar2#bookmark",target:"_new"},"\u66f8\u7c64\u65b0\u589e\u8aaa\u660e")),o.a.createElement("div",{style:{fontSize:"var(--ui-font-size)",textAlign:"center"}},o.a.createElement("a",{href:"https://github.com/MrMYHuang/cbetar2#web-app",target:"_new"},"\u7a0b\u5f0f\u5b89\u88dd\u8aaa\u660e"))),fe=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).bookmarkListRef=void 0,a.state={reorder:!1,showToast:!1,toastMessage:""},a.bookmarkListRef=o.a.createRef(),a}return Object(m.a)(n,[{key:"ionViewWillEnter",value:function(){var e=G.a.parse(this.props.location.search);if(e.item&&e.item<this.props.bookmarks.length){var t,n,a=this.props.bookmarks[e.item];this.props.history.push("/catalog/juan/".concat(null===(t=a.work)||void 0===t?void 0:t.work,"/").concat(null===(n=a.work)||void 0===n?void 0:n.juan))}}},{key:"delBookmarkHandler",value:function(e){this.props.dispatch({type:"DEL_BOOKMARK",uuid:e})}},{key:"reorderBookmarks",value:function(e){var t=e.detail.complete(this.props.bookmarks);this.props.dispatch({type:"UPDATE_BOOKMARKS",bookmarks:t})}},{key:"render",value:function(){var e=this,t=this.props.bookmarks,n=Array();return t.forEach((function(t,a){var r,s,i,c,l,u,d="",m="".concat(t.selectedText),f=!1;switch(t.type){case R.CATALOG:d="/catalog/catalog/".concat(t.uuid);break;case R.WORK:d="/catalog/work/".concat(t.uuid);break;case R.JUAN:d="/catalog/juan/".concat(null===(r=t.work)||void 0===r?void 0:r.work,"/").concat(null===(s=t.work)||void 0===s?void 0:s.juan),m="".concat(null===(i=t.work)||void 0===i?void 0:i.title,"\u7b2c").concat(null===(c=t.work)||void 0===c?void 0:c.juan,"\u5377 - ").concat(m);break;case R.HTML:f=!0,d="/catalog/juan/".concat(null===(l=t.work)||void 0===l?void 0:l.work,"/1"),m="".concat(null===(u=t.work)||void 0===u?void 0:u.title," - ").concat(m)}n.push(o.a.createElement(k.l,{key:"bookmarkItemSliding_"+a},o.a.createElement(k.i,{key:"bookmarkItem_"+a,button:!0,onClick:function(){var n=Object(h.a)(p.a.mark((function n(a){var r;return p.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!e.state.reorder){n.next=3;break}return e.setState({showToast:!0,toastMessage:"\u8acb\u5148\u95dc\u9589\u6392\u5217\u529f\u80fd\uff0c\u624d\u53ef\u9ede\u64ca\u66f8\u7c64\uff01"}),n.abrupt("return");case 3:a.preventDefault(),e.props.history.push({pathname:d,state:{uuid:t.uuid},search:G.a.stringify(f?{file:t.fileName,title:null===(r=t.work)||void 0===r?void 0:r.title}:{})});case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"},key:"bookmarkItemLabel_"+a},m),t.type===R.CATALOG?"":o.a.createElement(k.h,{icon:W.o,slot:"end"}),o.a.createElement(k.u,{slot:"end"})),o.a.createElement(k.k,{side:"end"},o.a.createElement(k.j,{style:{fontSize:"var(--ui-font-size)"},color:"danger",onClick:function(n){var a;e.delBookmarkHandler(t.uuid),null===(a=e.bookmarkListRef.current)||void 0===a||a.closeSlidingItems()}},"\u522a\u9664"))))})),o.a.createElement(k.q,null,o.a.createElement(k.g,null,o.a.createElement(k.H,null,o.a.createElement(k.E,{style:{fontSize:"var(--ui-font-size)"}},"\u66f8\u7c64"),o.a.createElement(k.c,{fill:this.state.reorder?"solid":"clear",slot:"end",onClick:function(t){return e.setState({reorder:!e.state.reorder})}},o.a.createElement(k.h,{icon:W.H,slot:"icon-only"})))),o.a.createElement(k.d,null,this.hasBookmark?o.a.createElement(o.a.Fragment,null,o.a.createElement(k.n,{ref:this.bookmarkListRef},o.a.createElement(k.v,{disabled:!this.state.reorder,onIonItemReorder:function(t){e.reorderBookmarks(t)}},n)),me):o.a.createElement(k.m,{className:"contentCenter"},o.a.createElement("div",null,o.a.createElement("div",null,"\u7121\u66f8\u7c64"),o.a.createElement("div",{style:{fontSize:"var(--ui-font-size)",paddingTop:24,paddingBottom:24}},"\u8acb\u5207\u63db\u81f3",o.a.createElement("a",{href:"/catalog",target:"_self"},"\u76ee\u9304\u9801"),"\u65b0\u589e"),me)),o.a.createElement(k.F,{cssClass:"uiFont",isOpen:this.state.showToast,onDidDismiss:function(){return e.setState({showToast:!1})},message:this.state.toastMessage,duration:2e3})))}},{key:"hasBookmark",get:function(){return this.props.bookmarks.length>0}}]),n}(o.a.Component),ve=Object(k.S)(fe),ye=Object(b.b)((function(e){return{bookmarks:e.settings.bookmarks}}))(ve),ke=function e(t){var n;Object(d.a)(this,e),this.type=void 0,this.n=void 0,this.label=void 0,this.work=void 0,this.title=void 0,this.creators=void 0,this.type=t.type,this.n=t.n,this.label=t.label,this.work=t.work,this.title=t.title,this.creators=null!==(n=t.creators)&&void 0!==n?n:"\u7121"},ge=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).state={fetchError:!1,showSearchAlert:!1,searches:[]},a}return Object(m.a)(n,[{key:"ionViewWillEnter",value:function(){this.search(this.props.match.params.keyword)}},{key:"search",value:function(){var e=Object(h.a)(p.a.mark((function e(t){var n,a,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.axiosInstance.get("/toc?q=".concat(t),{responseType:"arraybuffer"});case 3:return n=e.sent,a=JSON.parse((new TextDecoder).decode(n.data)).results,r=a.map((function(e){return new ke(e)})),this.setState({searches:r}),e.abrupt("return",!0);case 10:return e.prev=10,e.t0=e.catch(0),console.error(e.t0),console.error((new Error).stack),this.setState({fetchError:!0}),e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getRows",value:function(){var e=this,t=Array();return this.state.searches.forEach((function(n,a){var r="catalog"===n.type,s=r?n.label:"".concat(n.title,"\n\u4f5c\u8005:").concat(n.creators),i="/".concat(e.props.match.params.tab)+(r?"/catalog/".concat(n.n):"/work/".concat(n.work));t.push(o.a.createElement(k.i,{key:"searchItem_"+a,button:!0,onClick:function(){var t=Object(h.a)(p.a.mark((function t(n){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.preventDefault(),e.props.history.push({pathname:i});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"},key:"searchLabel_"+a},s)))})),t}},{key:"render",value:function(){var e=this,t=this.getRows();return o.a.createElement(k.q,null,o.a.createElement(k.g,null,o.a.createElement(k.H,null,o.a.createElement(k.E,{style:{fontSize:"var(--ui-font-size)"}},"\u641c\u5c0b - ",this.props.match.params.keyword),o.a.createElement(k.c,{hidden:this.isTopPage,fill:"clear",slot:"start",onClick:function(t){return e.props.history.goBack()}},o.a.createElement(k.h,{icon:W.a,slot:"icon-only"})),o.a.createElement(k.c,{fill:"clear",slot:"end",onClick:function(t){return e.props.history.push("/".concat(e.props.match.params.tab))}},o.a.createElement(k.h,{icon:W.s,slot:"icon-only"})),o.a.createElement(k.c,{fill:"clear",slot:"end",onClick:function(t){return e.setState({showSearchAlert:!0})}},o.a.createElement(k.h,{icon:W.B,slot:"icon-only"})),o.a.createElement(k.c,{fill:"clear",slot:"end",onClick:function(t){e.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})}},o.a.createElement(k.h,{icon:W.F,slot:"icon-only"})))),o.a.createElement(k.d,null,this.state.fetchError?V.fetchErrorContent:o.a.createElement(k.n,null,t),o.a.createElement(H,Object(l.a)({showSearchAlert:this.state.showSearchAlert,finish:function(){e.setState({showSearchAlert:!1})}},this.props))))}},{key:"isTopPage",get:function(){return"/catalog"===this.props.match.url}}]),n}(o.a.Component),be=Object(k.S)(ge),we=Object(b.b)((function(e){return{}}))(be),Ee=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).searchBarRef=void 0,a.selectedTextBeforeIonPopover="",a.state={keyword:"",fetchError:!1,searches:[],showNoSelectedTextAlert:!1,popover:{show:!1,event:null}},a.searchBarRef=o.a.createRef(),a}return Object(m.a)(n,[{key:"ionViewWillEnter",value:function(){this.props.match.params.keyword&&(this.setState({keyword:this.props.match.params.keyword}),this.lookupDict(this.props.match.params.keyword))}},{key:"ionViewWillLeave",value:function(){}},{key:"lookupDict",value:function(){var e=Object(h.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.axiosInstance.get("".concat(V.dilaDictApiUrl,"/?type=match&dicts=dila&term=").concat(t),{responseType:"json"});case 3:n=e.sent,this.setState({searches:n.data}),e.next=13;break;case 7:return e.prev=7,e.t0=e.catch(0),console.error(e.t0),console.error((new Error).stack),this.setState({fetchError:!0}),e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getSelectedString",value:function(){var e=document.getSelection();return((null===e||void 0===e?void 0:e.rangeCount)||0)>0&&e.getRangeAt(0).toString().length>0?e.getRangeAt(0).toString():""}},{key:"getRows",value:function(){var e=this.state.searches,t=Array();return e.forEach((function(e,n){t.push(o.a.createElement("div",{style:{display:"table-row"},key:"dictItem"+n},o.a.createElement("div",{className:"tableCell"},o.a.createElement("div",{className:"ion-text-wrap textFont",style:{color:"var(--ion-color-primary)",paddingBottom:"18pt"},dangerouslySetInnerHTML:{__html:e.dict_name_zh}}),o.a.createElement("div",{className:"ion-text-wrap textFont",key:"dictItemLabel"+n,dangerouslySetInnerHTML:{__html:e.desc}}))))})),t}},{key:"render",value:function(){var e=this;return o.a.createElement(k.q,null,o.a.createElement(k.g,null,o.a.createElement(k.H,null,o.a.createElement(k.c,{hidden:this.isTopPage,fill:"clear",slot:"start",onClick:function(t){return e.props.history.goBack()}},o.a.createElement(k.h,{icon:W.a,slot:"icon-only"})),o.a.createElement(k.c,{slot:"start",onClick:function(t){e.props.history.push({pathname:"/dictionary/searchWord/"})}},o.a.createElement("span",{className:"uiFont",style:{color:"var(--color)"}},"\u4f5b\u5b78\u8a5e\u5178")),o.a.createElement(k.c,{fill:"clear",slot:"end",onClick:function(t){e.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})}},o.a.createElement(k.h,{icon:W.F,slot:"icon-only"})),o.a.createElement(k.c,{fill:"clear",slot:"end",onClick:function(t){e.selectedTextBeforeIonPopover=e.getSelectedString(),e.setState({popover:{show:!0,event:t.nativeEvent}})}},o.a.createElement(k.h,{ios:W.p,md:W.q,slot:"icon-only"})),o.a.createElement(k.r,{isOpen:this.state.popover.show,event:this.state.popover.event,onDidDismiss:function(t){e.selectedTextBeforeIonPopover="",e.setState({popover:{show:!1,event:null}})}},o.a.createElement(k.n,null,o.a.createElement(k.i,{button:!0,onClick:function(t){e.props.history.push("/".concat(e.props.match.params.tab)),e.setState({popover:{show:!1,event:null}})}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.s,slot:"start"}),o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"}},"\u56de\u9996\u9801")),o.a.createElement(k.i,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}}),""!==e.selectedTextBeforeIonPopover?e.props.history.push({pathname:"/dictionary/search/".concat(e.selectedTextBeforeIonPopover)}):e.setState({showNoSelectedTextAlert:!0})}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.d,slot:"start"}),o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"}},"\u67e5\u8a5e\u5178")),o.a.createElement(k.i,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}}),""!==e.selectedTextBeforeIonPopover?e.props.history.push({pathname:"/dictionary/searchWord/".concat(e.selectedTextBeforeIonPopover)}):e.setState({showNoSelectedTextAlert:!0})}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.d,slot:"start"}),o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"}},"\u67e5\u5b57\u5178")))))),o.a.createElement(k.d,null,o.a.createElement(k.y,{ref:this.searchBarRef,placeholder:"\u8acb\u8f38\u5165\u5b57\u8a5e\uff0c\u518d\u6309\u9375\u76e4Enter\u9375",value:this.state.keyword,onIonChange:function(t){e.setState({keyword:t.detail.value})},onIonClear:function(t){e.setState({searches:[]})},onKeyUp:function(t){"Enter"===t.key&&e.props.history.push({pathname:"/dictionary/search/".concat(e.state.keyword)})}}),this.state.fetchError?V.fetchErrorContent:o.a.createElement("div",{style:{display:"table"}},this.getRows()),o.a.createElement("div",{style:{fontSize:"var(--ui-font-size)",textAlign:"center"}},o.a.createElement("a",{href:"https://github.com/MrMYHuang/cbetar2#dictionary",target:"_new"},"\u4f5b\u5b78\u8a5e\u5178\u8aaa\u660e")),o.a.createElement(k.a,{cssClass:"uiFont",isOpen:this.state.showNoSelectedTextAlert,backdropDismiss:!1,header:"\u5931\u6557",message:"\u8acb\u78ba\u8a8d\u662f\u5426\u5df2\u9078\u64c7\u4e00\u6bb5\u6587\u5b57\uff0c\u7136\u5f8c\u518d\u57f7\u884c\u6240\u9078\u7684\u529f\u80fd!",buttons:[{text:"\u78ba\u5b9a",cssClass:"primary uiFont",handler:function(t){e.setState({showNoSelectedTextAlert:!1})}}]})))}},{key:"isTopPage",get:function(){return this.props.match.url==="/".concat(this.props.match.params.tab)}}]),n}(o.a.Component),Se=Object(k.S)(Ee),xe=Object(b.b)((function(e){return{}}))(Se),Te=function e(t){Object(d.a)(this,e),this.id=void 0,this.term_hits=void 0,this.work=void 0,this.juan=void 0,this.title=void 0,this.creators=void 0,this.id=t.id,this.term_hits=t.term_hits,this.work=t.work,this.juan=t.juan,this.title=t.title,this.creators=t.creators},Ce=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).state={fetchError:!1,showSearchAlert:!1,searches:[]},a}return Object(m.a)(n,[{key:"ionViewWillEnter",value:function(){this.search(this.props.match.params.keyword)}},{key:"search",value:function(){var e=Object(h.a)(p.a.mark((function e(t){var n,a,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.axiosInstance.get("/sphinx?q=".concat(t),{responseType:"arraybuffer"});case 3:return n=e.sent,a=JSON.parse((new TextDecoder).decode(n.data)).results,r=a.map((function(e){return new Te(e)})),this.setState({searches:r}),e.abrupt("return",!0);case 10:return e.prev=10,e.t0=e.catch(0),console.error(e.t0),console.error((new Error).stack),this.setState({fetchError:!0}),e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getRows",value:function(){var e=this,t=Array();return this.state.searches.forEach((function(n,a){var r="".concat(n.title,"\u5377").concat(n.juan,"\n\u4f5c\u8005:").concat(n.creators),s="/catalog/juan/".concat(n.work,"/").concat(n.juan);t.push(o.a.createElement(k.i,{key:"searchItem_"+a,button:!0,onClick:function(){var t=Object(h.a)(p.a.mark((function t(n){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.preventDefault(),e.props.history.push({pathname:s});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"},key:"searchLabel_"+a},r)))})),t}},{key:"render",value:function(){var e=this,t=this.getRows();return o.a.createElement(k.q,null,o.a.createElement(k.g,null,o.a.createElement(k.H,null,o.a.createElement(k.E,{style:{fontSize:"var(--ui-font-size)"}},"\u5168\u6587\u6aa2\u7d22 - ",this.props.match.params.keyword),o.a.createElement(k.c,{hidden:this.isTopPage,fill:"clear",slot:"start",onClick:function(t){return e.props.history.goBack()}},o.a.createElement(k.h,{icon:W.a,slot:"icon-only"})),o.a.createElement(k.c,{fill:"clear",slot:"end",onClick:function(t){return e.props.history.push("/".concat(e.props.match.params.tab))}},o.a.createElement(k.h,{icon:W.s,slot:"icon-only"})),o.a.createElement(k.c,{fill:"clear",slot:"end",onClick:function(t){return e.setState({showSearchAlert:!0})}},o.a.createElement(k.h,{icon:W.B,slot:"icon-only"})),o.a.createElement(k.c,{fill:"clear",slot:"end",onClick:function(t){e.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})}},o.a.createElement(k.h,{icon:W.F,slot:"icon-only"})))),o.a.createElement(k.d,null,this.state.fetchError?V.fetchErrorContent:o.a.createElement(k.n,null,t),o.a.createElement(H,Object(l.a)({showSearchAlert:this.state.showSearchAlert,finish:function(){e.setState({showSearchAlert:!1})}},this.props))))}},{key:"isTopPage",get:function(){return"/catalog"===this.props.match.url}}]),n}(o.a.Component),je=Object(k.S)(Ce),Ae=Object(b.b)((function(e){return{}}))(je),Ie=n(207),Oe=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(m.a)(n,[{key:"updateQrCode",value:function(){navigator.clipboard&&navigator.clipboard.writeText(this.props.text);var e=document.getElementById("qrcCanvas");return Ie.toCanvas(e,this.props.text),e}},{key:"render",value:function(){var e=this;return o.a.createElement(k.p,{isOpen:this.props.showModal,cssClass:"uiFont",swipeToClose:!0,onWillPresent:function(){return e.updateQrCode()},onDidDismiss:function(){return e.props.finish()}},o.a.createElement(k.d,null,o.a.createElement("div",{style:{display:"flex",flexDirection:"column",height:"100%",alignItems:"center"}},o.a.createElement("div",null,o.a.createElement(k.m,{className:"uiFont"},"\u6b64\u9801app\u9023\u7d50\u5df2\u8907\u88fd\u81f3\u526a\u8cbc\u7c3f\uff01")),o.a.createElement("div",null,o.a.createElement(k.m,{className:"uiFont"},"\u4e5f\u53ef\u4ee5\u4f7f\u7528QR Code\u5206\u4eab:")),o.a.createElement("div",{style:{flexGrow:1,display:"flex",alignItems:"center"}},o.a.createElement("canvas",{id:"qrcCanvas",width:"500",height:"500",style:{margin:"0px auto"}})),o.a.createElement("div",null,o.a.createElement(k.c,{size:"large",onClick:function(){return e.props.finish()}},"\u95dc\u9589")))))}}]),n}(o.a.Component);!function(e){e.NOUN="\u540d",e.VERB="\u52d5"}(ie||(ie={}));var Ne=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).searchBarRef=void 0,a.selectedTextBeforeIonPopover="",a.state={keyword:"",search:null,fetchError:!1,showNoSelectedTextAlert:!1,popover:{show:!1,event:null}},a.searchBarRef=o.a.createRef(),a}return Object(m.a)(n,[{key:"ionViewWillEnter",value:function(){this.props.match.params.keyword&&(this.setState({keyword:this.props.match.params.keyword}),this.lookupDict(this.props.match.params.keyword))}},{key:"ionViewWillLeave",value:function(){}},{key:"lookupDict",value:function(){var e=Object(h.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.axiosInstance.get("https://www.moedict.tw/uni/".concat(t.substring(0,1)),{responseType:"json"});case 3:n=e.sent,this.setState({search:n.data.heteronyms}),e.next=13;break;case 7:return e.prev=7,e.t0=e.catch(0),console.error(e.t0),console.error((new Error).stack),this.setState({fetchError:!0}),e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getSelectedString",value:function(){var e=document.getSelection();return((null===e||void 0===e?void 0:e.rangeCount)||0)>0&&e.getRangeAt(0).toString().length>0?e.getRangeAt(0).toString():""}},{key:"defToView",value:function(e,t){return void 0!==e&&e.length>0?o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{key:ne.a(),style:{color:"var(--ion-color-primary)"}},t),o.a.createElement("ol",{key:ne.a()},null===e||void 0===e?void 0:e.map((function(e){var t,n,a;return o.a.createElement("li",{key:ne.a()},o.a.createElement("div",{key:ne.a()},e.def),null===(t=e.quote)||void 0===t?void 0:t.map((function(e){return o.a.createElement("div",{key:ne.a()},e)})),null===(n=e.example)||void 0===n?void 0:n.map((function(e){return o.a.createElement("div",{key:ne.a()},e)})),null===(a=e.link)||void 0===a?void 0:a.map((function(e){return o.a.createElement("div",{key:ne.a()},e)})))})))):o.a.createElement(o.a.Fragment,null)}},{key:"render",value:function(){var e,t=this,n=[];this.props.match.params.keyword&&(null===(e=this.state.search)||void 0===e||e.forEach((function(e){var a=null===e||void 0===e?void 0:e.definitions.filter((function(e){return e.type===ie.NOUN})),r=null===e||void 0===e?void 0:e.definitions.filter((function(e){return e.type===ie.VERB})),s=null===e||void 0===e?void 0:e.definitions.filter((function(e){return void 0===e.type})),i=t.defToView(a,"\u540d\u8a5e"),c=t.defToView(r,"\u52d5\u8a5e"),l=t.defToView(s,"");n.push(o.a.createElement("div",{key:ne.a(),className:"textFont textSelectable"},o.a.createElement("div",{key:ne.a(),className:"textFontX3"},t.props.match.params.keyword.substring(0,1)),(null===e||void 0===e?void 0:e.bopomofo)?o.a.createElement("div",null,"\u6ce8\u97f3\uff1a",null===e||void 0===e?void 0:e.bopomofo):null,(null===e||void 0===e?void 0:e.pinyin)?o.a.createElement("div",null,"\u62fc\u97f3\uff1a",null===e||void 0===e?void 0:e.pinyin):null,i,c,l))})));return o.a.createElement(k.q,null,o.a.createElement(k.g,null,o.a.createElement(k.H,null,o.a.createElement(k.c,{hidden:this.isTopPage,fill:"clear",slot:"start",onClick:function(e){return t.props.history.goBack()}},o.a.createElement(k.h,{icon:W.a,slot:"icon-only"})),o.a.createElement(k.c,{slot:"start",onClick:function(e){t.props.history.push({pathname:"/dictionary/"})}},o.a.createElement("span",{className:"uiFont",style:{color:"var(--color)"}},"\u840c\u5178\u5b57\u5178")),o.a.createElement(k.c,{fill:"clear",slot:"end",onClick:function(e){t.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})}},o.a.createElement(k.h,{icon:W.F,slot:"icon-only"})),o.a.createElement(k.c,{fill:"clear",slot:"end",onClick:function(e){t.selectedTextBeforeIonPopover=t.getSelectedString(),t.setState({popover:{show:!0,event:e.nativeEvent}})}},o.a.createElement(k.h,{ios:W.p,md:W.q,slot:"icon-only"})),o.a.createElement(k.r,{isOpen:this.state.popover.show,event:this.state.popover.event,onDidDismiss:function(e){t.setState({popover:{show:!1,event:null}}),t.selectedTextBeforeIonPopover=""}},o.a.createElement(k.n,null,o.a.createElement(k.i,{button:!0,onClick:function(e){t.props.history.push("/".concat(t.props.match.params.tab)),t.setState({popover:{show:!1,event:null}})}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.s,slot:"start"}),o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"}},"\u56de\u9996\u9801")),o.a.createElement(k.i,{button:!0,onClick:function(e){t.setState({popover:{show:!1,event:null}}),""!==t.selectedTextBeforeIonPopover?t.props.history.push({pathname:"/dictionary/search/".concat(t.selectedTextBeforeIonPopover)}):t.setState({showNoSelectedTextAlert:!0})}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.d,slot:"start"}),o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"}},"\u67e5\u8a5e\u5178")),o.a.createElement(k.i,{button:!0,onClick:function(e){t.setState({popover:{show:!1,event:null}}),""!==t.selectedTextBeforeIonPopover?t.props.history.push({pathname:"/dictionary/searchWord/".concat(t.selectedTextBeforeIonPopover)}):t.setState({showNoSelectedTextAlert:!0})}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.d,slot:"start"}),o.a.createElement(k.m,{className:"ion-text-wrap",style:{fontSize:"var(--ui-font-size)"}},"\u67e5\u5b57\u5178")))))),o.a.createElement(k.d,null,o.a.createElement(k.y,{ref:this.searchBarRef,placeholder:"\u8acb\u8f38\u5165\u5b57\uff0c\u518d\u6309\u9375\u76e4Enter\u9375",value:this.state.keyword,onIonChange:function(e){t.setState({keyword:e.detail.value})},onIonClear:function(e){t.setState({search:null})},onKeyUp:function(e){"Enter"===e.key&&t.props.history.push({pathname:"/dictionary/searchWord/".concat(t.state.keyword)})}}),this.state.fetchError?V.fetchErrorContent:n,o.a.createElement(k.a,{cssClass:"uiFont",isOpen:this.state.showNoSelectedTextAlert,backdropDismiss:!1,header:"\u5931\u6557",message:"\u8acb\u78ba\u8a8d\u662f\u5426\u5df2\u9078\u64c7\u4e00\u6bb5\u6587\u5b57\uff0c\u7136\u5f8c\u518d\u57f7\u884c\u6240\u9078\u7684\u529f\u80fd!",buttons:[{text:"\u78ba\u5b9a",cssClass:"primary uiFont",handler:function(e){t.setState({showNoSelectedTextAlert:!1})}}]})))}},{key:"isTopPage",get:function(){return this.props.match.url==="/".concat(this.props.match.params.tab)}}]),n}(o.a.Component),ze=Object(k.S)(Ne),Fe=Object(b.b)((function(e){return{}}))(ze),_e=function(){var e=localStorage.getItem(V.storeFile);return null!=e?Object(w.c)(K,JSON.parse(e)):Object(w.c)(K)}(),Be=_e.getState();Be.settings.hasAppLog||V.disableAppLog(),Object(k.R)({mode:"md",swipeBackEnabled:!1});var Pe={onSuccess:function(e){},onUpdate:function(e){}},Le=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(m.a)(n,[{key:"render",value:function(){return o.a.createElement(b.a,{store:_e},o.a.createElement(Re,this.props))}}]),n}(o.a.Component),De=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).registrationNew=void 0,a.wakeLock=void 0,a.registrationNew=null,document.body.classList.forEach((function(e){return document.body.classList.remove(e)})),document.body.classList.toggle("theme".concat(Be.settings.theme),!0),V.updateCssVars(Be.settings),a.state={showUpdateAlert:!1},Pe.onUpdate=function(e){a.registrationNew=e,a.setState({showUpdateAlert:!0})},Pe.onSuccess=function(e){},speechSynthesis.getVoices(),speechSynthesis.cancel(),a.wakeLockScreen(),a.loadTwKaiFont(),a}return Object(m.a)(n,[{key:"loadTwKaiFont",value:function(){var e=Object(h.a)(p.a.mark((function e(){var t,n,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=indexedDB.open(V.cbetardb)).onupgradeneeded=function(e){e.target.result.createObjectStore("store")},e.next=4,new Promise((function(e,a){t.onsuccess=function(){var a=Object(h.a)(p.a.mark((function a(r){var o,s,i;return p.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:o=t.result,s=o.transaction(["store"],"readwrite"),(i=s.objectStore("store").get(V.twKaiFontKey)).onsuccess=function(){var t=Object(h.a)(p.a.mark((function t(a){var r,s;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=i.result){t.next=9;break}return t.next=4,V.axiosInstance.get("".concat(window.location.origin,"/").concat(V.twKaiFontPath),{responseType:"arraybuffer",timeout:0});case 4:r=t.sent,s=o.transaction(["store"],"readwrite"),n=r.data,s.objectStore("store").put(n,V.twKaiFontKey).onsuccess=function(t){return e()};case 9:return t.abrupt("return",e());case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();case 4:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}()}));case 4:return a=new window.FontFace("Kai",n),e.next=7,a.load();case 7:document.fonts.add(a),console.log("[Main] TW-Kai font loading success!");case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"wakeLockScreen",value:function(){var e=Object(h.a)(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,void 0===(t=navigator.wakeLock)){e.next=7;break}return e.next=5,t.request("screen");case 5:this.wakeLock=e.sent,console.log("Auto screen lock is disabled.");case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("".concat(e.t0.name,", ").concat(e.t0.message));case 12:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"routeByQueryString",value:function(){console.log(window.location.search);var e=/route=([^&]*)/.exec(window.location.search),t=/query=([^&]*)/.exec(window.location.search);if(null!==e){var n="";return null!==t&&(n=decodeURIComponent(t[1])),o.a.createElement(y.a,{to:e[1]+n})}if("/"===window.location.pathname)return o.a.createElement(y.a,{to:"/bookmarks"})}},{key:"render",value:function(){var e,t,n=this;return o.a.createElement(k.b,{style:V.isTouchDevice()?{height:"".concat(window.innerHeight,"px")}:{}},o.a.createElement(g.a,null,o.a.createElement(k.D,null,o.a.createElement(k.x,{animated:!1},o.a.createElement(y.b,{path:"/:tab(catalog)/webview/:work/:path/:label",render:function(e){return o.a.createElement(ue,e)},exact:!0}),o.a.createElement(y.b,{path:"/:tab(catalog)/juan/:work/:path/",render:function(e){return o.a.createElement(ue,e)},exact:!0}),o.a.createElement(y.b,{path:"/:tab(catalog)/work/:path/:label",component:function(e){return o.a.createElement(ee,e)},exact:!0}),o.a.createElement(y.b,{path:"/:tab(catalog)/work/:path",component:function(e){return o.a.createElement(ee,e)},exact:!0}),o.a.createElement(y.b,{path:"/:tab(catalog)/search/:keyword",render:function(e){return o.a.createElement(we,e)},exact:!0}),o.a.createElement(y.b,{path:"/:tab(catalog)/fulltextsearch/:keyword",render:function(e){return o.a.createElement(Ae,e)},exact:!0}),o.a.createElement(y.b,{path:"/:tab(catalog)/catalog/:path/:label",component:function(e){return o.a.createElement(X,e)},exact:!0}),o.a.createElement(y.b,{path:"/:tab(catalog)/catalog/:path",component:function(e){return o.a.createElement(X,Object.assign({key:e.match.url},e))},exact:!0}),o.a.createElement(y.b,{path:"/:tab(catalog)",component:function(e){return o.a.createElement(X,e)},exact:!0}),o.a.createElement(y.b,{path:"/:tab(bookmarks)",component:ye,exact:!0}),o.a.createElement(y.b,{path:"/:tab(bookmarks)/search/:keyword",render:function(e){return o.a.createElement(we,e)},exact:!0}),o.a.createElement(y.b,{path:"/:tab(dictionary)",render:function(e){return o.a.createElement(xe,e)},exact:!0}),o.a.createElement(y.b,{path:"/:tab(dictionary)/search/:keyword",render:function(e){return o.a.createElement(xe,Object.assign({key:e.match.url},e))},exact:!0}),o.a.createElement(y.b,{path:"/:tab(dictionary)/searchWord",render:function(e){return o.a.createElement(Fe,Object.assign({key:e.match.url},e))},exact:!0}),o.a.createElement(y.b,{path:"/:tab(dictionary)/searchWord/:keyword",render:function(e){return o.a.createElement(Fe,Object.assign({key:e.match.url},e))},exact:!0}),o.a.createElement(y.b,{path:"/settings",component:de}),o.a.createElement(y.b,{path:"/",render:function(){return n.routeByQueryString()},exact:!0})),o.a.createElement(k.B,{slot:"bottom"},o.a.createElement(k.C,{tab:"bookmarks",href:"/bookmarks"},o.a.createElement(k.h,{icon:W.e})),o.a.createElement(k.C,{tab:"catalog",href:"/catalog"},o.a.createElement(k.h,{icon:W.t})),o.a.createElement(k.C,{tab:"dictionay",href:"/dictionary"},o.a.createElement(k.h,{icon:W.d})),o.a.createElement(k.C,{tab:"settings",href:"/settings"},o.a.createElement(k.h,{icon:W.E}))))),o.a.createElement(k.a,{cssClass:"uiFont",isOpen:this.state.showUpdateAlert,backdropDismiss:!1,onDidPresent:function(e){var t,a,r,o;null===(t=n.registrationNew)||void 0===t||null===(a=t.installing)||void 0===a||a.postMessage({type:"SKIP_WAITING"}),null===(r=n.registrationNew)||void 0===r||null===(o=r.waiting)||void 0===o||o.postMessage({type:"SKIP_WAITING"})},header:"\u767c\u73feapp\u66f4\u65b0\uff0c\u907f\u514d\u904b\u4f5c\u7570\u5e38\uff0c\u8acb\u91cd\u555fapp\u6216\u95dc\u9589\u76f8\u95dc\u5206\u9801!\u7136\u5f8c\u53ef\u81f3\u8a2d\u5b9a\u9801\u6aa2\u67e5\u7248\u672c\u865f\u3002",buttons:[{text:"\u95dc\u9589",cssClass:"primary uiFont",handler:function(e){n.setState({showUpdateAlert:!1})}},{text:"\u986f\u793a\u7248\u672c\u6b77\u53f2",cssClass:"secondary uiFont",handler:function(e){window.open("https://github.com/MrMYHuang/cbetar2#history")}}]}),o.a.createElement(Oe,Object(l.a)({text:null===(e=this.props.shareTextModal)||void 0===e?void 0:e.text,showModal:(null===(t=this.props.shareTextModal)||void 0===t?void 0:t.show)||!1,finish:function(){_e.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!1}})}},this.props)))}}]),n}(o.a.Component),Re=Object(b.b)((function(e){return{shareTextModal:e.tmpSettings.shareTextModal}}))(De),Ve=Object(y.f)(Le),Ue=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Ke(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){console.log("installingWorker stage changed: ".concat(n.state)),"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}V.enableAppLog(),i.a.render(o.a.createElement(c.a,null,o.a.createElement(Ve,null)),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("","/service-worker.js");Ue?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):Ke(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):Ke(t,e)}))}}({onSuccess:function(e){console.log("Precache app loaded!"),Pe.onSuccess(e)},onUpdate:function(e){console.log("Found app updated!"),Pe.onUpdate(e)}})}},[[211,3,4]]]);
//# sourceMappingURL=main.43101d1a.chunk.js.map