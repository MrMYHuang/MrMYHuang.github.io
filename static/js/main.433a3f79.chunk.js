(this.webpackJsonpcbetar2=this.webpackJsonpcbetar2||[]).push([[1],{129:function(e){e.exports=JSON.parse('{"name":"cbetar2","productName":"\u96fb\u5b50\u4f5b\u5178","pwaVersion":"4.23.7","version":"13.1.0","license":"MIT","keywords":["CBETA","\u96fb\u5b50\u4f5b\u5178","\u4f5b\u5178","\u4f5b\u7d93","\u5927\u85cf\u7d93","Tripitaka","Buddhist Canon","Buddhist text"],"description":"CBETA\u96fb\u5b50\u4f5b\u5178\u95b1\u8b80\u56682(\u975e\u5b98\u65b9)\uff0c\u4f7f\u7528CBETA API\u5b58\u53d6\u96fb\u5b50\u4f5b\u7d93\u3002","repository":"https://github.com/MrMYHuang/cbetar2","author":{"name":"Meng-Yuan Huang","email":"myh@live.com"},"private":false,"files":["README.md"],"main":"buildElectron/main.js","scripts":{"postinstall":"electron-builder install-app-deps","start":"react-app-rewired start","build":"react-app-rewired build && powershell -file CopyBuild.ps1","build_linux":"react-app-rewired build && ./CopyBuild.sh","test":"react-app-rewired test","eject":"react-scripts eject","build-electron":"tsc -b tsconfigElectron.json","build-electron-store":"tsc -b tsconfigElectron.json && mv buildElectron/mainStore.js buildElectron/main.js","start-electron":"npm run build-electron && electron .","dist-win":"npm run build-electron && electron-builder -w -c electronBuilderConfigs/win.json","dist-deb":"npm run build-electron && electron-builder -l deb -c electronBuilderConfigs/deb.json","dist-rpm":"npm run build-electron && electron-builder -l rpm -c electronBuilderConfigs/rpm.json","dist-snap":"npm run build-electron && rm -f dist/*.snap && electron-builder -l snap -c electronBuilderConfigs/snap.json","publish-snap":"snapcraft upload --release=stable dist/*.snap","dist-mac":"npm run build-electron && electron-builder -m pkg -c electronBuilderConfigs/mac.json","icons-mas":"cd buildElectron && iconutil -c icns icon.iconset","dist-mas":"npm run build-electron-store && electron-builder -m mas -c electronBuilderConfigs/mas.json","dist-mas-dev":"npm run build-electron-store && electron-builder -m mas-dev -c electronBuilderConfigs/masDev.json"},"eslintConfig":{"extends":"react-app"},"dependencies":{"@types/semver":"^7.3.4","axios":"^0.21.1","electron-window-state":"^5.0.3","libxslt-myh":"^0.9.7","node-downloader-helper":"^1.0.17","semver":"^7.3.4"},"devDependencies":{"@ionic/react":"^5.5.3","@ionic/react-router":"^5.5.3","@testing-library/jest-dom":"^5.11.4","@testing-library/react":"^11.1.0","@testing-library/user-event":"^12.6.2","@types/jest":"^26.0.15","@types/libxmljs":"^0.18.6","@types/node":"^12.19.15","@types/qrcode":"^1.3.5","@types/react":"^16.9.53","@types/react-dom":"^16.9.8","@types/react-redux":"^7.1.16","@types/react-router":"^5.1.8","@types/react-router-dom":"^5.1.6","@types/uuid":"^8.3.0","customize-cra":"^1.0.0","electron":"^11.2.1","electron-builder":"^22.9.1","electron-builder-notarize-pkg":"^1.2.0","epubjs-myh":"^0.3.112","history":"^4.10.1","ionicons":"^5.4.0","memfs":"^3.2.0","nodepub":"^2.2.0","qrcode":"^1.4.4","query-string":"^6.13.7","react":"^17.0.1","react-app-rewired":"^2.1.7","react-dom":"^17.0.1","react-redux":"^7.2.2","react-router":"^5.2.0","react-router-dom":"^5.2.0","react-scripts":"^4.0.1","redux":"^4.0.5","swiped-events-myh":"^1.2.0","typescript":"^4.1.3","uuid":"^8.3.1","workbox-background-sync":"^5.1.3","workbox-broadcast-update":"^5.1.3","workbox-cacheable-response":"^5.1.3","workbox-core":"^5.1.3","workbox-expiration":"^5.1.3","workbox-google-analytics":"^5.1.3","workbox-navigation-preload":"^5.1.3","workbox-precaching":"^5.1.3","workbox-range-requests":"^5.1.3","workbox-routing":"^5.1.3","workbox-strategies":"^5.1.3","workbox-streams":"^5.1.3"},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]}}')},145:function(e,t,n){},230:function(e,t,n){var s={"./ion-action-sheet.entry.js":[445,5],"./ion-alert.entry.js":[446,6],"./ion-app_8.entry.js":[447,7],"./ion-avatar_3.entry.js":[448,17],"./ion-back-button.entry.js":[449,18],"./ion-backdrop.entry.js":[450,43],"./ion-button_2.entry.js":[451,19],"./ion-card_5.entry.js":[452,20],"./ion-checkbox.entry.js":[453,21],"./ion-chip.entry.js":[454,22],"./ion-col_3.entry.js":[455,44],"./ion-datetime_3.entry.js":[456,10],"./ion-fab_3.entry.js":[457,23],"./ion-img.entry.js":[458,45],"./ion-infinite-scroll_2.entry.js":[459,46],"./ion-input.entry.js":[460,24],"./ion-item-option_3.entry.js":[461,25],"./ion-item_8.entry.js":[462,26],"./ion-loading.entry.js":[463,27],"./ion-menu_3.entry.js":[464,28],"./ion-modal.entry.js":[465,8],"./ion-nav_2.entry.js":[466,14],"./ion-popover.entry.js":[467,9],"./ion-progress-bar.entry.js":[468,29],"./ion-radio_2.entry.js":[469,30],"./ion-range.entry.js":[470,31],"./ion-refresher_2.entry.js":[471,11],"./ion-reorder_2.entry.js":[472,16],"./ion-ripple-effect.entry.js":[473,47],"./ion-route_4.entry.js":[474,32],"./ion-searchbar.entry.js":[475,33],"./ion-segment_2.entry.js":[476,34],"./ion-select_3.entry.js":[477,35],"./ion-slide_2.entry.js":[478,48],"./ion-spinner.entry.js":[479,13],"./ion-split-pane.entry.js":[480,49],"./ion-tab-bar_2.entry.js":[481,36],"./ion-tab_2.entry.js":[482,15],"./ion-text.entry.js":[483,37],"./ion-textarea.entry.js":[484,38],"./ion-toast.entry.js":[485,39],"./ion-toggle.entry.js":[486,12],"./ion-virtual-scroll.entry.js":[487,50]};function o(e){if(!n.o(s,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=s[e],o=t[0];return n.e(t[1]).then((function(){return n(o)}))}o.keys=function(){return Object.keys(s)},o.id=230,e.exports=o},232:function(e,t,n){var s={"./ion-icon.entry.js":[489,57]};function o(e){if(!n.o(s,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=s[e],o=t[0];return n.e(t[1]).then((function(){return n(o)}))}o.keys=function(){return Object.keys(s)},o.id=232,e.exports=o},266:function(e,t,n){},267:function(e,t,n){},308:function(e,t){},310:function(e,t){},344:function(e,t){},346:function(e,t){},362:function(e,t){},364:function(e,t){},386:function(e,t){},388:function(e,t){},394:function(e,t){},396:function(e,t){},421:function(e,t,n){},422:function(e,t,n){},443:function(e,t,n){"use strict";n.r(t);var s,o=n(0),r=n(2),a=n.n(r),i=n(68),c=n.n(i),l=n(95),h=n(5),u=n.n(h),p=n(10),d=n(18),b=n(4),j=n(6),f=n(12),v=n(13),x=n(19),g=n(1),m=n(213),k=n(24),y=n(49),O=n.n(y),w=n(55),S=n(25),T=n(215),C=n.n(T);!function(e){e[e.BY_CHAPTER=0]="BY_CHAPTER",e[e.BY_JUAN=1]="BY_JUAN"}(s||(s={}));var A=function e(t){Object(b.a)(this,e),this.title=void 0,this.juan=void 0,this.title=t.title,this.juan=t.juan},I=function e(t){Object(b.a)(this,e),this.title=void 0,this.juan=void 0,this.juan_list=void 0,this.mulu=void 0,this.work=void 0,this.vol=void 0,this.title=t.title,this.juan=t.juan,this.juan_list=t.juan_list,this.mulu=t.mulu,this.work=t.work,this.vol=t.vol},E="v1.2",F="https://cbdata.dila.edu.tw/".concat(E),L="cbetardb",N="Settings.json",D="",P=C.a.create({baseURL:F,timeout:5e3});function B(e){switch(e){case 0:return 0;case 1:return 20;case 2:return 40}}function _(e,t){return"".concat(e,"_juan").concat(t,".html")}function R(e){return M.apply(this,arguments)}function M(){return(M=Object(p.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=indexedDB.open(L),e.abrupt("return",new Promise((function(e,s){n.onsuccess=function(){var o=Object(p.a)(u.a.mark((function o(r){var a,i,c;return u.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:a=n.result,i=a.transaction(["store"],"readwrite"),(c=i.objectStore("store").get(t)).onsuccess=function(){var n=Object(p.a)(u.a.mark((function n(o){var r;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=c.result){n.next=5;break}return console.error("".concat(t," loading failed!")),console.error((new Error).stack),n.abrupt("return",s());case 5:return n.abrupt("return",e(r));case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();case 4:case"end":return o.stop()}}),o)})));return function(e){return o.apply(this,arguments)}}()})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(){return(V=Object(p.a)(u.a.mark((function e(t,n){var s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=indexedDB.open(L),e.abrupt("return",new Promise((function(e,o){s.onsuccess=function(){var r=Object(p.a)(u.a.mark((function r(a){var i,c,l;return u.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:i=s.result,c=i.transaction(["store"],"readwrite"),(l=c.objectStore("store").put(n,t)).onsuccess=function(t){return e()},l.onerror=function(e){return o()};case 5:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(){return(U=Object(p.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=indexedDB.open(L),e.abrupt("return",new Promise((function(e,s){try{n.onsuccess=function(o){var r=n.result.transaction(["store"],"readwrite");try{var a=r.objectStore("store").delete(t);a.onsuccess=function(t){return e()},a.onerror=function(e){return s()}}catch(i){console.error(i)}}}catch(o){s(o)}})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(){return K.apply(this,arguments)}function K(){return(K=Object(p.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=indexedDB.open(L),e.abrupt("return",new Promise((function(e,n){t.onsuccess=function(){var s=Object(p.a)(u.a.mark((function s(o){var r,a,i;return u.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:r=t.result,a=r.transaction(["store"],"readwrite"),(i=a.objectStore("store").clear()).onsuccess=function(t){return e()},i.onerror=function(e){return n()};case 5:case"end":return s.stop()}}),s)})));return function(e){return s.apply(this,arguments)}}()})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(){return(H=Object(p.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return localStorage.clear(),e.next=3,z();case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var W=window.electronBackendApi;function J(){return(J=Object(p.a)(u.a.mark((function e(t,n,s){var o,r,a,i,c,l,h,p,d,b,j,f,v,x,g=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=g.length>3&&void 0!==g[3]&&g[3],r=g.length>4&&void 0!==g[4]&&g[4],a=s||_(t,n),i=null,e.prev=4,e.next=7,R(a);case 7:i=e.sent,e.next=12;break;case 10:e.prev=10,e.t0=e.catch(4);case 12:if(c=localStorage.getItem(N),l=new I({}),c&&(p=JSON.parse(c).settings.bookmarks,h=p.find((function(e){return e.fileName===a||e.uuid===t}))),null===i||void 0===h||o){e.next=19;break}l=h.work,e.next=46;break;case 19:if(!s){e.next=28;break}return e.next=22,P.get("/".concat(s),{responseType:"arraybuffer"});case 22:d=e.sent,b=new TextDecoder,j=b.decode(d.data),i=j.includes("charset=big5")?new TextDecoder("big5").decode(d.data):j,e.next=41;break;case 28:if(!r){e.next=35;break}return null===W||void 0===W||W.send("toMain",{event:"fetchJuan",work:t,juan:n}),e.next=32,new Promise((function(e,t){null===W||void 0===W||W.receiveOnce("fromMain",(function(t){switch(t.event){case"fetchJuan":e(t)}}))}));case 32:f=e.sent,e.next=39;break;case 35:return e.next=37,P.get("/juans?edition=CBETA&work_info=1&work=".concat(t,"&juan=").concat(n),{responseType:"arraybuffer"});case 37:v=e.sent,f=JSON.parse((new TextDecoder).decode(v.data));case 39:i=f.results[0],l=f.work_info;case 41:(x=document.implementation.createHTMLDocument("")).body.innerHTML=i,i=(i=(i=(new XMLSerializer).serializeToString(x.body)).replace("<body","<div")).replace("/body>","/div>");case 46:return e.abrupt("return",{htmlStr:i,workInfo:l});case 47:case"end":return e.stop()}}),e,null,[[4,10]])})))).apply(this,arguments)}var Y=console.log.bind(console),G=console.error.bind(console);var q=window.webkit;function X(){return Object(g.S)("ios")&&"MacIntel"===navigator.platform}var Q,$={storeFile:N,fontSizeNorm:24,fontSizeLarge:48,getLog:function(){return D},enableAppLog:function(){console.log=function(){D+="----- Info ----\n",D+=Array.from(arguments)+"\n",Y.apply(console,arguments)},console.error=function(){D+="----- Error ----\n",D+=Array.from(arguments)+"\n",arguments[0].isAxiosError&&(D+="URL: ".concat(arguments[0].config.url,"\n")),G.apply(console,arguments)}},disableAppLog:function(){D="",console.log=Y,console.error=G},cbetardb:L,apiVersion:E,cbetaApiUrl:F,dilaDictApiUrl:"https://glossaries.dila.edu.tw/search.json",twKaiFontKey:"twKaiFont",twKaiFontPath:"/assets/TW-Kai-98_1.woff",axiosInstance:P,topCatalogsByCat:{CBETA:"CBETA \u90e8\u985e","Cat-T":"\u5927\u6b63\u85cf","Cat-X":"\u534d\u7e8c\u85cf","Cat-N":"\u5357\u50b3\u5927\u85cf\u7d93",others:"\u6b77\u4ee3\u85cf\u7d93\u88dc\u8f2f",modern:"\u8fd1\u4ee3\u65b0\u7de8\u6587\u737b"},topCatalogsByVol:{"Vol-T":"T \u5927\u6b63\u85cf","Vol-X":"X \u534d\u7e8c\u85cf","Vol-A":"A \u8d99\u57ce\u91d1\u85cf","Vol-K":"K \u9ad8\u9e97\u5927\u85cf\u7d93-\u65b0\u6587\u8c50\u7248","Vol-S":"S \u5b8b\u85cf\u907a\u73cd-\u65b0\u6587\u8c50\u7248","Vol-F":"F \u623f\u5c71\u77f3\u7d93","Vol-C":"C \u4e2d\u83ef\u5927\u85cf\u7d93-\u4e2d\u83ef\u66f8\u5c40\u7248","Vol-U":"U \u6d2a\u6b66\u5357\u85cf","Vol-P":"P \u6c38\u6a02\u5317\u85cf","Vol-J":"J \u5609\u8208\u85cf","Vol-L":"L \u4e7e\u9686\u5927\u85cf\u7d93-\u65b0\u6587\u8c50\u7248","Vol-G":"G \u4f5b\u6559\u5927\u85cf\u7d93","Vol-M":"M \u534d\u6b63\u85cf\u7d93-\u65b0\u6587\u8c50\u7248","Vol-D":"D \u570b\u5716\u5584\u672c","Vol-N":"N \u5357\u50b3\u5927\u85cf\u7d93(\u518a\u5225)","Vol-ZS":"ZS \u6b63\u53f2\u4f5b\u6559\u8cc7\u6599\u985e\u7de8","Vol-I":"I \u5317\u671d\u4f5b\u6559\u77f3\u523b\u62d3\u7247\u767e\u54c1","Vol-ZW":"ZW \u85cf\u5916\u4f5b\u6559\u6587\u737b","Vol-B":"B \u5927\u85cf\u7d93\u88dc\u7de8","Vol-GA":"GA \u4e2d\u570b\u4f5b\u5bfa\u53f2\u5fd7\u5f59\u520a","Vol-GB":"GB \u4e2d\u570b\u4f5b\u5bfa\u5fd7\u53e2\u520a","Vol-Y":"Y \u5370\u9806\u6cd5\u5e2b\u4f5b\u5b78\u8457\u4f5c\u96c6","Vol-LC":"LC \u5442\u6f82\u4f5b\u5b78\u8457\u4f5c\u96c6"},appSettings:{theme:"\u4f48\u666f\u4e3b\u984c",rtlVerticalLayout:"\u7d93\u6587\u76f4\u6392\u3001\u53f3\u81f3\u5de6\u66f8\u5beb",paginated:"\u55ae\u9801/\u5206\u9801",showComments:"\u986f\u793a\u7d93\u6587\u8a3b\u89e3\u3001\u7248\u6b0a",useFontKai:"\u9ed1\u9ad4/\u6977\u66f8\u5b57\u9ad4",uiFontSize:"UI\u5b57\u578b\u5927\u5c0f",fontSize:"\u7d93\u6587\u5b57\u578b\u5927\u5c0f",printStyle:"\u7d93\u6587\u5217\u5370\u6a23\u5f0f"},fetchErrorContent:Object(o.jsx)("div",{className:"contentCenter",children:Object(o.jsx)(g.o,{children:Object(o.jsxs)("div",{children:[Object(o.jsx)("div",{children:"\u9023\u7dda\u5931\u6557!"}),Object(o.jsxs)("div",{style:{fontSize:"var(--ui-font-size)",paddingTop:24},children:["\u5982\u679c\u554f\u984c\u6301\u7e8c\u767c\u751f\uff0c\u8acb\u57f7\u884c",Object(o.jsx)("a",{href:"/settings",target:"_self",children:"\u8a2d\u5b9a\u9801"}),"\u7684app\u7570\u5e38\u56de\u5831\u529f\u80fd\u3002"]})]})})}),updateApp:function(){return new Promise(function(){var e=Object(p.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:navigator.serviceWorker.getRegistrations().then(function(){var e=Object(p.a)(u.a.mark((function e(n){var s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(n.map((function(e){return e.update().then((function(e){return null!==e.installing||null!==e.waiting}))})));case 2:s=e.sent,t(s.reduce((function(e,t){return e||t}),!1));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},scrollbarSizeIdToValue:B,updateCssVars:function(e){var t=B(e.scrollbarSize);document.documentElement.style.cssText="--ion-font-family: ".concat(e.useFontKai?"Times, HeitiScoped, Kai":"Times, Heiti TC, Noto Sans CJK TC","; --scrollbar-size: ").concat(t,"px; --ui-font-size: ").concat(e.uiFontSize,"px; --text-font-size: ").concat(e.fontSize,"px")},isMacCatalyst:X,isTouchDevice:function(){return Object(g.S)("ios")&&!X()||Object(g.S)("android")},isStoreApps:function(){return Object(g.S)("pwa")||Object(g.S)("electron")},fetchJuan:function(e,t,n){return J.apply(this,arguments)},getFileName:_,getFileFromIndexedDB:R,saveFileToIndexedDB:function(e,t){return V.apply(this,arguments)},removeFileFromIndexedDB:function(e){return U.apply(this,arguments)},clearAppData:function(){return H.apply(this,arguments)},removeElementsByClassName:function(e,t){for(var n=e.getElementsByClassName(t);n.length>0;){var s;null===(s=n[0].parentNode)||void 0===s||s.removeChild(n[0])}},disableAndroidChromeCallout:function(e){return e.preventDefault(),e.stopPropagation(),!1},disableIosSafariCallout:function(e){var t=this.getSelection();if(((null===t||void 0===t?void 0:t.rangeCount)||0)>0){var n=null===t||void 0===t?void 0:t.getRangeAt(0);null===t||void 0===t||t.removeAllRanges(),setTimeout((function(){null===t||void 0===t||t.addRange(n)}),50)}},copyToClipboard:function(e){X()?q.messageHandlers.swiftCallbackHandler.postMessage({event:"copy",text:e}):navigator.clipboard&&navigator.clipboard.writeText(e)},zhVoices:function(){return speechSynthesis.getVoices().filter((function(e){return["zh-TW","zh_TW","zh-CN","zh_CN","zh-HK","zh_HK"].some((function(t){return e.localService&&e.lang.indexOf(t)>-1}))}))}};!function(e){e[e.CATALOG=0]="CATALOG",e[e.WORK=1]="WORK",e[e.JUAN=2]="JUAN",e[e.HTML=3]="HTML"}(Q||(Q={}));var Z=function e(t){Object(b.a)(this,e),this.type=Q.CATALOG,this.uuid="",this.work=null,this.selectedText="",this.epubcfi="",this.fileName="",this.type=t.type,this.uuid=t.uuid,this.work=t.work,this.selectedText=t.selectedText,this.epubcfi=t.epubcfi,this.fileName=t.fileName};var ee=Object(w.b)({settings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=Object(d.a)({},e);switch(t.type){case"LOAD_SETTINGS":n=JSON.parse(localStorage.getItem($.storeFile)).settings;break;case"SET_KEY_VAL":var s=t.key,o=t.val;switch(s){case"theme":document.body.classList.forEach((function(e){/theme/.test(e)&&document.body.classList.remove(e)})),document.body.classList.toggle("theme".concat(o),!0);break;case"printStyle":document.body.classList.forEach((function(e){/print/.test(e)&&document.body.classList.remove(e)})),document.body.classList.toggle("print".concat(o),!0)}n[s]=o,localStorage.setItem($.storeFile,JSON.stringify({settings:n}));break;case"ADD_BOOKMARK":var r=n.bookmarks,a=t.bookmark.fileName;null===a||""===a||r.some((function(e){return e.fileName===a}))||$.saveFileToIndexedDB(a,t.htmlStr),n.bookmarks=[].concat(Object(S.a)(n.bookmarks),[t.bookmark]),localStorage.setItem($.storeFile,JSON.stringify({settings:n}));break;case"DEL_BOOKMARK":var i=n.bookmarks,c=i.findIndex((function(e){return e.uuid===t.uuid}));if(-1!==c){var l=i.splice(c,1);if(1===l.length){var h=l[0],u=null==i.find((function(e){var t,n;return e.type===Q.WORK&&(null===(t=e.work)||void 0===t?void 0:t.work)===(null===(n=h.work)||void 0===n?void 0:n.work)}));if(u)switch(h.type){case Q.WORK:var p=h.work;if(null==p)break;for(var b=p.juan_list.split(","),j=function(e){var t=$.getFileName(p.work,b[e]);if(null==i.find((function(e){return e.type===Q.JUAN&&e.fileName===t})))try{$.removeFileFromIndexedDB(t)}catch(n){console.error(n)}},f=0;f<b.length;f++)j(f);break;case Q.JUAN:var v=h.fileName,x=null==i.find((function(e){return e.type===Q.JUAN&&e.fileName===v}));if(x)try{$.removeFileFromIndexedDB(v)}catch(y){console.error(y)}}}}n.bookmarks=Object(S.a)(i),localStorage.setItem($.storeFile,JSON.stringify({settings:n}));break;case"UPDATE_BOOKMARKS":n.bookmarks=t.bookmarks,localStorage.setItem($.storeFile,JSON.stringify({settings:n}));break;case"DEFAULT_SETTINGS":n={};default:0===Object.keys(n).length&&(n={});for(var g=["version","hasAppLog","theme","paginated","rtlVerticalLayout","scrollbarSize","useFontKai","fontSize","uiFontSize","showComments","printStyle","voiceURI","speechRate","bookmarks","dictionaryHistory","wordDictionaryHistory"],m=[1,1,0,1,1,2,1,32,24,0,0,null,.8,[],[],[]],k=0;k<g.length;k++)void 0===n[g[k]]&&(n[g[k]]=m[k])}return n},tmpSettings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=Object(d.a)({},e),s=t.key,o=t.val;switch(n[s]=o,t.type){case"TMP_SET_KEY_VAL":return n}return e}});var te,ne=n(7),se=(n(266),function e(t){Object(b.a)(this,e),this.n=void 0,this.nodeType=void 0,this.label=void 0,this.work=void 0,this.file=void 0,this.n=t.n,this.nodeType=t.node_type,this.label=t.label,this.work=t.work,this.file=t.file}),oe=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(){return Object(b.a)(this,n),t.apply(this,arguments)}return Object(j.a)(n,[{key:"render",value:function(){var e=this;return Object(o.jsx)(g.a,{cssClass:"uiFont",backdropDismiss:!1,isOpen:this.props.showSearchAlert,header:"\u641c\u5c0b\u7d93\u66f8",subHeader:"\u8f38\u5165\u641c\u5c0b",inputs:[{name:"name0",type:"search",placeholder:"\u4f8b:\u91d1\u525b\u822c\u82e5"}],buttons:[{text:"\u641c\u5c0b\u76ee\u9304",cssClass:"primary uiFont",handler:function(t){e.props.finish(),e.props.history.push("/catalog/search/".concat(t.name0))}},{text:"\u5168\u6587\u6aa2\u7d22",cssClass:"primary uiFont",handler:function(t){e.props.finish(),e.props.history.push("/catalog/fulltextsearch/".concat(t.name0))}},{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary uiFont",handler:function(){return e.props.finish()}}]})}}]),n}(a.a.Component),re=[{title:"\u822c\u82e5\u6ce2\u7f85\u871c\u591a\u5fc3\u7d93",url:"/catalog/juan/T0251/1"},{title:"\u91d1\u525b\u822c\u82e5\u6ce2\u7f85\u871c\u7d93",url:"/catalog/juan/T0235/1"},{title:"\u4f5b\u8aaa\u963f\u5f4c\u9640\u7d93",url:"/catalog/juan/T0366/1"},{title:"\u4f5b\u8aaa\u7121\u91cf\u58fd\u7d93\u5377\u4e0a",url:"/catalog/juan/T0360/1"},{title:"\u4f5b\u8aaa\u89c0\u7121\u91cf\u58fd\u4f5b\u7d93",url:"/catalog/juan/T0365/1"},{title:"\u85e5\u5e2b\u7409\u7483\u5149\u5982\u4f86\u672c\u9858\u529f\u5fb7\u7d93",url:"/catalog/juan/T0450/1"},{title:"\u4f5b\u8aaa\u89c0\u5f4c\u52d2\u83e9\u85a9\u4e0a\u751f\u515c\u7387\u5929\u7d93",url:"/catalog/juan/T0452/1"},{title:"\u4f5b\u8aaa\u5f4c\u52d2\u4e0b\u751f\u6210\u4f5b\u7d93",url:"/catalog/juan/T0454/1"},{title:"\u5730\u85cf\u83e9\u85a9\u672c\u9858\u7d93",url:"/catalog/juan/T0412/1"},{title:"\u5999\u6cd5\u84ee\u83ef\u7d93\u89c0\u4e16\u97f3\u83e9\u85a9\u666e\u9580\u54c1\u7d93",url:"/catalog/juan/T0262/7"},{title:"\u5927\u4f5b\u9802\u5982\u4f86\u5bc6\u56e0\u4fee\u8b49\u4e86\u7fa9\u8af8\u83e9\u85a9\u842c\u884c\u9996\u695e\u56b4\u7d93\u5377\u7b2c\u4e00",url:"/catalog/juan/T0945/1"},{title:"\u4f5b\u8aaa\u6cd5\u6ec5\u76e1\u7d93",url:"/catalog/juan/T0396/1"}],ae=window.electronBackendApi,ie=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var s;return Object(b.a)(this,n),(s=t.call(this,e)).state={topCatalogsType:0,fetchError:!1,catalogs:[],pathLabel:"",showSearchAlert:!1,isLoading:!1},s}return Object(j.a)(n,[{key:"ionViewWillEnter",value:function(){console.log("".concat(this.props.match.url," will enter."));var e=-1;switch(this.props.match.url){case"/catalog":e=0;break;case"/catalog/volumes":e=1;break;case"/catalog/famous":e=2;break;default:e=-1}this.setState({topCatalogsType:e}),this.fetchData(this.props.match.params.path)}},{key:"componentDidMount",value:function(){console.log("did mount: ".concat(this.props.match.url))}},{key:"fetchData",value:function(){var e=Object(p.a)(u.a.mark((function e(t){var n,s,o,r,a,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({isLoading:!0}),n=new Array,s="",e.t0=this.state.topCatalogsType,e.next=0===e.t0||1===e.t0?6:-1===e.t0?7:2===e.t0?33:35;break;case 6:return e.abrupt("return",this.fetchTopCatalogs(this.state.topCatalogsType));case 7:if(e.prev=7,!this.props.cbetaOfflineDbMode){e.next=15;break}return null===ae||void 0===ae||ae.send("toMain",{event:"fetchCatalog",path:t}),e.next=12,new Promise((function(e,t){null===ae||void 0===ae||ae.receiveOnce("fromMain",(function(t){switch(t.event){case"fetchCatalog":e(t)}}))}));case 12:o=e.sent,e.next=19;break;case 15:return e.next=17,$.axiosInstance.get("/catalog_entry?q=".concat(t),{responseType:"arraybuffer"});case 17:r=e.sent,o=JSON.parse((new TextDecoder).decode(r.data));case 19:return a=o.results,n=a.map((function(e){return new se(e)})),""!==this.parentPath(t)?s=o.label:(i=$.topCatalogsByCat[t],s=void 0!==i?i:$.topCatalogsByVol[t]),this.setState({fetchError:!1,isLoading:!1,catalogs:n,pathLabel:s}),e.abrupt("return",!0);case 27:return e.prev=27,e.t1=e.catch(7),console.error(e.t1),console.error((new Error).stack),this.setState({fetchError:!0,isLoading:!1,pathLabel:""}),e.abrupt("return",!1);case 33:return this.setState({fetchError:!1,isLoading:!1,pathLabel:""}),e.abrupt("break",35);case 35:case"end":return e.stop()}}),e,this,[[7,27]])})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchTopCatalogs",value:function(e){var t=Array(),n=e?$.topCatalogsByVol:$.topCatalogsByCat;return Object.keys(n).forEach((function(e){var s={n:e,nodeType:null,work:null,label:n[e],file:null};t.push(s)})),this.setState({fetchError:!1,isLoading:!1,catalogs:t,pathLabel:""}),!0}},{key:"parentPath",value:function(e){var t=e.split(".");return t.pop(),t.join(".")}},{key:"addBookmarkHandler",value:function(){this.props.dispatch({type:"ADD_BOOKMARK",bookmark:new Z({type:Q.CATALOG,uuid:this.props.match.params.path,selectedText:this.state.pathLabel,epubcfi:"",fileName:"",work:null})})}},{key:"delBookmarkHandler",value:function(){this.props.dispatch({type:"DEL_BOOKMARK",uuid:this.props.match.params.path})}},{key:"getRows",value:function(){var e=this,t=Array();return this.state.catalogs.forEach((function(n,s){var r="",a="html"===n.nodeType;r=a?"/catalog/juan/".concat(n.n,"/1"):null==n.work?"/catalog/catalog/".concat(n.n):"/catalog/work/".concat(n.work),t.push(Object(o.jsxs)(g.k,{button:!0,onClick:function(){var t=Object(p.a)(u.a.mark((function t(s){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:s.preventDefault(),e.props.history.push({pathname:r,search:O.a.stringify(a?{file:n.file,title:n.label}:{})});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:n.label},"".concat(n.n,"label")+s)]},"".concat(n.n,"item")+s))})),t}},{key:"getFamousJuanRows",value:function(){var e=this,t=Array();return re.forEach((function(n,s){var r=n.title,a=n.url;t.push(Object(o.jsxs)(g.k,{button:!0,onClick:function(){var t=Object(p.a)(u.a.mark((function t(n){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.props.history.push(a);case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:r},"famousItemLabel_"+s)]},"famousJuanItem_"+s))})),t}},{key:"render",value:function(){var e=this,t=Object(o.jsx)(g.p,{children:2===this.state.topCatalogsType?this.getFamousJuanRows():this.getRows()});return Object(o.jsxs)(g.s,{children:[Object(o.jsx)(g.g,{children:Object(o.jsxs)(g.J,{children:[Object(o.jsx)(g.c,{hidden:this.isTopCatalog,fill:"clear",slot:"start",onClick:function(t){return e.props.history.goBack()},children:Object(o.jsx)(g.h,{icon:ne.a,slot:"icon-only"})}),Object(o.jsxs)(g.B,{hidden:!this.isTopCatalog,slot:"start",value:this.state.topCatalogsType,className:"buttonRounded",interface:"popover",interfaceOptions:{cssClass:"cbetar2themes"},onIonChange:function(t){var n="";switch(t.detail.value){case 0:n="/catalog";break;case 1:n="/catalog/volumes";break;case 2:n="/catalog/famous";break;case-1:n=e.props.match.url}e.props.match.url!==n&&e.props.history.push(n)},children:[Object(o.jsx)(g.C,{className:"uiFont",value:0,children:"\u90e8\u5206\u985e"}),Object(o.jsx)(g.C,{className:"uiFont",value:1,children:"\u518a\u5206\u985e"}),Object(o.jsx)(g.C,{className:"uiFont",value:2,children:"\u77e5\u540d\u7d93\u5178"})]}),Object(o.jsx)(g.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(t){return e.fetchData(e.props.match.params.path)},children:Object(o.jsx)(g.h,{icon:ne.E,slot:"icon-only"})}),Object(o.jsx)(g.c,{hidden:this.isTopCatalog,fill:this.hasBookmark?"solid":"clear",slot:"end",onClick:function(t){return e.hasBookmark?e.delBookmarkHandler():e.addBookmarkHandler()},children:Object(o.jsx)(g.h,{icon:ne.g,slot:"icon-only"})}),Object(o.jsx)(g.c,{hidden:this.isTopCatalog,fill:"clear",slot:"end",onClick:function(t){return e.props.history.push("/".concat(e.props.match.params.tab))},children:Object(o.jsx)(g.h,{icon:ne.v,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"clear",slot:"end",onClick:function(t){return e.setState({showSearchAlert:!0})},children:Object(o.jsx)(g.h,{icon:ne.H,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"clear",slot:"end",onClick:function(t){e.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})},children:Object(o.jsx)(g.h,{icon:ne.L,slot:"icon-only"})})]})}),Object(o.jsxs)(g.d,{children:[this.state.fetchError?$.fetchErrorContent:Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)("div",{className:"uiFontX2",style:{color:"var(--ion-color-primary)"},children:this.state.pathLabel}),t]}),Object(o.jsx)(oe,Object(d.a)({},Object(d.a)({showSearchAlert:this.state.showSearchAlert,finish:function(){e.setState({showSearchAlert:!1})}},this.props))),Object(o.jsx)("div",{style:{fontSize:"var(--ui-font-size)",textAlign:"center"},children:Object(o.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2#bookmark",target:"_new",children:"\u66f8\u7c64\u8207\u96e2\u7dda\u700f\u89bd\u8aaa\u660e"})}),Object(o.jsx)("div",{style:{fontSize:"var(--ui-font-size)",textAlign:"center"},children:Object(o.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2#search",target:"_new",children:"\u641c\u5c0b\u7d93\u66f8\u6559\u5b78"})}),Object(o.jsx)(g.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return e.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."})]})]})}},{key:"isTopCatalog",get:function(){var e=this;return["/catalog","/catalog/volumes","/catalog/famous"].reduce((function(t,n){return t||n===e.props.match.url}),!1)}},{key:"hasBookmark",get:function(){var e=this;return null!=this.props.bookmarks.find((function(t){return t.type===Q.CATALOG&&t.uuid===e.props.match.params.path}))}}]),n}(a.a.Component),ce=Object(g.U)(ie),le=Object(k.b)((function(e){return{bookmarks:e.settings.bookmarks,state:e,cbetaOfflineDbMode:e.tmpSettings.cbetaOfflineDbMode}}))(ce),he=(n(145),window.electronBackendApi),ue=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var s;return Object(b.a)(this,n),(s=t.call(this,e)).fetchJuan="",s.state={work:null,showSearchAlert:!1,showAddBookmarkDone:!1,isLoading:!1,fetchError:!1},s}return Object(j.a)(n,[{key:"ionViewWillEnter",value:function(){this.fetchWork(this.props.match.params.path)}},{key:"componentDidMount",value:function(){}},{key:"fetchWork",value:function(){var e=Object(p.a)(u.a.mark((function e(t){var n,s,o,r,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setState({isLoading:!0}),!this.hasBookmark){e.next=5;break}n=this.bookmark.work,e.next=32;break;case 5:if(e.prev=5,!this.props.cbetaOfflineDbMode){e.next=13;break}return null===he||void 0===he||he.send("toMain",{event:"fetchWork",path:t}),e.next=10,new Promise((function(e,t){null===he||void 0===he||he.receiveOnce("fromMain",(function(t){switch(t.event){case"fetchWork":e(t)}}))}));case 10:s=e.sent,e.next=17;break;case 13:return e.next=15,$.axiosInstance.get("/works?work=".concat(t),{responseType:"arraybuffer"});case 15:o=e.sent,s=JSON.parse((new TextDecoder).decode(o.data));case 17:if(r=s.results,n=r[0],this.props.cbetaOfflineDbMode){e.next=24;break}return e.next=22,$.axiosInstance.get("/toc?work=".concat(t));case 22:a=e.sent,n.mulu=a.data.results[0].mulu.map((function(e){return new A(e)}));case 24:e.next=32;break;case 26:return e.prev=26,e.t0=e.catch(5),console.error(e.t0),console.error((new Error).stack),this.setState({fetchError:!0,isLoading:!1}),e.abrupt("return",!1);case 32:return this.setState({fetchError:!1,isLoading:!1,work:n}),e.abrupt("return",!0);case 34:case"end":return e.stop()}}),e,this,[[5,26]])})));return function(t){return e.apply(this,arguments)}}()},{key:"saveJuans",value:function(){var e=Object(p.a)(u.a.mark((function e(){var t,n,s,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.state.work,n=t.juan_list.split(","),s=0;case 3:if(!(s<n.length)){e.next=19;break}return this.fetchJuan=n[s],e.prev=5,e.next=8,$.fetchJuan(t.work,this.fetchJuan,null);case 8:o=e.sent,$.saveFileToIndexedDB($.getFileName(t.work,this.fetchJuan),o.htmlStr),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(5),console.error("Fetching juan ".concat(s," failed! ").concat(e.t0)),console.error((new Error).stack);case 16:s++,e.next=3;break;case 19:case"end":return e.stop()}}),e,this,[[5,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"addBookmarkHandler",value:function(){var e=Object(p.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.cbetaOfflineDbMode){e.next=3;break}return e.next=3,this.saveJuans();case 3:this.setState({showAddBookmarkDone:!0}),this.props.dispatch({type:"ADD_BOOKMARK",bookmark:new Z({type:Q.WORK,uuid:this.props.match.params.path,selectedText:this.state.work.title,epubcfi:"",fileName:"",work:this.state.work})});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"delBookmarkHandler",value:function(){this.props.dispatch({type:"DEL_BOOKMARK",uuid:this.props.match.params.path})}},{key:"getRowsByChapter",value:function(){for(var e=this,t=this.state.work,n=null===t||void 0===t?void 0:t.mulu,s=Array(),r=function(r){var a="/catalog/juan/".concat(null===t||void 0===t?void 0:t.work,"/").concat(n[r].juan);s.push(Object(o.jsxs)(g.k,{button:!0,onClick:function(){var t=Object(p.a)(u.a.mark((function t(n){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.preventDefault(),e.props.history.push({pathname:a});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:n[r].title},"chapterLabel"+r)]},"chapterItem"+r))},a=0;a<((null===n||void 0===n?void 0:n.length)||-1);a++)r(a);return s}},{key:"getRowsByJuan",value:function(){for(var e=this,t=this.state.work,n=Array(),s=null===t||void 0===t?void 0:t.juan_list.split(","),r=function(r){var a="/catalog/juan/".concat(null===t||void 0===t?void 0:t.work,"/").concat(s[r]);n.push(Object(o.jsxs)(g.k,{button:!0,onClick:function(){var t=Object(p.a)(u.a.mark((function t(n){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.preventDefault(),e.props.history.push({pathname:a});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsxs)(g.o,{className:"ion-text-wrap uiFont",children:["\u5377",s[r]]},"juanLabel"+r)]},"juanItem"+r))},a=0;a<((null===s||void 0===s?void 0:s.length)||-1);a++)r(a);return n}},{key:"render",value:function(){var e,t=this;return Object(o.jsxs)(g.s,{children:[Object(o.jsx)(g.g,{children:Object(o.jsxs)(g.J,{children:[Object(o.jsx)(g.c,{hidden:this.isTopPage,fill:"clear",slot:"start",onClick:function(e){return t.props.history.goBack()},children:Object(o.jsx)(g.h,{icon:ne.a,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"outline",shape:"round",size:"large",slot:"start",onClick:function(e){var n=t.props.workListType===s.BY_CHAPTER?s.BY_JUAN:s.BY_CHAPTER;t.props.dispatch({type:"TMP_SET_KEY_VAL",key:"workListType",val:n})},children:Object(o.jsx)("span",{className:"uiFont",style:{color:"var(--color)"},children:this.props.workListType===s.BY_CHAPTER?"\u5206\u54c1":"\u5206\u5377"})}),Object(o.jsx)(g.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(e){return t.fetchWork(t.props.match.params.path)},children:Object(o.jsx)(g.h,{icon:ne.E,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:this.hasBookmark?"solid":"clear",slot:"end",onClick:function(e){return t.hasBookmark?t.delBookmarkHandler():t.addBookmarkHandler()},children:Object(o.jsx)(g.h,{icon:ne.g,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"clear",slot:"end",onClick:function(e){return t.props.history.push("/".concat(t.props.match.params.tab))},children:Object(o.jsx)(g.h,{icon:ne.v,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"clear",slot:"end",onClick:function(e){return t.setState({showSearchAlert:!0})},children:Object(o.jsx)(g.h,{icon:ne.H,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"clear",slot:"end",onClick:function(e){t.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})},children:Object(o.jsx)(g.h,{icon:ne.L,slot:"icon-only"})})]})}),Object(o.jsxs)(g.d,{children:[Object(o.jsx)("div",{className:"uiFontX2",style:{color:"var(--ion-color-primary)"},children:null===(e=this.state.work)||void 0===e?void 0:e.title}),this.state.fetchError?$.fetchErrorContent:Object(o.jsx)(g.p,{children:this.props.workListType===s.BY_CHAPTER?this.getRowsByChapter():this.getRowsByJuan()}),Object(o.jsx)(oe,Object(d.a)({},Object(d.a)({showSearchAlert:this.state.showSearchAlert,finish:function(){t.setState({showSearchAlert:!1})}},this.props))),Object(o.jsx)(g.H,{cssClass:"uiFont",isOpen:this.state.showAddBookmarkDone,onDidDismiss:function(){return t.setState({showAddBookmarkDone:!1})},message:"\u66f8\u7c64\u65b0\u589e\u6210\u529f\uff01",duration:2e3}),Object(o.jsx)(g.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return t.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."})]})]})}},{key:"isTopPage",get:function(){return"/catalog"===this.props.match.url}},{key:"bookmark",get:function(){var e=this;return this.props.bookmarks.find((function(t){return t.type===Q.WORK&&t.uuid===e.props.match.params.path}))}},{key:"hasBookmark",get:function(){return null!=this.bookmark}}]),n}(a.a.Component),pe=Object(g.U)(ue),de=Object(k.b)((function(e){return{bookmarks:e.settings.bookmarks,workListType:void 0!==e.tmpSettings.workListType?e.tmpSettings.workListType:s.BY_JUAN,cbetaOfflineDbMode:e.tmpSettings.cbetaOfflineDbMode}}))(pe),be=n(17),je=n(491),fe=(n(267),n(99)),ve=n(219);function xe(){return ge.apply(this,arguments)}function ge(){return(ge=Object(p.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$.getFileFromIndexedDB($.twKaiFontKey);case 2:return t=e.sent,n=new window.FontFace("Kai",t),e.next=6,n.load();case 6:this.document.fonts.add(n);case 7:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function me(){var e=this;this.document.querySelectorAll(".pre .lb").forEach((function(t){var n=e.document.createElement("br");t.before(n)}))}function ke(){n(410)(this.window,this.document)}!function(e){e[e.UNINITIAL=0]="UNINITIAL",e[e.SPEAKING=1]="SPEAKING",e[e.PAUSE=2]="PAUSE"}(te||(te={}));var ye,Oe=function(e){Object(f.a)(s,e);var t=Object(v.a)(s);function s(e){var n;return Object(b.a)(this,s),(n=t.call(this,e)).htmlFile=void 0,n.htmlTitle=void 0,n.book=void 0,n.rendition=void 0,n.epub=void 0,n.displayed=void 0,n.cfiRange=void 0,n.speechSynthesisUtterance=void 0,n.currentWork="",n.uuidStr="",n.epubcfiFromUrl="",n.lastPage=0,n.epubcfiFromSelectedString="",n.bookCreated=!1,n.ePubIframe=null,n.pageWidth=0,n.pagesWidth=0,n.searchTextRanges=[],n.visibleTextNodes=[],n.visibleChars=[],n.isPageSearched=[],n.allTexts="",n.ePubIframeOffset=0,n.showedSearchTextIndex=0,n.maxCharsPerUtterance=1e3,n.workTexts=[],n.workTextsIndex=0,n.speechRepeatStart=void 0,n.speechRepeatEnd=void 0,n.state={isLoading:!1,fetchError:!1,workInfo:new I({}),htmlStr:null,currentPage:1,pageCount:1,showJumpPageAlert:!1,showNoSelectedTextAlert:!1,showSearchTextAlert:!1,searchText:"",showSearchTextToast:!1,showToast:!1,toastMessage:"",showSearchAlert:!1,popover:{show:!1,event:null},lookupDictPopover:{show:!1,data:[]},canTextToSpeech:"undefined"!==typeof SpeechSynthesisUtterance,speechState:te.UNINITIAL,isSpeechRepeatMode:!1,showSpeechRepeatStart:!1,showSpeechRepeatEnd:!1},n.htmlFile="",n.htmlTitle="",n.book=null,n.rendition=null,n.cfiRange="",n.speechSynthesisUtterance=null,n.state.canTextToSpeech&&(n.speechSynthesisUtterance=new SpeechSynthesisUtterance,n.speechSynthesisUtterance.onend=function(e){if(speechSynthesis.cancel(),n.state.speechState!==te.UNINITIAL){var t,s=n.workTextsIndex<n.workTexts.length-1,o=!n.state.isSpeechRepeatMode&&n.props.paginated&&n.state.currentPage<n.state.pageCount;if(s)n.workTextsIndex+=1;else{if(!o)return n.setState({speechState:te.UNINITIAL}),console.log("Stop work text to speech."),void(n.state.isSpeechRepeatMode&&n.playText2Speech());n.pageNext(),n.findTextsInPageAndChunking()}t=n.workTexts[n.workTextsIndex],n.speechSynthesisUtterance.text=t,speechSynthesis.speak(n.speechSynthesisUtterance),console.log("Play work text to speech part / page: ".concat(s?n.workTextsIndex:n.state.currentPage))}}),document.addEventListener("keydown",n.keyListener.bind(Object(be.a)(n)),!1),n}return Object(j.a)(s,[{key:"loadEpubCoverToMemFs",value:function(){var e=Object(p.a)(u.a.mark((function e(){var t,s,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(t=new Uint8Array(JSON.parse(localStorage.getItem("logo.png")||"[]"))).length){e.next=8;break}return e.next=4,$.axiosInstance.get("".concat(window.location.origin,"/assets/icon/icon.png"),{responseType:"arraybuffer"});case 4:s=e.sent,t=new Uint8Array(s.data),o=JSON.stringify(Array.from(t)),localStorage.setItem("logo.png",o);case 8:n(48).writeFileSync("logo.png",t);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"ionViewWillEnter",value:function(){var e=O.a.parse(this.props.location.search);this.htmlFile=e.file,this.htmlTitle=e.title,this.epubcfiFromUrl=e.bookmark||"";var t=this.props.location.state;this.uuidStr=t?t.uuid:"",this.currentWork!==this.workJuanId&&(this.currentWork=this.workJuanId,this.lastPage=0),this.fetchData()}},{key:"ionViewDidEnter",value:function(){}},{key:"ionViewWillLeave",value:function(){var e;this.state.canTextToSpeech&&speechSynthesis.cancel(),this.lastPage=this.state.currentPage,this.setState({htmlStr:null,currentPage:1,speechState:te.UNINITIAL,showSearchTextToast:!1}),null===(e=this.book)||void 0===e||e.destroy(),this.book=null,this.bookCreated=!1}},{key:"fetchData",value:function(){var e=Object(p.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({isLoading:!0}),e.prev=1,e.next=4,$.fetchJuan(this.props.match.params.work,this.props.match.params.path,this.htmlFile,!1,this.props.cbetaOfflineDbMode);case 4:return t=e.sent,e.next=7,this.loadEpubCoverToMemFs();case 7:this.setState({fetchError:!1,workInfo:t.workInfo,htmlStr:t.htmlStr}),e.next=15;break;case 10:e.prev=10,e.t0=e.catch(1),console.error(e.t0),console.error((new Error).stack),this.setState({isLoading:!1,fetchError:!0});case 15:case"end":return e.stop()}}),e,this,[[1,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"addBookmarkHandler",value:function(){var e=this.getSelectedString();if(""!==e){var t=je.a();this.props.dispatch({type:"ADD_BOOKMARK",htmlStr:this.state.htmlStr,bookmark:new Z({type:this.htmlFile?Q.HTML:Q.JUAN,uuid:t,selectedText:e,epubcfi:this.epubcfiFromSelectedString,fileName:this.props.cbetaOfflineDbMode?null:this.htmlFile||"".concat(this.props.match.params.work,"_juan").concat(this.props.match.params.path,".html"),work:Object.assign(this.state.workInfo,{title:this.htmlFile?this.htmlTitle:this.state.workInfo.title,juan:this.props.match.params.path})})}),this.setState({showToast:!0,toastMessage:"\u66f8\u7c64\u65b0\u589e\u6210\u529f\uff01"})}else this.setState({showNoSelectedTextAlert:!0})}},{key:"pagePrev",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.props.paginated&&this.state.currentPage>1&&(null===(e=this.rendition)||void 0===e||e.prev(t),this.setState({currentPage:this.state.currentPage-t}))}},{key:"pageNext",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.props.paginated&&this.state.currentPage<this.state.pageCount&&(null===(e=this.rendition)||void 0===e||e.next(t),this.setState({currentPage:this.state.currentPage+t}))}},{key:"jumpToPage",value:function(e){if(0!==e){e=isNaN(e)?1:Math.max(Math.min(this.state.pageCount,e),1);var t=this.state.currentPage,n=t<e?1:-1,s=Math.abs(e-t);1===n?this.pageNext(s):this.pagePrev(s)}}},{key:"keyListener",value:function(e){var t=e.keyCode||e.which;console.log(e.type),t===(this.props.rtlVerticalLayout?37:40)&&this.buttonNext(),t===(this.props.rtlVerticalLayout?39:38)&&this.buttonPrev(),("F3"===e.code||e.ctrlKey&&"f"===e.key.toLowerCase())&&(e.preventDefault(),this.setState({showSearchTextToast:!1,showSearchTextAlert:!0}))}},{key:"html2Epub",value:function(){var e=Object(p.a)(u.a.mark((function e(){var t,s,o=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.bookCreated=!0,this.epub=ve.document({id:"123-123456789",title:"Title",series:"",sequence:1,author:"Author",fileAs:"",genre:"genre",tags:"",copyright:"",publisher:"",published:"",language:"en",description:"A temp book.",contents:this.state.workInfo.title,source:"",images:["logo.png"]},"logo.png"),t=this.state.htmlStr,this.props.rtlVerticalLayout&&(t=(t=(t=(t=(t=t.replace(/(margin|border)-left/g,"$1-temp")).replace(/(margin|border)-bottom/g,"$1-left")).replace(/(margin|border)-right/g,"$1-bottom")).replace(/(margin|border)-top/g,"$1-right")).replace(/(margin|border)-temp/g,"$1-top")),s=t+"\n    <script>\n    <\/script>\n    ",this.epub.addSection("",s,!0,!1),"\n    html {\n      writing-mode: vertical-rl;\n      direction: ltr;\n    }\n    ",this.epub.addCSS("\n    @page {\n      size: A4;\n      margin: 0.5in;\n    }\n\n    /* For double side printing for book bundling. */\n    @page :left {\n      margin-right: 1in;\n    }\n\n    @page :right {\n      margin-left: 1in;\n    }\n\n    @media print {\n      body {\n        color: ".concat(getComputedStyle(document.body).getPropertyValue("--print-text-color")," !important;\n        background: ").concat(getComputedStyle(document.body).getPropertyValue("--print-background")," !important;\n        padding: 0 !important;\n        width: 100% !important;\n        height: 100% !important;\n        column-gap: unset !important;\n        column-width: unset !important;\n      }\n    }\n\n    html {\n      /*\n      Because different fonts have different line heights with 'line-height: normal,'\n      the content size of epubjs iframe changes after the fallback font is swapped with the web font.\n      Unfortunately, epubjs can't detect the size change and update the iframe.\n      This problem causes the total page count is incorrect.\n      Fortunately, we can set the line height based on the same font size as below.\n      */\n      line-height: 1.2;\n      -webkit-text-size-adjust: none;\n      text-size-adjust: none;\n    }\n\n    body {\n      color: ").concat(getComputedStyle(document.body).getPropertyValue("--ion-text-color"),";\n      background: ").concat(getComputedStyle(document.body).getPropertyValue("--ion-background-color"),";\n      /* Disable browser's swipe to forward / backward page navigation. */\n      overscroll-behavior-x: none;\n    }\n\n    @font-face {\n        font-family: 'Times';\n        src: local('Times New Roman');\n        unicode-range: U+0-007F;\n    }\n\n    /* Workaround parenthesis orientation problem of TW-Kai-98_1 on iOS Safari. */\n    @font-face {\n        font-family: HeitiScoped;\n        src: local('Heiti TC');\n        unicode-range: U+3008-301B, U+FF01-FF60;\n    }\n\n    .lb {\n      display: none\n    }\n\n    /* In-HTML anchor jumps don't update this.state.currentPage.\n    Thus, we disable them. */\n    .noteAnchor {\n      pointer-events: none;\n      text-decoration: inherit;\n      color: inherit;\n      cursor: auto;\n    }\n\n    .doube-line-note, .doube-line-note .t {\n      font-size: ").concat(.8*this.props.fontSize,'px;\n    }\n\n    .doube-line-note::before {\n      content: "\uff08";\n    }\n\n    .doube-line-note::after {\n      content: "\uff09";\n    }\n\n    .bip-table {\n      display: table;\n    }\n\n    .bip-table-row {\n      display: table-row;\n    }\n\n    .bip-table-cell {\n      display: table-cell;\n      border: 1px solid ').concat(getComputedStyle(document.body).getPropertyValue("--ion-text-color"),";\n      text-align: center;\n    }\n  \n    ").concat(this.props.rtlVerticalLayout?"\n    html {\n      writing-mode: vertical-rl;\n      direction: ltr;\n    }\n    ":"","\n\n    .t, p, div {\n      font-family: ").concat(getComputedStyle(document.body).getPropertyValue("--ion-font-family"),";\n      font-size: ").concat(this.props.fontSize,"px;\n    }\n\n    .bold {\n      font-weight: 700;\n    }\n    \n    #back, #cbeta-copyright {\n      display: ").concat(this.props.showComments?"block":"none",";\n    }\n    ")),this.epub.writeEPUB((function(e){console.log("Error: ".concat(e))}),".","temp",Object(p.a)(u.a.mark((function e(){var t,s,r,a,i,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=n(48),r=s.readFileSync("temp.epub"),o.book=Object(fe.b)(r.buffer,{openAs:"binary"}),o.rendition=o.book.renderTo("cbetarEPubView",{width:"100%",height:"100%",spread:"none",flow:o.props.paginated?"paginated":"scrolled",scrollbarWidth:$.scrollbarSizeIdToValue(o.props.scrollbarSize),defaultDirection:o.props.rtlVerticalLayout?"rtl":"ltr",afterScrolledTimeout:500}),o.rendition.on("selected",(function(e,t){o.epubcfiFromSelectedString=e})),o.rendition.on(fe.a.RENDITION.DISPLAYED,(function(){o.updatePageInfos()})),o.rendition.on(fe.a.VIEWS.RENDERED,(function(){o.updateEPubIframe()})),e.next=9,o.rendition.display(o.props.paginated?o.epubcfi:void 0);case 9:if(o.props.paginated){e.next=15;break}return e.next=12,null===(a=o.rendition)||void 0===a?void 0:a.next();case 12:return e.next=14,null===(i=o.rendition)||void 0===i?void 0:i.next();case 14:o.updateEPubIframe();case 15:if(0!==o.lastPage&&null==o.bookmark&&o.lastPage!==o.state.currentPage&&o.jumpToPage(o.lastPage),o.setState({isLoading:!1}),o.hasBookmark)try{null===(c=o.rendition)||void 0===c||c.annotations.highlight(o.epubcfi)}catch(l){console.error(l)}null===(t=o.book)||void 0===t||t.locations.generate(150);case 19:case"end":return e.stop()}}),e)}))));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateEPubIframe",value:function(){var e=this,t=document.getElementsByTagName("iframe");if(1===t.length){var n;this.ePubIframe=t[0],null===(n=this.ePubIframe.contentDocument)||void 0===n||n.addEventListener("keydown",this.keyListener.bind(this),!1);var s=this.ePubIframe.contentWindow;Object(g.S)("android")?s.window.oncontextmenu=$.disableAndroidChromeCallout:Object(g.S)("ios")&&(s.document.ontouchend=$.disableIosSafariCallout.bind(s)),this.props.useFontKai&&(s.loadTwKaiFont=xe,s.loadTwKaiFont()),s.addCbetaLineBreaks=me,s.addCbetaLineBreaks(),s.addSwpiedEvents=ke,s.addSwpiedEvents(),s.document.addEventListener("swiped",(function(t){if(e.props.paginated)if(e.props.rtlVerticalLayout)switch(t.detail.dir){case"left":e.pagePrev();break;case"right":e.pageNext()}else switch(t.detail.dir){case"down":e.pagePrev();break;case"up":e.pageNext()}})),this.findVisibleTexts()}else t.length>1?alert("Error! This component locates ePub iframe by the only iframe."):console.error("ePub iframes count is 0.")}},{key:"updatePageInfos",value:function(){var e,t=(null===(e=this.rendition)||void 0===e?void 0:e.currentLocation()).start.displayed;this.setState({currentPage:t.page,pageCount:t.total})}},{key:"getSelectedString",value:function(){var e,t,n="",s=null===(e=this.ePubIframe)||void 0===e||null===(t=e.contentDocument)||void 0===t?void 0:t.getSelection();return((null===s||void 0===s?void 0:s.rangeCount)||0)>0&&s.getRangeAt(0).toString().length>0&&(n=s.toString(),null===s||void 0===s||s.removeAllRanges()),n}},{key:"getSelectedRange",value:function(){var e,t,n;return null===(e=this.ePubIframe)||void 0===e||null===(t=e.contentDocument)||void 0===t||null===(n=t.getSelection())||void 0===n?void 0:n.getRangeAt(0)}},{key:"getRemainingWorkTextFromSelectedRange",value:function(){var e,t=this.ePubIframe.contentWindow.getSelection();if("Range"===t.type){var n=this.ePubIframe.contentDocument.getElementById("back"),s=t.getRangeAt(0);s.setEnd(n,0);var o=s.cloneContents();null===t||void 0===t||t.removeAllRanges();var r=new Document,a=r.createElement("html");r.appendChild(a),a.appendChild(o),$.removeElementsByClassName(r,"lb"),$.removeElementsByClassName(r,"doube-line-note"),e=r.getElementById("body").innerText}return e}},{key:"getAllTextNodes",value:function(e){return document.createTreeWalker(e,NodeFilter.SHOW_TEXT)}},{key:"visibleCharToRange",value:function(e){var t=this.visibleChars[e],n=new Range;return n.setStart(t.node,t.offset),n.setEnd(t.node,t.offset+1),n}},{key:"rectBinDirSize",value:function(e){return this.props.rtlVerticalLayout?e.y:e.x}},{key:"findBinBoundaryVisibleCharIndex",value:function(e,t,n){var s=t+Math.floor((n-t)/2);if(0===s)return 0;if(s===this.visibleChars.length-1)return this.visibleChars.length-1;var o=this.visibleCharToRange(s),r=this.visibleCharToRange(s+1),a=o.getBoundingClientRect(),i=r.getBoundingClientRect(),c=this.rectBinDirSize(a)-this.ePubIframeOffset,l=this.rectBinDirSize(i)-this.ePubIframeOffset;return c<e&&e<=l?s:c<e&&e>l?this.findBinBoundaryVisibleCharIndex(e,s+1,n):c>=e&&e<=l?this.findBinBoundaryVisibleCharIndex(e,t,s):(console.error("Unreasonable case!"),-1)}},{key:"findTextsInPage",value:function(e){var t=new Date,n=e-1;if(!this.isPageSearched[n]){var s=this.pageWidth*(e-1),o=this.pageWidth*e,r=0;1!==e&&(r=this.isPageSearched[n-1]?this.visibleChars.length-1-this.visibleChars.slice().reverse().findIndex((function(t){return t.page===e-1}))+1:this.findBinBoundaryVisibleCharIndex(s,0,this.visibleChars.length-1)+1);var a=this.visibleChars.length-1,i=this.visibleChars.length-1;e!==this.state.pageCount&&(i=this.isPageSearched[n+1]?this.visibleChars.findIndex((function(t){return t.page===e+1}))-1:this.findBinBoundaryVisibleCharIndex(o,r,a));for(var c=r;c<=i;c++)this.visibleChars[c].page=e;this.isPageSearched[n]=!0}var l=this.visibleChars.filter((function(t){return t.page===e})).map((function(e){return e.char})).join(""),h=(new Date).getTime()-t.getTime();return console.log("findTextsInPage spends: ".concat(h/1e3,"s")),l}},{key:"findVisibleTexts",value:function(){var e=this,t=this.ePubIframe.contentDocument.getElementById("body");if(t){var n,s=this.getAllTextNodes(t);this.visibleTextNodes=[],this.visibleChars=[],this.isPageSearched=[];for(var o=function(){var t=n;if(["t","pc","gaijiAnchor"].reduce((function(e,n){var s;return e&&n!==(null===(s=t.parentElement)||void 0===s?void 0:s.className)}),!0))return"continue";e.visibleTextNodes.push(n)};null!=(n=s.nextNode());)o();this.allTexts=this.visibleTextNodes.map((function(e){return e.textContent})).join("");for(var r=0,a=0;a<this.visibleTextNodes.length;a++)for(var i=this.visibleTextNodes[a],c=0;c<i.length;c++)this.visibleChars.push({node:i,offset:c,page:0,char:this.allTexts[r]}),r++;var l=document.querySelector(".epub-container");this.pageWidth=this.props.rtlVerticalLayout?l.clientHeight:l.clientWidth,this.pagesWidth=this.pageWidth*this.state.pageCount,this.isPageSearched=new Array(this.state.pageCount);for(var h=0;h<this.isPageSearched.length;h++)this.isPageSearched[h]=!1;var u=this.visibleCharToRange(0).getBoundingClientRect();this.ePubIframeOffset=this.props.rtlVerticalLayout?u.y:u.x}}},{key:"findSearchTextRanges",value:function(e){this.searchTextRanges=[],this.showedSearchTextIndex=0;var t=[],n=0,s=1;do{if(-1===(s=this.allTexts.indexOf(e,n)))break;n=s+e.length,t.push(s),t.push(s+e.length)}while(s<this.allTexts.length-1);if(0!==t.length){var o=[],r=0;s=t.shift();for(var a=0;a<this.visibleTextNodes.length;a++){for(var i=this.visibleTextNodes[a],c=0;c<i.length&&(r!==s||(o.push({node:i,offset:c}),-1!==(s=t.shift()||-1)));c++)r++;if(-1===s)break}for(var l=0;l<o.length/2;l+=1){var h=new Range,u=o[2*l],p=o[2*l+1];h.setStart(u.node,u.offset),h.setEnd(p.node,p.offset),this.searchTextRanges.push(h)}}}},{key:"findVisibleCharIndex",value:function(e,t){for(var n=0;n<this.visibleChars.length;n++){var s=this.visibleChars[n];if(s.node===e&&s.offset===t)return n}return-1}},{key:"searchTextPrev",value:function(){this.showedSearchTextIndex>0&&this.showedSearchTextIndex--,this.moveToSearchText(this.showedSearchTextIndex)}},{key:"searchTextNext",value:function(){this.showedSearchTextIndex<this.searchTextRanges.length-1&&this.showedSearchTextIndex++,this.moveToSearchText(this.showedSearchTextIndex)}},{key:"moveToSearchText",value:function(e){var t=this;this.epubcfiFromSelectedString="";var n=this.ePubIframe.contentWindow.getSelection();n.removeAllRanges(),setTimeout((function(){var s,o,r=t.searchTextRanges[e];(t.ePubIframe.contentWindow.focus(),n.addRange(r),t.props.paginated)?s=setInterval((function(){var e;""!==t.epubcfiFromSelectedString&&(clearInterval(s),null===(e=t.rendition)||void 0===e||e.display(t.epubcfiFromSelectedString).then((function(){})))}),100):null===(o=r.startContainer.parentElement)||void 0===o||o.scrollIntoView()}),100)}},{key:"buttonPrev",value:function(){this.state.showSearchTextToast?this.searchTextPrev():this.pagePrev()}},{key:"buttonNext",value:function(){this.state.showSearchTextToast?this.searchTextNext():this.pageNext()}},{key:"findCbetaHtmlLine",value:function(e){var t=e.parentElement;do{var n,s;if(null===(s=t)||void 0===s?void 0:s.getAttribute("l"))break}while(t=null===(n=t)||void 0===n?void 0:n.parentElement);return t}},{key:"findTextsInPageAndChunking",value:function(){var e,t,n,s;if(this.state.isSpeechRepeatMode){var o=this.findVisibleCharIndex(this.speechRepeatStart.startContainer,this.speechRepeatStart.startOffset),r=this.findVisibleCharIndex(this.speechRepeatEnd.endContainer,this.speechRepeatEnd.endOffset-1);s="";for(var a=o;a<r+1;a++)s+=this.visibleChars[a].char}else s=this.props.paginated?this.findTextsInPage(this.state.currentPage):this.getRemainingWorkTextFromSelectedRange();var i=s||(null===(e=this.ePubIframe)||void 0===e||null===(t=e.contentDocument)||void 0===t||null===(n=t.getElementById("body"))||void 0===n?void 0:n.innerText)||"\u7121\u6cd5\u53d6\u5f97\u7d93\u6587\u5167\u5bb9";this.workTexts=[];for(var c=0;c<Math.ceil(i.length/this.maxCharsPerUtterance);c++)this.workTexts.push(i.substring(c*this.maxCharsPerUtterance,(c+1)*this.maxCharsPerUtterance));this.workTextsIndex=0}},{key:"playText2Speech",value:function(){var e=this,t=$.zhVoices();switch(this.state.speechState){case te.UNINITIAL:var n=t.find((function(t){return t.voiceURI===e.props.voiceURI}))||t[0];void 0!==n&&(this.speechSynthesisUtterance.lang=n.lang,this.speechSynthesisUtterance.voice=n),this.findTextsInPageAndChunking(),this.speechSynthesisUtterance.text=this.workTexts[this.workTextsIndex],this.speechSynthesisUtterance.rate=this.props.speechRate,speechSynthesis.cancel(),speechSynthesis.speak(this.speechSynthesisUtterance),this.setState({speechState:te.SPEAKING,showToast:!0,toastMessage:"\u7d93\u6587\u5538\u8aa6\u975e\u771f\u4eba\u767c\u97f3\uff0c\u50c5\u4f5c\u53c3\u8003\uff01"});break;case te.SPEAKING:speechSynthesis.cancel(),this.setState({speechState:te.UNINITIAL,isSpeechRepeatMode:!1});break;case te.PAUSE:speechSynthesis.resume(),this.setState({speechState:te.SPEAKING})}}},{key:"render",value:function(){var e=this,t=Object(o.jsx)(g.g,{children:Object(o.jsxs)(g.J,{children:[Object(o.jsx)(g.G,{style:{fontSize:"var(--ui-font-size)"}}),Object(o.jsx)(g.c,{hidden:this.isTopPage,fill:"clear",slot:"start",onClick:function(t){return e.props.history.goBack()},children:Object(o.jsx)(g.h,{icon:ne.a,slot:"icon-only"})}),Object(o.jsx)(g.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(t){return e.fetchData()},children:Object(o.jsx)(g.h,{icon:ne.E,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"outline",shape:"round",hidden:!this.props.paginated,slot:"end",onClick:function(t){e.setState({showJumpPageAlert:!0})},children:Object(o.jsx)(g.o,{className:"uiFont",children:this.state.currentPage})}),Object(o.jsx)(g.c,{hidden:this.state.fetchError||!this.state.canTextToSpeech,fill:"clear",slot:"end",onClick:function(t){e.playText2Speech()},children:Object(o.jsx)(g.h,{icon:this.state.speechState===te.SPEAKING?ne.M:ne.B,slot:"icon-only"})}),Object(o.jsx)(g.c,{hidden:this.state.fetchError,fill:"clear",slot:"end",onClick:function(t){e.setState({popover:{show:!1,event:null}}),e.addBookmarkHandler()},children:Object(o.jsx)(g.h,{icon:ne.g,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"clear",slot:"end",onClick:function(t){return e.setState({popover:{show:!0,event:t.nativeEvent}})},children:Object(o.jsx)(g.h,{ios:ne.s,md:ne.t,slot:"icon-only"})}),Object(o.jsx)(g.t,{isOpen:this.state.popover.show,event:this.state.popover.event,onDidDismiss:function(t){e.setState({popover:{show:!1,event:null}})},children:Object(o.jsxs)(g.p,{children:[Object(o.jsxs)(g.k,{button:!0,onClick:function(t){e.setState({showSpeechRepeatStart:!0,popover:{show:!1,event:null}})},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.C,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u5faa\u74b0\u64ad\u653e"})]}),Object(o.jsxs)(g.k,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}}),e.props.history.push("/catalog/work/".concat(e.props.match.params.work))},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.v,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u56de\u7d93\u76ee\u9304"})]}),Object(o.jsxs)(g.k,{button:!0,onClick:function(t){e.props.history.push("/".concat(e.props.match.params.tab)),e.setState({popover:{show:!1,event:null}})},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.v,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u56de\u9996\u9801"})]}),Object(o.jsxs)(g.k,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}});var n=e.getSelectedString();$.copyToClipboard(n),e.setState({showToast:!0,toastMessage:"\u8907\u88fd\u6587\u5b57\u6210\u529f\uff01"})},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.p,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u8907\u88fd\u6587\u5b57"})]}),Object(o.jsxs)(g.k,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}}),e.setState({showSearchTextToast:!1,showSearchTextAlert:!0})},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.H,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u641c\u5c0b\u6587\u5b57"})]}),Object(o.jsxs)(g.k,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}}),e.setState({showSearchAlert:!0})},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.H,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u641c\u5c0b\u7d93\u66f8"})]}),Object(o.jsxs)(g.k,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}});var n=e.getSelectedString();""!==n?e.props.history.push({pathname:"/dictionary/search/".concat(n)}):e.setState({showNoSelectedTextAlert:!0})},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.f,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u67e5\u8a5e\u5178"})]}),Object(o.jsxs)(g.k,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}});var n=e.getSelectedString();""!==n?e.props.history.push({pathname:"/dictionary/searchWord/".concat(n)}):e.setState({showNoSelectedTextAlert:!0})},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.f,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u67e5\u5b57\u5178"})]}),Object(o.jsxs)(g.k,{hidden:$.isMacCatalyst(),button:!0,onClick:function(t){var n,s;e.setState({popover:{show:!1,event:null}}),null===(n=e.ePubIframe)||void 0===n||null===(s=n.contentWindow)||void 0===s||s.print()},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.D,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u5217\u5370"})]}),Object(o.jsxs)(g.k,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}}),window.open("https://cbetaonline.dila.edu.tw/zh/".concat(e.props.match.params.work,"_").concat(e.props.match.params.path.padStart(3,"0")),"_bank")},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.y,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"CBETA Online"})]}),Object(o.jsxs)(g.k,{button:!0,onClick:function(t){var n,s;e.setState({popover:{show:!1,event:null}});var o=null===(n=e.ePubIframe)||void 0===n||null===(s=n.contentDocument)||void 0===s?void 0:s.getSelection();if((o.rangeCount||0)>0&&o.getRangeAt(0).toString().length>0){var r,a,i=o.toString(),c=o.getRangeAt(0),l=null===(r=e.findCbetaHtmlLine(c.startContainer))||void 0===r?void 0:r.getAttribute("l"),h=null===(a=e.findCbetaHtmlLine(c.endContainer))||void 0===a?void 0:a.getAttribute("l");if(null===o||void 0===o||o.removeAllRanges(),null==l||null==h)return void e.setState({showToast:!0,toastMessage:"\u6240\u9078\u6587\u5b57\u7121\u6cd5\u5f15\u7528\uff01"});var u=/0*([1-9]*)([a-z])0*([1-9]*)/.exec(l),p="".concat(u[1]).concat(u[2]).concat(u[3]),d=/0*([1-9]*)([a-z])0*([1-9]*)/.exec(h)[3],b="".concat(p);l!==h&&(b+="-".concat(d));var j="\u300a".concat(e.state.workInfo.title,"\u300b\u5377").concat(e.props.match.params.path,"\uff1a\u300c").concat(i,"\u300d(CBETA, ").concat(e.state.workInfo.vol,", no. ").concat(+/[^0-9]*(.*)/.exec(e.state.workInfo.work)[1],", p. ").concat(b,")");$.copyToClipboard(j),e.setState({showToast:!0,toastMessage:"\u5df2\u8907\u88fd\u5230\u526a\u8cbc\u7c3f\uff01"})}else e.setState({showNoSelectedTextAlert:!0})},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.L,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u5f15\u7528\u6587\u7ae0"})]}),Object(o.jsxs)(g.k,{button:!0,onClick:function(t){var n=window.location.href.split("?")[0];""!==e.getSelectedString()&&(n+="?bookmark=".concat(e.epubcfiFromSelectedString)),e.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(n)}})},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.L,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u5206\u4eab\u6b64\u9801"})]})]})}),Object(o.jsx)(g.u,{reversed:this.props.rtlVerticalLayout,value:this.state.currentPage/this.state.pageCount})]})}),n=.2,s=Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(g.e,{vertical:"center",horizontal:"start",slot:"fixed",children:Object(o.jsx)(g.f,{style:{opacity:n},onClick:function(t){return e.props.rtlVerticalLayout?e.buttonNext():e.buttonPrev()},onPointerDown:function(e){e.currentTarget.style.setProperty("opacity","1")},onPointerEnter:function(e){e.currentTarget.style.setProperty("opacity","1")},onPointerUp:function(e){$.isTouchDevice()&&e.currentTarget.style.setProperty("opacity","".concat(n))},onPointerLeave:function(e){e.currentTarget.style.setProperty("opacity","".concat(n))},children:Object(o.jsx)(g.h,{icon:this.props.rtlVerticalLayout?ne.a:ne.e})})}),Object(o.jsx)(g.e,{vertical:"center",horizontal:"end",slot:"fixed",children:Object(o.jsx)(g.f,{style:{opacity:n},onClick:function(t){return e.props.rtlVerticalLayout?e.buttonPrev():e.buttonNext()},onPointerDown:function(e){e.currentTarget.style.setProperty("opacity","1")},onPointerEnter:function(e){e.currentTarget.style.setProperty("opacity","1")},onPointerUp:function(e){$.isTouchDevice()&&e.currentTarget.style.setProperty("opacity","".concat(n))},onPointerLeave:function(e){e.currentTarget.style.setProperty("opacity","".concat(n))},children:Object(o.jsx)(g.h,{icon:this.props.rtlVerticalLayout?ne.d:ne.c})})})]});return this.bookCreated||null==this.state.htmlStr||this.html2Epub(),Object(o.jsxs)(g.s,{children:[t,Object(o.jsxs)(g.d,{children:[this.props.paginated||this.state.showSearchTextToast?s:Object(o.jsx)(o.Fragment,{}),Object(o.jsx)(g.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return e.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."}),this.state.fetchError?$.fetchErrorContent:Object(o.jsx)(o.Fragment,{}),Object(o.jsx)("div",{id:"cbetarEPubView",style:{width:"100%",height:"100%",userSelect:"text",WebkitUserSelect:"text"}}),Object(o.jsx)(g.a,{cssClass:"uiFont",isOpen:this.state.showJumpPageAlert,header:"\u8df3\u9801",subHeader:"\u8acb\u8f38\u5165\u9801\u78bc(1 - ".concat(this.state.pageCount,")"),inputs:[{name:"name0",type:"number",min:1,max:this.state.pageCount,value:this.state.currentPage}],buttons:[{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary uiFont",handler:function(){return e.setState({showJumpPageAlert:!1})}},{text:"\u78ba\u5b9a",cssClass:"primary uiFont",handler:function(t){e.setState({showJumpPageAlert:!1}),e.jumpToPage(t.name0)}}]}),Object(o.jsx)(oe,Object(d.a)({},Object(d.a)({showSearchAlert:this.state.showSearchAlert,finish:function(){e.setState({showSearchAlert:!1})}},this.props))),Object(o.jsx)(g.a,{cssClass:"uiFont",isOpen:this.state.showNoSelectedTextAlert,backdropDismiss:!1,header:"\u5931\u6557",message:"\u8acb\u78ba\u8a8d\u662f\u5426\u5df2\u9078\u64c7\u4e00\u6bb5\u6587\u5b57\uff0c\u7136\u5f8c\u518d\u57f7\u884c\u6240\u9078\u7684\u529f\u80fd!",buttons:[{text:"\u78ba\u5b9a",cssClass:"primary uiFont",handler:function(t){e.setState({showNoSelectedTextAlert:!1})}}]}),Object(o.jsx)(g.a,{cssClass:"uiFont",isOpen:this.state.showSearchTextAlert,header:"\u641c\u5c0b\u6587\u5b57",subHeader:"\u6309\u4e0b\u641c\u5c0b\u5f8c\uff0c\u5de6\u53f3\u65b9\u5411\u9215\u8b8a\u70ba\u641c\u5c0b\u6587\u5b57\u65b9\u5411\u9215\u3002\u6309\u4e0b\u65b9\u901a\u77e5UI\u95dc\u9589\u9215\uff0c\u96e2\u958b\u641c\u5c0b\u6587\u5b57\u6a21\u5f0f\u3002",inputs:[{name:"name0",type:"search",placeholder:"\u4f8b:\u5982\u662f\u6211\u805e"}],buttons:[{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary uiFont",handler:function(){return e.setState({showSearchTextAlert:!1})}},{text:"\u641c\u5c0b",cssClass:"primary uiFont",handler:function(t){""!==t.name0?(e.findSearchTextRanges(t.name0),0===e.searchTextRanges.length?e.setState({showSearchTextAlert:!1,showToast:!0,toastMessage:"\u627e\u4e0d\u5230\u6587\u5b57\uff1a".concat(t.name0)}):(e.setState({showSearchTextAlert:!1,showSearchTextToast:!0,searchText:t.name0}),e.searchTextPrev())):e.setState({showSearchTextAlert:!1})}}]}),Object(o.jsx)(g.H,{cssClass:"uiFont",isOpen:this.state.showSearchTextToast,onDidDismiss:function(){return e.setState({showSearchTextToast:!1})},message:"\u641c\u5c0b\uff1a".concat(this.state.searchText),buttons:[{text:"\u95dc\u9589",role:"cancel",handler:function(){return e.setState({showSearchTextToast:!1})}}]}),Object(o.jsx)(g.H,{cssClass:"uiFont",isOpen:this.state.showSpeechRepeatStart,onDidDismiss:function(){return e.setState({showSpeechRepeatStart:!1})},message:"\u8acb\u9078\u64c7\u5071\u74b0\u64ad\u653e\u6587\u5b57\u8d77\u9ede\uff0c\u518d\u6309\u78ba\u5b9a",buttons:[{text:"\u78ba\u5b9a",role:"ok",handler:function(){e.speechRepeatStart=e.getSelectedRange(),e.setState({showSpeechRepeatStart:!1,showSpeechRepeatEnd:!0})}}]}),Object(o.jsx)(g.H,{cssClass:"uiFont",isOpen:this.state.showSpeechRepeatEnd,onDidDismiss:function(){return e.setState({showSpeechRepeatEnd:!1})},message:"\u8acb\u9078\u64c7\u5071\u74b0\u64ad\u653e\u6587\u5b57\u7d42\u9ede\uff0c\u518d\u6309\u78ba\u5b9a",buttons:[{text:"\u78ba\u5b9a",role:"ok",handler:function(){e.speechRepeatEnd=e.getSelectedRange(),e.setState({isSpeechRepeatMode:!0,showSpeechRepeatEnd:!1}),e.playText2Speech()}}]}),Object(o.jsx)(g.H,{cssClass:"uiFont",isOpen:this.state.showToast,onDidDismiss:function(){return e.setState({showToast:!1})},message:this.state.toastMessage,duration:2e3})]})]})}},{key:"workJuanId",get:function(){return"".concat(this.props.match.params.work,"/").concat(this.props.match.params.path)}},{key:"fileName",get:function(){return $.getFileName(this.props.match.params.work,this.props.match.params.path)}},{key:"isTopPage",get:function(){return"/catalog"===this.props.match.url}},{key:"bookmark",get:function(){var e=this;return this.props.bookmarks.find((function(t){return t.type===Q.JUAN&&t.uuid===e.uuidStr}))}},{key:"hasBookmark",get:function(){return""!==this.epubcfiFromUrl||null!=this.bookmark}},{key:"epubcfi",get:function(){return""!==this.epubcfiFromUrl?this.epubcfiFromUrl:null!=this.bookmark?this.bookmark.epubcfi:"epubcfi(/6/6[s1]!/4/4/2/6[body]/6,/1:0,/1:1)"}}]),s}(a.a.Component),we=Object(g.U)(Oe),Se=Object(k.b)((function(e){return{settings:e.settings,bookmarks:e.settings.bookmarks,fontSize:e.settings.fontSize,showComments:e.settings.showComments,paginated:e.settings.paginated,rtlVerticalLayout:e.settings.rtlVerticalLayout,useFontKai:e.settings.useFontKai,scrollbarSize:e.settings.scrollbarSize,voiceURI:e.settings.voiceURI,speechRate:e.settings.speechRate,cbetaOfflineDbMode:e.tmpSettings.cbetaOfflineDbMode}}))(we),Te=(n(411),n(412),n(413),n(414),n(415),n(416),n(417),n(418),n(419),n(420),n(421),n(422),n(129)),Ce=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var s;return Object(b.a)(this,n),(s=t.call(this,e)).state={showFontLicense:!1,juansDownloadedRatio:0,showUpdateAllJuansDone:!1,showClearAlert:!1,showToast:!1,toastMessage:""},s}return Object(j.a)(n,[{key:"ionViewWillEnter",value:function(){}},{key:"updateBookmark",value:function(e,t){var n=e.findIndex((function(e){return e.uuid===t.uuid}));-1===n?console.error("Update bookmark fails! Can't find the original bookmark with UUID: ".concat(t.uuid)):e[n]=t}},{key:"updateAllJuans",value:function(){var e=Object(p.a)(u.a.mark((function e(){var t,n,s,o,r,a,i,c,l,h,p,d,b,j,f,v,x,g,m,k,y;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(this.setState({juansDownloadedRatio:0}),t=this.props.bookmarks.filter((function(e){return e.type===Q.WORK})),n=this.props.bookmarks.filter((function(e){return e.type===Q.JUAN})),s=n.filter((function(e){return-1===t.findIndex((function(t){var n,s;return(null===(n=t.work)||void 0===n?void 0:n.work)===(null===(s=e.work)||void 0===s?void 0:s.work)}))})),o=s.length,r=0;r<t.length;r++)a=t[r].work,o+=a.juan_list.split(",").length;i=0,c=0;case 8:if(!(c<t.length)){e.next=30;break}l=t[c],h=l.work,p=h.juan_list.split(","),d=0;case 13:if(!(d<p.length)){e.next=27;break}return b=p[d],i+=1,this.setState({juansDownloadedRatio:i/o}),e.next=19,$.fetchJuan(h.work,b,null,!0);case 19:j=e.sent,f=$.getFileName(h.work,b),this.props.cbetaOfflineDbMode||$.saveFileToIndexedDB(f,j.htmlStr),0===d&&this.updateBookmark(this.props.bookmarks,Object.assign(l,{work:j.workInfo})),console.log("File saved: ".concat(f));case 24:d++,e.next=13;break;case 27:c++,e.next=8;break;case 30:v=0;case 31:if(!(v<s.length)){e.next=48;break}return i+=1,this.setState({juansDownloadedRatio:i/o}),x=s[v],g=x.work,e.next=38,$.fetchJuan(g.work,"".concat(g.juan),null,!0);case 38:m=e.sent,k=$.getFileName(g.work,"".concat(g.juan)),(y=m.workInfo).juan=g.juan,this.props.cbetaOfflineDbMode||$.saveFileToIndexedDB(k,m.htmlStr),this.updateBookmark(this.props.bookmarks,Object.assign(x,{work:y})),console.log("File saved: ".concat(k));case 45:v++,e.next=31;break;case 48:this.props.dispatch({type:"UPDATE_BOOKMARKS",bookmarks:this.props.bookmarks}),this.setState({showUpdateAllJuansDone:!0});case 50:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return Object(o.jsxs)(g.s,{children:[Object(o.jsx)(g.g,{children:Object(o.jsx)(g.J,{children:Object(o.jsx)(g.G,{className:"uiFont",children:"\u8a2d\u5b9a"})})}),Object(o.jsxs)(g.d,{children:[Object(o.jsxs)(g.p,{children:[Object(o.jsxs)(g.k,{children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.L,slot:"start"}),Object(o.jsxs)(g.o,{className:"ion-text-wrap uiFont",onClick:function(){var e=Object(p.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:["PWA\u7248\u672c: ",Object(o.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2#history",target:"_new",children:Te.pwaVersion})]}),Object(o.jsx)(g.c,{fill:"outline",shape:"round",slot:"end",size:"large",style:{fontSize:"var(--ui-font-size)"},onClick:function(t){e.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:window.location.origin}})},children:"\u5206\u4eab"})]}),Object(o.jsxs)(g.k,{hidden:!this.props.mainVersion,children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.w,slot:"start"}),Object(o.jsxs)(g.o,{className:"ion-text-wrap uiFont",children:["Backend app\u7248\u672c: ",this.props.mainVersion]})]}),Object(o.jsxs)(g.k,{hidden:!this.props.mainVersion,children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.w,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u4f7f\u7528CBETA\u96e2\u7dda\u7d93\u6587\u8cc7\u6599\u6a94"}),Object(o.jsx)(g.I,{slot:"end",disabled:!0,checked:this.props.cbetaOfflineDbMode})]}),Object(o.jsxs)(g.k,{children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.h,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:Object(o.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2#report",target:"_new",children:"\u555f\u7528app\u7570\u5e38\u8a18\u9304"})}),Object(o.jsx)(g.I,{slot:"end",checked:this.props.hasAppLog,onIonChange:function(t){var n=t.detail.checked;e.props.hasAppLog!==n&&(n?$.enableAppLog():$.disableAppLog(),e.props.dispatch({type:"SET_KEY_VAL",key:"hasAppLog",val:n}))}})]}),Object(o.jsxs)(g.k,{hidden:!this.props.hasAppLog,children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.h,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u56de\u5831app\u7570\u5e38\u8a18\u9304"}),Object(o.jsx)(g.c,{fill:"outline",shape:"round",slot:"end",size:"large",style:{fontSize:"var(--ui-font-size)"},onClick:function(t){window.open("mailto:myh@live.com?subject=\u96fb\u5b50\u4f5b\u5178\u7570\u5e38\u8a18\u9304\u56de\u5831&body=".concat(encodeURIComponent("\u554f\u984c\u63cf\u8ff0(\u5efa\u8b70\u586b\u5beb)\uff1a\n\n\u700f\u89bd\u5668\uff1a"+navigator.userAgent+"\n\nApp\u7248\u672c\uff1a"+Te.pwaVersion+"\n\nApp\u8a2d\u5b9a\uff1a"+JSON.stringify(e.props.settings)+"\n\nLog\uff1a\n"+$.getLog())))},children:"\u56de\u5831"})]}),Object(o.jsxs)(g.k,{children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.r,slot:"start"}),Object(o.jsx)("div",{className:"contentBlock",children:Object(o.jsxs)("div",{style:{flexDirection:"column"},children:[Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"App\u8a2d\u5b9a\u8207\u66f8\u7c64"}),Object(o.jsxs)("div",{style:{textAlign:"right"},children:[Object(o.jsx)(g.c,{fill:"outline",shape:"round",size:"large",style:{fontSize:"var(--ui-font-size)"},onClick:function(){var e=Object(p.a)(u.a.mark((function e(t){var n,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n="data:text/json;charset=utf-8,".concat(encodeURIComponent(localStorage.getItem($.storeFile)||"")),(s=document.createElement("a")).href=n,s.download=$.storeFile,s.click(),s.remove();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:"\u532f\u51fa"}),Object(o.jsx)("input",{id:"importJsonInput",type:"file",accept:".json",style:{display:"none"},onChange:function(){var t=Object(p.a)(u.a.mark((function t(n){var s,o,r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=null===(s=n.target.files)||void 0===s?void 0:s.item(0),t.next=3,null===o||void 0===o?void 0:o.text();case 3:if(t.t0=t.sent,t.t0){t.next=6;break}t.t0="";case 6:r=t.t0;try{JSON.parse(r),localStorage.setItem($.storeFile,r),e.props.dispatch({type:"LOAD_SETTINGS"}),e.updateAllJuans()}catch(a){console.error(a),console.error((new Error).stack)}document.getElementById("importJsonInput").value="";case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}),Object(o.jsx)(g.c,{fill:"outline",shape:"round",size:"large",style:{fontSize:"var(--ui-font-size)"},onClick:function(e){document.querySelector("#importJsonInput").click()},children:"\u532f\u5165"}),Object(o.jsx)(g.c,{fill:"outline",shape:"round",size:"large",style:{fontSize:"var(--ui-font-size)"},onClick:function(t){e.setState({showClearAlert:!0})},children:"\u91cd\u7f6e"}),Object(o.jsx)(g.a,{cssClass:"uiFont",isOpen:this.state.showClearAlert,backdropDismiss:!1,onDidPresent:function(e){},header:"\u91cd\u7f6e\u6703\u9084\u539fapp\u8a2d\u5b9a\u9810\u8a2d\u503c\u4e26\u6e05\u9664\u66f8\u7c64\u3001\u5b57\u578b\u6a94\uff01\u78ba\u5b9a\u91cd\u7f6e\uff1f",buttons:[{text:"\u53d6\u6d88",cssClass:"primary uiFont",handler:function(t){e.setState({showClearAlert:!1})}},{text:"\u91cd\u7f6e",cssClass:"secondary uiFont",handler:function(){var t=Object(p.a)(u.a.mark((function t(n){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,$.clearAppData();case 2:for(e.props.dispatch({type:"DEFAULT_SETTINGS"});document.body.classList.length>0;)document.body.classList.remove(document.body.classList.item(0));document.body.classList.toggle("theme".concat(e.props.theme),!0),document.body.classList.toggle("print".concat(e.props.printStyle),!0),e.setState({showClearAlert:!1,showToast:!0,toastMessage:"\u6e05\u9664\u6210\u529f!"});case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]})]})]})})]}),Object(o.jsxs)(g.k,{children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.E,slot:"start"}),Object(o.jsxs)("div",{style:{width:"100%"},children:[Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u66f4\u65b0\u96e2\u7dda\u7d93\u6587\u6a94"}),Object(o.jsx)(g.u,{value:this.state.juansDownloadedRatio})]}),Object(o.jsx)(g.c,{fill:"outline",shape:"round",slot:"end",size:"large",style:{fontSize:"var(--ui-font-size)"},onClick:function(){var t=Object(p.a)(u.a.mark((function t(n){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.updateAllJuans());case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),children:"\u66f4\u65b0"}),Object(o.jsx)(g.H,{cssClass:"uiFont",isOpen:this.state.showUpdateAllJuansDone,onDidDismiss:function(){return e.setState({showUpdateAllJuansDone:!1})},message:"\u96e2\u7dda\u7d93\u6587\u6a94\u66f4\u65b0\u5b8c\u7562\uff01",duration:2e3})]}),Object(o.jsxs)(g.k,{children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.o,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:$.appSettings.theme}),Object(o.jsxs)(g.B,{slot:"end",value:this.props.theme,style:{fontSize:"var(--ui-font-size)"},interface:"popover",interfaceOptions:{cssClass:"cbetar2themes"},onIonChange:function(t){var n=t.detail.value;e.props.theme!==n&&e.props.dispatch({type:"SET_KEY_VAL",key:"theme",val:n})},children:[Object(o.jsx)(g.C,{className:"uiFont cbeta",value:0,children:"CBETA"}),Object(o.jsx)(g.C,{className:"uiFont dark",value:1,children:"\u6697\u8272"}),Object(o.jsx)(g.C,{className:"uiFont light",value:2,children:"\u4eae\u8272"}),Object(o.jsx)(g.C,{className:"uiFont oldPaper",value:3,children:"\u820a\u66f8"}),Object(o.jsx)(g.C,{className:"uiFont marble",value:4,children:"\u5927\u7406\u77f3"})]})]}),Object(o.jsxs)(g.k,{children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.q,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:$.appSettings.rtlVerticalLayout}),Object(o.jsx)(g.I,{slot:"end",checked:this.props.rtlVerticalLayout,onIonChange:function(t){var n=t.detail.checked;e.props.rtlVerticalLayout!==n&&e.props.dispatch({type:"SET_KEY_VAL",key:"rtlVerticalLayout",val:n})}})]}),Object(o.jsxs)(g.k,{children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.q,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:$.appSettings.paginated}),Object(o.jsx)(g.I,{slot:"end",checked:this.props.paginated,onIonChange:function(t){var n=t.detail.checked;e.props.paginated!==n&&e.props.dispatch({type:"SET_KEY_VAL",key:"paginated",val:n})}})]}),Object(o.jsxs)(g.k,{children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.q,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u55ae\u9801\u7d93\u6587\u6372\u8ef8\u5927\u5c0f"}),Object(o.jsxs)(g.B,{slot:"end",value:this.props.scrollbarSize,style:{fontSize:"var(--ui-font-size)"},interface:"popover",interfaceOptions:{cssClass:"uiFont"},onIonChange:function(t){var n=t.detail.value;e.props.scrollbarSize!==n&&(e.props.dispatch({type:"SET_KEY_VAL",key:"scrollbarSize",val:n}),$.updateCssVars(e.props.settings))},children:[Object(o.jsx)(g.C,{className:"uiFont",value:0,children:"\u7121"}),Object(o.jsx)(g.C,{className:"uiFont",value:1,children:"\u4e2d"}),Object(o.jsx)(g.C,{className:"uiFont",value:2,children:"\u5927"})]})]}),Object(o.jsxs)(g.k,{children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.q,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:$.appSettings.showComments}),Object(o.jsx)(g.I,{slot:"end",checked:this.props.showComments,onIonChange:function(t){var n=t.detail.checked;e.props.showComments!==n&&e.props.dispatch({type:"SET_KEY_VAL",key:"showComments",val:n})}})]}),Object(o.jsxs)(g.k,{children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.O,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:$.appSettings.useFontKai}),Object(o.jsx)(g.I,{slot:"end",checked:this.props.useFontKai,onIonChange:function(t){var n=t.detail.checked;e.props.useFontKai!==n&&(e.props.dispatch({type:"SET_KEY_VAL",key:"useFontKai",val:n}),$.updateCssVars(e.props.settings))}})]}),Object(o.jsxs)(g.k,{children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.O,slot:"start"}),Object(o.jsx)("div",{className:"contentBlock",children:Object(o.jsxs)("div",{style:{flexDirection:"column"},children:[Object(o.jsxs)(g.o,{className:"ion-text-wrap uiFont",children:[$.appSettings.uiFontSize,": ",this.props.uiFontSize]}),Object(o.jsx)(g.v,{min:10,max:128,pin:!0,snaps:!0,value:this.props.uiFontSize,onIonChange:function(t){e.props.dispatch({type:"SET_KEY_VAL",key:"uiFontSize",val:t.detail.value}),$.updateCssVars(e.props.settings)}})]})})]}),Object(o.jsxs)(g.k,{children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.O,slot:"start"}),Object(o.jsxs)("div",{className:"contentBlock",children:[Object(o.jsxs)(g.o,{className:"ion-text-wrap uiFont",children:[$.appSettings.fontSize,": ",Object(o.jsx)("span",{className:"textFont",children:this.props.settings.fontSize})]}),Object(o.jsx)(g.v,{min:10,max:128,pin:!0,snaps:!0,value:this.props.settings.fontSize,onIonChange:function(t){e.props.dispatch({type:"SET_KEY_VAL",key:"fontSize",val:t.detail.value}),$.updateCssVars(e.props.settings)}})]})]}),Object(o.jsxs)(g.k,{children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.D,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:$.appSettings.printStyle}),Object(o.jsxs)(g.B,{slot:"end",value:this.props.printStyle,style:{fontSize:"var(--ui-font-size)"},interface:"popover",interfaceOptions:{cssClass:"cbetar2themes"},onIonChange:function(t){var n=t.detail.value;e.props.printStyle!==n&&e.props.dispatch({type:"SET_KEY_VAL",key:"printStyle",val:n})},children:[Object(o.jsx)(g.C,{className:"uiFont blackWhite printVar",value:0,children:"\u767d\u5e95\u9ed1\u5b57"}),Object(o.jsx)(g.C,{className:"uiFont manuscript printVar",value:1,children:"\u6284\u7d93\u672c"})]})]}),Object(o.jsxs)(g.k,{children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.D,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u5408\u6210\u8a9e\u97f3"}),Object(o.jsx)(g.B,{slot:"end",value:this.props.voiceURI,style:{fontSize:"var(--ui-font-size)"},interface:"action-sheet",cancelText:"\u53d6\u6d88",onIonChange:function(t){var n=t.detail.value;e.props.voiceURI!==n&&e.props.dispatch({type:"SET_KEY_VAL",key:"voiceURI",val:n})},children:$.zhVoices().map((function(e,t){return Object(o.jsx)(g.C,{className:"uiFont blackWhite printVar",value:e.voiceURI,children:e.name},t)}))})]}),Object(o.jsxs)(g.k,{children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.C,slot:"start"}),Object(o.jsx)("div",{className:"contentBlock",children:Object(o.jsxs)("div",{style:{flexDirection:"column"},children:[Object(o.jsxs)(g.o,{className:"ion-text-wrap uiFont",children:[Object(o.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2#text2speech",target:"_new",children:"\u5408\u6210\u8a9e\u97f3\u8a9e\u901f"}),": ",this.props.speechRate]}),Object(o.jsx)(g.v,{min:.1,max:1.5,step:.1,snaps:!0,value:this.props.speechRate,onIonChange:function(t){e.props.dispatch({type:"SET_KEY_VAL",key:"speechRate",val:t.detail.value.toFixed(1)})}})]})})]}),Object(o.jsxs)(g.k,{children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.u,slot:"start"}),Object(o.jsxs)("div",{style:{fontSize:"var(--ui-font-size)"},children:[Object(o.jsx)("div",{children:"\u95dc\u65bc"}),Object(o.jsx)("div",{children:Object(o.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2",target:"_new",children:"\u64cd\u4f5c\u8aaa\u660e\u8207\u958b\u653e\u539f\u59cb\u78bc"})}),Object(o.jsxs)("div",{children:["CBETA API\u7248\u672c: ",$.apiVersion]}),Object(o.jsx)("div",{children:Object(o.jsx)("a",{href:"http://cbdata.dila.edu.tw/v1.2/",target:"_new",children:"CBETA API\u53c3\u8003\u6587\u4ef6"})}),Object(o.jsx)("div",{children:Object(o.jsx)("a",{href:"http://glossaries.dila.edu.tw/?locale=zh-TW",target:"_new",children:"DILA \u4f5b\u5b78\u8853\u8a9e\u5b57\u8fad\u5178"})}),Object(o.jsx)("div",{children:"\u4f5c\u8005: Meng-Yuan Huang"}),Object(o.jsx)("div",{children:Object(o.jsx)("a",{href:"mailto:myh@live.com",target:"_new",children:"myh@live.com"})}),Object(o.jsx)("div",{children:Object(o.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2#contributors",target:"_new",children:"App\u76f8\u95dc\u8ca2\u737b\u8005"})}),Object(o.jsx)("div",{children:Object(o.jsx)("a",{href:"/",onClick:function(t){t.preventDefault(),e.setState({showFontLicense:!0})},children:"\u5168\u5b57\u5eab\u5b57\u578b\u7248\u6b0a\u8072\u660e"})})]})]}),Object(o.jsx)(g.a,{cssClass:"uiFont",isOpen:this.state.showFontLicense,backdropDismiss:!1,message:"\u6b64app\u4f7f\u7528\u7684\u5168\u5b57\u5eab\u5b57\u578b(2020-08-18\u7248)\u7531\u570b\u5bb6\u767c\u5c55\u59d4\u54e1\u6703\u63d0\u4f9b\u3002\u6b64\u958b\u653e\u8cc7\u6599\u4f9d\u653f\u5e9c\u8cc7\u6599\u958b\u653e\u6388\u6b0a\u689d\u6b3e (Open Government Data License) \u9032\u884c\u516c\u773e\u91cb\u51fa\uff0c\u4f7f\u7528\u8005\u65bc\u9075\u5b88\u672c\u689d\u6b3e\u5404\u9805\u898f\u5b9a\u4e4b\u524d\u63d0\u4e0b\uff0c\u5f97\u5229\u7528\u4e4b\u3002\u653f\u5e9c\u8cc7\u6599\u958b\u653e\u6388\u6b0a\u689d\u6b3e\uff1ahttps://data.gov.tw/license",buttons:[{text:"\u95dc\u9589",cssClass:"primary uiFont",handler:function(t){e.setState({showFontLicense:!1})}},{text:"\u958b\u555f\u6388\u6b0a",cssClass:"secondary uiFont",handler:function(t){e.setState({showFontLicense:!1}),window.open("https://data.gov.tw/license")}}]})]}),Object(o.jsx)(g.H,{cssClass:"uiFont",isOpen:this.state.showToast,onDidDismiss:function(){return e.setState({showToast:!1})},message:this.state.toastMessage,duration:2e3})]})]})}}]),n}(a.a.Component),Ae=Object(g.U)(Ce),Ie=Object(k.b)((function(e){return{settings:e.settings,hasAppLog:e.settings.hasAppLog,theme:e.settings.theme,showComments:e.settings.showComments,paginated:e.settings.paginated,rtlVerticalLayout:e.settings.rtlVerticalLayout,scrollbarSize:e.settings.scrollbarSize,useFontKai:e.settings.useFontKai,uiFontSize:e.settings.uiFontSize,printStyle:e.settings.printStyle,speechRate:e.settings.speechRate,bookmarks:e.settings.bookmarks,voiceURI:e.settings.voiceURI,mainVersion:e.tmpSettings.mainVersion,cbetaOfflineDbMode:e.tmpSettings.cbetaOfflineDbMode}}))(Ae),Ee=Object(o.jsxs)(o.Fragment,{children:[Object(o.jsxs)("div",{style:{fontSize:"var(--ui-font-size)",textAlign:"center"},children:["\u53ef\u96e2\u7dda\u700f\u89bd\u5716\u793a ",Object(o.jsx)(g.h,{icon:ne.r})]}),$.isStoreApps()?Object(o.jsx)(o.Fragment,{}):Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)("div",{style:{fontSize:"var(--ui-font-size)",textAlign:"center"},children:Object(o.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2#web-app",target:"_new",children:"\u7a0b\u5f0f\u5b89\u88dd\u8aaa\u660e"})}),Object(o.jsx)("div",{style:{fontSize:"var(--ui-font-size)",textAlign:"center"},children:Object(o.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2#shortcuts",target:"_new",children:"\u7a0b\u5f0f\u6377\u5f91"})})]})]}),Fe=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var s;return Object(b.a)(this,n),(s=t.call(this,e)).bookmarkListRef=void 0,s.state={reorder:!1,showToast:!1,toastMessage:""},s.bookmarkListRef=a.a.createRef(),s}return Object(j.a)(n,[{key:"ionViewWillEnter",value:function(){var e=O.a.parse(this.props.location.search);if(e.item&&e.item<this.props.bookmarks.length){var t,n,s=this.props.bookmarks[e.item];this.props.history.push("/catalog/juan/".concat(null===(t=s.work)||void 0===t?void 0:t.work,"/").concat(null===(n=s.work)||void 0===n?void 0:n.juan))}else this.hasBookmark||(this.setState({showToast:!0,toastMessage:"\u7121\u66f8\u7c64\uff01\u8acb\u5f9e\u76ee\u9304\u9801\u65b0\u589e\u66f8\u7c64\u3002"}),this.props.history.push("/catalog/famous"))}},{key:"delBookmarkHandler",value:function(e){this.props.dispatch({type:"DEL_BOOKMARK",uuid:e}),this.hasBookmark||this.props.history.push("/catalog/famous")}},{key:"reorderBookmarks",value:function(e){var t=e.detail.complete(this.props.bookmarks);this.props.dispatch({type:"UPDATE_BOOKMARKS",bookmarks:t})}},{key:"getBookmarkRows",value:function(){var e=this,t=this.props.bookmarks,n=Array();return t.forEach((function(t,s){var r,a,i,c,l,h,d="",b="".concat(t.selectedText),j=!1;switch(t.type){case Q.CATALOG:d="/catalog/catalog/".concat(t.uuid);break;case Q.WORK:d="/catalog/work/".concat(t.uuid);break;case Q.JUAN:d="/catalog/juan/".concat(null===(r=t.work)||void 0===r?void 0:r.work,"/").concat(null===(a=t.work)||void 0===a?void 0:a.juan),b="".concat(null===(i=t.work)||void 0===i?void 0:i.title,"\u7b2c").concat(null===(c=t.work)||void 0===c?void 0:c.juan,"\u5377 - ").concat(b);break;case Q.HTML:j=!0,d="/catalog/juan/".concat(null===(l=t.work)||void 0===l?void 0:l.work,"/1"),b="".concat(null===(h=t.work)||void 0===h?void 0:h.title," - ").concat(b)}n.push(Object(o.jsxs)(g.n,{children:[Object(o.jsxs)(g.k,{button:!0,onClick:function(){var n=Object(p.a)(u.a.mark((function n(s){var o;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!e.state.reorder){n.next=3;break}return e.setState({showToast:!0,toastMessage:"\u8acb\u5148\u95dc\u9589\u6392\u5217\u529f\u80fd\uff0c\u624d\u53ef\u9ede\u64ca\u66f8\u7c64\uff01"}),n.abrupt("return");case 3:s.preventDefault(),e.props.history.push({pathname:d,state:{uuid:t.uuid},search:O.a.stringify(j?{file:t.fileName,title:null===(o=t.work)||void 0===o?void 0:o.title}:{})});case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:b},"bookmarkItemLabel_"+s),t.type===Q.CATALOG?"":Object(o.jsx)(g.h,{icon:ne.r,slot:"end"}),Object(o.jsx)(g.w,{slot:"end"})]},"bookmarkItem_"+s),Object(o.jsx)(g.m,{side:"end",children:Object(o.jsx)(g.l,{style:{fontSize:"var(--ui-font-size)"},color:"danger",onClick:function(n){var s;e.delBookmarkHandler(t.uuid),null===(s=e.bookmarkListRef.current)||void 0===s||s.closeSlidingItems()},children:"\u522a\u9664"})})]},"bookmarkItemSliding_"+s))})),n}},{key:"render",value:function(){var e=this,t=this.getBookmarkRows();return Object(o.jsxs)(g.s,{children:[Object(o.jsx)(g.g,{children:Object(o.jsxs)(g.J,{children:[Object(o.jsx)(g.G,{style:{fontSize:"var(--ui-font-size)"},children:"\u66f8\u7c64"}),Object(o.jsx)(g.c,{fill:this.state.reorder?"solid":"clear",slot:"end",onClick:function(t){return e.setState({reorder:!e.state.reorder})},children:Object(o.jsx)(g.h,{icon:ne.N,slot:"icon-only"})})]})}),Object(o.jsxs)(g.d,{children:[this.hasBookmark?Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(g.p,{ref:this.bookmarkListRef,children:Object(o.jsx)(g.x,{disabled:!this.state.reorder,onIonItemReorder:function(t){e.reorderBookmarks(t)},children:t})},"bookmarkList0"),Ee]}):Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(g.p,{children:t},"bookmarkList1"),Ee]}),Object(o.jsx)(g.H,{cssClass:"uiFont",isOpen:this.state.showToast,onDidDismiss:function(){return e.setState({showToast:!1})},message:this.state.toastMessage,duration:2e3})]})]},"bookmarksPage".concat(this.isFamousPage))}},{key:"hasBookmark",get:function(){return this.props.bookmarks.length>0}},{key:"isFamousPage",get:function(){return"/catalog/famous"===this.props.match.url}}]),n}(a.a.Component),Le=Object(g.U)(Fe),Ne=Object(k.b)((function(e){return{bookmarks:e.settings.bookmarks}}))(Le),De=function e(t){var n;Object(b.a)(this,e),this.type=void 0,this.n=void 0,this.label=void 0,this.work=void 0,this.title=void 0,this.creators=void 0,this.type=t.type,this.n=t.n,this.label=t.label,this.work=t.work,this.title=t.title,this.creators=null!==(n=t.creators)&&void 0!==n?n:"\u7121"},Pe=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var s;return Object(b.a)(this,n),(s=t.call(this,e)).state={fetchError:!1,showSearchAlert:!1,searches:[],isLoading:!1},s}return Object(j.a)(n,[{key:"ionViewWillEnter",value:function(){this.search(this.props.match.params.keyword)}},{key:"componentDidMount",value:function(){}},{key:"search",value:function(){var e=Object(p.a)(u.a.mark((function e(t){var n,s,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({isLoading:!0}),e.prev=1,e.next=4,$.axiosInstance.get("/toc?q=".concat(t),{responseType:"arraybuffer"});case 4:return n=e.sent,s=JSON.parse((new TextDecoder).decode(n.data)).results,o=s.map((function(e){return new De(e)})),this.setState({fetchError:!1,isLoading:!1,searches:o}),e.abrupt("return",!0);case 11:return e.prev=11,e.t0=e.catch(1),console.error(e.t0),console.error((new Error).stack),this.setState({fetchError:!0,isLoading:!1}),e.abrupt("return",!1);case 17:case"end":return e.stop()}}),e,this,[[1,11]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getRows",value:function(){var e=this,t=Array();return this.state.searches.forEach((function(n,s){var r="catalog"===n.type,a=r?n.label:"".concat(n.title,"\n\u4f5c\u8005:").concat(n.creators),i="/".concat(e.props.match.params.tab)+(r?"/catalog/".concat(n.n):"/work/".concat(n.work));t.push(Object(o.jsxs)(g.k,{button:!0,onClick:function(){var t=Object(p.a)(u.a.mark((function t(n){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.preventDefault(),e.props.history.push({pathname:i});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:a},"searchLabel_"+s)]},"searchItem_"+s))})),t}},{key:"render",value:function(){var e=this,t=this.getRows();return Object(o.jsxs)(g.s,{children:[Object(o.jsx)(g.g,{children:Object(o.jsxs)(g.J,{children:[Object(o.jsxs)(g.G,{style:{fontSize:"var(--ui-font-size)"},children:["\u641c\u5c0b - ",this.props.match.params.keyword]}),Object(o.jsx)(g.c,{hidden:this.isTopPage,fill:"clear",slot:"start",onClick:function(t){return e.props.history.goBack()},children:Object(o.jsx)(g.h,{icon:ne.a,slot:"icon-only"})}),Object(o.jsx)(g.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(t){return e.search(e.props.match.params.keyword)},children:Object(o.jsx)(g.h,{icon:ne.E,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"clear",slot:"end",onClick:function(t){return e.props.history.push("/".concat(e.props.match.params.tab))},children:Object(o.jsx)(g.h,{icon:ne.v,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"clear",slot:"end",onClick:function(t){return e.setState({showSearchAlert:!0})},children:Object(o.jsx)(g.h,{icon:ne.H,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"clear",slot:"end",onClick:function(t){e.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})},children:Object(o.jsx)(g.h,{icon:ne.L,slot:"icon-only"})})]})}),Object(o.jsxs)(g.d,{children:[this.state.fetchError?$.fetchErrorContent:Object(o.jsx)(g.p,{children:t}),Object(o.jsx)(g.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return e.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."}),Object(o.jsx)(oe,Object(d.a)({},Object(d.a)({showSearchAlert:this.state.showSearchAlert,finish:function(){e.setState({showSearchAlert:!1})}},this.props)))]})]})}},{key:"isTopPage",get:function(){return"/catalog"===this.props.match.url}}]),n}(a.a.Component),Be=Object(g.U)(Pe),_e=Object(k.b)((function(e){return{}}))(Be),Re=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var s;return Object(b.a)(this,n),(s=t.call(this,e)).searchBarRef=void 0,s.selectedTextBeforeIonPopover="",s.state={keyword:"",searches:[],showNoSelectedTextAlert:!1,popover:{show:!1,event:null},isLoading:!1,fetchError:!1,showToast:!1,toastMessage:""},s.searchBarRef=a.a.createRef(),s}return Object(j.a)(n,[{key:"ionViewWillEnter",value:function(){this.setState({keyword:this.props.match.params.keyword}),this.props.match.params.keyword?this.lookupDict(this.props.match.params.keyword):this.setState({searches:[]})}},{key:"lookupDict",value:function(){var e=Object(p.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({isLoading:!0}),e.prev=1,e.next=4,$.axiosInstance.get("".concat($.dilaDictApiUrl,"/?type=match&dicts=dila&term=").concat(t),{responseType:"json"});case 4:n=e.sent,this.props.dictionaryHistory.unshift(t),this.props.dictionaryHistory.splice(10),this.props.dispatch({type:"SET_KEY_VAL",key:"dictionaryHistory",val:this.props.dictionaryHistory}),this.setState({fetchError:!1,isLoading:!1,searches:n.data}),e.next=17;break;case 11:return e.prev=11,e.t0=e.catch(1),console.error(e.t0),console.error((new Error).stack),this.setState({fetchError:!0,isLoading:!1}),e.abrupt("return",!1);case 17:case"end":return e.stop()}}),e,this,[[1,11]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getSelectedString",value:function(){var e=document.getSelection();return((null===e||void 0===e?void 0:e.rangeCount)||0)>0&&e.getRangeAt(0).toString().length>0?e.getRangeAt(0).toString():""}},{key:"getRows",value:function(){var e=this.state.searches,t=Array();return e.forEach((function(e,n){t.push(Object(o.jsx)("div",{style:{display:"table-row"},children:Object(o.jsxs)("div",{className:"tableCell",children:[Object(o.jsx)("div",{className:"textFont",style:{color:"var(--ion-color-primary)",paddingBottom:"18pt"},dangerouslySetInnerHTML:{__html:e.dict_name_zh}}),Object(o.jsx)("div",{className:"textFont",style:{padding:"0 5px",textAlign:"justify",overflowWrap:"normal"},dangerouslySetInnerHTML:{__html:e.desc}},"dictItemLabel"+n)]})},"dictItem"+n))})),t}},{key:"render",value:function(){var e=this;return Object(o.jsxs)(g.s,{children:[Object(o.jsx)(g.g,{children:Object(o.jsxs)(g.J,{children:[Object(o.jsx)(g.c,{hidden:this.isTopPage,fill:"clear",slot:"start",onClick:function(t){return e.props.history.goBack()},children:Object(o.jsx)(g.h,{icon:ne.a,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"outline",shape:"round",slot:"start",onClick:function(t){e.props.history.push("/dictionary/searchWord")},children:Object(o.jsx)("span",{className:"uiFont",style:{color:"var(--color)"},children:"\u4f5b\u5b78\u8a5e\u5178"})}),Object(o.jsx)(g.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(t){return e.lookupDict(e.props.match.params.keyword)},children:Object(o.jsx)(g.h,{icon:ne.E,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"clear",slot:"end",onClick:function(t){e.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})},children:Object(o.jsx)(g.h,{icon:ne.L,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"clear",slot:"end",onPointerDown:function(t){e.selectedTextBeforeIonPopover=e.getSelectedString()},onClick:function(t){e.setState({popover:{show:!0,event:t.nativeEvent}})},children:Object(o.jsx)(g.h,{ios:ne.s,md:ne.t,slot:"icon-only"})}),Object(o.jsx)(g.t,{isOpen:this.state.popover.show,event:this.state.popover.event,onDidDismiss:function(t){e.selectedTextBeforeIonPopover="",e.setState({popover:{show:!1,event:null}})},children:Object(o.jsxs)(g.p,{children:[Object(o.jsxs)(g.k,{button:!0,onClick:function(t){e.props.history.push("/".concat(e.props.match.params.tab,"/search")),e.setState({popover:{show:!1,event:null}})},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.v,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u56de\u9996\u9801"})]}),Object(o.jsxs)(g.k,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}}),$.copyToClipboard(e.selectedTextBeforeIonPopover),e.setState({showToast:!0,toastMessage:"\u8907\u88fd\u6587\u5b57\u6210\u529f"})},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.p,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u8907\u88fd\u6587\u5b57"})]}),Object(o.jsxs)(g.k,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}}),""!==e.selectedTextBeforeIonPopover?e.props.history.push({pathname:"/dictionary/search/".concat(e.selectedTextBeforeIonPopover)}):e.setState({showNoSelectedTextAlert:!0})},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.f,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u67e5\u8a5e\u5178"})]}),Object(o.jsxs)(g.k,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}}),""!==e.selectedTextBeforeIonPopover?e.props.history.push({pathname:"/dictionary/searchWord/".concat(e.selectedTextBeforeIonPopover)}):e.setState({showNoSelectedTextAlert:!0})},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.f,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u67e5\u5b57\u5178"})]})]})})]})}),Object(o.jsxs)(g.d,{children:[Object(o.jsx)(g.A,{ref:this.searchBarRef,placeholder:"\u8acb\u8f38\u5165\u5b57\u8a5e\uff0c\u518d\u6309\u9375\u76e4Enter\u9375",value:this.state.keyword,onIonClear:function(t){e.setState({searches:[]})},onKeyUp:function(t){var n=t.target.value;e.setState({keyword:n}),""===n?e.setState({searches:[]}):"Enter"===t.key&&(n===e.props.match.params.keyword?(e.setState({keyword:n}),e.lookupDict(n)):e.props.history.push("/dictionary/search/".concat(n)))}}),this.state.fetchError?$.fetchErrorContent:this.state.searches.length<1||this.props.dictionaryHistory.length>0&&(""===this.state.keyword||void 0===this.state.keyword)?Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)("div",{className:"uiFont",style:{color:"var(--ion-color-primary)"},children:"\u641c\u5c0b\u6b77\u53f2"}),Object(o.jsx)(g.p,{children:this.props.dictionaryHistory.map((function(t,n){return Object(o.jsx)(g.k,{button:!0,onClick:function(){var n=Object(p.a)(u.a.mark((function n(s){return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t===e.props.match.params.keyword?(e.setState({keyword:t}),e.lookupDict(t)):e.props.history.push("/dictionary/search/".concat(t));case 1:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),children:Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:t},"dictHistoryLabel_"+n)},"dictHistoryItem_".concat(n))}))}),Object(o.jsx)("div",{style:{textAlign:"center"},children:Object(o.jsx)(g.c,{fill:"outline",shape:"round",size:"large",onClick:function(t){e.setState({keyword:""}),e.props.dispatch({type:"SET_KEY_VAL",key:"dictionaryHistory",val:[]})},children:"\u6e05\u9664\u6b77\u53f2"})})]}):Object(o.jsx)("div",{style:{display:"table",tableLayout:"fixed",width:"100%"},children:this.getRows()}),Object(o.jsx)("div",{style:{fontSize:"var(--ui-font-size)",textAlign:"center"},children:Object(o.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2#dictionary",target:"_new",children:"\u4f5b\u5b78\u8a5e\u5178\u8aaa\u660e"})}),Object(o.jsx)(g.a,{cssClass:"uiFont",isOpen:this.state.showNoSelectedTextAlert,backdropDismiss:!1,header:"\u5931\u6557",message:"\u8acb\u78ba\u8a8d\u662f\u5426\u5df2\u9078\u64c7\u4e00\u6bb5\u6587\u5b57\uff0c\u7136\u5f8c\u518d\u57f7\u884c\u6240\u9078\u7684\u529f\u80fd!",buttons:[{text:"\u78ba\u5b9a",cssClass:"primary uiFont",handler:function(t){e.setState({showNoSelectedTextAlert:!1})}}]}),Object(o.jsx)(g.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return e.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."}),Object(o.jsx)(g.H,{cssClass:"uiFont",isOpen:this.state.showToast,onDidDismiss:function(){return e.setState({showToast:!1})},message:this.state.toastMessage,duration:2e3})]})]})}},{key:"isTopPage",get:function(){return void 0===this.props.match.params.keyword}}]),n}(a.a.Component),Me=Object(g.U)(Re),Ve=Object(k.b)((function(e){return{dictionaryHistory:e.settings.dictionaryHistory}}))(Me),Ue=function e(t){Object(b.a)(this,e),this.id=void 0,this.term_hits=void 0,this.work=void 0,this.juan=void 0,this.title=void 0,this.creators=void 0,this.id=t.id,this.term_hits=t.term_hits,this.work=t.work,this.juan=t.juan,this.title=t.title,this.creators=t.creators},ze=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var s;return Object(b.a)(this,n),(s=t.call(this,e)).page=0,s.rows=20,s.state={showSearchAlert:!1,searches:[],isScrollOn:!1,isLoading:!1,fetchError:!1},s}return Object(j.a)(n,[{key:"ionViewWillEnter",value:function(){this.search(this.props.match.params.keyword,!0)}},{key:"componentDidMount",value:function(){}},{key:"search",value:function(){var e=Object(p.a)(u.a.mark((function e(t){var n,s,o,r,a=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]&&a[1],this.setState({isLoading:!0}),n&&(this.page=0,this.setState({searches:[]})),e.prev=3,console.log("Loading page ".concat(this.page)),e.next=7,$.axiosInstance.get("/sphinx?q=".concat(t,"&start=").concat(this.page*this.rows,"&rows=").concat(this.rows),{responseType:"arraybuffer"});case 7:return s=e.sent,o=JSON.parse((new TextDecoder).decode(s.data)).results,r=o.map((function(e){return new Ue(e)})),this.setState({fetchError:!1,isLoading:!1,searches:[].concat(Object(S.a)(this.state.searches),Object(S.a)(r)),isScrollOn:r.length===this.rows}),this.page+=1,e.abrupt("return",!0);case 15:return e.prev=15,e.t0=e.catch(3),console.error(e.t0),console.error((new Error).stack),this.setState({fetchError:!0,isLoading:!1,isScrollOn:!1}),e.abrupt("return",!1);case 21:case"end":return e.stop()}}),e,this,[[3,15]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getRows",value:function(){var e=this,t=Array();return this.state.searches.forEach((function(n,s){var r="".concat(n.title,"\u5377").concat(n.juan,"\n\u4f5c\u8005:").concat(n.creators),a="/catalog/juan/".concat(n.work,"/").concat(n.juan);t.push(Object(o.jsxs)(g.k,{button:!0,onClick:function(){var t=Object(p.a)(u.a.mark((function t(n){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.preventDefault(),e.props.history.push({pathname:a});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:r},"searchLabel_"+s)]},"searchItem_"+s))})),t}},{key:"render",value:function(){var e=this,t=this.getRows();return Object(o.jsxs)(g.s,{children:[Object(o.jsx)(g.g,{children:Object(o.jsxs)(g.J,{children:[Object(o.jsxs)(g.G,{style:{fontSize:"var(--ui-font-size)"},children:["\u5168\u6587\u6aa2\u7d22 - ",this.props.match.params.keyword]}),Object(o.jsx)(g.c,{hidden:this.isTopPage,fill:"clear",slot:"start",onClick:function(t){return e.props.history.goBack()},children:Object(o.jsx)(g.h,{icon:ne.a,slot:"icon-only"})}),Object(o.jsx)(g.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(t){return e.search(e.props.match.params.keyword)},children:Object(o.jsx)(g.h,{icon:ne.E,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"clear",slot:"end",onClick:function(t){return e.props.history.push("/".concat(e.props.match.params.tab))},children:Object(o.jsx)(g.h,{icon:ne.v,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"clear",slot:"end",onClick:function(t){return e.setState({showSearchAlert:!0})},children:Object(o.jsx)(g.h,{icon:ne.H,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"clear",slot:"end",onClick:function(t){e.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})},children:Object(o.jsx)(g.h,{icon:ne.L,slot:"icon-only"})})]})}),Object(o.jsxs)(g.d,{children:[this.state.fetchError?$.fetchErrorContent:Object(o.jsxs)(g.p,{children:[t,Object(o.jsx)(g.i,{threshold:"100px",disabled:!this.state.isScrollOn,onIonInfinite:function(t){e.search(e.props.match.params.keyword),t.target.complete()},children:Object(o.jsx)(g.j,{loadingText:"\u8f09\u5165\u4e2d..."})})]}),Object(o.jsx)(g.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return e.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."}),Object(o.jsx)(oe,Object(d.a)({},Object(d.a)({showSearchAlert:this.state.showSearchAlert,finish:function(){e.setState({showSearchAlert:!1})}},this.props)))]})]})}},{key:"isTopPage",get:function(){return"/catalog"===this.props.match.url}}]),n}(a.a.Component),Ke=Object(g.U)(ze),He=Object(k.b)((function(e){return{}}))(Ke),We=n(220),Je=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var s;return Object(b.a)(this,n),(s=t.call(this,e)).state={isAppSettingsExport:Array(Object.keys($.appSettings).length)},s}return Object(j.a)(n,[{key:"updateQrCode",value:function(){var e=this,t=Object.keys($.appSettings).filter((function(t,n){return e.state.isAppSettingsExport[n]})).map((function(t,n){return{key:t,val:e.props.settings[t]}})).map((function(e){return"".concat(e.key,"=").concat(+e.val)})).join(",");t=""!==t?"settings=".concat(t):null;var n=this.props.text,s=/\?/.test(n);t&&(n+=s?"&".concat(t):"?".concat(t)),$.copyToClipboard(n);var o=document.getElementById("qrcCanvas");return We.toCanvas(o,n),o}},{key:"render",value:function(){var e=this;return Object(o.jsx)(g.r,{isOpen:this.props.showModal,cssClass:"uiFont",swipeToClose:!0,onWillPresent:function(){for(var t=[],n=0;n<e.state.isAppSettingsExport.length;n++)t.push(!1);e.setState({isAppSettingsExport:t}),e.updateQrCode()},onDidDismiss:function(){return e.props.finish()},children:Object(o.jsx)(g.d,{children:Object(o.jsxs)("div",{style:{display:"flex",flexDirection:"column",height:"100%",alignItems:"center"},children:[Object(o.jsx)("div",{children:Object(o.jsx)(g.o,{className:"uiFont",children:"\u6b64\u9801app\u9023\u7d50\u5df2\u8907\u88fd\u81f3\u526a\u8cbc\u7c3f\uff01"})}),Object(o.jsx)("div",{children:Object(o.jsx)(g.o,{className:"uiFont",children:"\u4e5f\u53ef\u4ee5\u4f7f\u7528QR Code\u5206\u4eab:"})}),Object(o.jsx)("div",{style:{flexGrow:1,flexShrink:0,display:"flex",alignItems:"center",margin:10},children:Object(o.jsx)("canvas",{id:"qrcCanvas",width:"500",height:"500",style:{margin:"0px auto"}})}),Object(o.jsxs)("div",{children:[Object(o.jsx)(g.o,{className:"uiFont",children:"\u5305\u62ecapp\u8a2d\u5b9a:"}),Object(o.jsx)(g.p,{children:Object.keys($.appSettings).map((function(t,n){return Object(o.jsxs)(g.k,{children:[Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:$.appSettings[t]}),Object(o.jsx)(g.I,{slot:"end",onIonChange:function(t){var s=e.state.isAppSettingsExport;s[n]=t.detail.checked,e.setState({isAppSettingsExport:s}),e.updateQrCode()}})]},"appSettingExportItem_".concat(n))}))})]}),Object(o.jsx)("div",{children:Object(o.jsx)(g.c,{fill:"outline",shape:"round",size:"large",onClick:function(){return e.props.finish()},children:"\u95dc\u9589"})})]})})})}}]),n}(a.a.Component),Ye=Object(k.b)((function(e){return{settings:e.settings}}))(Je);!function(e){e.NOUN="\u540d",e.VERB="\u52d5"}(ye||(ye={}));var Ge=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var s;return Object(b.a)(this,n),(s=t.call(this,e)).searchBarRef=void 0,s.selectedTextBeforeIonPopover="",s.state={keyword:"",search:null,showNoSelectedTextAlert:!1,popover:{show:!1,event:null},isLoading:!1,fetchError:!1,showToast:!1,toastMessage:""},s.searchBarRef=a.a.createRef(),s}return Object(j.a)(n,[{key:"ionViewWillEnter",value:function(){this.props.match.params.keyword&&(this.setState({keyword:this.props.match.params.keyword}),this.lookupDict(this.props.match.params.keyword))}},{key:"componentDidMount",value:function(){}},{key:"ionViewWillLeave",value:function(){}},{key:"lookupDict",value:function(){var e=Object(p.a)(u.a.mark((function e(t){var n,s,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({isLoading:!0}),e.prev=1,e.next=4,$.axiosInstance.get("https://www.moedict.tw/uni/".concat(t.substring(0,1)),{responseType:"json"});case 4:n=e.sent,this.props.wordDictionaryHistory.unshift(t),this.props.wordDictionaryHistory.splice(10),this.props.dispatch({type:"SET_KEY_VAL",key:"wordDictionaryHistory",val:this.props.wordDictionaryHistory}),this.setState({fetchError:!1,isLoading:!1,search:n.data.heteronyms}),e.next=16;break;case 11:return e.prev=11,e.t0=e.catch(1),o=e.t0,404===(null===(s=o.response)||void 0===s?void 0:s.status)?this.setState({fetchError:!1,isLoading:!1,search:[]}):(console.error(e.t0),console.error((new Error).stack),this.setState({fetchError:!0,isLoading:!1})),e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,this,[[1,11]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getSelectedString",value:function(){var e=document.getSelection();return((null===e||void 0===e?void 0:e.rangeCount)||0)>0&&e.getRangeAt(0).toString().length>0?e.getRangeAt(0).toString():""}},{key:"defToView",value:function(e,t){return void 0!==e&&e.length>0?Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)("div",{style:{color:"var(--ion-color-primary)"},children:t},je.a()),Object(o.jsx)("ol",{children:null===e||void 0===e?void 0:e.map((function(e){var t,n,s;return Object(o.jsxs)("li",{children:[Object(o.jsx)("div",{children:e.def},je.a()),null===(t=e.quote)||void 0===t?void 0:t.map((function(e){return Object(o.jsx)("div",{children:e},je.a())})),null===(n=e.example)||void 0===n?void 0:n.map((function(e){return Object(o.jsx)("div",{children:e},je.a())})),null===(s=e.link)||void 0===s?void 0:s.map((function(e){return Object(o.jsx)("div",{children:e},je.a())}))]},je.a())}))},je.a())]}):Object(o.jsx)(o.Fragment,{})}},{key:"render",value:function(){var e,t,n=this,s=[];this.props.match.params.keyword&&(null===(t=this.state.search)||void 0===t||t.forEach((function(e){var t=null===e||void 0===e?void 0:e.definitions.filter((function(e){return e.type===ye.NOUN})),r=null===e||void 0===e?void 0:e.definitions.filter((function(e){return e.type===ye.VERB})),a=null===e||void 0===e?void 0:e.definitions.filter((function(e){return void 0===e.type})),i=n.defToView(t,"\u540d\u8a5e"),c=n.defToView(r,"\u52d5\u8a5e"),l=n.defToView(a,"");s.push(Object(o.jsxs)("div",{className:"textFont textSelectable",style:{padding:"0 5px"},children:[Object(o.jsx)("div",{className:"textFontX3",children:n.props.match.params.keyword.substring(0,1)},je.a()),(null===e||void 0===e?void 0:e.bopomofo)?Object(o.jsxs)("div",{children:["\u6ce8\u97f3\uff1a",null===e||void 0===e?void 0:e.bopomofo]}):null,(null===e||void 0===e?void 0:e.pinyin)?Object(o.jsxs)("div",{children:["\u62fc\u97f3\uff1a",null===e||void 0===e?void 0:e.pinyin]}):null,i,c,l]},je.a()))})));return Object(o.jsxs)(g.s,{children:[Object(o.jsx)(g.g,{children:Object(o.jsxs)(g.J,{children:[Object(o.jsx)(g.c,{fill:"clear",slot:"start",onClick:function(e){return n.props.history.goBack()},children:Object(o.jsx)(g.h,{icon:ne.a,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"outline",shape:"round",slot:"start",onClick:function(e){n.props.history.push("/dictionary/search")},children:Object(o.jsx)("span",{className:"uiFont",children:"\u840c\u5178\u5b57\u5178"})}),Object(o.jsx)(g.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(e){return n.lookupDict(n.props.match.params.keyword)},children:Object(o.jsx)(g.h,{icon:ne.E,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"clear",slot:"end",onClick:function(e){n.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})},children:Object(o.jsx)(g.h,{icon:ne.L,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"clear",slot:"end",onPointerDown:function(e){n.selectedTextBeforeIonPopover=n.getSelectedString()},onClick:function(e){n.setState({popover:{show:!0,event:e.nativeEvent}})},children:Object(o.jsx)(g.h,{ios:ne.s,md:ne.t,slot:"icon-only"})}),Object(o.jsx)(g.t,{isOpen:this.state.popover.show,event:this.state.popover.event,onDidDismiss:function(e){n.setState({popover:{show:!1,event:null}}),n.selectedTextBeforeIonPopover=""},children:Object(o.jsxs)(g.p,{children:[Object(o.jsxs)(g.k,{button:!0,onClick:function(e){n.props.history.push("/".concat(n.props.match.params.tab,"/searchWord")),n.setState({popover:{show:!1,event:null}})},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.v,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u56de\u9996\u9801"})]}),Object(o.jsxs)(g.k,{button:!0,onClick:function(e){n.setState({popover:{show:!1,event:null}}),$.copyToClipboard(n.selectedTextBeforeIonPopover),n.setState({showToast:!0,toastMessage:"\u8907\u88fd\u6587\u5b57\u6210\u529f"})},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.p,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u8907\u88fd\u6587\u5b57"})]}),Object(o.jsxs)(g.k,{button:!0,onClick:function(e){n.setState({popover:{show:!1,event:null}}),""!==n.selectedTextBeforeIonPopover?n.props.history.push("/dictionary/search/".concat(n.selectedTextBeforeIonPopover)):n.setState({showNoSelectedTextAlert:!0})},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.f,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u67e5\u8a5e\u5178"})]}),Object(o.jsxs)(g.k,{button:!0,onClick:function(e){n.setState({popover:{show:!1,event:null}}),""!==n.selectedTextBeforeIonPopover?n.props.history.push({pathname:"/dictionary/searchWord/".concat(n.selectedTextBeforeIonPopover)}):n.setState({showNoSelectedTextAlert:!0})},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:ne.f,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u67e5\u5b57\u5178"})]})]})})]})}),Object(o.jsx)(g.d,{children:Object(o.jsxs)("div",{style:{display:"flex",flexFlow:"column",height:"100%"},children:[Object(o.jsx)(g.A,{ref:this.searchBarRef,placeholder:"\u8acb\u8f38\u5165\u5b57\uff0c\u518d\u6309\u9375\u76e4Enter\u9375",value:this.state.keyword,onIonClear:function(e){n.setState({search:null})},onKeyUp:function(e){var t=e.target.value;n.setState({keyword:t}),""===t?n.setState({search:null}):"Enter"===e.key&&(t===n.props.match.params.keyword?(n.setState({keyword:t}),n.lookupDict(t)):n.props.history.push("/dictionary/searchWord/".concat(t)))}}),this.state.fetchError?$.fetchErrorContent:((null===(e=this.state.search)||void 0===e?void 0:e.length)||0)<1||this.props.wordDictionaryHistory.length>0&&(""===this.state.keyword||void 0===this.state.keyword)?Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)("div",{className:"uiFont",style:{color:"var(--ion-color-primary)"},children:"\u641c\u5c0b\u6b77\u53f2"}),Object(o.jsx)(g.p,{children:this.props.wordDictionaryHistory.map((function(e,t){return Object(o.jsx)(g.k,{button:!0,onClick:function(){var t=Object(p.a)(u.a.mark((function t(s){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e===n.props.match.params.keyword?(n.setState({keyword:e}),n.lookupDict(e)):n.props.history.push("/dictionary/searchWord/".concat(e));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),children:Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:e},"wordDictHistoryLabel_"+t)},"wordDictHistoryItem_".concat(t))}))}),Object(o.jsx)("div",{style:{textAlign:"center"},children:Object(o.jsx)(g.c,{fill:"outline",shape:"round",size:"large",style:{fontSize:"var(--ui-font-size)"},onClick:function(e){n.setState({keyword:""}),n.props.dispatch({type:"SET_KEY_VAL",key:"wordDictionaryHistory",val:[]})},children:"\u6e05\u9664\u6b77\u53f2"})})]}):s,Object(o.jsx)(g.a,{cssClass:"uiFont",isOpen:this.state.showNoSelectedTextAlert,backdropDismiss:!1,header:"\u5931\u6557",message:"\u8acb\u78ba\u8a8d\u662f\u5426\u5df2\u9078\u64c7\u4e00\u6bb5\u6587\u5b57\uff0c\u7136\u5f8c\u518d\u57f7\u884c\u6240\u9078\u7684\u529f\u80fd!",buttons:[{text:"\u78ba\u5b9a",cssClass:"primary uiFont",handler:function(e){n.setState({showNoSelectedTextAlert:!1})}}]}),Object(o.jsx)(g.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return n.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."}),Object(o.jsx)(g.H,{cssClass:"uiFont",isOpen:this.state.showToast,onDidDismiss:function(){return n.setState({showToast:!1})},message:this.state.toastMessage,duration:2e3})]})})]})}},{key:"isTopPage",get:function(){return this.props.match.url==="/".concat(this.props.match.params.tab)}}]),n}(a.a.Component),qe=Object(g.U)(Ge),Xe=Object(k.b)((function(e){return{wordDictionaryHistory:e.settings.wordDictionaryHistory}}))(qe),Qe=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var s;return Object(b.a)(this,n),(s=t.call(this,e)).state={isAppSettingsExport:Array(Object.keys($.appSettings).length)},s}return Object(j.a)(n,[{key:"render",value:function(){return Object(o.jsx)(g.r,{isOpen:this.props.showModal,cssClass:"uiFont",backdropDismiss:!1,swipeToClose:!1,children:Object(o.jsx)(g.d,{children:Object(o.jsxs)("div",{style:{display:"flex",flexDirection:"column",height:"100%",alignItems:"center"},children:[Object(o.jsx)("div",{style:{marginBottom:"50px"},children:Object(o.jsx)(g.o,{className:"uiFont",children:"\u5f8c\u7aefapp\u4e0b\u8f09\u9032\u5ea6"})}),Object(o.jsx)(g.u,{style:{height:"40px"},value:this.props.progress}),Object(o.jsxs)(g.o,{className:"uiFont",children:[Math.floor(100*this.props.progress),"%"]})]})})})}}]),n}(a.a.Component),$e=Object(k.b)((function(e){return{}}))(Qe),Ze=window.electronBackendApi,et=function(){var e=localStorage.getItem($.storeFile);return null!=e?Object(w.c)(ee,JSON.parse(e)):Object(w.c)(ee)}();Object(g.T)({mode:"md",swipeBackEnabled:!1});var tt={onSuccess:function(e){},onUpdate:function(e){}},nt=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(){return Object(b.a)(this,n),t.apply(this,arguments)}return Object(j.a)(n,[{key:"render",value:function(){return Object(o.jsx)(k.a,{store:et,children:Object(o.jsx)(ot,Object(d.a)({},this.props))})}}]),n}(a.a.Component),st=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var s;for(Object(b.a)(this,n),(s=t.call(this,e)).registrationNew=void 0,s.originalAppSettingsStr=void 0,s.wakeLock=void 0,s.props.settings.hasAppLog||$.disableAppLog(),null===Ze||void 0===Ze||Ze.receive("fromMain",(function(e){switch(e.event){case"version":et.dispatch({type:"TMP_SET_KEY_VAL",key:"mainVersion",val:e.version});break;case"cbetaOfflineDbMode":et.dispatch({type:"TMP_SET_KEY_VAL",key:"cbetaOfflineDbMode",val:e.isOn});break;case"DownloadingBackend":s.setState({downloadModal:{show:!0,progress:e.progress/100}});break;case"DownloadingBackendDone":s.setState({downloadModal:{show:!1,progress:s.state.downloadModal.progress}})}})),null===Ze||void 0===Ze||Ze.send("toMain",{event:"ready"}),s.registrationNew=null,Object(g.S)("android")?window.oncontextmenu=$.disableAndroidChromeCallout:Object(g.S)("ios")&&(document.ontouchend=$.disableIosSafariCallout.bind(window)),$.isTouchDevice()&&(window.onorientationchange=function(e){setTimeout((function(){s.forceUpdate()}),500)});document.body.classList.length>0;)document.body.classList.remove(document.body.classList.item(0));document.body.classList.toggle("theme".concat(s.props.settings.theme),!0),document.body.classList.toggle("print".concat(s.props.settings.printStyle),!0);var o=O.a.parse(s.props.location.search);return o.settings&&(s.originalAppSettingsStr=localStorage.getItem($.storeFile),o.settings.split(",").forEach((function(e){var t=e.split("=");s.props.dispatch({type:"SET_KEY_VAL",key:t[0],val:+t[1]})}))),$.updateCssVars(s.props.settings),s.state={showUpdateAlert:!1,showRestoreAppSettingsToast:null!=o.settings&&null!=s.originalAppSettingsStr||!1,showToast:!1,toastMessage:"",downloadModal:{progress:0,show:!1}},tt.onUpdate=function(e){s.registrationNew=e,s.setState({showUpdateAlert:!0})},tt.onSuccess=function(e){},"undefined"!==typeof speechSynthesis&&(speechSynthesis.getVoices(),speechSynthesis.cancel()),navigator.wakeLock&&(s.wakeLockScreen(),document.addEventListener("visibilitychange",Object(p.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"visible"===document.visibilityState?s.wakeLockScreen():s.wakeLockScreenRelease();case 1:case"end":return e.stop()}}),e)}))))),indexedDB.open($.cbetardb).onupgradeneeded=function(e){e.target.result.createObjectStore("store")},s.loadTwKaiFont(),s}return Object(j.a)(n,[{key:"restoreAppSettings",value:function(){for(localStorage.setItem($.storeFile,this.originalAppSettingsStr),this.props.dispatch({type:"LOAD_SETTINGS"});document.body.classList.length>0;)document.body.classList.remove(document.body.classList.item(0));document.body.classList.toggle("theme".concat(this.props.settings.theme),!0),document.body.classList.toggle("print".concat(this.props.settings.printStyle),!0),$.updateCssVars(this.props.settings)}},{key:"loadTwKaiFont",value:function(){var e=Object(p.a)(u.a.mark((function e(){var t,n,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,$.getFileFromIndexedDB($.twKaiFontKey);case 3:t=e.sent,e.next=13;break;case 6:return e.prev=6,e.t0=e.catch(0),e.next=10,$.axiosInstance.get("".concat(window.location.origin,"/").concat($.twKaiFontPath),{responseType:"arraybuffer",timeout:0});case 10:n=e.sent,t=n.data,$.saveFileToIndexedDB($.twKaiFontKey,t);case 13:return s=new window.FontFace("Kai",t),e.next=16,s.load();case 16:document.fonts.add(s),console.log("[Main] TW-Kai font loading success!");case 18:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"wakeLockScreen",value:function(){var e=Object(p.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,null==(t=navigator.wakeLock)){e.next=9;break}return e.next=5,t.request("screen");case 5:this.wakeLock=e.sent,console.log("Screen wake lock is requested."),e.next=10;break;case 9:console.error("navigator.wakeLock is undefined.");case 10:e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.log("".concat(e.t0.name,", ").concat(e.t0.message)),console.log((new Error).stack);case 16:case"end":return e.stop()}}),e,this,[[0,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"wakeLockScreenRelease",value:function(){var e=Object(p.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.wakeLock){e.next=5;break}return e.next=3,this.wakeLock.release();case 3:this.wakeLock=null,console.log("Screen wake lock is released.");case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"routeByQueryString",value:function(){console.log(window.location.search);var e=/route=([^&]*)/.exec(window.location.search),t=/query=([^&]*)/.exec(window.location.search);if(null!==e){var n="";return null!==t&&(n=decodeURIComponent(t[1])),Object(o.jsx)(x.a,{to:e[1]+n})}if("/"===window.location.pathname)return Object(o.jsx)(x.a,{to:"/bookmarks"})}},{key:"render",value:function(){var e,t,n=this;return Object(o.jsxs)(g.b,{style:$.isTouchDevice()?{height:"".concat(window.innerHeight,"px")}:{},children:[Object(o.jsx)(m.a,{children:Object(o.jsxs)(g.F,{children:[Object(o.jsxs)(g.z,{animated:!1,children:[Object(o.jsx)(x.b,{path:"/:tab(catalog)/webview/:work/:path/:label",render:function(e){return Object(o.jsx)(Se,Object(d.a)({},e))},exact:!0}),Object(o.jsx)(x.b,{path:"/:tab(catalog)/juan/:work/:path/",render:function(e){return Object(o.jsx)(Se,Object(d.a)({},e))},exact:!0}),Object(o.jsx)(x.b,{path:"/:tab(catalog)/work/:path/:label",render:function(e){return Object(o.jsx)(de,Object(d.a)({},e))},exact:!0}),Object(o.jsx)(x.b,{path:"/:tab(catalog)/work/:path",render:function(e){return Object(o.jsx)(de,Object(d.a)({},e))},exact:!0}),Object(o.jsx)(x.b,{path:"/:tab(catalog)/search/:keyword",render:function(e){return Object(o.jsx)(_e,Object(d.a)({},e))},exact:!0}),Object(o.jsx)(x.b,{path:"/:tab(catalog)/fulltextsearch/:keyword",render:function(e){return Object(o.jsx)(He,Object(d.a)({},e))},exact:!0}),Object(o.jsx)(x.b,{path:"/:tab(catalog)/catalog/:path/:label",render:function(e){return Object(o.jsx)(le,Object(d.a)({},e))},exact:!0}),Object(o.jsx)(x.b,{path:"/:tab(catalog)/:type(catalog|volumes|famous)?/:path?",render:function(e){return Object(o.jsx)(le,Object(d.a)({},e))},exact:!0}),Object(o.jsx)(x.b,{path:"/:tab(bookmarks)",render:function(e){return Object(o.jsx)(Ne,Object(d.a)({},e))},exact:!0}),Object(o.jsx)(x.b,{path:"/:tab(dictionary)/search/:keyword?",render:function(e){return Object(o.jsx)(Ve,Object(d.a)({},e))},exact:!0}),Object(o.jsx)(x.b,{path:"/:tab(dictionary)/searchWord/:keyword?",render:function(e){return Object(o.jsx)(Xe,Object(d.a)({},e))},exact:!0}),Object(o.jsx)(x.b,{path:"/settings",render:function(e){return Object(o.jsx)(Ie,Object(d.a)({},e))}}),Object(o.jsx)(x.b,{path:"/",render:function(){return n.routeByQueryString()},exact:!0})]}),Object(o.jsxs)(g.D,{slot:"bottom",children:[Object(o.jsx)(g.E,{tab:"bookmarks",href:"/bookmarks",children:Object(o.jsx)(g.h,{icon:ne.g})}),Object(o.jsx)(g.E,{tab:"catalog",href:"/catalog",children:Object(o.jsx)(g.h,{icon:ne.x})}),Object(o.jsx)(g.E,{tab:"dictionay",href:"/dictionary/search",children:Object(o.jsx)(g.h,{icon:ne.f})}),Object(o.jsx)(g.E,{tab:"settings",href:"/settings",children:Object(o.jsx)(g.h,{icon:ne.K})})]})]})}),Object(o.jsx)(g.a,{cssClass:"uiFont",isOpen:this.state.showUpdateAlert,backdropDismiss:!1,onDidPresent:function(e){var t,s,o,r;null===(t=n.registrationNew)||void 0===t||null===(s=t.installing)||void 0===s||s.postMessage({type:"SKIP_WAITING"}),null===(o=n.registrationNew)||void 0===o||null===(r=o.waiting)||void 0===r||r.postMessage({type:"SKIP_WAITING"})},header:"\u8acb\u91cd\u555f app!",buttons:[{text:"\u95dc\u9589",cssClass:"primary uiFont",handler:function(e){n.setState({showUpdateAlert:!1})}}]}),Object(o.jsx)(Ye,Object(d.a)({},Object(d.a)({text:null===(e=this.props.shareTextModal)||void 0===e?void 0:e.text,showModal:(null===(t=this.props.shareTextModal)||void 0===t?void 0:t.show)||!1,finish:function(){et.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!1}})}},this.props))),Object(o.jsx)($e,Object(d.a)({},Object(d.a)({progress:this.state.downloadModal.progress,showModal:this.state.downloadModal.show},this.props))),Object(o.jsx)(g.H,{cssClass:"uiFont",isOpen:this.state.showRestoreAppSettingsToast,onDidDismiss:function(){return n.setState({showRestoreAppSettingsToast:!1})},message:"\u5df2\u5957\u7528app\u9023\u7d50\u4e2d\u7684\u8a2d\u5b9a\uff0c\u662f\u5426\u9084\u539f\u8a2d\u5b9a\uff1f",buttons:[{text:"\u53d6\u6d88",role:"cancel",handler:function(){return n.setState({showRestoreAppSettingsToast:!1})}},{text:"\u9084\u539f",handler:function(){return n.restoreAppSettings()}}]}),Object(o.jsx)(g.H,{cssClass:"uiFont",isOpen:this.state.showToast,onDidDismiss:function(){return n.setState({showToast:!1})},message:this.state.toastMessage,duration:2e3})]})}}]),n}(a.a.Component),ot=Object(k.b)((function(e){return{shareTextModal:e.tmpSettings.shareTextModal,settings:e.settings}}))(st),rt=Object(x.f)(nt),at=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function it(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){console.log("installingWorker stage changed: ".concat(n.state)),"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}$.enableAppLog(),c.a.render(Object(o.jsx)(l.a,{children:Object(o.jsx)(rt,{})}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("","/service-worker.js");at?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var s=n.headers.get("content-type");404===n.status||null!=s&&-1===s.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):it(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):it(t,e)}))}}({onSuccess:function(e){console.log("Precache app loaded!"),tt.onSuccess(e)},onUpdate:function(e){console.log("Found app updated!"),tt.onUpdate(e)}})}},[[443,3,4]]]);
//# sourceMappingURL=main.433a3f79.chunk.js.map