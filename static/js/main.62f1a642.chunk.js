(this.webpackJsonpcbetar2=this.webpackJsonpcbetar2||[]).push([[1],{122:function(e){e.exports=JSON.parse('{"name":"cbetar2","version":"4.13.0","private":true,"dependencies":{"@ionic/react":"^5.5.2","@ionic/react-router":"^5.5.2","@testing-library/jest-dom":"^4.2.4","@testing-library/react":"^9.4.0","@testing-library/user-event":"^8.0.3","@types/jest":"^24.0.25","@types/node":"^12.19.8","@types/react":"^16.14.2","@types/react-dom":"^16.9.10","@types/react-router":"^5.1.8","@types/react-router-dom":"^5.1.6","axios":"^0.19.2","epubjs-myh":"^0.3.111","history":"^4.10.1","ionicons":"^5.2.3","memfs":"^3.2.0","nodepub":"^2.2.0","qrcode":"^1.4.4","query-string":"^6.13.7","react":"^16.14.0","react-dom":"^16.14.0","react-redux":"^7.2.2","react-router":"^5.2.0","react-router-dom":"^5.2.0","react-scripts":"^3.4.4","redux":"^4.0.5","swiped-events-myh":"^1.2.0","typescript":"3.8.3","uuid":"^8.3.1"},"scripts":{"start":"react-app-rewired start","build":"react-app-rewired build && powershell -file CopyBuild.ps1","build_linux":"react-app-rewired build && ./CopyBuild.sh","test":"react-app-rewired test","eject":"react-scripts eject","android":"npx cap open android","sync":"npx cap sync android"},"eslintConfig":{"extends":"react-app"},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]},"devDependencies":{"@types/qrcode":"^1.3.5","@types/react-redux":"^7.1.11","@types/uuid":"^8.3.0","customize-cra":"^1.0.0","react-app-rewired":"^2.1.7"},"description":"An Ionic project"}')},138:function(e,t,n){},211:function(e,t,n){e.exports=n(430)},217:function(e,t,n){var a={"./ion-action-sheet.entry.js":[432,5],"./ion-alert.entry.js":[433,6],"./ion-app_8.entry.js":[434,7],"./ion-avatar_3.entry.js":[435,17],"./ion-back-button.entry.js":[436,18],"./ion-backdrop.entry.js":[437,43],"./ion-button_2.entry.js":[438,19],"./ion-card_5.entry.js":[439,20],"./ion-checkbox.entry.js":[440,21],"./ion-chip.entry.js":[441,22],"./ion-col_3.entry.js":[442,44],"./ion-datetime_3.entry.js":[443,10],"./ion-fab_3.entry.js":[444,23],"./ion-img.entry.js":[445,45],"./ion-infinite-scroll_2.entry.js":[446,46],"./ion-input.entry.js":[447,24],"./ion-item-option_3.entry.js":[448,25],"./ion-item_8.entry.js":[449,26],"./ion-loading.entry.js":[450,27],"./ion-menu_3.entry.js":[451,28],"./ion-modal.entry.js":[452,8],"./ion-nav_2.entry.js":[453,14],"./ion-popover.entry.js":[454,9],"./ion-progress-bar.entry.js":[455,29],"./ion-radio_2.entry.js":[456,30],"./ion-range.entry.js":[457,31],"./ion-refresher_2.entry.js":[458,11],"./ion-reorder_2.entry.js":[459,16],"./ion-ripple-effect.entry.js":[460,47],"./ion-route_4.entry.js":[461,32],"./ion-searchbar.entry.js":[462,33],"./ion-segment_2.entry.js":[463,34],"./ion-select_3.entry.js":[464,35],"./ion-slide_2.entry.js":[465,48],"./ion-spinner.entry.js":[466,13],"./ion-split-pane.entry.js":[467,49],"./ion-tab-bar_2.entry.js":[468,36],"./ion-tab_2.entry.js":[469,15],"./ion-text.entry.js":[470,37],"./ion-textarea.entry.js":[471,38],"./ion-toast.entry.js":[472,39],"./ion-toggle.entry.js":[473,12],"./ion-virtual-scroll.entry.js":[474,50]};function r(e){if(!n.o(a,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=a[e],r=t[0];return n.e(t[1]).then((function(){return n(r)}))}r.keys=function(){return Object.keys(a)},r.id=217,e.exports=r},219:function(e,t,n){var a={"./ion-icon.entry.js":[476,57]};function r(e){if(!n.o(a,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=a[e],r=t[0];return n.e(t[1]).then((function(){return n(r)}))}r.keys=function(){return Object.keys(a)},r.id=219,e.exports=r},252:function(e,t,n){},253:function(e,t,n){},296:function(e,t){},298:function(e,t){},330:function(e,t){},332:function(e,t){},338:function(e,t){},340:function(e,t){},348:function(e,t){},350:function(e,t){},360:function(e,t){},362:function(e,t){},408:function(e,t,n){},409:function(e,t,n){},430:function(e,t,n){"use strict";n.r(t);var a,r=n(0),o=n.n(r),s=n(68),i=n.n(s),c=n(89),l=n(32),u=n(4),p=n.n(u),h=n(9),d=n(3),m=n(5),f=n(11),v=n(12),g=n(17),k=n(1),y=n(200),b=n(22),w=n(50),E=n.n(w),S=n(58),x=n(21),T=n(202),C=n.n(T);!function(e){e[e.BY_CHAPTER=0]="BY_CHAPTER",e[e.BY_JUAN=1]="BY_JUAN"}(a||(a={}));var j=function e(t){Object(d.a)(this,e),this.title=void 0,this.juan=void 0,this.title=t.title,this.juan=t.juan},A=function e(t){Object(d.a)(this,e),this.title=void 0,this.juan=void 0,this.juan_list=void 0,this.mulu=void 0,this.work=void 0,this.vol=void 0,this.title=t.title,this.juan=t.juan,this.juan_list=t.juan_list,this.mulu=t.mulu,this.work=t.work,this.vol=t.vol},I="https://cbdata.dila.edu.tw/".concat("v1.2"),O="",F=C.a.create({baseURL:I,timeout:3e3});function L(e){switch(e){case 0:return 0;case 1:return 20;case 2:return 40}}function N(e,t){return"".concat(e,"_juan").concat(t,".html")}function P(e){return D.apply(this,arguments)}function D(){return(D=Object(h.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=indexedDB.open("cbetardb"),e.abrupt("return",new Promise((function(e,a){n.onsuccess=function(){var r=Object(h.a)(p.a.mark((function r(o){var s,i,c;return p.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:s=n.result,i=s.transaction(["store"],"readwrite"),(c=i.objectStore("store").get(t)).onsuccess=function(){var n=Object(h.a)(p.a.mark((function n(r){var o;return p.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=c.result){n.next=5;break}return console.error("".concat(t," loading failed!")),console.error((new Error).stack),n.abrupt("return",a());case 5:return n.abrupt("return",e(o));case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();case 4:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(){return(_=Object(h.a)(p.a.mark((function e(t,n){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=indexedDB.open("cbetardb"),e.abrupt("return",new Promise((function(e,r){a.onsuccess=function(){var r=Object(h.a)(p.a.mark((function r(o){var s,i;return p.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:s=a.result,i=s.transaction(["store"],"readwrite"),i.objectStore("store").put(n,t).onsuccess=function(t){return e()};case 4:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(){return(B=Object(h.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=indexedDB.open("cbetardb"),e.abrupt("return",new Promise((function(e,a){n.onsuccess=function(){var a=Object(h.a)(p.a.mark((function a(r){var o,s;return p.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:o=n.result,s=o.transaction(["store"],"readwrite"),s.objectStore("store").delete(t).onsuccess=function(t){return e()};case 4:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}()})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(){return(R=Object(h.a)(p.a.mark((function e(t,n,a){var r,o,s,i,c,l,u,h,d,m,f,v,g,k=arguments;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=k.length>3&&void 0!==k[3]&&k[3],o=a||N(t,n),s=null,e.prev=3,e.next=6,P(o);case 6:s=e.sent,e.next=11;break;case 9:e.prev=9,e.t0=e.catch(3);case 11:if(i=localStorage.getItem("Settings.json"),c=new A({}),i&&(u=JSON.parse(i).settings.bookmarks,l=u.find((function(e){return e.fileName===o||e.uuid===t}))),null===s||void 0===l||r){e.next=18;break}c=l.work,e.next=38;break;case 18:if(!a){e.next=27;break}return e.next=21,F.get("/".concat(a),{responseType:"arraybuffer"});case 21:h=e.sent,d=new TextDecoder,m=d.decode(h.data),s=m.includes("charset=big5")?new TextDecoder("big5").decode(h.data):m,e.next=33;break;case 27:return e.next=29,F.get("/juans?edition=CBETA&work_info=1&work=".concat(t,"&juan=").concat(n),{responseType:"arraybuffer"});case 29:f=e.sent,v=JSON.parse((new TextDecoder).decode(f.data)),s=v.results[0],c=v.work_info;case 33:(g=document.implementation.createHTMLDocument("")).body.innerHTML=s,s=(s=(s=(new XMLSerializer).serializeToString(g.body)).replace("<body","<div")).replace("/body>","/div>");case 38:return e.abrupt("return",{htmlStr:s,workInfo:c});case 39:case"end":return e.stop()}}),e,null,[[3,9]])})))).apply(this,arguments)}var z=console.log.bind(console),V=console.error.bind(console);var U,M={storeFile:"Settings.json",fontSizeNorm:24,fontSizeLarge:48,getLog:function(){return O},enableAppLog:function(){console.log=function(){O+="----- Info ----\n",O+=Array.from(arguments)+"\n",z.apply(console,arguments)},console.error=function(){O+="----- Error ----\n",O+=Array.from(arguments)+"\n",V.apply(console,arguments)}},disableAppLog:function(){O="",console.log=z,console.error=V},cbetardb:"cbetardb",apiVersion:"v1.2",cbetaApiUrl:I,dilaDictApiUrl:"https://glossaries.dila.edu.tw/search.json",twKaiFontKey:"twKaoFont",twKaiFontPath:"/assets/TW-Kai-98_1.woff",axiosInstance:F,topCatalogsByCat:{CBETA:"CBETA \u90e8\u985e","Cat-T":"\u5927\u6b63\u85cf","Cat-X":"\u534d\u7e8c\u85cf","Cat-N":"\u5357\u50b3\u5927\u85cf\u7d93",others:"\u6b77\u4ee3\u85cf\u7d93\u88dc\u8f2f",modern:"\u8fd1\u4ee3\u65b0\u7de8\u6587\u737b"},topCatalogsByVol:{"Vol-T":"T \u5927\u6b63\u85cf","Vol-X":"X \u534d\u7e8c\u85cf","Vol-A":"A \u8d99\u57ce\u91d1\u85cf","Vol-K":"K \u9ad8\u9e97\u5927\u85cf\u7d93-\u65b0\u6587\u8c50\u7248","Vol-S":"S \u5b8b\u85cf\u907a\u73cd-\u65b0\u6587\u8c50\u7248","Vol-F":"F \u623f\u5c71\u77f3\u7d93","Vol-C":"C \u4e2d\u83ef\u5927\u85cf\u7d93-\u4e2d\u83ef\u66f8\u5c40\u7248","Vol-U":"U \u6d2a\u6b66\u5357\u85cf","Vol-P":"P \u6c38\u6a02\u5317\u85cf","Vol-J":"J \u5609\u8208\u85cf","Vol-L":"L \u4e7e\u9686\u5927\u85cf\u7d93-\u65b0\u6587\u8c50\u7248","Vol-G":"G \u4f5b\u6559\u5927\u85cf\u7d93","Vol-M":"M \u534d\u6b63\u85cf\u7d93-\u65b0\u6587\u8c50\u7248","Vol-D":"D \u570b\u5716\u5584\u672c","Vol-N":"N \u5357\u50b3\u5927\u85cf\u7d93(\u518a\u5225)","Vol-ZS":"ZS \u6b63\u53f2\u4f5b\u6559\u8cc7\u6599\u985e\u7de8","Vol-I":"I \u5317\u671d\u4f5b\u6559\u77f3\u523b\u62d3\u7247\u767e\u54c1","Vol-ZW":"ZW \u85cf\u5916\u4f5b\u6559\u6587\u737b","Vol-B":"B \u5927\u85cf\u7d93\u88dc\u7de8","Vol-GA":"GA \u4e2d\u570b\u4f5b\u5bfa\u53f2\u5fd7\u5f59\u520a","Vol-GB":"GB \u4e2d\u570b\u4f5b\u5bfa\u5fd7\u53e2\u520a","Vol-Y":"Y \u5370\u9806\u6cd5\u5e2b\u4f5b\u5b78\u8457\u4f5c\u96c6","Vol-LC":"LC \u5442\u6f82\u4f5b\u5b78\u8457\u4f5c\u96c6"},appSettings:{theme:"\u4f48\u666f\u4e3b\u984c",rtlVerticalLayout:"\u7d93\u6587\u76f4\u6392\u3001\u53f3\u81f3\u5de6\u66f8\u5beb",paginated:"\u55ae\u9801/\u5206\u9801",showComments:"\u986f\u793a\u7d93\u6587\u8a3b\u89e3\u3001\u7248\u6b0a",useFontKai:"\u9ed1\u9ad4/\u6977\u66f8\u5b57\u9ad4",uiFontSize:"UI\u5b57\u578b\u5927\u5c0f",fontSize:"\u7d93\u6587\u5b57\u578b\u5927\u5c0f",printStyle:"\u7d93\u6587\u5217\u5370\u6a23\u5f0f"},fetchErrorContent:o.a.createElement("div",{className:"contentCenter"},o.a.createElement(k.o,null,o.a.createElement("div",null,o.a.createElement("div",null,"\u9023\u7dda\u5931\u6557!"),o.a.createElement("div",{style:{fontSize:"var(--ui-font-size)",paddingTop:24}},"\u5982\u679c\u554f\u984c\u6301\u7e8c\u767c\u751f\uff0c\u8acb\u57f7\u884c",o.a.createElement("a",{href:"/settings",target:"_self"},"\u8a2d\u5b9a\u9801"),"\u7684app\u7570\u5e38\u56de\u5831\u529f\u80fd\u3002")))),updateApp:function(){return new Promise(function(){var e=Object(h.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:navigator.serviceWorker.getRegistrations().then(function(){var e=Object(h.a)(p.a.mark((function e(n){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(n.map((function(e){return e.update().then((function(e){return null!==e.installing||null!==e.waiting}))})));case 2:a=e.sent,t(a.reduce((function(e,t){return e||t}),!1));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},scrollbarSizeIdToValue:L,updateCssVars:function(e){var t=L(e.scrollbarSize);document.documentElement.style.cssText="--ion-font-family: ".concat(e.useFontKai?"Heiti, Times, Kai":"Times, Heiti",";\n        --scrollbar-size: ").concat(t,"px; --ui-font-size: ").concat(e.uiFontSize,"px; --text-font-size: ").concat(e.fontSize,"px")},isTouchDevice:function(){return Object(k.S)("ios")||Object(k.S)("android")},fetchJuan:function(e,t,n){return R.apply(this,arguments)},getFileName:N,getFileFromIndexedDB:P,saveFileToIndexedDB:function(e,t){return _.apply(this,arguments)},removeFileFromIndexedDB:function(e){return B.apply(this,arguments)},removeElementsByClassName:function(e,t){for(var n=e.getElementsByClassName(t);n.length>0;){var a;null===(a=n[0].parentNode)||void 0===a||a.removeChild(n[0])}},disableAndroidChromeCallout:function(e){return e.preventDefault(),e.stopPropagation(),!1},disableIosSafariCallout:function(e){var t=this.getSelection();if(((null===t||void 0===t?void 0:t.rangeCount)||0)>0){var n=null===t||void 0===t?void 0:t.getRangeAt(0);null===t||void 0===t||t.removeAllRanges(),setTimeout((function(){null===t||void 0===t||t.addRange(n)}),50)}},copyToClipboard:function(e){navigator.clipboard&&navigator.clipboard.writeText(e)}};!function(e){e[e.CATALOG=0]="CATALOG",e[e.WORK=1]="WORK",e[e.JUAN=2]="JUAN",e[e.HTML=3]="HTML"}(U||(U={}));var K=function e(t){Object(d.a)(this,e),this.type=U.CATALOG,this.uuid="",this.work=null,this.selectedText="",this.epubcfi="",this.fileName="",this.type=t.type,this.uuid=t.uuid,this.work=t.work,this.selectedText=t.selectedText,this.epubcfi=t.epubcfi,this.fileName=t.fileName};var H=Object(S.b)({settings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=Object(l.a)({},e);switch(t.type){case"LOAD_SETTINGS":n=JSON.parse(localStorage.getItem(M.storeFile)).settings;break;case"SET_KEY_VAL":var a=t.key,r=t.val;switch(a){case"theme":document.body.classList.forEach((function(e){return document.body.classList.remove(e)})),document.body.classList.toggle("theme".concat(r),!0);break;case"printStyle":document.body.classList.forEach((function(e){/print/.test(e)&&document.body.classList.remove(e)})),document.body.classList.toggle("print".concat(r),!0)}n[a]=r,localStorage.setItem(M.storeFile,JSON.stringify({settings:n}));break;case"ADD_BOOKMARK":var o=n.bookmarks,s=t.bookmark.fileName;null===s||""===s||o.some((function(e){return e.fileName===s}))||M.saveFileToIndexedDB(s,t.htmlStr),n.bookmarks=[].concat(Object(x.a)(n.bookmarks),[t.bookmark]),localStorage.setItem(M.storeFile,JSON.stringify({settings:n}));break;case"DEL_BOOKMARK":var i=n.bookmarks,c=i.findIndex((function(e){return e.uuid===t.uuid}));if(-1!==c){var u=i.splice(c,1);if(1===u.length){var p=u[0],h=p.fileName,d=null==i.find((function(e){return e.type===U.JUAN&&e.uuid===p.uuid})),m=null==i.find((function(e){var t,n;return e.type===U.WORK&&(null===(t=e.work)||void 0===t?void 0:t.work)===(null===(n=p.work)||void 0===n?void 0:n.work)}));if(m)switch(p.type){case U.WORK:var f=p.work;if(null==f)break;for(var v=f.juan_list.split(","),g=function(e){var t=M.getFileName(f.work,v[e]);(d=null==i.find((function(e){return e.type===U.JUAN&&e.fileName===t})))&&M.removeFileFromIndexedDB(t)},k=0;k<v.length;k++)g(k);break;case U.JUAN:d&&M.removeFileFromIndexedDB(h)}}}n.bookmarks=Object(x.a)(i),localStorage.setItem(M.storeFile,JSON.stringify({settings:n}));break;case"UPDATE_BOOKMARKS":n.bookmarks=t.bookmarks,localStorage.setItem(M.storeFile,JSON.stringify({settings:n}));break;default:0===Object.keys(n).length&&(n={});for(var y=["version","hasAppLog","theme","paginated","rtlVerticalLayout","scrollbarSize","useFontKai","fontSize","uiFontSize","showComments","printStyle","speechRate","bookmarks","dictionaryHistory","wordDictionaryHistory"],b=[1,1,0,1,1,2,1,32,24,0,0,.8,[],[],[]],w=0;w<y.length;w++)void 0===n[y[w]]&&(n[y[w]]=b[w])}return n},tmpSettings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=Object(l.a)({},e),a=t.key,r=t.val;switch(n[a]=r,t.type){case"TMP_SET_KEY_VAL":return n}return e}});var J,W=n(6),Y=(n(252),function e(t){Object(d.a)(this,e),this.n=void 0,this.nodeType=void 0,this.label=void 0,this.work=void 0,this.file=void 0,this.n=t.n,this.nodeType=t.node_type,this.label=t.label,this.work=t.work,this.file=t.file}),G=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(m.a)(n,[{key:"render",value:function(){var e=this;return o.a.createElement(k.a,{cssClass:"uiFont",isOpen:this.props.showSearchAlert,header:"\u641c\u5c0b\u7d93\u66f8",subHeader:"\u8f38\u5165\u641c\u5c0b",inputs:[{name:"name0",type:"search",placeholder:"\u4f8b:\u91d1\u525b\u822c\u82e5"}],buttons:[{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary uiFont",handler:function(){return e.props.finish()}},{text:"\u641c\u5c0b\u76ee\u9304",cssClass:"primary uiFont",handler:function(t){e.props.finish(),e.props.history.push("/catalog/search/".concat(t.name0))}},{text:"\u5168\u6587\u6aa2\u7d22",cssClass:"primary uiFont",handler:function(t){e.props.finish(),e.props.history.push("/catalog/fulltextsearch/".concat(t.name0))}}]})}}]),n}(o.a.Component),q=[{title:"\u822c\u82e5\u6ce2\u7f85\u871c\u591a\u5fc3\u7d93",url:"/catalog/juan/T0251/1"},{title:"\u91d1\u525b\u822c\u82e5\u6ce2\u7f85\u871c\u7d93",url:"/catalog/juan/T0235/1"},{title:"\u4f5b\u8aaa\u963f\u5f4c\u9640\u7d93",url:"/catalog/juan/T0366/1"},{title:"\u85e5\u5e2b\u7409\u7483\u5149\u5982\u4f86\u672c\u9858\u529f\u5fb7\u7d93",url:"/catalog/juan/T0450/1"},{title:"\u4f5b\u8aaa\u89c0\u5f4c\u52d2\u83e9\u85a9\u4e0a\u751f\u515c\u7387\u5929\u7d93",url:"/catalog/juan/T0452/1"},{title:"\u5730\u85cf\u83e9\u85a9\u672c\u9858\u7d93",url:"/catalog/juan/T0412/1"},{title:"\u5999\u6cd5\u84ee\u83ef\u7d93\u89c0\u4e16\u97f3\u83e9\u85a9\u666e\u9580\u54c1\u7d93",url:"/catalog/juan/T0262/7"},{title:"\u5927\u4f5b\u9802\u5982\u4f86\u5bc6\u56e0\u4fee\u8b49\u4e86\u7fa9\u8af8\u83e9\u85a9\u842c\u884c\u9996\u695e\u56b4\u7d93\u5377\u7b2c\u4e00",url:"/catalog/juan/T0945/1"},{title:"\u4f5b\u8aaa\u6cd5\u6ec5\u76e1\u7d93",url:"/catalog/juan/T0396/1"}],X=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).state={topCatalogsType:0,fetchError:!1,catalogs:[],pathLabel:"",showSearchAlert:!1,isLoading:!1},a}return Object(m.a)(n,[{key:"ionViewWillEnter",value:function(){console.log("".concat(this.props.match.url," will enter."));var e=-1;switch(this.props.match.url){case"/catalog":e=0;break;case"/catalog/volumes":e=1;break;case"/catalog/famous":e=2;break;default:e=-1}this.setState({topCatalogsType:e}),this.fetchData(this.props.match.params.path)}},{key:"componentDidMount",value:function(){console.log("did mount: ".concat(this.props.match.url))}},{key:"fetchData",value:function(){var e=Object(h.a)(p.a.mark((function e(t){var n,a,r,o,s,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({isLoading:!0}),n=new Array,a="",e.t0=this.state.topCatalogsType,e.next=0===e.t0||1===e.t0?6:-1===e.t0?7:2===e.t0?26:28;break;case 6:return e.abrupt("return",this.fetchTopCatalogs(this.state.topCatalogsType));case 7:return e.prev=7,e.next=10,M.axiosInstance.get("/catalog_entry?q=".concat(t),{responseType:"arraybuffer"});case 10:return r=e.sent,o=JSON.parse((new TextDecoder).decode(r.data)),s=o.results,n=s.map((function(e){return new Y(e)})),""!==this.parentPath(t)?a=o.label:(i=M.topCatalogsByCat[t],a=void 0!==i?i:M.topCatalogsByVol[t]),this.setState({fetchError:!1,isLoading:!1,catalogs:n,pathLabel:a}),e.abrupt("return",!0);case 20:return e.prev=20,e.t1=e.catch(7),console.error(e.t1),console.error((new Error).stack),this.setState({fetchError:!0,isLoading:!1,pathLabel:""}),e.abrupt("return",!1);case 26:return this.setState({fetchError:!1,isLoading:!1,pathLabel:""}),e.abrupt("break",28);case 28:case"end":return e.stop()}}),e,this,[[7,20]])})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchTopCatalogs",value:function(e){var t=Array(),n=e?M.topCatalogsByVol:M.topCatalogsByCat;return Object.keys(n).forEach((function(e){var a={n:e,nodeType:null,work:null,label:n[e],file:null};t.push(a)})),this.setState({fetchError:!1,isLoading:!1,catalogs:t,pathLabel:""}),!0}},{key:"parentPath",value:function(e){var t=e.split(".");return t.pop(),t.join(".")}},{key:"addBookmarkHandler",value:function(){this.props.dispatch({type:"ADD_BOOKMARK",bookmark:new K({type:U.CATALOG,uuid:this.props.match.params.path,selectedText:this.state.pathLabel,epubcfi:"",fileName:"",work:null})})}},{key:"delBookmarkHandler",value:function(){this.props.dispatch({type:"DEL_BOOKMARK",uuid:this.props.match.params.path})}},{key:"getRows",value:function(){var e=this,t=Array();return this.state.catalogs.forEach((function(n,a){var r="",s="html"===n.nodeType;r=s?"/catalog/juan/".concat(n.n,"/1"):null==n.work?"/catalog/catalog/".concat(n.n):"/catalog/work/".concat(n.work),t.push(o.a.createElement(k.k,{key:"".concat(n.n,"item")+a,button:!0,onClick:function(){var t=Object(h.a)(p.a.mark((function t(a){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a.preventDefault(),e.props.history.push({pathname:r,search:E.a.stringify(s?{file:n.file,title:n.label}:{})});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont",key:"".concat(n.n,"label")+a},n.label)))})),t}},{key:"getFamousJuanRows",value:function(){var e=this,t=Array();return q.forEach((function(n,a){var r=n.title,s=n.url;t.push(o.a.createElement(k.k,{key:"famousJuanItem_"+a,button:!0,onClick:function(){var t=Object(h.a)(p.a.mark((function t(n){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.props.history.push(s);case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont",key:"famousItemLabel_"+a},r)))})),t}},{key:"render",value:function(){var e=this,t=o.a.createElement(k.p,null,2===this.state.topCatalogsType?this.getFamousJuanRows():this.getRows());return o.a.createElement(k.s,null,o.a.createElement(k.g,null,o.a.createElement(k.J,null,o.a.createElement(k.c,{hidden:this.isTopCatalog,fill:"clear",slot:"start",onClick:function(t){return e.props.history.goBack()}},o.a.createElement(k.h,{icon:W.a,slot:"icon-only"})),o.a.createElement(k.B,{hidden:!this.isTopCatalog,slot:"start",value:this.state.topCatalogsType,style:{fontSize:"var(--ui-font-size)"},interface:"popover",interfaceOptions:{cssClass:"cbetar2themes"},onIonChange:function(t){var n="";switch(t.detail.value){case 0:n="/catalog";break;case 1:n="/catalog/volumes";break;case 2:n="/catalog/famous";break;case-1:n=e.props.match.url}e.props.match.url!==n&&e.props.history.push(n)}},o.a.createElement(k.C,{className:"uiFont",value:0},"\u90e8\u5206\u985e"),o.a.createElement(k.C,{className:"uiFont",value:1},"\u518a\u5206\u985e"),o.a.createElement(k.C,{className:"uiFont",value:2},"\u77e5\u540d\u7d93\u5178")),o.a.createElement(k.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(t){return e.fetchData(e.props.match.params.path)}},o.a.createElement(k.h,{icon:W.z,slot:"icon-only"})),o.a.createElement(k.c,{hidden:this.isTopCatalog,fill:"clear",color:this.hasBookmark?"warning":"primary",slot:"end",onClick:function(t){return e.hasBookmark?e.delBookmarkHandler():e.addBookmarkHandler()}},o.a.createElement(k.h,{icon:W.e,slot:"icon-only"})),o.a.createElement(k.c,{hidden:this.isTopCatalog,fill:"clear",slot:"end",onClick:function(t){return e.props.history.push("/".concat(e.props.match.params.tab))}},o.a.createElement(k.h,{icon:W.t,slot:"icon-only"})),o.a.createElement(k.c,{fill:"clear",slot:"end",onClick:function(t){return e.setState({showSearchAlert:!0})}},o.a.createElement(k.h,{icon:W.C,slot:"icon-only"})),o.a.createElement(k.c,{fill:"clear",slot:"end",onClick:function(t){e.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})}},o.a.createElement(k.h,{icon:W.G,slot:"icon-only"})))),o.a.createElement(k.d,null,this.state.fetchError?M.fetchErrorContent:o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"uiFontX2",style:{color:"var(--ion-color-primary)"}},this.state.pathLabel),t),o.a.createElement(G,Object(l.a)({showSearchAlert:this.state.showSearchAlert,finish:function(){e.setState({showSearchAlert:!1})}},this.props)),o.a.createElement("div",{style:{fontSize:"var(--ui-font-size)",textAlign:"center"}},o.a.createElement("a",{href:"https://github.com/MrMYHuang/cbetar2#bookmark",target:"_new"},"\u66f8\u7c64\u65b0\u589e\u8aaa\u660e")),o.a.createElement("div",{style:{fontSize:"var(--ui-font-size)",textAlign:"center"}},o.a.createElement("a",{href:"https://github.com/MrMYHuang/cbetar2#search",target:"_new"},"\u641c\u5c0b\u7d93\u66f8\u6559\u5b78")),o.a.createElement(k.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return e.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."})))}},{key:"isTopCatalog",get:function(){var e=this;return["/catalog","/catalog/volumes","/catalog/famous"].reduce((function(t,n){return t||n===e.props.match.url}),!1)}},{key:"hasBookmark",get:function(){var e=this;return null!=this.props.bookmarks.find((function(t){return t.type===U.CATALOG&&t.uuid===e.props.match.params.path}))}}]),n}(o.a.Component),Q=Object(k.U)(X),Z=Object(b.b)((function(e){return{bookmarks:e.settings.bookmarks,state:e}}))(Q),$=(n(138),function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).fetchJuan="",a.state={work:null,showSearchAlert:!1,showAddBookmarkDone:!1,isLoading:!1,fetchError:!1},a}return Object(m.a)(n,[{key:"ionViewWillEnter",value:function(){this.fetchWork(this.props.match.params.path)}},{key:"componentDidMount",value:function(){}},{key:"fetchWork",value:function(){var e=Object(h.a)(p.a.mark((function e(t){var n,a,r,o,s;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setState({isLoading:!0}),!this.hasBookmark){e.next=5;break}n=this.bookmark.work,e.next=24;break;case 5:return e.prev=5,e.next=8,M.axiosInstance.get("/works?work=".concat(t),{responseType:"arraybuffer"});case 8:return a=e.sent,r=JSON.parse((new TextDecoder).decode(a.data)),o=r.results,n=o[0],e.next=14,M.axiosInstance.get("/toc?work=".concat(t));case 14:s=e.sent,n.mulu=s.data.results[0].mulu.map((function(e){return new j(e)})),e.next=24;break;case 18:return e.prev=18,e.t0=e.catch(5),console.error(e.t0),console.error((new Error).stack),this.setState({fetchError:!0,isLoading:!1}),e.abrupt("return",!1);case 24:return this.setState({fetchError:!1,isLoading:!1,work:n}),e.abrupt("return",!0);case 26:case"end":return e.stop()}}),e,this,[[5,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"saveJuans",value:function(){var e=Object(h.a)(p.a.mark((function e(){var t,n,a,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.state.work,n=t.juan_list.split(","),a=0;case 3:if(!(a<n.length)){e.next=19;break}return this.fetchJuan=n[a],e.prev=5,e.next=8,M.fetchJuan(t.work,this.fetchJuan,null);case 8:r=e.sent,M.saveFileToIndexedDB(M.getFileName(t.work,this.fetchJuan),r.htmlStr),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(5),console.error("Fetching juan ".concat(a," failed! ").concat(e.t0)),console.error((new Error).stack);case 16:a++,e.next=3;break;case 19:this.setState({showAddBookmarkDone:!0});case 20:case"end":return e.stop()}}),e,this,[[5,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"addBookmarkHandler",value:function(){var e=Object(h.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveJuans();case 2:this.props.dispatch({type:"ADD_BOOKMARK",bookmark:new K({type:U.WORK,uuid:this.props.match.params.path,selectedText:this.state.work.title,epubcfi:"",fileName:"",work:this.state.work})});case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"delBookmarkHandler",value:function(){this.props.dispatch({type:"DEL_BOOKMARK",uuid:this.props.match.params.path})}},{key:"getRowsByChapter",value:function(){for(var e=this,t=this.state.work,n=null===t||void 0===t?void 0:t.mulu,a=Array(),r=function(r){var s="/catalog/juan/".concat(null===t||void 0===t?void 0:t.work,"/").concat(n[r].juan);a.push(o.a.createElement(k.k,{key:"chapterItem"+r,button:!0,onClick:function(){var t=Object(h.a)(p.a.mark((function t(n){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.preventDefault(),e.props.history.push({pathname:s});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont",key:"chapterLabel"+r},n[r].title)))},s=0;s<((null===n||void 0===n?void 0:n.length)||-1);s++)r(s);return a}},{key:"getRowsByJuan",value:function(){for(var e=this,t=this.state.work,n=Array(),a=null===t||void 0===t?void 0:t.juan_list.split(","),r=function(r){var s="/catalog/juan/".concat(null===t||void 0===t?void 0:t.work,"/").concat(a[r]);n.push(o.a.createElement(k.k,{key:"juanItem"+r,button:!0,onClick:function(){var t=Object(h.a)(p.a.mark((function t(n){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.preventDefault(),e.props.history.push({pathname:s});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont",key:"juanLabel"+r},"\u5377",a[r])))},s=0;s<((null===a||void 0===a?void 0:a.length)||-1);s++)r(s);return n}},{key:"render",value:function(){var e,t=this;return o.a.createElement(k.s,null,o.a.createElement(k.g,null,o.a.createElement(k.J,null,o.a.createElement(k.c,{hidden:this.isTopPage,fill:"clear",slot:"start",onClick:function(e){return t.props.history.goBack()}},o.a.createElement(k.h,{icon:W.a,slot:"icon-only"})),o.a.createElement(k.c,{slot:"start",onClick:function(e){var n=t.props.workListType===a.BY_CHAPTER?a.BY_JUAN:a.BY_CHAPTER;t.props.dispatch({type:"TMP_SET_KEY_VAL",key:"workListType",val:n})}},o.a.createElement("span",{className:"uiFont",style:{color:"var(--color)"}},this.props.workListType===a.BY_CHAPTER?"\u5206\u54c1":"\u5206\u5377")),o.a.createElement(k.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(e){return t.fetchWork(t.props.match.params.path)}},o.a.createElement(k.h,{icon:W.z,slot:"icon-only"})),o.a.createElement(k.c,{fill:"clear",color:this.hasBookmark?"warning":"primary",slot:"end",onClick:function(e){return t.hasBookmark?t.delBookmarkHandler():t.addBookmarkHandler()}},o.a.createElement(k.h,{icon:W.e,slot:"icon-only"})),o.a.createElement(k.c,{fill:"clear",slot:"end",onClick:function(e){return t.props.history.push("/".concat(t.props.match.params.tab))}},o.a.createElement(k.h,{icon:W.t,slot:"icon-only"})),o.a.createElement(k.c,{fill:"clear",slot:"end",onClick:function(e){return t.setState({showSearchAlert:!0})}},o.a.createElement(k.h,{icon:W.C,slot:"icon-only"})),o.a.createElement(k.c,{fill:"clear",slot:"end",onClick:function(e){t.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})}},o.a.createElement(k.h,{icon:W.G,slot:"icon-only"})))),o.a.createElement(k.d,null,o.a.createElement("div",{className:"uiFontX2",style:{color:"var(--ion-color-primary)"}},null===(e=this.state.work)||void 0===e?void 0:e.title),this.state.fetchError?M.fetchErrorContent:o.a.createElement(k.p,null,this.props.workListType===a.BY_CHAPTER?this.getRowsByChapter():this.getRowsByJuan()),o.a.createElement(G,Object(l.a)({showSearchAlert:this.state.showSearchAlert,finish:function(){t.setState({showSearchAlert:!1})}},this.props)),o.a.createElement(k.H,{cssClass:"uiFont",isOpen:this.state.showAddBookmarkDone,onDidDismiss:function(){return t.setState({showAddBookmarkDone:!1})},message:"\u66f8\u7c64\u65b0\u589e\u6210\u529f\uff01",duration:2e3}),o.a.createElement(k.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return t.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."})))}},{key:"isTopPage",get:function(){return"/catalog"===this.props.match.url}},{key:"bookmark",get:function(){var e=this;return this.props.bookmarks.find((function(t){return t.type===U.WORK&&t.uuid===e.props.match.params.path}))}},{key:"hasBookmark",get:function(){return null!=this.bookmark}}]),n}(o.a.Component)),ee=Object(k.U)($),te=Object(b.b)((function(e){return{bookmarks:e.settings.bookmarks,workListType:void 0!==e.tmpSettings.workListType?e.tmpSettings.workListType:a.BY_JUAN}}))(ee),ne=n(15),ae=n(478),re=(n(253),n(93)),oe=n(206);function se(){return ie.apply(this,arguments)}function ie(){return(ie=Object(h.a)(p.a.mark((function e(){var t,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.getFileFromIndexedDB(M.twKaiFontKey);case 2:return t=e.sent,n=new window.FontFace("Kai",t),e.next=6,n.load();case 6:this.document.fonts.add(n);case 7:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function ce(){var e=this;this.document.querySelectorAll(".pre .lb").forEach((function(t){var n=e.document.createElement("br");t.before(n)}))}function le(){n(397)(this.window,this.document)}!function(e){e[e.UNINITIAL=0]="UNINITIAL",e[e.SPEAKING=1]="SPEAKING",e[e.PAUSE=2]="PAUSE"}(J||(J={}));var ue,pe=function(e){Object(f.a)(a,e);var t=Object(v.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).htmlFile=void 0,n.htmlTitle=void 0,n.book=void 0,n.rendition=void 0,n.epub=void 0,n.displayed=void 0,n.cfiRange=void 0,n.speechSynthesisUtterance=void 0,n.uuidStr="",n.epubcfiFromUrl="",n.epubcfiFromSelectedString="",n.bookCreated=!1,n.ePubIframe=null,n.pageWidth=0,n.pagesWidth=0,n.searchTextRanges=[],n.visibleTextNodes=[],n.visibleChars=[],n.isPageSearched=[],n.allTexts="",n.ePubIframeOffset=0,n.showedSearchTextIndex=0,n.maxCharsPerUtterance=1e3,n.workTexts=[],n.workTextsIndex=0,n.state={isLoading:!1,fetchError:!1,workInfo:new A({}),htmlStr:null,currentPage:1,pageCount:1,showJumpPageAlert:!1,showNoSelectedTextAlert:!1,showAddBookmarkSuccess:!1,showsCopyToClipboardSuccess:!1,showsCitationFail:!1,showSearchTextAlert:!1,searchText:"",showSearchTextToast:!1,showToast:!1,toastMessage:"",showSearchAlert:!1,popover:{show:!1,event:null},lookupDictPopover:{show:!1,data:[]},speechState:J.UNINITIAL},n.htmlFile="",n.htmlTitle="",n.book=null,n.rendition=null,n.cfiRange="",n.speechSynthesisUtterance=new SpeechSynthesisUtterance,n.speechSynthesisUtterance.lang="zh-TW",n.speechSynthesisUtterance.onend=function(e){if(n.state.speechState!==J.UNINITIAL){var t=!n.props.paginated&&n.workTextsIndex<n.workTexts.length-1,a=n.props.paginated&&n.state.currentPage<n.state.pageCount,r="";if(t)n.workTextsIndex+=1,r=n.workTexts[n.workTextsIndex];else{if(!a)return n.setState({speechState:J.UNINITIAL}),void console.log("Stop work text to speech.");n.pageNext(),r=n.findTextsInPage(n.state.currentPage)}n.speechSynthesisUtterance.text=r,speechSynthesis.speak(n.speechSynthesisUtterance),console.log("Play work text to speech part / page: ".concat(t?n.workTextsIndex:n.state.currentPage))}},document.addEventListener("keydown",n.keyListener.bind(Object(ne.a)(n)),!1),n}return Object(m.a)(a,[{key:"loadEpubCoverToMemFs",value:function(){var e=Object(h.a)(p.a.mark((function e(){var t,a,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(t=new Uint8Array(JSON.parse(localStorage.getItem("logo.png")||"[]"))).length){e.next=8;break}return e.next=4,M.axiosInstance.get("".concat(window.location.origin,"/assets/icon/icon.png"),{responseType:"arraybuffer"});case 4:a=e.sent,t=new Uint8Array(a.data),r=JSON.stringify(Array.from(t)),localStorage.setItem("logo.png",r);case 8:n(49).writeFileSync("logo.png",t);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"ionViewWillEnter",value:function(){var e=E.a.parse(this.props.location.search);this.htmlFile=e.file,this.htmlTitle=e.title,this.epubcfiFromUrl=e.bookmark||"";var t=this.props.location.state;this.uuidStr=t?t.uuid:"",this.fetchData()}},{key:"ionViewDidEnter",value:function(){}},{key:"fetchData",value:function(){var e=Object(h.a)(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({isLoading:!0}),e.prev=1,e.next=4,M.fetchJuan(this.props.match.params.work,this.props.match.params.path,this.htmlFile);case 4:return t=e.sent,e.next=7,this.loadEpubCoverToMemFs();case 7:this.setState({fetchError:!1,workInfo:t.workInfo,htmlStr:t.htmlStr}),e.next=15;break;case 10:e.prev=10,e.t0=e.catch(1),console.error(e.t0),console.error((new Error).stack),this.setState({isLoading:!1,fetchError:!0});case 15:case"end":return e.stop()}}),e,this,[[1,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"addBookmarkHandler",value:function(){var e=this.getSelectedString();if(""!==e){var t=ae.a();this.props.dispatch({type:"ADD_BOOKMARK",htmlStr:this.state.htmlStr,bookmark:new K({type:this.htmlFile?U.HTML:U.JUAN,uuid:t,selectedText:e,epubcfi:this.epubcfiFromSelectedString,fileName:this.htmlFile||"".concat(this.props.match.params.work,"_juan").concat(this.props.match.params.path,".html"),work:Object.assign(this.state.workInfo,{title:this.htmlFile?this.htmlTitle:this.state.workInfo.title,juan:this.props.match.params.path})})}),this.setState({showAddBookmarkSuccess:!0})}else this.setState({showNoSelectedTextAlert:!0})}},{key:"ionViewWillLeave",value:function(){var e;speechSynthesis.cancel(),this.setState({htmlStr:null,currentPage:1,speechState:J.UNINITIAL,showSearchTextToast:!1}),null===(e=this.book)||void 0===e||e.destroy(),this.book=null,this.bookCreated=!1}},{key:"pagePrev",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.props.paginated&&this.state.currentPage>1&&(null===(e=this.rendition)||void 0===e||e.prev(t),this.setState({currentPage:this.state.currentPage-t}))}},{key:"pageNext",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.props.paginated&&this.state.currentPage<this.state.pageCount&&(null===(e=this.rendition)||void 0===e||e.next(t),this.setState({currentPage:this.state.currentPage+t}))}},{key:"jumpToPage",value:function(e){if(0!==e){e=isNaN(e)?1:Math.max(Math.min(this.state.pageCount,e),1);var t=this.state.currentPage,n=t<e?1:-1,a=Math.abs(e-t);1===n?this.pageNext(a):this.pagePrev(a)}}},{key:"keyListener",value:function(e){var t=e.keyCode||e.which;console.log(e.type),t===(this.props.rtlVerticalLayout?37:40)&&this.buttonNext(),t===(this.props.rtlVerticalLayout?39:38)&&this.buttonPrev(),("F3"===e.code||e.ctrlKey&&"f"===e.key.toLowerCase())&&(e.preventDefault(),this.setState({showSearchTextToast:!1,showSearchTextAlert:!0}))}},{key:"html2Epub",value:function(){var e=Object(h.a)(p.a.mark((function e(){var t,a,r=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.bookCreated=!0,this.epub=oe.document({id:"123-123456789",title:"Title",series:"",sequence:1,author:"Author",fileAs:"",genre:"genre",tags:"",copyright:"",publisher:"",published:"",language:"en",description:"A temp book.",contents:this.state.workInfo.title,source:"",images:["logo.png"]},"logo.png"),t=this.state.htmlStr,this.props.rtlVerticalLayout&&(t=t.replace(/margin-left/g,"margin-top")),a=t+"\n    <script>\n    <\/script>\n    ",this.epub.addSection("",a,!0,!1),"\n    html {\n      writing-mode: vertical-rl;\n      direction: ltr;\n    }\n    ",this.epub.addCSS("\n    @page {\n      size: A4;\n      margin: 0.5in;\n    }\n\n    /* For double side printing for book bundling. */\n    @page :left {\n      margin-right: 1in;\n    }\n\n    @page :right {\n      margin-left: 1in;\n    }\n\n    @media print {\n      body {\n        color: ".concat(getComputedStyle(document.body).getPropertyValue("--print-text-color")," !important;\n        background: ").concat(getComputedStyle(document.body).getPropertyValue("--print-background")," !important;\n        padding: 0 !important;\n        width: 100% !important;\n        height: 100% !important;\n        column-gap: unset !important;\n        column-width: unset !important;\n      }\n    }\n\n    html {\n      /*\n      Because different fonts have different line heights with 'line-height: normal,'\n      the content size of epubjs iframe changes after the fallback font is swapped with the web font.\n      Unfortunately, epubjs can't detect the size change and update the iframe.\n      This problem causes the total page count is incorrect.\n      Fortunately, we can set the line height based on the same font size as below.\n      */\n      line-height: 1.2;\n    }\n\n    body {\n      color: ").concat(getComputedStyle(document.body).getPropertyValue("--ion-text-color"),";\n      background: ").concat(getComputedStyle(document.body).getPropertyValue("--ion-background-color"),";\n      /* Disable browser's swipe to forward / backward page navigation. */\n      overscroll-behavior-x: none;\n    }\n\n    @font-face {\n        font-family: 'Times';\n        src: local('Times New Roman');\n        unicode-range: U+0-007F;\n    }\n\n    /* Workaround parenthesis orientation problem of TW-Kai-98_1 on iOS Safari. */\n    @font-face {\n        font-family: 'Heiti';\n        src: local('Heiti TC');\n        unicode-range: U+3008-301B, U+FF01-FF60;\n    }\n\n    .lb {\n      display: none\n    }\n\n    /* In-HTML anchor jumps don't update this.state.currentPage.\n    Thus, we disable them. */\n    .noteAnchor {\n      pointer-events: none;\n      text-decoration: inherit;\n      color: inherit;\n      cursor: auto;\n    }\n\n    .doube-line-note, .doube-line-note .t {\n      font-size: ").concat(.8*this.props.fontSize,'px;\n    }\n\n    .doube-line-note::before {\n      content: "\uff08";\n    }\n\n    .doube-line-note::after {\n      content: "\uff09";\n    }\n\n    .bip-table {\n      display: table;\n    }\n\n    .bip-table-row {\n      display: table-row;\n    }\n\n    .bip-table-cell {\n      display: table-cell;\n      border: 1px solid ').concat(getComputedStyle(document.body).getPropertyValue("--ion-text-color"),";\n      text-align: center;\n    }\n  \n    ").concat(this.props.rtlVerticalLayout?"\n    html {\n      writing-mode: vertical-rl;\n      direction: ltr;\n    }\n    ":"","\n\n    .t, p, div {\n      font-family: ").concat(getComputedStyle(document.body).getPropertyValue("--ion-font-family"),";\n      font-size: ").concat(this.props.fontSize,"px;\n    }\n    \n    #back, #cbeta-copyright {\n      display: ").concat(this.props.showComments?"block":"none",";\n    }\n    ")),this.epub.writeEPUB((function(e){console.log("Error: ".concat(e))}),".","temp",Object(h.a)(p.a.mark((function e(){var t,a,o,s,i,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n(49),o=a.readFileSync("temp.epub"),r.book=Object(re.b)(o.buffer,{openAs:"binary"}),r.rendition=r.book.renderTo("cbetarEPubView",{width:"100%",height:"100%",spread:"none",flow:r.props.paginated?"paginated":"scrolled",scrollbarWidth:M.scrollbarSizeIdToValue(r.props.scrollbarSize),defaultDirection:r.props.rtlVerticalLayout?"rtl":"ltr"}),r.rendition.on("selected",(function(e,t){r.epubcfiFromSelectedString=e})),r.rendition.on(re.a.RENDITION.DISPLAYED,(function(){r.updatePageInfos()})),r.rendition.on(re.a.VIEWS.RENDERED,(function(){r.updateEPubIframe()})),e.next=9,r.rendition.display(r.props.paginated?r.epubcfi:void 0);case 9:if(r.props.paginated){e.next=15;break}return e.next=12,null===(s=r.rendition)||void 0===s?void 0:s.next();case 12:return e.next=14,null===(i=r.rendition)||void 0===i?void 0:i.next();case 14:r.updateEPubIframe();case 15:if(r.setState({isLoading:!1}),r.hasBookmark)try{null===(c=r.rendition)||void 0===c||c.annotations.highlight(r.epubcfi)}catch(l){console.error(l)}null===(t=r.book)||void 0===t||t.locations.generate(150);case 18:case"end":return e.stop()}}),e)}))));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateEPubIframe",value:function(){var e=this,t=document.getElementsByTagName("iframe");if(1===t.length){var n;this.ePubIframe=t[0],null===(n=this.ePubIframe.contentDocument)||void 0===n||n.addEventListener("keydown",this.keyListener.bind(this),!1);var a=this.ePubIframe.contentWindow;Object(k.S)("android")?a.window.oncontextmenu=M.disableAndroidChromeCallout:Object(k.S)("ios")&&(a.document.ontouchend=M.disableIosSafariCallout.bind(a)),a.loadTwKaiFont=se,a.loadTwKaiFont(),a.addCbetaLineBreaks=ce,a.addCbetaLineBreaks(),a.addSwpiedEvents=le,a.addSwpiedEvents(),a.document.addEventListener("swiped",(function(t){if(e.props.paginated)if(e.props.rtlVerticalLayout)switch(t.detail.dir){case"left":e.pagePrev();break;case"right":e.pageNext()}else switch(t.detail.dir){case"down":e.pagePrev();break;case"up":e.pageNext()}})),this.findVisibleTexts()}else t.length>1?alert("Error! This component locates ePub iframe by the only iframe."):console.error("ePub iframes count is 0.")}},{key:"updatePageInfos",value:function(){var e,t=(null===(e=this.rendition)||void 0===e?void 0:e.currentLocation()).start.displayed;this.setState({currentPage:t.page,pageCount:t.total})}},{key:"getSelectedString",value:function(){var e,t,n="",a=null===(e=this.ePubIframe)||void 0===e||null===(t=e.contentDocument)||void 0===t?void 0:t.getSelection();return((null===a||void 0===a?void 0:a.rangeCount)||0)>0&&a.getRangeAt(0).toString().length>0&&(n=a.toString(),null===a||void 0===a||a.removeAllRanges()),n}},{key:"getRemainingWorkTextFromSelectedRange",value:function(){var e,t=this.ePubIframe.contentWindow.getSelection();if("Range"===t.type){var n=this.ePubIframe.contentDocument.getElementById("back"),a=t.getRangeAt(0);a.setEnd(n,0);var r=a.cloneContents();null===t||void 0===t||t.removeAllRanges();var o=new Document,s=o.createElement("html");o.appendChild(s),s.appendChild(r),M.removeElementsByClassName(o,"lb"),M.removeElementsByClassName(o,"doube-line-note"),e=o.getElementById("body").innerText}return e}},{key:"getAllTextNodes",value:function(e){return document.createTreeWalker(e,NodeFilter.SHOW_TEXT)}},{key:"visibleCharToRange",value:function(e){var t=this.visibleChars[e],n=new Range;return n.setStart(t.node,t.offset),n.setEnd(t.node,t.offset+1),n}},{key:"rectBinDirSize",value:function(e){return this.props.rtlVerticalLayout?e.y:e.x}},{key:"findBinBoundaryVisibleCharIndex",value:function(e,t,n){var a=t+Math.floor((n-t)/2);if(0===a)return 0;if(a===this.visibleChars.length-1)return this.visibleChars.length-1;var r=this.visibleCharToRange(a),o=this.visibleCharToRange(a+1),s=r.getBoundingClientRect(),i=o.getBoundingClientRect(),c=this.rectBinDirSize(s)-this.ePubIframeOffset,l=this.rectBinDirSize(i)-this.ePubIframeOffset;return c<e&&e<=l?a:c<e&&e>l?this.findBinBoundaryVisibleCharIndex(e,a+1,n):c>=e&&e<=l?this.findBinBoundaryVisibleCharIndex(e,t,a):(console.error("Unreasonable case!"),-1)}},{key:"findTextsInPage",value:function(e){var t=new Date,n=e-1;if(!this.isPageSearched[n]){var a=this.pageWidth*(e-1),r=this.pageWidth*e,o=0;1!==e&&(o=this.isPageSearched[n-1]?this.visibleChars.length-1-this.visibleChars.slice().reverse().findIndex((function(t){return t.page===e-1}))+1:this.findBinBoundaryVisibleCharIndex(a,0,this.visibleChars.length-1)+1);var s=this.visibleChars.length-1,i=this.visibleChars.length-1;e!==this.state.pageCount&&(i=this.isPageSearched[n+1]?this.visibleChars.findIndex((function(t){return t.page===e+1}))-1:this.findBinBoundaryVisibleCharIndex(r,o,s));for(var c=o;c<=i;c++)this.visibleChars[c].page=e;this.isPageSearched[n]=!0}var l=this.visibleChars.filter((function(t){return t.page===e})).map((function(e){return e.char})).join(""),u=(new Date).getTime()-t.getTime();return console.log("findTextsInPage spends: ".concat(u/1e3,"s")),l}},{key:"findVisibleTexts",value:function(){var e=this,t=this.ePubIframe.contentDocument.getElementById("body");if(t){var n,a=this.getAllTextNodes(t);this.visibleTextNodes=[],this.visibleChars=[],this.isPageSearched=[];for(var r=function(){var t=n;if(["t","pc","gaijiAnchor"].reduce((function(e,n){var a;return e&&n!==(null===(a=t.parentElement)||void 0===a?void 0:a.className)}),!0))return"continue";e.visibleTextNodes.push(n)};null!=(n=a.nextNode());)r();this.allTexts=this.visibleTextNodes.map((function(e){return e.textContent})).join("");for(var o=0,s=0;s<this.visibleTextNodes.length;s++)for(var i=this.visibleTextNodes[s],c=0;c<i.length;c++)this.visibleChars.push({node:i,offset:c,page:0,char:this.allTexts[o]}),o++;var l=document.querySelector(".epub-container");this.pageWidth=this.props.rtlVerticalLayout?l.clientHeight:l.clientWidth,this.pagesWidth=this.pageWidth*this.state.pageCount,this.isPageSearched=new Array(this.state.pageCount);for(var u=0;u<this.isPageSearched.length;u++)this.isPageSearched[u]=!1;var p=this.visibleCharToRange(0).getBoundingClientRect();this.ePubIframeOffset=this.props.rtlVerticalLayout?p.y:p.x}}},{key:"findSearchTextRanges",value:function(e){this.searchTextRanges=[],this.showedSearchTextIndex=0;var t=[],n=0,a=1;do{if(-1===(a=this.allTexts.indexOf(e,n)))break;n=a+e.length,t.push(a),t.push(a+e.length)}while(a<this.allTexts.length-1);if(0!==t.length){var r=[],o=0;a=t.shift();for(var s=0;s<this.visibleTextNodes.length;s++){for(var i=this.visibleTextNodes[s],c=0;c<i.length&&(o!==a||(r.push({node:i,offset:c}),-1!==(a=t.shift()||-1)));c++)o++;if(-1===a)break}for(var l=0;l<r.length/2;l+=1){var u=new Range,p=r[2*l],h=r[2*l+1];u.setStart(p.node,p.offset),u.setEnd(h.node,h.offset),this.searchTextRanges.push(u)}}}},{key:"searchTextPrev",value:function(){this.showedSearchTextIndex>0&&this.showedSearchTextIndex--,this.moveToSearchText(this.showedSearchTextIndex)}},{key:"searchTextNext",value:function(){this.showedSearchTextIndex<this.searchTextRanges.length-1&&this.showedSearchTextIndex++,this.moveToSearchText(this.showedSearchTextIndex)}},{key:"moveToSearchText",value:function(e){var t=this;this.epubcfiFromSelectedString="";var n=this.ePubIframe.contentWindow.getSelection();n.removeAllRanges(),setTimeout((function(){var a,r,o=t.searchTextRanges[e];(t.ePubIframe.contentWindow.focus(),n.addRange(o),t.props.paginated)?a=setInterval((function(){var e;""!==t.epubcfiFromSelectedString&&(clearInterval(a),null===(e=t.rendition)||void 0===e||e.display(t.epubcfiFromSelectedString).then((function(){})))}),100):null===(r=o.startContainer.parentElement)||void 0===r||r.scrollIntoView()}),100)}},{key:"buttonPrev",value:function(){this.state.showSearchTextToast?this.searchTextPrev():this.pagePrev()}},{key:"buttonNext",value:function(){this.state.showSearchTextToast?this.searchTextNext():this.pageNext()}},{key:"findCbetaHtmlLine",value:function(e){var t=e.parentElement;do{var n,a;if(null===(a=t)||void 0===a?void 0:a.getAttribute("l"))break}while(t=null===(n=t)||void 0===n?void 0:n.parentElement);return t}},{key:"render",value:function(){var e=this,t=o.a.createElement(k.g,null,o.a.createElement(k.J,null,o.a.createElement(k.G,{style:{fontSize:"var(--ui-font-size)"}}),o.a.createElement(k.c,{hidden:this.isTopPage,fill:"clear",slot:"start",onClick:function(t){return e.props.history.goBack()}},o.a.createElement(k.h,{icon:W.a,slot:"icon-only"})),o.a.createElement(k.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(t){return e.fetchData()}},o.a.createElement(k.h,{icon:W.z,slot:"icon-only"})),o.a.createElement(k.c,{hidden:!this.props.paginated,slot:"end",onClick:function(t){e.setState({showJumpPageAlert:!0})}},o.a.createElement("span",{className:"uiFont",style:{color:"var(--color)"}},"\u9801",this.state.currentPage,"/",this.state.pageCount)),o.a.createElement(k.c,{hidden:this.state.fetchError,fill:"clear",slot:"end",onClick:function(t){var n,a,r,o=speechSynthesis.getVoices();if(0!==o.length)switch(e.state.speechState){case J.UNINITIAL:var s=o.find((function(e){return e.lang.indexOf("zh-TW")>-1||e.lang.indexOf("zh_TW")>-1}));void 0!==s&&(e.speechSynthesisUtterance.voice=s);var i=(e.props.paginated?e.findTextsInPage(e.state.currentPage):e.getRemainingWorkTextFromSelectedRange())||(null===(n=e.ePubIframe)||void 0===n||null===(a=n.contentDocument)||void 0===a||null===(r=a.getElementById("body"))||void 0===r?void 0:r.innerText)||"\u7121\u6cd5\u53d6\u5f97\u7d93\u6587\u5167\u5bb9";e.workTexts=[];for(var c=0;c<Math.ceil(i.length/e.maxCharsPerUtterance);c++)e.workTexts.push(i.substring(c*e.maxCharsPerUtterance,(c+1)*e.maxCharsPerUtterance));e.workTextsIndex=0,e.speechSynthesisUtterance.text=e.workTexts[e.workTextsIndex],e.speechSynthesisUtterance.rate=e.props.speechRate,speechSynthesis.cancel(),speechSynthesis.speak(e.speechSynthesisUtterance),e.setState({speechState:J.SPEAKING});break;case J.SPEAKING:speechSynthesis.cancel(),e.setState({speechState:J.UNINITIAL});break;case J.PAUSE:speechSynthesis.resume(),e.setState({speechState:J.SPEAKING})}}},o.a.createElement(k.h,{icon:this.state.speechState===J.SPEAKING?W.H:W.x,slot:"icon-only"})),o.a.createElement(k.c,{hidden:this.state.fetchError,fill:"clear",slot:"end",onClick:function(t){e.setState({popover:{show:!1,event:null}}),e.addBookmarkHandler()}},o.a.createElement(k.h,{icon:W.e,slot:"icon-only"})),o.a.createElement(k.c,{fill:"clear",slot:"end",onClick:function(t){return e.setState({popover:{show:!0,event:t.nativeEvent}})}},o.a.createElement(k.h,{ios:W.q,md:W.r,slot:"icon-only"})),o.a.createElement(k.t,{isOpen:this.state.popover.show,event:this.state.popover.event,onDidDismiss:function(t){e.setState({popover:{show:!1,event:null}})}},o.a.createElement(k.p,null,o.a.createElement(k.k,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}}),e.props.history.push("/catalog/work/".concat(e.props.match.params.work))}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.t,slot:"start"}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},"\u56de\u7d93\u76ee\u9304")),o.a.createElement(k.k,{button:!0,onClick:function(t){e.props.history.push("/".concat(e.props.match.params.tab)),e.setState({popover:{show:!1,event:null}})}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.t,slot:"start"}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},"\u56de\u9996\u9801")),o.a.createElement(k.k,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}});var n=e.getSelectedString();M.copyToClipboard(n),e.setState({showToast:!0,toastMessage:"\u8907\u88fd\u6587\u5b57\u6210\u529f"})}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.n,slot:"start"}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},"\u8907\u88fd\u6587\u5b57")),o.a.createElement(k.k,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}}),e.setState({showSearchTextToast:!1,showSearchTextAlert:!0})}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.C,slot:"start"}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},"\u641c\u5c0b\u6587\u5b57")),o.a.createElement(k.k,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}}),e.setState({showSearchAlert:!0})}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.C,slot:"start"}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},"\u641c\u5c0b\u7d93\u66f8")),o.a.createElement(k.k,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}});var n=e.getSelectedString();""!==n?e.props.history.push({pathname:"/dictionary/search/".concat(n)}):e.setState({showNoSelectedTextAlert:!0})}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.d,slot:"start"}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},"\u67e5\u8a5e\u5178")),o.a.createElement(k.k,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}});var n=e.getSelectedString();""!==n?e.props.history.push({pathname:"/dictionary/searchWord/".concat(n)}):e.setState({showNoSelectedTextAlert:!0})}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.d,slot:"start"}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},"\u67e5\u5b57\u5178")),o.a.createElement(k.k,{button:!0,onClick:function(t){var n,a;e.setState({popover:{show:!1,event:null}}),null===(n=e.ePubIframe)||void 0===n||null===(a=n.contentWindow)||void 0===a||a.print()}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.y,slot:"start"}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},"\u5217\u5370")),o.a.createElement(k.k,{button:!0,onClick:function(t){var n,a;e.setState({popover:{show:!1,event:null}});var r=null===(n=e.ePubIframe)||void 0===n||null===(a=n.contentDocument)||void 0===a?void 0:a.getSelection();if((r.rangeCount||0)>0&&r.getRangeAt(0).toString().length>0){var o,s,i=r.toString(),c=r.getRangeAt(0),l=null===(o=e.findCbetaHtmlLine(c.startContainer))||void 0===o?void 0:o.getAttribute("l"),u=null===(s=e.findCbetaHtmlLine(c.endContainer))||void 0===s?void 0:s.getAttribute("l");if(null===r||void 0===r||r.removeAllRanges(),null==l||null==u)return void e.setState({showsCitationFail:!0});var p=/0*([1-9]*)([a-z])0*([1-9]*)/.exec(l),h="".concat(p[1]).concat(p[2]).concat(p[3]),d=/0*([1-9]*)([a-z])0*([1-9]*)/.exec(u)[3],m="".concat(h);l!==u&&(m+="-".concat(d));var f="\u300a".concat(e.state.workInfo.title,"\u300b\u5377").concat(e.props.match.params.path,"\uff1a\u300c").concat(i,"\u300d(CBETA, ").concat(e.state.workInfo.vol,", no. ").concat(/[^0-9]*(.*)/.exec(e.state.workInfo.work)[1],", p. ").concat(m,")");navigator.clipboard&&navigator.clipboard.writeText(f),e.setState({showsCopyToClipboardSuccess:!0})}else e.setState({showNoSelectedTextAlert:!0})}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.G,slot:"start"}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},"\u5f15\u7528\u6587\u7ae0")),o.a.createElement(k.k,{button:!0,onClick:function(t){var n=window.location.href.split("?")[0];""!==e.getSelectedString()&&(n+="?bookmark=".concat(e.epubcfiFromSelectedString)),e.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(n)}})}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.G,slot:"start"}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},"\u5206\u4eab\u6b64\u9801")))))),n=o.a.createElement(o.a.Fragment,null,o.a.createElement(k.e,{vertical:"center",horizontal:"start",slot:"fixed"},o.a.createElement(k.f,{style:{opacity:.2},onClick:function(t){return e.props.rtlVerticalLayout?e.buttonNext():e.buttonPrev()},onPointerDown:function(e){e.currentTarget.style.setProperty("opacity","1")},onPointerEnter:function(e){e.currentTarget.style.setProperty("opacity","1")},onPointerUp:function(e){M.isTouchDevice()&&e.currentTarget.style.setProperty("opacity","".concat(.2))},onPointerLeave:function(e){e.currentTarget.style.setProperty("opacity","".concat(.2))}},o.a.createElement(k.h,{icon:W.a}))),o.a.createElement(k.e,{vertical:"center",horizontal:"end",slot:"fixed"},o.a.createElement(k.f,{style:{opacity:.2},onClick:function(t){return e.props.rtlVerticalLayout?e.buttonPrev():e.buttonNext()},onPointerDown:function(e){e.currentTarget.style.setProperty("opacity","1")},onPointerEnter:function(e){e.currentTarget.style.setProperty("opacity","1")},onPointerUp:function(e){M.isTouchDevice()&&e.currentTarget.style.setProperty("opacity","".concat(.2))},onPointerLeave:function(e){e.currentTarget.style.setProperty("opacity","".concat(.2))}},o.a.createElement(k.h,{icon:W.c}))));return this.bookCreated||null==this.state.htmlStr||this.html2Epub(),o.a.createElement(k.s,null,t,o.a.createElement(k.d,null,this.props.paginated||this.state.showSearchTextToast?n:o.a.createElement(o.a.Fragment,null),o.a.createElement(k.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return e.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."}),this.state.fetchError?M.fetchErrorContent:o.a.createElement(o.a.Fragment,null),o.a.createElement("div",{id:"cbetarEPubView",style:{width:"100%",height:"100%",userSelect:"text",WebkitUserSelect:"text"}}),o.a.createElement(k.a,{cssClass:"uiFont",isOpen:this.state.showJumpPageAlert,header:"\u8df3\u9801",subHeader:"\u8acb\u8f38\u5165\u9801\u78bc(1 - ".concat(this.state.pageCount,")"),inputs:[{name:"name0",type:"number",min:1,max:this.state.pageCount,value:this.state.currentPage}],buttons:[{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary uiFont",handler:function(){return e.setState({showJumpPageAlert:!1})}},{text:"\u78ba\u5b9a",cssClass:"primary uiFont",handler:function(t){e.setState({showJumpPageAlert:!1}),e.jumpToPage(t.name0)}}]}),o.a.createElement(G,Object(l.a)({showSearchAlert:this.state.showSearchAlert,finish:function(){e.setState({showSearchAlert:!1})}},this.props)),o.a.createElement(k.a,{cssClass:"uiFont",isOpen:this.state.showNoSelectedTextAlert,backdropDismiss:!1,header:"\u5931\u6557",message:"\u8acb\u78ba\u8a8d\u662f\u5426\u5df2\u9078\u64c7\u4e00\u6bb5\u6587\u5b57\uff0c\u7136\u5f8c\u518d\u57f7\u884c\u6240\u9078\u7684\u529f\u80fd!",buttons:[{text:"\u78ba\u5b9a",cssClass:"primary uiFont",handler:function(t){e.setState({showNoSelectedTextAlert:!1})}}]}),o.a.createElement(k.H,{cssClass:"uiFont",isOpen:this.state.showAddBookmarkSuccess,onDidDismiss:function(){return e.setState({showAddBookmarkSuccess:!1})},message:"\u66f8\u7c64\u65b0\u589e\u6210\u529f\uff01",duration:2e3}),o.a.createElement(k.H,{cssClass:"uiFont",isOpen:this.state.showsCopyToClipboardSuccess,onDidDismiss:function(){return e.setState({showsCopyToClipboardSuccess:!1})},message:"\u5df2\u8907\u88fd\u5230\u526a\u8cbc\u7c3f\uff01",duration:2e3}),o.a.createElement(k.H,{cssClass:"uiFont",isOpen:this.state.showsCitationFail,onDidDismiss:function(){return e.setState({showsCitationFail:!1})},message:"\u6240\u9078\u6587\u5b57\u7121\u6cd5\u5f15\u7528\uff01",duration:2e3}),o.a.createElement(k.a,{cssClass:"uiFont",isOpen:this.state.showSearchTextAlert,header:"\u641c\u5c0b\u6587\u5b57",subHeader:"\u6309\u4e0b\u641c\u5c0b\u5f8c\uff0c\u5de6\u53f3\u65b9\u5411\u9215\u8b8a\u70ba\u641c\u5c0b\u6587\u5b57\u65b9\u5411\u9215\u3002\u6309\u4e0b\u65b9\u901a\u77e5UI\u95dc\u9589\u9215\uff0c\u96e2\u958b\u641c\u5c0b\u6587\u5b57\u6a21\u5f0f\u3002",inputs:[{name:"name0",type:"search",placeholder:"\u4f8b:\u5982\u662f\u6211\u805e"}],buttons:[{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary uiFont",handler:function(){return e.setState({showSearchTextAlert:!1})}},{text:"\u641c\u5c0b",cssClass:"primary uiFont",handler:function(t){""!==t.name0?(e.findSearchTextRanges(t.name0),0===e.searchTextRanges.length?e.setState({showSearchTextAlert:!1,showToast:!0,toastMessage:"\u627e\u4e0d\u5230\u6587\u5b57\uff1a".concat(t.name0)}):(e.setState({showSearchTextAlert:!1,showSearchTextToast:!0,searchText:t.name0}),e.searchTextPrev())):e.setState({showSearchTextAlert:!1})}}]}),o.a.createElement(k.H,{cssClass:"uiFont",isOpen:this.state.showSearchTextToast,onDidDismiss:function(){return e.setState({showSearchTextToast:!1})},message:"\u641c\u5c0b\uff1a".concat(this.state.searchText),buttons:[{text:"\u95dc\u9589",role:"cancel",handler:function(){return e.setState({showSearchTextToast:!1})}}]}),o.a.createElement(k.H,{cssClass:"uiFont",isOpen:this.state.showToast,onDidDismiss:function(){return e.setState({showToast:!1})},message:this.state.toastMessage,duration:2e3})))}},{key:"fileName",get:function(){return M.getFileName(this.props.match.params.work,this.props.match.params.path)}},{key:"isTopPage",get:function(){return"/catalog"===this.props.match.url}},{key:"bookmark",get:function(){var e=this;return this.props.bookmarks.find((function(t){return t.type===U.JUAN&&t.uuid===e.uuidStr}))}},{key:"hasBookmark",get:function(){return""!==this.epubcfiFromUrl||null!=this.bookmark}},{key:"epubcfi",get:function(){return""!==this.epubcfiFromUrl?this.epubcfiFromUrl:null!=this.bookmark?this.bookmark.epubcfi:"epubcfi(/6/6[s1]!/4/4/2/6[body]/6,/1:0,/1:1)"}}]),a}(o.a.Component),he=Object(k.U)(pe),de=Object(b.b)((function(e){return{bookmarks:e.settings.bookmarks,fontSize:e.settings.fontSize,showComments:e.settings.showComments,paginated:e.settings.paginated,rtlVerticalLayout:e.settings.rtlVerticalLayout,settings:e.settings,scrollbarSize:e.settings.scrollbarSize,speechRate:e.settings.speechRate}}))(he),me=(n(398),n(399),n(400),n(401),n(402),n(403),n(404),n(405),n(406),n(407),n(408),n(409),n(122)),fe=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).state={showFontLicense:!1,juansDownloadedRatio:0,showUpdateAllJuansDone:!1,showToast:!1,toastMessage:""},a}return Object(m.a)(n,[{key:"updateBookmark",value:function(e,t){var n=e.findIndex((function(e){return e.uuid===t.uuid}));-1===n?console.error("Update bookmark fails! Can't find the original bookmark with UUID: ".concat(t.uuid)):e[n]=t}},{key:"updateAllJuans",value:function(){var e=Object(h.a)(p.a.mark((function e(){var t,n,a,r,o,s,i,c,l,u,h,d,m,f,v,g,k,y,b,w,E;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(this.setState({juansDownloadedRatio:0}),t=this.props.bookmarks.filter((function(e){return e.type===U.WORK})),n=this.props.bookmarks.filter((function(e){return e.type===U.JUAN})),a=n.filter((function(e){return-1===t.findIndex((function(t){var n,a;return(null===(n=t.work)||void 0===n?void 0:n.work)===(null===(a=e.work)||void 0===a?void 0:a.work)}))})),r=a.length,o=0;o<t.length;o++)s=t[o].work,r+=s.juan_list.split(",").length;i=0,c=0;case 8:if(!(c<t.length)){e.next=30;break}l=t[c],u=l.work,h=u.juan_list.split(","),d=0;case 13:if(!(d<h.length)){e.next=27;break}return m=h[d],i+=1,this.setState({juansDownloadedRatio:i/r}),e.next=19,M.fetchJuan(u.work,m,null,!0);case 19:f=e.sent,v=M.getFileName(u.work,m),M.saveFileToIndexedDB(v,f.htmlStr),0===d&&this.updateBookmark(this.props.bookmarks,Object.assign(l,{work:f.workInfo})),console.log("File saved: ".concat(v));case 24:d++,e.next=13;break;case 27:c++,e.next=8;break;case 30:g=0;case 31:if(!(g<a.length)){e.next=48;break}return i+=1,this.setState({juansDownloadedRatio:i/r}),k=a[g],y=k.work,e.next=38,M.fetchJuan(y.work,"".concat(y.juan),null,!0);case 38:b=e.sent,w=M.getFileName(y.work,"".concat(y.juan)),(E=b.workInfo).juan=y.juan,M.saveFileToIndexedDB(w,b.htmlStr),this.updateBookmark(this.props.bookmarks,Object.assign(k,{work:E})),console.log("File saved: ".concat(w));case 45:g++,e.next=31;break;case 48:this.props.dispatch({type:"UPDATE_BOOKMARKS",bookmarks:this.props.bookmarks}),this.setState({showUpdateAllJuansDone:!0});case 50:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return o.a.createElement(k.s,null,o.a.createElement(k.g,null,o.a.createElement(k.J,null,o.a.createElement(k.G,{className:"uiFont"},"\u8a2d\u5b9a"))),o.a.createElement(k.d,null,o.a.createElement(k.p,null,o.a.createElement(k.k,null,o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.G,slot:"start"}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},"\u96fb\u5b50\u4f5b\u5178app\u7248\u672c: ",o.a.createElement("a",{href:"https://github.com/MrMYHuang/cbetar2#history",target:"_new"},me.version)),o.a.createElement(k.c,{slot:"end",size:"large",style:{fontSize:"var(--ui-font-size)"},onClick:function(t){e.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:window.location.origin}})}},"\u5206\u4eab")),o.a.createElement(k.k,null,o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.z,slot:"start"}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},"\u6aa2\u67e5app\u66f4\u65b0"),o.a.createElement(k.c,{slot:"end",size:"large",style:{fontSize:"var(--ui-font-size)"},onClick:function(){var t=Object(h.a)(p.a.mark((function t(n){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,M.updateApp();case 2:t.sent||e.setState({showToast:!0,toastMessage:"App\u5df2\u662f\u6700\u65b0\u7248"});case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},"\u6aa2\u67e5")),o.a.createElement(k.k,null,o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.f,slot:"start"}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},o.a.createElement("a",{href:"https://github.com/MrMYHuang/cbetar2#report",target:"_new"},"\u555f\u7528app\u7570\u5e38\u8a18\u9304")),o.a.createElement(k.I,{slot:"end",checked:this.props.hasAppLog,onIonChange:function(t){var n=t.detail.checked;n?M.enableAppLog():M.disableAppLog(),e.props.dispatch({type:"SET_KEY_VAL",key:"hasAppLog",val:n})}})),o.a.createElement(k.k,{hidden:!this.props.hasAppLog},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.f,slot:"start"}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},"\u56de\u5831app\u7570\u5e38\u8a18\u9304"),o.a.createElement(k.c,{slot:"end",size:"large",style:{fontSize:"var(--ui-font-size)"},onClick:function(t){window.open("mailto:myh@live.com?subject=\u96fb\u5b50\u4f5b\u5178\u7570\u5e38\u8a18\u9304\u56de\u5831&body=".concat(encodeURIComponent("\u554f\u984c\u63cf\u8ff0(\u5efa\u8b70\u586b\u5beb)\uff1a\n\n\u700f\u89bd\u5668\uff1a"+navigator.userAgent+"\n\nApp\u7248\u672c\uff1a"+me.version+"\n\nApp\u8a2d\u5b9a\uff1a"+JSON.stringify(e.props.settings)+"\n\nLog\uff1a\n"+M.getLog())))}},"\u56de\u5831")),o.a.createElement(k.k,null,o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.p,slot:"start"}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},"App\u8a2d\u5b9a\u8207\u66f8\u7c64"),o.a.createElement(k.c,{size:"large",style:{fontSize:"var(--ui-font-size)"},onClick:function(){var e=Object(h.a)(p.a.mark((function e(t){var n,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n="data:text/json;charset=utf-8,".concat(encodeURIComponent(localStorage.getItem("Settings.json")||"")),(a=document.createElement("a")).href=n,a.download="Settings.json",a.click(),a.remove();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},"\u532f\u51fa"),o.a.createElement("input",{id:"importJsonInput",type:"file",accept:".json",style:{display:"none"},onChange:function(){var t=Object(h.a)(p.a.mark((function t(n){var a,r,o;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=null===(a=n.target.files)||void 0===a?void 0:a.item(0),t.next=3,null===r||void 0===r?void 0:r.text();case 3:if(t.t0=t.sent,t.t0){t.next=6;break}t.t0="";case 6:o=t.t0;try{JSON.parse(o),localStorage.setItem("Settings.json",o),e.props.dispatch({type:"LOAD_SETTINGS"}),e.updateAllJuans()}catch(s){console.error(s),console.error((new Error).stack)}document.getElementById("importJsonInput").value="";case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}),o.a.createElement(k.c,{size:"large",style:{fontSize:"var(--ui-font-size)"},onClick:function(e){document.querySelector("#importJsonInput").click()}},"\u532f\u5165")),o.a.createElement(k.k,null,o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.z,slot:"start"}),o.a.createElement("div",{style:{width:"100%"}},o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},"\u66f4\u65b0\u96e2\u7dda\u7d93\u6587\u6a94"),o.a.createElement(k.u,{value:this.state.juansDownloadedRatio})),o.a.createElement(k.c,{slot:"end",size:"large",style:{fontSize:"var(--ui-font-size)"},onClick:function(){var t=Object(h.a)(p.a.mark((function t(n){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.updateAllJuans());case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},"\u66f4\u65b0"),o.a.createElement(k.H,{cssClass:"uiFont",isOpen:this.state.showUpdateAllJuansDone,onDidDismiss:function(){return e.setState({showUpdateAllJuansDone:!1})},message:"\u96e2\u7dda\u7d93\u6587\u6a94\u66f4\u65b0\u5b8c\u7562\uff01",duration:2e3})),o.a.createElement(k.k,null,o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.m,slot:"start"}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},M.appSettings.theme),o.a.createElement(k.B,{slot:"end",value:this.props.theme,style:{fontSize:"var(--ui-font-size)"},interface:"popover",interfaceOptions:{cssClass:"cbetar2themes"},onIonChange:function(t){var n=t.detail.value;e.props.dispatch({type:"SET_KEY_VAL",key:"theme",val:n})}},o.a.createElement(k.C,{className:"uiFont cbeta",value:0},"CBETA"),o.a.createElement(k.C,{className:"uiFont dark",value:1},"\u6697\u8272"),o.a.createElement(k.C,{className:"uiFont light",value:2},"\u4eae\u8272"),o.a.createElement(k.C,{className:"uiFont oldPaper",value:3},"\u820a\u66f8"),o.a.createElement(k.C,{className:"uiFont marble",value:4},"\u5927\u7406\u77f3"))),o.a.createElement(k.k,null,o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.o,slot:"start"}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},M.appSettings.rtlVerticalLayout),o.a.createElement(k.I,{slot:"end",checked:this.props.rtlVerticalLayout,onIonChange:function(t){var n=t.detail.checked;e.props.dispatch({type:"SET_KEY_VAL",key:"rtlVerticalLayout",val:n})}})),o.a.createElement(k.k,null,o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.o,slot:"start"}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},M.appSettings.paginated),o.a.createElement(k.I,{slot:"end",checked:this.props.paginated,onIonChange:function(t){var n=t.detail.checked;e.props.dispatch({type:"SET_KEY_VAL",key:"paginated",val:n})}})),o.a.createElement(k.k,null,o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.o,slot:"start"}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},"\u55ae\u9801\u7d93\u6587\u6372\u8ef8\u5927\u5c0f"),o.a.createElement(k.B,{slot:"end",value:this.props.scrollbarSize,style:{fontSize:"var(--ui-font-size)"},interface:"popover",interfaceOptions:{cssClass:"uiFont"},onIonChange:function(t){var n=t.detail.value;e.props.dispatch({type:"SET_KEY_VAL",key:"scrollbarSize",val:n}),M.updateCssVars(e.props.settings)}},o.a.createElement(k.C,{className:"uiFont",value:0},"\u7121"),o.a.createElement(k.C,{className:"uiFont",value:1},"\u4e2d"),o.a.createElement(k.C,{className:"uiFont",value:2},"\u5927"))),o.a.createElement(k.k,null,o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.o,slot:"start"}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},M.appSettings.showComments),o.a.createElement(k.I,{slot:"end",checked:this.props.showComments,onIonChange:function(t){var n=t.detail.checked;e.props.dispatch({type:"SET_KEY_VAL",key:"showComments",val:n})}})),o.a.createElement(k.k,null,o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.J,slot:"start"}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},M.appSettings.useFontKai),o.a.createElement(k.I,{slot:"end",checked:this.props.useFontKai,onIonChange:function(t){var n=t.detail.checked;e.props.dispatch({type:"SET_KEY_VAL",key:"useFontKai",val:n}),M.updateCssVars(e.props.settings)}})),o.a.createElement(k.k,null,o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.J,slot:"start"}),o.a.createElement("div",{className:"contentBlock"},o.a.createElement("div",{style:{flexDirection:"column"}},o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},M.appSettings.uiFontSize,": ",this.props.uiFontSize),o.a.createElement(k.v,{min:10,max:128,pin:!0,snaps:!0,value:this.props.uiFontSize,onIonChange:function(t){e.props.dispatch({type:"SET_KEY_VAL",key:"uiFontSize",val:t.detail.value}),M.updateCssVars(e.props.settings)}})))),o.a.createElement(k.k,null,o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.J,slot:"start"}),o.a.createElement("div",{className:"contentBlock"},o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},M.appSettings.fontSize,": ",o.a.createElement("span",{className:"textFont"},this.props.settings.fontSize)),o.a.createElement(k.v,{min:10,max:128,pin:!0,snaps:!0,value:this.props.settings.fontSize,onIonChange:function(t){e.props.dispatch({type:"SET_KEY_VAL",key:"fontSize",val:t.detail.value}),M.updateCssVars(e.props.settings)}}))),o.a.createElement(k.k,null,o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.y,slot:"start"}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},M.appSettings.printStyle),o.a.createElement(k.B,{slot:"end",value:this.props.printStyle,style:{fontSize:"var(--ui-font-size)"},interface:"popover",interfaceOptions:{cssClass:"cbetar2themes"},onIonChange:function(t){var n=t.detail.value;e.props.dispatch({type:"SET_KEY_VAL",key:"printStyle",val:n})}},o.a.createElement(k.C,{className:"uiFont blackWhite printVar",value:0},"\u767d\u5e95\u9ed1\u5b57"),o.a.createElement(k.C,{className:"uiFont manuscript printVar",value:1},"\u6284\u7d93\u672c"))),o.a.createElement(k.k,null,o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.x,slot:"start"}),o.a.createElement("div",{className:"contentBlock"},o.a.createElement("div",{style:{flexDirection:"column"}},o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},o.a.createElement("a",{href:"https://github.com/MrMYHuang/cbetar2#text2speech",target:"_new"},"\u5408\u6210\u8a9e\u97f3\u8a9e\u901f"),": ",this.props.speechRate),o.a.createElement(k.v,{min:.1,max:1.5,step:.1,snaps:!0,value:this.props.speechRate,onIonChange:function(t){e.props.dispatch({type:"SET_KEY_VAL",key:"speechRate",val:t.detail.value.toFixed(1)})}})))),o.a.createElement(k.k,null,o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.s,slot:"start"}),o.a.createElement("div",{style:{fontSize:"var(--ui-font-size)"}},o.a.createElement("div",null,"\u95dc\u65bc"),o.a.createElement("div",null,o.a.createElement("a",{href:"https://github.com/MrMYHuang/cbetar2#web-app",target:"_new"},"\u7a0b\u5f0f\u5b89\u88dd\u8aaa\u660e")),o.a.createElement("div",null,o.a.createElement("a",{href:"https://github.com/MrMYHuang/cbetar2",target:"_new"},"\u64cd\u4f5c\u8aaa\u660e\u8207\u958b\u653e\u539f\u59cb\u78bc")),o.a.createElement("div",null,"CBETA API\u7248\u672c: ",M.apiVersion),o.a.createElement("div",null,o.a.createElement("a",{href:"http://cbdata.dila.edu.tw/v1.2/",target:"_new"},"CBETA API\u53c3\u8003\u6587\u4ef6")),o.a.createElement("div",null,o.a.createElement("a",{href:"http://glossaries.dila.edu.tw/?locale=zh-TW",target:"_new"},"DILA \u4f5b\u5b78\u8853\u8a9e\u5b57\u8fad\u5178")),o.a.createElement("div",null,"\u4f5c\u8005: Meng-Yuan Huang"),o.a.createElement("div",null,o.a.createElement("a",{href:"mailto:myh@live.com",target:"_new"},"myh@live.com")),o.a.createElement("div",null,o.a.createElement("a",{href:"https://github.com/MrMYHuang/cbetar2#contributors",target:"_new"},"App\u76f8\u95dc\u8ca2\u737b\u8005")),o.a.createElement("div",null,o.a.createElement("a",{href:"/",onClick:function(t){t.preventDefault(),e.setState({showFontLicense:!0})}},"\u5168\u5b57\u5eab\u5b57\u578b\u7248\u6b0a\u8072\u660e")))),o.a.createElement(k.a,{cssClass:"uiFont",isOpen:this.state.showFontLicense,backdropDismiss:!1,message:"\u6b64app\u4f7f\u7528\u7684\u5168\u5b57\u5eab\u5b57\u578b(2020-08-18\u7248)\u7531\u570b\u5bb6\u767c\u5c55\u59d4\u54e1\u6703\u63d0\u4f9b\u3002\u6b64\u958b\u653e\u8cc7\u6599\u4f9d\u653f\u5e9c\u8cc7\u6599\u958b\u653e\u6388\u6b0a\u689d\u6b3e (Open Government Data License) \u9032\u884c\u516c\u773e\u91cb\u51fa\uff0c\u4f7f\u7528\u8005\u65bc\u9075\u5b88\u672c\u689d\u6b3e\u5404\u9805\u898f\u5b9a\u4e4b\u524d\u63d0\u4e0b\uff0c\u5f97\u5229\u7528\u4e4b\u3002\u653f\u5e9c\u8cc7\u6599\u958b\u653e\u6388\u6b0a\u689d\u6b3e\uff1ahttps://data.gov.tw/license",buttons:[{text:"\u95dc\u9589",cssClass:"primary uiFont",handler:function(t){e.setState({showFontLicense:!1})}},{text:"\u958b\u555f\u6388\u6b0a",cssClass:"secondary uiFont",handler:function(t){e.setState({showFontLicense:!1}),window.open("https://data.gov.tw/license")}}]})),o.a.createElement(k.H,{cssClass:"uiFont",isOpen:this.state.showToast,onDidDismiss:function(){return e.setState({showToast:!1})},message:this.state.toastMessage,duration:2e3})))}}]),n}(o.a.Component),ve=Object(b.b)((function(e){return{settings:e.settings,hasAppLog:e.settings.hasAppLog,theme:e.settings.theme,showComments:e.settings.showComments,paginated:e.settings.paginated,rtlVerticalLayout:e.settings.rtlVerticalLayout,scrollbarSize:e.settings.scrollbarSize,useFontKai:e.settings.useFontKai,uiFontSize:e.settings.uiFontSize,printStyle:e.settings.printStyle,speechRate:e.settings.speechRate,bookmarks:e.settings.bookmarks}}))(fe),ge=o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{style:{fontSize:"var(--ui-font-size)",textAlign:"center"}},"\u53ef\u96e2\u7dda\u700f\u89bd\u5716\u793a ",o.a.createElement(k.h,{icon:W.p})),o.a.createElement("div",{style:{fontSize:"var(--ui-font-size)",textAlign:"center"}},o.a.createElement("a",{href:"https://github.com/MrMYHuang/cbetar2#web-app",target:"_new"},"\u7a0b\u5f0f\u5b89\u88dd\u8aaa\u660e")),o.a.createElement("div",{style:{fontSize:"var(--ui-font-size)",textAlign:"center"}},o.a.createElement("a",{href:"https://github.com/MrMYHuang/cbetar2#shortcuts",target:"_new"},"\u7a0b\u5f0f\u6377\u5f91"))),ke=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).bookmarkListRef=void 0,a.state={reorder:!1,showToast:!1,toastMessage:""},a.bookmarkListRef=o.a.createRef(),a}return Object(m.a)(n,[{key:"ionViewWillEnter",value:function(){var e=E.a.parse(this.props.location.search);if(e.item&&e.item<this.props.bookmarks.length){var t,n,a=this.props.bookmarks[e.item];this.props.history.push("/catalog/juan/".concat(null===(t=a.work)||void 0===t?void 0:t.work,"/").concat(null===(n=a.work)||void 0===n?void 0:n.juan))}else this.hasBookmark||(this.setState({showToast:!0,toastMessage:"\u7121\u66f8\u7c64\uff01\u8acb\u5f9e\u76ee\u9304\u9801\u65b0\u589e\u66f8\u7c64\u3002"}),this.props.history.push("/catalog/famous"))}},{key:"delBookmarkHandler",value:function(e){this.props.dispatch({type:"DEL_BOOKMARK",uuid:e}),this.hasBookmark||this.props.history.push("/catalog/famous")}},{key:"reorderBookmarks",value:function(e){var t=e.detail.complete(this.props.bookmarks);this.props.dispatch({type:"UPDATE_BOOKMARKS",bookmarks:t})}},{key:"getBookmarkRows",value:function(){var e=this,t=this.props.bookmarks,n=Array();return t.forEach((function(t,a){var r,s,i,c,l,u,d="",m="".concat(t.selectedText),f=!1;switch(t.type){case U.CATALOG:d="/catalog/catalog/".concat(t.uuid);break;case U.WORK:d="/catalog/work/".concat(t.uuid);break;case U.JUAN:d="/catalog/juan/".concat(null===(r=t.work)||void 0===r?void 0:r.work,"/").concat(null===(s=t.work)||void 0===s?void 0:s.juan),m="".concat(null===(i=t.work)||void 0===i?void 0:i.title,"\u7b2c").concat(null===(c=t.work)||void 0===c?void 0:c.juan,"\u5377 - ").concat(m);break;case U.HTML:f=!0,d="/catalog/juan/".concat(null===(l=t.work)||void 0===l?void 0:l.work,"/1"),m="".concat(null===(u=t.work)||void 0===u?void 0:u.title," - ").concat(m)}n.push(o.a.createElement(k.n,{key:"bookmarkItemSliding_"+a},o.a.createElement(k.k,{key:"bookmarkItem_"+a,button:!0,onClick:function(){var n=Object(h.a)(p.a.mark((function n(a){var r;return p.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!e.state.reorder){n.next=3;break}return e.setState({showToast:!0,toastMessage:"\u8acb\u5148\u95dc\u9589\u6392\u5217\u529f\u80fd\uff0c\u624d\u53ef\u9ede\u64ca\u66f8\u7c64\uff01"}),n.abrupt("return");case 3:a.preventDefault(),e.props.history.push({pathname:d,state:{uuid:t.uuid},search:E.a.stringify(f?{file:t.fileName,title:null===(r=t.work)||void 0===r?void 0:r.title}:{})});case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont",key:"bookmarkItemLabel_"+a},m),t.type===U.CATALOG?"":o.a.createElement(k.h,{icon:W.p,slot:"end"}),o.a.createElement(k.w,{slot:"end"})),o.a.createElement(k.m,{side:"end"},o.a.createElement(k.l,{style:{fontSize:"var(--ui-font-size)"},color:"danger",onClick:function(n){var a;e.delBookmarkHandler(t.uuid),null===(a=e.bookmarkListRef.current)||void 0===a||a.closeSlidingItems()}},"\u522a\u9664"))))})),n}},{key:"render",value:function(){var e=this,t=this.getBookmarkRows();return o.a.createElement(k.s,{key:"bookmarksPage".concat(this.isFamousPage)},o.a.createElement(k.g,null,o.a.createElement(k.J,null,o.a.createElement(k.G,{style:{fontSize:"var(--ui-font-size)"}},"\u66f8\u7c64"),o.a.createElement(k.c,{fill:this.state.reorder?"solid":"clear",slot:"end",onClick:function(t){return e.setState({reorder:!e.state.reorder})}},o.a.createElement(k.h,{icon:W.I,slot:"icon-only"})))),o.a.createElement(k.d,null,this.hasBookmark?o.a.createElement(o.a.Fragment,null,o.a.createElement(k.p,{key:"bookmarkList0",ref:this.bookmarkListRef},o.a.createElement(k.x,{disabled:!this.state.reorder,onIonItemReorder:function(t){e.reorderBookmarks(t)}},t)),ge):o.a.createElement(o.a.Fragment,null,o.a.createElement(k.p,{key:"bookmarkList1"},t),ge),o.a.createElement(k.H,{cssClass:"uiFont",isOpen:this.state.showToast,onDidDismiss:function(){return e.setState({showToast:!1})},message:this.state.toastMessage,duration:2e3})))}},{key:"hasBookmark",get:function(){return this.props.bookmarks.length>0}},{key:"isFamousPage",get:function(){return"/catalog/famous"===this.props.match.url}}]),n}(o.a.Component),ye=Object(k.U)(ke),be=Object(b.b)((function(e){return{bookmarks:e.settings.bookmarks}}))(ye),we=function e(t){var n;Object(d.a)(this,e),this.type=void 0,this.n=void 0,this.label=void 0,this.work=void 0,this.title=void 0,this.creators=void 0,this.type=t.type,this.n=t.n,this.label=t.label,this.work=t.work,this.title=t.title,this.creators=null!==(n=t.creators)&&void 0!==n?n:"\u7121"},Ee=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).state={fetchError:!1,showSearchAlert:!1,searches:[],isLoading:!1},a}return Object(m.a)(n,[{key:"ionViewWillEnter",value:function(){}},{key:"componentDidMount",value:function(){this.search(this.props.match.params.keyword)}},{key:"search",value:function(){var e=Object(h.a)(p.a.mark((function e(t){var n,a,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({isLoading:!0}),e.prev=1,e.next=4,M.axiosInstance.get("/toc?q=".concat(t),{responseType:"arraybuffer"});case 4:return n=e.sent,a=JSON.parse((new TextDecoder).decode(n.data)).results,r=a.map((function(e){return new we(e)})),this.setState({fetchError:!1,isLoading:!1,searches:r}),e.abrupt("return",!0);case 11:return e.prev=11,e.t0=e.catch(1),console.error(e.t0),console.error((new Error).stack),this.setState({fetchError:!0,isLoading:!1}),e.abrupt("return",!1);case 17:case"end":return e.stop()}}),e,this,[[1,11]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getRows",value:function(){var e=this,t=Array();return this.state.searches.forEach((function(n,a){var r="catalog"===n.type,s=r?n.label:"".concat(n.title,"\n\u4f5c\u8005:").concat(n.creators),i="/".concat(e.props.match.params.tab)+(r?"/catalog/".concat(n.n):"/work/".concat(n.work));t.push(o.a.createElement(k.k,{key:"searchItem_"+a,button:!0,onClick:function(){var t=Object(h.a)(p.a.mark((function t(n){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.preventDefault(),e.props.history.push({pathname:i});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont",key:"searchLabel_"+a},s)))})),t}},{key:"render",value:function(){var e=this,t=this.getRows();return o.a.createElement(k.s,null,o.a.createElement(k.g,null,o.a.createElement(k.J,null,o.a.createElement(k.G,{style:{fontSize:"var(--ui-font-size)"}},"\u641c\u5c0b - ",this.props.match.params.keyword),o.a.createElement(k.c,{hidden:this.isTopPage,fill:"clear",slot:"start",onClick:function(t){return e.props.history.goBack()}},o.a.createElement(k.h,{icon:W.a,slot:"icon-only"})),o.a.createElement(k.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(t){return e.search(e.props.match.params.keyword)}},o.a.createElement(k.h,{icon:W.z,slot:"icon-only"})),o.a.createElement(k.c,{fill:"clear",slot:"end",onClick:function(t){return e.props.history.push("/".concat(e.props.match.params.tab))}},o.a.createElement(k.h,{icon:W.t,slot:"icon-only"})),o.a.createElement(k.c,{fill:"clear",slot:"end",onClick:function(t){return e.setState({showSearchAlert:!0})}},o.a.createElement(k.h,{icon:W.C,slot:"icon-only"})),o.a.createElement(k.c,{fill:"clear",slot:"end",onClick:function(t){e.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})}},o.a.createElement(k.h,{icon:W.G,slot:"icon-only"})))),o.a.createElement(k.d,null,this.state.fetchError?M.fetchErrorContent:o.a.createElement(k.p,null,t),o.a.createElement(k.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return e.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."}),o.a.createElement(G,Object(l.a)({showSearchAlert:this.state.showSearchAlert,finish:function(){e.setState({showSearchAlert:!1})}},this.props))))}},{key:"isTopPage",get:function(){return"/catalog"===this.props.match.url}}]),n}(o.a.Component),Se=Object(k.U)(Ee),xe=Object(b.b)((function(e){return{}}))(Se),Te=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).searchBarRef=void 0,a.selectedTextBeforeIonPopover="",a.state={keyword:"",searches:[],showNoSelectedTextAlert:!1,popover:{show:!1,event:null},isLoading:!1,fetchError:!1,showToast:!1,toastMessage:""},a.searchBarRef=o.a.createRef(),a}return Object(m.a)(n,[{key:"ionViewWillEnter",value:function(){this.setState({keyword:this.props.match.params.keyword}),this.props.match.params.keyword?this.lookupDict(this.props.match.params.keyword):this.setState({searches:[]})}},{key:"lookupDict",value:function(){var e=Object(h.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({isLoading:!0}),e.prev=1,e.next=4,M.axiosInstance.get("".concat(M.dilaDictApiUrl,"/?type=match&dicts=dila&term=").concat(t),{responseType:"json"});case 4:n=e.sent,this.setState({fetchError:!1,isLoading:!1,searches:n.data}),e.next=14;break;case 8:return e.prev=8,e.t0=e.catch(1),console.error(e.t0),console.error((new Error).stack),this.setState({fetchError:!0,isLoading:!1}),e.abrupt("return",!1);case 14:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getSelectedString",value:function(){var e=document.getSelection();return((null===e||void 0===e?void 0:e.rangeCount)||0)>0&&e.getRangeAt(0).toString().length>0?e.getRangeAt(0).toString():""}},{key:"getRows",value:function(){var e=this.state.searches,t=Array();return e.forEach((function(e,n){t.push(o.a.createElement("div",{style:{display:"table-row"},key:"dictItem"+n},o.a.createElement("div",{className:"tableCell"},o.a.createElement("div",{className:"ion-text-wrap textFont",style:{color:"var(--ion-color-primary)",paddingBottom:"18pt"},dangerouslySetInnerHTML:{__html:e.dict_name_zh}}),o.a.createElement("div",{className:"ion-text-wrap textFont",key:"dictItemLabel"+n,dangerouslySetInnerHTML:{__html:e.desc}}))))})),t}},{key:"render",value:function(){var e=this;return o.a.createElement(k.s,null,o.a.createElement(k.g,null,o.a.createElement(k.J,null,o.a.createElement(k.c,{hidden:this.isTopPage,fill:"clear",slot:"start",onClick:function(t){return e.props.history.goBack()}},o.a.createElement(k.h,{icon:W.a,slot:"icon-only"})),o.a.createElement(k.c,{slot:"start",onClick:function(t){e.props.history.push("/dictionary/searchWord")}},o.a.createElement("span",{className:"uiFont",style:{color:"var(--color)"}},"\u4f5b\u5b78\u8a5e\u5178")),o.a.createElement(k.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(t){return e.lookupDict(e.props.match.params.keyword)}},o.a.createElement(k.h,{icon:W.z,slot:"icon-only"})),o.a.createElement(k.c,{fill:"clear",slot:"end",onClick:function(t){e.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})}},o.a.createElement(k.h,{icon:W.G,slot:"icon-only"})),o.a.createElement(k.c,{fill:"clear",slot:"end",onPointerDown:function(t){e.selectedTextBeforeIonPopover=e.getSelectedString()},onClick:function(t){e.setState({popover:{show:!0,event:t.nativeEvent}})}},o.a.createElement(k.h,{ios:W.q,md:W.r,slot:"icon-only"})),o.a.createElement(k.t,{isOpen:this.state.popover.show,event:this.state.popover.event,onDidDismiss:function(t){e.selectedTextBeforeIonPopover="",e.setState({popover:{show:!1,event:null}})}},o.a.createElement(k.p,null,o.a.createElement(k.k,{button:!0,onClick:function(t){e.props.history.push("/".concat(e.props.match.params.tab)),e.setState({popover:{show:!1,event:null}})}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.t,slot:"start"}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},"\u56de\u9996\u9801")),o.a.createElement(k.k,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}}),M.copyToClipboard(e.selectedTextBeforeIonPopover),e.setState({showToast:!0,toastMessage:"\u8907\u88fd\u6587\u5b57\u6210\u529f"})}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.n,slot:"start"}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},"\u8907\u88fd\u6587\u5b57")),o.a.createElement(k.k,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}}),""!==e.selectedTextBeforeIonPopover?e.props.history.push({pathname:"/dictionary/search/".concat(e.selectedTextBeforeIonPopover)}):e.setState({showNoSelectedTextAlert:!0})}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.d,slot:"start"}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},"\u67e5\u8a5e\u5178")),o.a.createElement(k.k,{button:!0,onClick:function(t){e.setState({popover:{show:!1,event:null}}),""!==e.selectedTextBeforeIonPopover?e.props.history.push({pathname:"/dictionary/searchWord/".concat(e.selectedTextBeforeIonPopover)}):e.setState({showNoSelectedTextAlert:!0})}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.d,slot:"start"}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},"\u67e5\u5b57\u5178")))))),o.a.createElement(k.d,null,o.a.createElement(k.A,{ref:this.searchBarRef,placeholder:"\u8acb\u8f38\u5165\u5b57\u8a5e\uff0c\u518d\u6309\u9375\u76e4Enter\u9375",value:this.state.keyword,onIonClear:function(t){e.setState({searches:[]})},onKeyUp:function(t){var n=t.target.value;e.setState({keyword:n}),""===n?e.setState({searches:[]}):"Enter"===t.key&&(e.props.dictionaryHistory.unshift(n),e.props.dictionaryHistory.splice(10),e.props.dispatch({type:"SET_KEY_VAL",key:"dictionaryHistory",val:e.props.dictionaryHistory}),n===e.props.match.params.keyword?(e.setState({keyword:n}),e.lookupDict(n)):e.props.history.push("/dictionary/search/".concat(n)))}}),this.state.fetchError?M.fetchErrorContent:this.state.searches.length<1||this.props.dictionaryHistory.length>0&&(""===this.state.keyword||void 0===this.state.keyword)?o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"uiFont",style:{color:"var(--ion-color-primary)"}},"\u641c\u5c0b\u6b77\u53f2"),o.a.createElement(k.p,null,this.props.dictionaryHistory.map((function(t,n){return o.a.createElement(k.k,{key:"dictHistoryItem_".concat(n),button:!0,onClick:function(){var n=Object(h.a)(p.a.mark((function n(a){return p.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t===e.props.match.params.keyword?(e.setState({keyword:t}),e.lookupDict(t)):e.props.history.push("/dictionary/search/".concat(t));case 1:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()},o.a.createElement(k.o,{className:"ion-text-wrap uiFont",key:"dictHistoryLabel_"+n},t))}))),o.a.createElement("div",{style:{textAlign:"center"}},o.a.createElement(k.c,{size:"large",style:{fontSize:"var(--ui-font-size)"},onClick:function(t){e.setState({keyword:""}),e.props.dispatch({type:"SET_KEY_VAL",key:"dictionaryHistory",val:[]})}},"\u6e05\u9664\u6b77\u53f2"))):o.a.createElement("div",{style:{display:"table"}},this.getRows()),o.a.createElement("div",{style:{fontSize:"var(--ui-font-size)",textAlign:"center"}},o.a.createElement("a",{href:"https://github.com/MrMYHuang/cbetar2#dictionary",target:"_new"},"\u4f5b\u5b78\u8a5e\u5178\u8aaa\u660e")),o.a.createElement(k.a,{cssClass:"uiFont",isOpen:this.state.showNoSelectedTextAlert,backdropDismiss:!1,header:"\u5931\u6557",message:"\u8acb\u78ba\u8a8d\u662f\u5426\u5df2\u9078\u64c7\u4e00\u6bb5\u6587\u5b57\uff0c\u7136\u5f8c\u518d\u57f7\u884c\u6240\u9078\u7684\u529f\u80fd!",buttons:[{text:"\u78ba\u5b9a",cssClass:"primary uiFont",handler:function(t){e.setState({showNoSelectedTextAlert:!1})}}]}),o.a.createElement(k.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return e.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."}),o.a.createElement(k.H,{cssClass:"uiFont",isOpen:this.state.showToast,onDidDismiss:function(){return e.setState({showToast:!1})},message:this.state.toastMessage,duration:2e3})))}},{key:"isTopPage",get:function(){return void 0===this.props.match.params.keyword}}]),n}(o.a.Component),Ce=Object(k.U)(Te),je=Object(b.b)((function(e){return{dictionaryHistory:e.settings.dictionaryHistory}}))(Ce),Ae=function e(t){Object(d.a)(this,e),this.id=void 0,this.term_hits=void 0,this.work=void 0,this.juan=void 0,this.title=void 0,this.creators=void 0,this.id=t.id,this.term_hits=t.term_hits,this.work=t.work,this.juan=t.juan,this.title=t.title,this.creators=t.creators},Ie=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).page=0,a.rows=20,a.state={showSearchAlert:!1,searches:[],isScrollOn:!1,isLoading:!1,fetchError:!1},a}return Object(m.a)(n,[{key:"ionViewWillEnter",value:function(){}},{key:"componentDidMount",value:function(){this.search(this.props.match.params.keyword)}},{key:"search",value:function(){var e=Object(h.a)(p.a.mark((function e(t){var n,a,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({isLoading:!0}),e.prev=1,console.log("Loading page ".concat(this.page)),e.next=5,M.axiosInstance.get("/sphinx?q=".concat(t,"&start=").concat(this.page,"&rows=").concat(this.rows),{responseType:"arraybuffer"});case 5:return n=e.sent,a=JSON.parse((new TextDecoder).decode(n.data)).results,r=a.map((function(e){return new Ae(e)})),this.setState({fetchError:!1,isLoading:!1,searches:[].concat(Object(x.a)(this.state.searches),Object(x.a)(r)),isScrollOn:r.length===this.rows}),this.page+=1,e.abrupt("return",!0);case 13:return e.prev=13,e.t0=e.catch(1),console.error(e.t0),console.error((new Error).stack),this.setState({fetchError:!0,isLoading:!1,isScrollOn:!1}),e.abrupt("return",!1);case 19:case"end":return e.stop()}}),e,this,[[1,13]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getRows",value:function(){var e=this,t=Array();return this.state.searches.forEach((function(n,a){var r="".concat(n.title,"\u5377").concat(n.juan,"\n\u4f5c\u8005:").concat(n.creators),s="/catalog/juan/".concat(n.work,"/").concat(n.juan);t.push(o.a.createElement(k.k,{key:"searchItem_"+a,button:!0,onClick:function(){var t=Object(h.a)(p.a.mark((function t(n){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.preventDefault(),e.props.history.push({pathname:s});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont",key:"searchLabel_"+a},r)))})),t}},{key:"render",value:function(){var e=this,t=this.getRows();return o.a.createElement(k.s,null,o.a.createElement(k.g,null,o.a.createElement(k.J,null,o.a.createElement(k.G,{style:{fontSize:"var(--ui-font-size)"}},"\u5168\u6587\u6aa2\u7d22 - ",this.props.match.params.keyword),o.a.createElement(k.c,{hidden:this.isTopPage,fill:"clear",slot:"start",onClick:function(t){return e.props.history.goBack()}},o.a.createElement(k.h,{icon:W.a,slot:"icon-only"})),o.a.createElement(k.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(t){return e.search(e.props.match.params.keyword)}},o.a.createElement(k.h,{icon:W.z,slot:"icon-only"})),o.a.createElement(k.c,{fill:"clear",slot:"end",onClick:function(t){return e.props.history.push("/".concat(e.props.match.params.tab))}},o.a.createElement(k.h,{icon:W.t,slot:"icon-only"})),o.a.createElement(k.c,{fill:"clear",slot:"end",onClick:function(t){return e.setState({showSearchAlert:!0})}},o.a.createElement(k.h,{icon:W.C,slot:"icon-only"})),o.a.createElement(k.c,{fill:"clear",slot:"end",onClick:function(t){e.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})}},o.a.createElement(k.h,{icon:W.G,slot:"icon-only"})))),o.a.createElement(k.d,null,this.state.fetchError?M.fetchErrorContent:o.a.createElement(k.p,null,t,o.a.createElement(k.i,{threshold:"100px",disabled:!this.state.isScrollOn,onIonInfinite:function(t){e.search(e.props.match.params.keyword),t.target.complete()}},o.a.createElement(k.j,{loadingText:"\u8f09\u5165\u4e2d..."}))),o.a.createElement(k.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return e.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."}),o.a.createElement(G,Object(l.a)({showSearchAlert:this.state.showSearchAlert,finish:function(){e.setState({showSearchAlert:!1})}},this.props))))}},{key:"isTopPage",get:function(){return"/catalog"===this.props.match.url}}]),n}(o.a.Component),Oe=Object(k.U)(Ie),Fe=Object(b.b)((function(e){return{}}))(Oe),Le=n(207),Ne=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).state={isAppSettingsExport:Array(Object.keys(M.appSettings).length)},a}return Object(m.a)(n,[{key:"updateQrCode",value:function(){var e=this,t=Object.keys(M.appSettings).filter((function(t,n){return e.state.isAppSettingsExport[n]})).map((function(t,n){return{key:t,val:e.props.settings[t]}})).map((function(e){return"".concat(e.key,"=").concat(+e.val)})).join(",");t=""!==t?"settings=".concat(t):null;var n=this.props.text,a=/\?/.test(n);t&&(n+=a?"&".concat(t):"?".concat(t)),navigator.clipboard&&navigator.clipboard.writeText(n);var r=document.getElementById("qrcCanvas");return Le.toCanvas(r,n),r}},{key:"render",value:function(){var e=this;return o.a.createElement(k.r,{isOpen:this.props.showModal,cssClass:"uiFont",swipeToClose:!0,onWillPresent:function(){for(var t=[],n=0;n<e.state.isAppSettingsExport.length;n++)t.push(!1);e.setState({isAppSettingsExport:t}),e.updateQrCode()},onDidDismiss:function(){return e.props.finish()}},o.a.createElement(k.d,null,o.a.createElement("div",{style:{display:"flex",flexDirection:"column",height:"100%",alignItems:"center"}},o.a.createElement("div",null,o.a.createElement(k.o,{className:"uiFont"},"\u6b64\u9801app\u9023\u7d50\u5df2\u8907\u88fd\u81f3\u526a\u8cbc\u7c3f\uff01")),o.a.createElement("div",null,o.a.createElement(k.o,{className:"uiFont"},"\u4e5f\u53ef\u4ee5\u4f7f\u7528QR Code\u5206\u4eab:")),o.a.createElement("div",{style:{flexGrow:1,display:"flex",alignItems:"center",margin:10}},o.a.createElement("canvas",{id:"qrcCanvas",width:"500",height:"500",style:{margin:"0px auto"}})),o.a.createElement("div",null,o.a.createElement(k.o,{className:"uiFont"},"\u5305\u62ecapp\u8a2d\u5b9a:"),o.a.createElement(k.p,null,Object.keys(M.appSettings).map((function(t,n){return o.a.createElement(k.k,{key:"appSettingExportItem_".concat(n)},o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},M.appSettings[t]),o.a.createElement(k.I,{slot:"end",onIonChange:function(t){var a=e.state.isAppSettingsExport;a[n]=t.detail.checked,e.setState({isAppSettingsExport:a}),e.updateQrCode()}}))})))),o.a.createElement("div",null,o.a.createElement(k.c,{size:"large",onClick:function(){return e.props.finish()}},"\u95dc\u9589")))))}}]),n}(o.a.Component),Pe=Object(b.b)((function(e){return{settings:e.settings}}))(Ne);!function(e){e.NOUN="\u540d",e.VERB="\u52d5"}(ue||(ue={}));var De=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).searchBarRef=void 0,a.selectedTextBeforeIonPopover="",a.state={keyword:"",search:null,showNoSelectedTextAlert:!1,popover:{show:!1,event:null},isLoading:!1,fetchError:!1,showToast:!1,toastMessage:""},a.searchBarRef=o.a.createRef(),a}return Object(m.a)(n,[{key:"ionViewWillEnter",value:function(){this.props.match.params.keyword&&(this.setState({keyword:this.props.match.params.keyword}),this.lookupDict(this.props.match.params.keyword))}},{key:"componentDidMount",value:function(){}},{key:"ionViewWillLeave",value:function(){}},{key:"lookupDict",value:function(){var e=Object(h.a)(p.a.mark((function e(t){var n,a,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({isLoading:!0}),e.prev=1,e.next=4,M.axiosInstance.get("https://www.moedict.tw/uni/".concat(t.substring(0,1)),{responseType:"json"});case 4:n=e.sent,this.setState({fetchError:!1,isLoading:!1,search:n.data.heteronyms}),e.next=13;break;case 8:return e.prev=8,e.t0=e.catch(1),r=e.t0,404===(null===(a=r.response)||void 0===a?void 0:a.status)?this.setState({fetchError:!1,isLoading:!1,search:[]}):(console.error(e.t0),console.error((new Error).stack),this.setState({fetchError:!0,isLoading:!1})),e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getSelectedString",value:function(){var e=document.getSelection();return((null===e||void 0===e?void 0:e.rangeCount)||0)>0&&e.getRangeAt(0).toString().length>0?e.getRangeAt(0).toString():""}},{key:"defToView",value:function(e,t){return void 0!==e&&e.length>0?o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{key:ae.a(),style:{color:"var(--ion-color-primary)"}},t),o.a.createElement("ol",{key:ae.a()},null===e||void 0===e?void 0:e.map((function(e){var t,n,a;return o.a.createElement("li",{key:ae.a()},o.a.createElement("div",{key:ae.a()},e.def),null===(t=e.quote)||void 0===t?void 0:t.map((function(e){return o.a.createElement("div",{key:ae.a()},e)})),null===(n=e.example)||void 0===n?void 0:n.map((function(e){return o.a.createElement("div",{key:ae.a()},e)})),null===(a=e.link)||void 0===a?void 0:a.map((function(e){return o.a.createElement("div",{key:ae.a()},e)})))})))):o.a.createElement(o.a.Fragment,null)}},{key:"render",value:function(){var e,t,n=this,a=[];this.props.match.params.keyword&&(null===(t=this.state.search)||void 0===t||t.forEach((function(e){var t=null===e||void 0===e?void 0:e.definitions.filter((function(e){return e.type===ue.NOUN})),r=null===e||void 0===e?void 0:e.definitions.filter((function(e){return e.type===ue.VERB})),s=null===e||void 0===e?void 0:e.definitions.filter((function(e){return void 0===e.type})),i=n.defToView(t,"\u540d\u8a5e"),c=n.defToView(r,"\u52d5\u8a5e"),l=n.defToView(s,"");a.push(o.a.createElement("div",{key:ae.a(),className:"textFont textSelectable"},o.a.createElement("div",{key:ae.a(),className:"textFontX3"},n.props.match.params.keyword.substring(0,1)),(null===e||void 0===e?void 0:e.bopomofo)?o.a.createElement("div",null,"\u6ce8\u97f3\uff1a",null===e||void 0===e?void 0:e.bopomofo):null,(null===e||void 0===e?void 0:e.pinyin)?o.a.createElement("div",null,"\u62fc\u97f3\uff1a",null===e||void 0===e?void 0:e.pinyin):null,i,c,l))})));return o.a.createElement(k.s,null,o.a.createElement(k.g,null,o.a.createElement(k.J,null,o.a.createElement(k.c,{fill:"clear",slot:"start",onClick:function(e){return n.props.history.goBack()}},o.a.createElement(k.h,{icon:W.a,slot:"icon-only"})),o.a.createElement(k.c,{slot:"start",onClick:function(e){n.props.history.push("/dictionary/search")}},o.a.createElement("span",{className:"uiFont",style:{color:"var(--color)"}},"\u840c\u5178\u5b57\u5178")),o.a.createElement(k.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(e){return n.lookupDict(n.props.match.params.keyword)}},o.a.createElement(k.h,{icon:W.z,slot:"icon-only"})),o.a.createElement(k.c,{fill:"clear",slot:"end",onClick:function(e){n.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})}},o.a.createElement(k.h,{icon:W.G,slot:"icon-only"})),o.a.createElement(k.c,{fill:"clear",slot:"end",onPointerDown:function(e){n.selectedTextBeforeIonPopover=n.getSelectedString()},onClick:function(e){n.setState({popover:{show:!0,event:e.nativeEvent}})}},o.a.createElement(k.h,{ios:W.q,md:W.r,slot:"icon-only"})),o.a.createElement(k.t,{isOpen:this.state.popover.show,event:this.state.popover.event,onDidDismiss:function(e){n.setState({popover:{show:!1,event:null}}),n.selectedTextBeforeIonPopover=""}},o.a.createElement(k.p,null,o.a.createElement(k.k,{button:!0,onClick:function(e){n.props.history.push("/".concat(n.props.match.params.tab)),n.setState({popover:{show:!1,event:null}})}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.t,slot:"start"}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},"\u56de\u9996\u9801")),o.a.createElement(k.k,{button:!0,onClick:function(e){n.setState({popover:{show:!1,event:null}}),M.copyToClipboard(n.selectedTextBeforeIonPopover),n.setState({showToast:!0,toastMessage:"\u8907\u88fd\u6587\u5b57\u6210\u529f"})}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.n,slot:"start"}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},"\u8907\u88fd\u6587\u5b57")),o.a.createElement(k.k,{button:!0,onClick:function(e){n.setState({popover:{show:!1,event:null}}),""!==n.selectedTextBeforeIonPopover?n.props.history.push("/dictionary/search/".concat(n.selectedTextBeforeIonPopover)):n.setState({showNoSelectedTextAlert:!0})}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.d,slot:"start"}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},"\u67e5\u8a5e\u5178")),o.a.createElement(k.k,{button:!0,onClick:function(e){n.setState({popover:{show:!1,event:null}}),""!==n.selectedTextBeforeIonPopover?n.props.history.push({pathname:"/dictionary/searchWord/".concat(n.selectedTextBeforeIonPopover)}):n.setState({showNoSelectedTextAlert:!0})}},o.a.createElement("div",{tabIndex:0}),o.a.createElement(k.h,{icon:W.d,slot:"start"}),o.a.createElement(k.o,{className:"ion-text-wrap uiFont"},"\u67e5\u5b57\u5178")))))),o.a.createElement(k.d,null,o.a.createElement("div",{style:{display:"flex",flexFlow:"column",height:"100%"}},o.a.createElement(k.A,{ref:this.searchBarRef,placeholder:"\u8acb\u8f38\u5165\u5b57\uff0c\u518d\u6309\u9375\u76e4Enter\u9375",value:this.state.keyword,onIonClear:function(e){n.setState({search:null})},onKeyUp:function(e){var t=e.target.value;n.setState({keyword:t}),""===t?n.setState({search:null}):"Enter"===e.key&&(n.props.wordDictionaryHistory.unshift(t),n.props.wordDictionaryHistory.splice(10),n.props.dispatch({type:"SET_KEY_VAL",key:"wordDictionaryHistory",val:n.props.wordDictionaryHistory}),t===n.props.match.params.keyword?(n.setState({keyword:t}),n.lookupDict(t)):n.props.history.push("/dictionary/searchWord/".concat(t)))}}),this.state.fetchError?M.fetchErrorContent:((null===(e=this.state.search)||void 0===e?void 0:e.length)||0)<1||this.props.wordDictionaryHistory.length>0&&(""===this.state.keyword||void 0===this.state.keyword)?o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"uiFont",style:{color:"var(--ion-color-primary)"}},"\u641c\u5c0b\u6b77\u53f2"),o.a.createElement(k.p,null,this.props.wordDictionaryHistory.map((function(e,t){return o.a.createElement(k.k,{key:"wordDictHistoryItem_".concat(t),button:!0,onClick:function(){var t=Object(h.a)(p.a.mark((function t(a){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e===n.props.match.params.keyword?(n.setState({keyword:e}),n.lookupDict(e)):n.props.history.push("/dictionary/searchWord/".concat(e));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},o.a.createElement(k.o,{className:"ion-text-wrap uiFont",key:"wordDictHistoryLabel_"+t},e))}))),o.a.createElement("div",{style:{textAlign:"center"}},o.a.createElement(k.c,{size:"large",style:{fontSize:"var(--ui-font-size)"},onClick:function(e){n.setState({keyword:""}),n.props.dispatch({type:"SET_KEY_VAL",key:"wordDictionaryHistory",val:[]})}},"\u6e05\u9664\u6b77\u53f2"))):a,o.a.createElement(k.a,{cssClass:"uiFont",isOpen:this.state.showNoSelectedTextAlert,backdropDismiss:!1,header:"\u5931\u6557",message:"\u8acb\u78ba\u8a8d\u662f\u5426\u5df2\u9078\u64c7\u4e00\u6bb5\u6587\u5b57\uff0c\u7136\u5f8c\u518d\u57f7\u884c\u6240\u9078\u7684\u529f\u80fd!",buttons:[{text:"\u78ba\u5b9a",cssClass:"primary uiFont",handler:function(e){n.setState({showNoSelectedTextAlert:!1})}}]}),o.a.createElement(k.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return n.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."}),o.a.createElement(k.H,{cssClass:"uiFont",isOpen:this.state.showToast,onDidDismiss:function(){return n.setState({showToast:!1})},message:this.state.toastMessage,duration:2e3}))))}},{key:"isTopPage",get:function(){return this.props.match.url==="/".concat(this.props.match.params.tab)}}]),n}(o.a.Component),_e=Object(k.U)(De),Be=Object(b.b)((function(e){return{wordDictionaryHistory:e.settings.wordDictionaryHistory}}))(_e),Re=function(){var e=localStorage.getItem(M.storeFile);return null!=e?Object(S.c)(H,JSON.parse(e)):Object(S.c)(H)}(),ze=Re.getState();ze.settings.hasAppLog||M.disableAppLog(),Object(k.T)({mode:"md",swipeBackEnabled:!1});var Ve={onSuccess:function(e){},onUpdate:function(e){}},Ue=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(m.a)(n,[{key:"render",value:function(){return o.a.createElement(b.a,{store:Re},o.a.createElement(Ke,this.props))}}]),n}(o.a.Component),Me=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var a;Object(d.a)(this,n),(a=t.call(this,e)).registrationNew=void 0,a.wakeLock=void 0,a.registrationNew=null,Object(k.S)("android")?window.oncontextmenu=M.disableAndroidChromeCallout:Object(k.S)("ios")&&(document.ontouchend=M.disableIosSafariCallout.bind(window)),document.body.classList.forEach((function(e){return document.body.classList.remove(e)})),document.body.classList.toggle("theme".concat(ze.settings.theme),!0),document.body.classList.toggle("print".concat(ze.settings.printStyle),!0);var r=E.a.parse(a.props.location.search);return r.settings&&r.settings.split(",").forEach((function(e){var t=e.split("=");a.props.dispatch({type:"SET_KEY_VAL",key:t[0],val:+t[1]})})),M.updateCssVars(ze.settings),a.state={showUpdateAlert:!1},Ve.onUpdate=function(e){a.registrationNew=e,a.setState({showUpdateAlert:!0})},Ve.onSuccess=function(e){},speechSynthesis.getVoices(),speechSynthesis.cancel(),a.wakeLockScreen(),document.addEventListener("visibilitychange",Object(h.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"visible"===document.visibilityState?a.wakeLockScreen():a.wakeLockScreenRelease();case 1:case"end":return e.stop()}}),e)})))),a.loadTwKaiFont(),a}return Object(m.a)(n,[{key:"loadTwKaiFont",value:function(){var e=Object(h.a)(p.a.mark((function e(){var t,n,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=indexedDB.open(M.cbetardb)).onupgradeneeded=function(e){e.target.result.createObjectStore("store")},e.next=4,new Promise((function(e,a){t.onsuccess=function(){var a=Object(h.a)(p.a.mark((function a(r){var o,s,i;return p.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:o=t.result,s=o.transaction(["store"],"readwrite"),(i=s.objectStore("store").get(M.twKaiFontKey)).onsuccess=function(){var t=Object(h.a)(p.a.mark((function t(a){var r,s;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=i.result){t.next=9;break}return t.next=4,M.axiosInstance.get("".concat(window.location.origin,"/").concat(M.twKaiFontPath),{responseType:"arraybuffer",timeout:0});case 4:r=t.sent,s=o.transaction(["store"],"readwrite"),n=r.data,s.objectStore("store").put(n,M.twKaiFontKey).onsuccess=function(t){return e()};case 9:return t.abrupt("return",e());case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();case 4:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}()}));case 4:return a=new window.FontFace("Kai",n),e.next=7,a.load();case 7:document.fonts.add(a),console.log("[Main] TW-Kai font loading success!");case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"wakeLockScreen",value:function(){var e=Object(h.a)(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,null==(t=navigator.wakeLock)){e.next=9;break}return e.next=5,t.request("screen");case 5:this.wakeLock=e.sent,console.log("Screen wake lock is requested."),e.next=10;break;case 9:console.error("navigator.wakeLock is undefined.");case 10:e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.log("".concat(e.t0.name,", ").concat(e.t0.message)),console.log((new Error).stack);case 16:case"end":return e.stop()}}),e,this,[[0,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"wakeLockScreenRelease",value:function(){var e=Object(h.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.wakeLock){e.next=5;break}return e.next=3,this.wakeLock.release();case 3:this.wakeLock=null,console.log("Screen wake lock is released.");case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"routeByQueryString",value:function(){console.log(window.location.search);var e=/route=([^&]*)/.exec(window.location.search),t=/query=([^&]*)/.exec(window.location.search);if(null!==e){var n="";return null!==t&&(n=decodeURIComponent(t[1])),o.a.createElement(g.a,{to:e[1]+n})}if("/"===window.location.pathname)return o.a.createElement(g.a,{to:"/bookmarks"})}},{key:"render",value:function(){var e,t,n=this;return o.a.createElement(k.b,{style:M.isTouchDevice()?{height:"".concat(window.innerHeight,"px")}:{}},o.a.createElement(y.a,null,o.a.createElement(k.F,null,o.a.createElement(k.z,{animated:!1},o.a.createElement(g.b,{path:"/:tab(catalog)/webview/:work/:path/:label",render:function(e){return o.a.createElement(de,e)},exact:!0}),o.a.createElement(g.b,{path:"/:tab(catalog)/juan/:work/:path/",render:function(e){return o.a.createElement(de,e)},exact:!0}),o.a.createElement(g.b,{path:"/:tab(catalog)/work/:path/:label",render:function(e){return o.a.createElement(te,e)},exact:!0}),o.a.createElement(g.b,{path:"/:tab(catalog)/work/:path",render:function(e){return o.a.createElement(te,e)},exact:!0}),o.a.createElement(g.b,{path:"/:tab(catalog)/search/:keyword",render:function(e){return o.a.createElement(xe,e)},exact:!0}),o.a.createElement(g.b,{path:"/:tab(catalog)/fulltextsearch/:keyword",render:function(e){return o.a.createElement(Fe,e)},exact:!0}),o.a.createElement(g.b,{path:"/:tab(catalog)/catalog/:path/:label",render:function(e){return o.a.createElement(Z,e)},exact:!0}),o.a.createElement(g.b,{path:"/:tab(catalog)/:type(catalog|volumes|famous)?/:path?",render:function(e){return o.a.createElement(Z,e)},exact:!0}),o.a.createElement(g.b,{path:"/:tab(bookmarks)",render:function(e){return o.a.createElement(be,e)},exact:!0}),o.a.createElement(g.b,{path:"/:tab(dictionary)/search/:keyword?",render:function(e){return o.a.createElement(je,e)},exact:!0}),o.a.createElement(g.b,{path:"/:tab(dictionary)/searchWord/:keyword?",render:function(e){return o.a.createElement(Be,e)},exact:!0}),o.a.createElement(g.b,{path:"/settings",render:function(e){return o.a.createElement(ve,e)}}),o.a.createElement(g.b,{path:"/",render:function(){return n.routeByQueryString()},exact:!0})),o.a.createElement(k.D,{slot:"bottom"},o.a.createElement(k.E,{tab:"bookmarks",href:"/bookmarks"},o.a.createElement(k.h,{icon:W.e})),o.a.createElement(k.E,{tab:"catalog",href:"/catalog"},o.a.createElement(k.h,{icon:W.u})),o.a.createElement(k.E,{tab:"dictionay",href:"/dictionary/search"},o.a.createElement(k.h,{icon:W.d})),o.a.createElement(k.E,{tab:"settings",href:"/settings"},o.a.createElement(k.h,{icon:W.F}))))),o.a.createElement(k.a,{cssClass:"uiFont",isOpen:this.state.showUpdateAlert,backdropDismiss:!1,onDidPresent:function(e){var t,a,r,o;null===(t=n.registrationNew)||void 0===t||null===(a=t.installing)||void 0===a||a.postMessage({type:"SKIP_WAITING"}),null===(r=n.registrationNew)||void 0===r||null===(o=r.waiting)||void 0===o||o.postMessage({type:"SKIP_WAITING"})},header:"\u767c\u73feapp\u66f4\u65b0\uff0c\u907f\u514d\u904b\u4f5c\u7570\u5e38\uff0c\u8acb\u91cd\u555fapp\u6216\u95dc\u9589\u76f8\u95dc\u5206\u9801!\u7136\u5f8c\u53ef\u81f3\u8a2d\u5b9a\u9801\u6aa2\u67e5\u7248\u672c\u865f\u3002",buttons:[{text:"\u95dc\u9589",cssClass:"primary uiFont",handler:function(e){n.setState({showUpdateAlert:!1})}},{text:"\u986f\u793a\u7248\u672c\u6b77\u53f2",cssClass:"secondary uiFont",handler:function(e){window.open("https://github.com/MrMYHuang/cbetar2#history")}}]}),o.a.createElement(Pe,Object(l.a)({text:null===(e=this.props.shareTextModal)||void 0===e?void 0:e.text,showModal:(null===(t=this.props.shareTextModal)||void 0===t?void 0:t.show)||!1,finish:function(){Re.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!1}})}},this.props)))}}]),n}(o.a.Component),Ke=Object(b.b)((function(e){return{shareTextModal:e.tmpSettings.shareTextModal}}))(Me),He=Object(g.f)(Ue),Je=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function We(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){console.log("installingWorker stage changed: ".concat(n.state)),"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}M.enableAppLog(),i.a.render(o.a.createElement(c.a,null,o.a.createElement(He,null)),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("","/service-worker.js");Je?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):We(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):We(t,e)}))}}({onSuccess:function(e){console.log("Precache app loaded!"),Ve.onSuccess(e)},onUpdate:function(e){console.log("Found app updated!"),Ve.onUpdate(e)}})}},[[211,3,4]]]);
//# sourceMappingURL=main.62f1a642.chunk.js.map