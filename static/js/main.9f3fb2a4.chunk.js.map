{"version":3,"sources":["../node_modules/@ionic/core/dist/esm-es5 lazy /^/.*/.entry/.js$/ groupOptions: {} namespace object","../node_modules/ionicons/dist/esm-es5 lazy /^/.*/.entry/.js$/ include: /.entry/.js$/ exclude: /.system/.entry/.js$/ groupOptions: {} namespace object","models/Work.tsx","Globals.tsx","models/Bookmark.tsx","redux/reducers/index.tsx","redux/reducers/setReducer.tsx","redux/reducers/tmpSetReducer.tsx","pages/EPubViewPage.tsx","models/Catalog.tsx","components/SearchAlert.tsx","pages/CatalogPage.tsx","pages/WorkPage.tsx","models/DictWordItem.tsx","pages/SettingsPage.tsx","pages/BookmarkPage.tsx","models/Search.tsx","pages/SearchPage.tsx","pages/DictionaryPage.tsx","models/FullTextSearch.tsx","pages/FullTextSearchPage.tsx","components/ShareTextModal.tsx","pages/WordDictionaryPage.tsx","App.tsx","redux/store.tsx","serviceWorker.ts","index.tsx"],"names":["map","webpackAsyncContext","req","__webpack_require__","o","Promise","resolve","then","e","Error","code","ids","id","keys","Object","module","exports","WorkListType","WorkChapter","json","title","juan","this","Work","juan_list","mulu","work","vol","cbetaApiUrl","log","axiosInstance","axios","create","baseURL","timeout","scrollbarSizeIdToValue","getFileName","getFileFromIndexedDB","fileName","a","dbOpenReq","indexedDB","open","ok","fail","onsuccess","ev","db","result","trans","transaction","objectStore","get","_ev","data","console","error","stack","transWrite","put","delete","htmlFile","update","htmlStr","settingsStr","localStorage","getItem","workInfo","bookmarks","JSON","parse","settings","bookmark","find","b","uuid","undefined","responseType","res","tryDecoder","TextDecoder","tryDecodeHtmlStr","decode","includes","results","work_info","doc","document","implementation","createHTMLDocument","body","innerHTML","XMLSerializer","serializeToString","replace","consoleLog","bind","consoleError","BookmarkType","storeFile","fontSizeNorm","fontSizeLarge","getLog","enableAppLog","Array","from","arguments","apply","disableAppLog","cbetardb","apiVersion","dilaDictApiUrl","twKaiFontKey","twKaiFontPath","topCatalogsByCat","topCatalogsByVol","fetchErrorContent","className","style","fontSize","paddingTop","href","target","updateApp","navigator","serviceWorker","getRegistrations","regs","all","reg","updateCssVars","scrollbarSize","documentElement","cssText","useFontKai","uiFontSize","isTouchDevice","isPlatform","fetchJuan","saveFileToIndexedDB","removeFileFromIndexedDB","removeElementsByClassName","elements","getElementsByClassName","length","parentNode","removeChild","disableAndroidChromeCallout","event","preventDefault","stopPropagation","disableIosSafariCallout","s","getSelection","rangeCount","r","getRangeAt","removeAllRanges","setTimeout","addRange","copyToClipboard","text","clipboard","writeText","Bookmark","type","CATALOG","selectedText","epubcfi","combineReducers","state","action","newSettings","Globals","key","val","setItem","stringify","oldBookmarks","some","bookmarksTemp","idxToDel","findIndex","deletedBookmarks","splice","deletedBookmark","noJuanBookmarkUseTheFile","JUAN","noWorkBookmarkUseTheFile","WORK","juans","split","i","vals","k","tmpSettings","newState","SpeechState","Catalog","n","nodeType","label","file","node_type","SearchAlert","cssClass","isOpen","props","showSearchAlert","header","subHeader","inputs","name","placeholder","buttons","role","handler","finish","value","history","push","name0","React","Component","famousJuans","url","_CatalogPage","topCatalogsType","fetchError","catalogs","pathLabel","isLoading","match","setState","fetchData","params","path","fetchTopCatalogs","obj","parentPath","topCatalogsByCatLabel","topCatalogs","forEach","catalog","paths","pop","join","dispatch","rows","index","routeLink","isHtmlNode","button","onClick","pathname","search","queryString","tabIndex","list","getFamousJuanRows","getRows","hidden","isTopCatalog","fill","slot","goBack","icon","arrowBack","interface","interfaceOptions","onIonChange","nextPage","detail","refreshCircle","color","hasBookmark","delBookmarkHandler","addBookmarkHandler","tab","home","show","decodeURIComponent","window","location","shareSocial","textAlign","onDidDismiss","message","reduce","prev","curr","CatalogPage","withIonLifeCycle","connect","_WorkPage","showAddBookmarkDone","fetchWork","works","resToc","wc","saveJuans","isTopPage","newWorkListType","workListType","BY_CHAPTER","BY_JUAN","getRowsByChapter","getRowsByJuan","duration","WorkPage","loadTwKaiFont","fontData","fontFace","FontFace","load","fonts","add","addCbetaLineBreaks","querySelectorAll","el","newBr","createElement","before","addSwpiedEvents","require","WordType","_EPubViewPage","htmlTitle","book","rendition","epub","displayed","cfiRange","speechSynthesisUtterance","uuidStr","epubcfiFromUrl","epubcfiFromSelectedString","bookCreated","ePubIframe","pageWidth","pagesWidth","searchTextRanges","visibleTextNodes","visibleChars","isPageSearched","allTexts","ePubIframeOffset","showedSearchTextIndex","maxCharsPerUtterance","workTexts","workTextsIndex","currentPage","pageCount","showJumpPageAlert","showNoSelectedTextAlert","showAddBookmarkSuccess","showsCopyToClipboardSuccess","showsCitationFail","showSearchTextAlert","searchText","showSearchTextToast","showToast","toastMessage","popover","lookupDictPopover","speechState","UNINITIAL","SpeechSynthesisUtterance","lang","onend","hasNextTexts1","paginated","hasNextTexts2","texts","pageNext","findTextsInPage","speechSynthesis","speak","addEventListener","keyListener","logoArray","Uint8Array","origin","logoStr","writeFileSync","queryParams","loadEpubCoverToMemFs","getSelectedString","HTML","assign","cancel","destroy","next","page","isNaN","Math","max","min","step","diff","abs","pagePrev","keyCode","which","rtlVerticalLayout","buttonNext","buttonPrev","ctrlKey","toLowerCase","nodepub","series","sequence","author","fileAs","genre","tags","copyright","publisher","published","language","description","contents","source","images","htmlStrModifiedStyles","htmlStrWithCssJs","addSection","addCSS","getComputedStyle","getPropertyValue","showComments","writeEPUB","fs","tempEpubBuffer","readFileSync","ePub","buffer","openAs","renderTo","width","height","spread","flow","scrollbarWidth","defaultDirection","on","EVENTS","RENDITION","DISPLAYED","updatePageInfos","VIEWS","RENDERED","updateEPubIframe","display","annotations","highlight","locations","generate","iframes","getElementsByTagName","contentDocument","ePubIframeWindow","contentWindow","oncontextmenu","ontouchend","dir","findVisibleTexts","alert","currentLocation","start","total","sel","toString","remainingWorkText","selection","back","getElementById","setEnd","docFragment","cloneContents","Document","docHtml","appendChild","innerText","root","createTreeWalker","NodeFilter","SHOW_TEXT","visibleChar","Range","setStart","node","offset","rect","y","x","binBoundary","leftSearchIndex","rightSearchIndex","checkpointIndex","floor","checkpointRange0","visibleCharToRange","checkpointRange1","rect0","getBoundingClientRect","rect1","rect0BinDirSize","rectBinDirSize","rect1BinDirSize","findBinBoundaryVisibleCharIndex","timeStart","Date","nZ","pageStartOffset","pageEndOffset","pageStartCharIndex","slice","reverse","vc","pageEndCharSearchRangeEnd","pageEndCharIndex","filter","char","timeDiff","getTime","cbetaHtmlBody","textNodesWalker","getAllTextNodes","node2","parentElement","nextNode","textContent","visibleTextNode","c","epubContainer","querySelector","clientHeight","clientWidth","searchTextIndexes","startIndex","searchTextIndex","indexOf","searchTextNodes","shift","end","moveToSearchText","timer","range","focus","setInterval","clearInterval","startContainer","scrollIntoView","searchTextPrev","searchTextNext","parent","getAttribute","voices","getVoices","zhTwVoice","voice","workText","getRemainingWorkTextFromSelectedRange","ceil","substring","rate","speechRate","SPEAKING","PAUSE","resume","stopCircle","musicalNotes","nativeEvent","ios","ellipsisHorizontal","md","ellipsisVertical","copy","print","startLine","findCbetaHtmlLine","endLine","endContainer","startLineMatches","exec","startLineModified","endLineModified","lineInfo","citation","sharedUrl","navButtons","vertical","horizontal","opacity","onPointerDown","currentTarget","setProperty","onPointerEnter","onPointerUp","onPointerLeave","arrowForward","html2Epub","userSelect","WebkitUserSelect","jumpToPage","backdropDismiss","findSearchTextRanges","EPubViewPage","SettingsPage","showFontLicense","juansDownloadedRatio","showUpdateAllJuansDone","newBookmarks","newBookmark","updateIndex","workBookmarksWithHtml","juanBookmarksWithHtml","juanBookmarksNotInWorkBookmarksWithHtml","wb","juansToDownload","juansDownloaded","bookmarkWithHtml","j","updateBookmark","newWork","PackageInfos","version","size","bug","checked","hasAppLog","isChecked","encodeURIComponent","userAgent","download","settingsJsonUri","click","remove","accept","onChange","files","item","fileText","updateAllJuans","colorPalette","theme","classList","toggle","documentText","flexDirection","pin","snaps","printStyle","test","toFixed","helpCircle","helpDoc","_BookmarkPage","bookmarkListRef","reorder","createRef","complete","side","current","closeSlidingItems","getBookmarkRows","isFamousPage","swapVertical","ref","disabled","onIonItemReorder","reorderBookmarks","BookmarkPage","Search","creators","_SearchPage","searches","keyword","isCatalog","SearchPage","_DictionaryPage","searchBarRef","selectedTextBeforeIonPopover","lookupDict","paddingBottom","dangerouslySetInnerHTML","__html","dict_name_zh","desc","onKeyUp","DictionaryPage","FullTextSearch","term_hits","isScrollOn","threshold","onIonInfinite","loadingText","ShareTextModal","qrcCanvas","qrcode","showModal","swipeToClose","onWillPresent","updateQrCode","alignItems","flexGrow","margin","_WordDictionaryPage","heteronyms","defs","d","def","quote","q","example","link","l","dictView","nouns","definitions","NOUN","verbs","VERB","others","nounsView","defToView","verbsView","othersView","bopomofo","pinyin","WordDictionaryPage","store","savedSettingsStr","createStore","reducer","getSavedStore","getState","setupConfig","mode","swipeBackEnabled","serviceWorkCallbacks","onSuccess","registration","onUpdate","_App","AppOrig","_AppOrig","registrationNew","wakeLock","showUpdateAlert","wakeLockScreen","onupgradeneeded","createObjectStore","request","routeMatches","queryMatches","query","to","innerHeight","animated","render","exact","FullTextSearchPage","routeByQueryString","library","onDidPresent","installing","postMessage","waiting","shareTextModal","App","withRouter","isLocalhost","Boolean","hostname","registerValidSW","swUrl","config","register","onupdatefound","installingWorker","onstatechange","controller","catch","ReactDOM","URL","process","fetch","headers","response","contentType","status","ready","unregister","reload","checkValidServiceWorker"],"mappings":"6nDAAA,IAAIA,EAAM,CACT,8BAA+B,CAC9B,IACA,GAED,uBAAwB,CACvB,IACA,GAED,uBAAwB,CACvB,IACA,GAED,0BAA2B,CAC1B,IACA,IAED,6BAA8B,CAC7B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,wBAAyB,CACxB,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,sBAAuB,CACtB,IACA,IAED,uBAAwB,CACvB,IACA,IAED,4BAA6B,CAC5B,IACA,IAED,uBAAwB,CACvB,IACA,IAED,qBAAsB,CACrB,IACA,IAED,mCAAoC,CACnC,IACA,IAED,uBAAwB,CACvB,IACA,IAED,+BAAgC,CAC/B,IACA,IAED,wBAAyB,CACxB,IACA,IAED,yBAA0B,CACzB,IACA,IAED,wBAAyB,CACxB,IACA,IAED,uBAAwB,CACvB,IACA,GAED,uBAAwB,CACvB,IACA,IAED,yBAA0B,CACzB,IACA,GAED,8BAA+B,CAC9B,IACA,IAED,yBAA0B,CACzB,IACA,IAED,uBAAwB,CACvB,IACA,IAED,6BAA8B,CAC7B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,+BAAgC,CAC/B,IACA,IAED,yBAA0B,CACzB,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,yBAA0B,CACzB,IACA,IAED,yBAA0B,CACzB,IACA,IAED,4BAA6B,CAC5B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,uBAAwB,CACvB,IACA,IAED,sBAAuB,CACtB,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,uBAAwB,CACvB,IACA,IAED,wBAAyB,CACxB,IACA,IAED,gCAAiC,CAChC,IACA,KAGF,SAASC,EAAoBC,GAC5B,IAAIC,EAAoBC,EAAEJ,EAAKE,GAC9B,OAAOG,QAAQC,UAAUC,MAAK,WAC7B,IAAIC,EAAI,IAAIC,MAAM,uBAAyBP,EAAM,KAEjD,MADAM,EAAEE,KAAO,mBACHF,KAIR,IAAIG,EAAMX,EAAIE,GAAMU,EAAKD,EAAI,GAC7B,OAAOR,EAAoBK,EAAEG,EAAI,IAAIJ,MAAK,WACzC,OAAOJ,EAAoBS,MAG7BX,EAAoBY,KAAO,WAC1B,OAAOC,OAAOD,KAAKb,IAEpBC,EAAoBW,GAAK,IACzBG,EAAOC,QAAUf,G,oBChMjB,IAAID,EAAM,CACT,sBAAuB,CACtB,IACA,KAGF,SAASC,EAAoBC,GAC5B,IAAIC,EAAoBC,EAAEJ,EAAKE,GAC9B,OAAOG,QAAQC,UAAUC,MAAK,WAC7B,IAAIC,EAAI,IAAIC,MAAM,uBAAyBP,EAAM,KAEjD,MADAM,EAAEE,KAAO,mBACHF,KAIR,IAAIG,EAAMX,EAAIE,GAAMU,EAAKD,EAAI,GAC7B,OAAOR,EAAoBK,EAAEG,EAAI,IAAIJ,MAAK,WACzC,OAAOJ,EAAoBS,MAG7BX,EAAoBY,KAAO,WAC1B,OAAOC,OAAOD,KAAKb,IAEpBC,EAAoBW,GAAK,IACzBG,EAAOC,QAAUf,G,4UCxBLgB,E,kLAAAA,O,2BAAAA,I,sBAAAA,M,KAML,IAAMC,EAIT,WAAYC,GAAY,yBAHxBC,WAGuB,OAFvBC,UAEuB,EACnBC,KAAKF,MAAQD,EAAKC,MAClBE,KAAKD,KAAOF,EAAKE,MAIZE,EAQT,WAAYJ,GAAY,yBAPxBC,WAOuB,OANvBC,UAMuB,OALvBG,eAKuB,OAJvBC,UAIuB,OAHvBC,UAGuB,OAFvBC,SAEuB,EACnBL,KAAKF,MAAQD,EAAKC,MAClBE,KAAKD,KAAOF,EAAKE,KACjBC,KAAKE,UAAYL,EAAKK,UACtBF,KAAKG,KAAON,EAAKM,KACjBH,KAAKI,KAAOP,EAAKO,KACjBJ,KAAKK,IAAMR,EAAKQ,KCvBlBC,EAAW,qCADE,QAOfC,EAAM,GAEJC,EAAgBC,IAAMC,OAAO,CACjCC,QAASL,EACTM,QAAS,MAGX,SAASC,EAAuBvB,GAC9B,OAAQA,GACN,KAAK,EAAG,OAAO,EACf,KAAK,EAAG,OAAO,GACf,KAAK,EAAG,OAAO,IAInB,SAASwB,EAAYV,EAAcL,GACjC,MAAM,GAAN,OAAUK,EAAV,gBAAsBL,EAAtB,S,SAGagB,E,8EAAf,WAAoCC,GAApC,eAAAC,EAAA,6DACQC,EAAYC,UAAUC,KAxBb,YAuBjB,kBAGS,IAAIrC,SAAQ,SAAUsC,EAAIC,GAC/BJ,EAAUK,UAAV,uCAAsB,WAAgBC,GAAhB,mBAAAP,EAAA,sDACdQ,EAAKP,EAAUQ,OAEfC,EAAQF,EAAGG,YAAY,CAAC,SAAU,cACpChD,EAAM+C,EAAME,YAAY,SAASC,IAAId,IACrCO,UAAJ,uCAAgB,WAAgBQ,GAAhB,eAAAd,EAAA,yDACRe,EAAOpD,EAAI8C,OADH,uBAGZO,QAAQC,MAAR,UAAiBlB,EAAjB,qBACAiB,QAAQC,OAAM,IAAI/C,OAAQgD,OAJd,kBAKLb,KALK,gCAOPD,EAAGW,IAPI,2CAAhB,sDALoB,2CAAtB,0DAJJ,4C,kEAsBA,WAAmChB,EAAkBgB,GAArD,eAAAf,EAAA,6DACQC,EAAYC,UAAUC,KA9Cb,YA6CjB,kBAES,IAAIrC,SAAQ,SAACsC,EAAIC,GACtBJ,EAAUK,UAAV,uCAAsB,WAAOC,GAAP,iBAAAP,EAAA,sDACdQ,EAAKP,EAAUQ,OAEfU,EAAaX,EAAGG,YAAY,CAAC,SAAU,aAC5BQ,EAAWP,YAAY,SAASQ,IAAIL,EAAMhB,GAClDO,UAAY,SAACQ,GACpB,OAAOV,KANW,2CAAtB,0DAHJ,4C,kEAeA,WAAuCL,GAAvC,eAAAC,EAAA,6DACQC,EAAYC,UAAUC,KA7Db,YA4DjB,kBAES,IAAIrC,SAAQ,SAACsC,EAAIC,GACtBJ,EAAUK,UAAV,uCAAsB,WAAOC,GAAP,iBAAAP,EAAA,sDACdQ,EAAKP,EAAUQ,OAEfU,EAAaX,EAAGG,YAAY,CAAC,SAAU,aAC5BQ,EAAWP,YAAY,SAASS,OAAOtB,GAC/CO,UAAY,SAACQ,GACpB,OAAOV,KANW,2CAAtB,0DAHJ,4C,kEAgBA,WAAyBjB,EAAcL,EAAcwC,GAArD,mDAAAtB,EAAA,6DAA8EuB,EAA9E,gCACQxB,EAAWuB,GAAYzB,EAAYV,EAAML,GAC3C0C,EAAyB,KAF/B,kBAIoB1B,EAAqBC,GAJzC,OAIIyB,EAJJ,kEAQQC,EAAcC,aAAaC,QAAQ,iBAErCC,EAAW,IAAI5C,EAAK,IAEpByC,IACII,EAA8BC,KAAKC,MAAMN,GAAqBO,SAASH,UAC7EI,EAAWJ,EAAUK,MAAK,SAACC,GAAD,OAAOA,EAAEpC,WAAaA,GAAYoC,EAAEC,OAASjD,MAGzD,OAAZqC,QAAiCa,IAAbJ,GAA2BV,EAjBrD,iBAkBIK,EAAWK,EAAS9C,KAlBxB,4BAoBQmC,EApBR,kCAqBwB/B,EAAcsB,IAAd,WAAsBS,GAAY,CAClDgB,aAAc,gBAtBtB,QAqBYC,EArBZ,OAwBUC,EAAa,IAAIC,YACjBC,EAAmBF,EAAWG,OAAOJ,EAAIxB,MAE3CS,EADEkB,EAAiBE,SAAS,gBAClB,IAAIH,YAAY,QAAQE,OAAOJ,EAAIxB,MAEnC2B,EA7BlB,yCAgCwBnD,EAAcsB,IAAd,gDAA2D1B,EAA3D,iBAAwEL,GAAQ,CAChGwD,aAAc,gBAjCtB,QAgCYC,EAhCZ,OAmCUxB,EAAOe,KAAKC,OAAM,IAAIU,aAAcE,OAAOJ,EAAIxB,OACnDS,EAAUT,EAAK8B,QAAQ,GACvBjB,EAAWb,EAAK+B,UArCtB,SA0CQC,EAAMC,SAASC,eAAeC,mBAAmB,KACjDC,KAAKC,UAAY5B,EAIrBA,GADAA,GAFAA,GAAU,IAAI6B,eAAgBC,kBAAkBP,EAAII,OAElCI,QAAQ,QAAS,SACjBA,QAAQ,SAAU,SA/CxC,iCAiDS,CAAE/B,UAASI,aAjDpB,0D,sBA2DA,IAAM4B,EAAaxC,QAAQ1B,IAAImE,KAAKzC,SAC9B0C,EAAe1C,QAAQC,MAAMwC,KAAKzC,SAgDzB,IC/LH2C,ED+LG,GACbC,UAAW,gBACXC,aAAc,GACdC,cAAe,GACfC,OAlDF,WACE,OAAOzE,GAkDP0E,aA/CF,WACEhD,QAAQ1B,IAAM,WACZA,GAAO,oBACPA,GAAQ2E,MAAMC,KAAKC,WAAc,KACjCX,EAAWY,MAAMpD,QAASmD,YAG5BnD,QAAQC,MAAQ,WACd3B,GAAO,qBACPA,GAAQ2E,MAAMC,KAAKC,WAAc,KACjCT,EAAaU,MAAMpD,QAASmD,aAsC9BE,cAlCF,WACE/E,EAAM,GACN0B,QAAQ1B,IAAMkE,EACdxC,QAAQC,MAAQyC,GAgChBY,SA/Le,WAgMfC,WAnMiB,OAoMjBlF,cACAmF,eAnMkB,6CAoMlBC,aAlMmB,YAmMnBC,cAjMoB,2BAkMpBnF,gBACAoF,iBAAkB,CAChB,MAAS,qBACT,QAAS,qBACT,QAAS,qBACT,QAAS,iCACT,OAAU,uCACV,OAAU,wCAEZC,iBAAkB,CAChB,QAAS,uBACT,QAAS,uBACT,QAAS,6BACT,QAAS,4DACT,QAAS,sDACT,QAAS,6BACT,QAAS,kEACT,QAAS,6BACT,QAAS,6BACT,QAAS,uBACT,QAAS,4DACT,QAAS,mCACT,QAAS,sDACT,QAAS,6BACT,QAAS,iDACT,SAAU,sDACV,QAAS,iEACT,SAAU,0CACV,QAAS,mCACT,SAAU,sDACV,SAAU,gDACV,QAAS,2DACT,SAAU,iDAEZC,kBACE,kBAAC,IAAD,CAAUC,UAAU,iBAClB,6BACE,0DACA,yBAAKC,MAAO,CAAEC,SAAU,sBAAuBC,WAAY,KAA3D,2EAA6E,uBAAGC,KAAK,YAAYC,OAAO,SAA3B,sBAA7E,yDAGNC,UAAW,WACTC,UAAUC,cAAcC,mBAAmBvH,MAAK,SAAAwH,GAC9C,OAAO1H,QAAQ2H,IAAID,EAAK/H,KAAI,SAAAiI,GAAG,OAAIA,EAAInE,iBAG3C3B,yBACA+F,cAAe,SAAC3D,GACd,IAAI4D,EAAgBhG,EAAuBoC,EAAS4D,eACpD5C,SAAS6C,gBAAgBd,MAAMe,QAA/B,6BAA+D9D,EAAS+D,WAAa,oBAAsB,eAA3G,wCACwBH,EADxB,+BAC4D5D,EAASgE,WADrE,iCACwGhE,EAASgD,SADjH,OAGFiB,cAAe,WACb,OAAOC,YAAW,QAAUA,YAAW,YAEzCC,U,gDACAtG,cACAC,uBACAsG,oB,8CACAC,wB,4CACAC,0BAjIF,SAAmCvD,EAAe+B,GAEhD,IADA,IAAIyB,EAAWxD,EAAIyD,uBAAuB1B,GACnCyB,EAASE,OAAS,GAAG,CAAC,IAAD,EAC1B,UAAAF,EAAS,GAAGG,kBAAZ,SAAwBC,YAAYJ,EAAS,MA+H/CK,4BAhGF,SAAqCC,GAGnC,OAFAA,EAAMC,iBACND,EAAME,mBACC,GA8FPC,wBA1FF,SAA+CH,GAC7C,IAAMI,EAAIlI,KAAKmI,eACf,KAAM,OAADD,QAAC,IAADA,OAAA,EAAAA,EAAGE,aAAc,GAAK,EAAG,CAC5B,IAAMC,EAAC,OAAGH,QAAH,IAAGA,OAAH,EAAGA,EAAGI,WAAW,GACvB,OAADJ,QAAC,IAADA,KAAGK,kBACHC,YAAW,WACR,OAADN,QAAC,IAADA,KAAGO,SAASJ,KACX,MAoFLK,gBAhFF,SAAyBC,GACvBrC,UAAUsC,WAAatC,UAAUsC,UAAUC,UAAUF,M,SC5L3C/D,O,qBAAAA,I,eAAAA,I,eAAAA,I,gBAAAA,M,KAQL,IAAMkE,EAQT,WAAYjJ,GAAiB,yBAP7BkJ,KAAqBnE,EAAaoE,QAON,KAN5B3F,KAAe,GAMa,KAL5BjD,KAAgC,KAKJ,KAJ5B6I,aAAuB,GAIK,KAH5BC,QAAkB,GAGU,KAF5BlI,SAAmB,GAGfhB,KAAK+I,KAAOlJ,EAAKkJ,KACjB/I,KAAKqD,KAAOxD,EAAKwD,KACjBrD,KAAKI,KAAOP,EAAKO,KACjBJ,KAAKiJ,aAAepJ,EAAKoJ,aACzBjJ,KAAKkJ,QAAUrJ,EAAKqJ,QACpBlJ,KAAKgB,SAAWnB,EAAKmB,UCnBdmI,kBAAgB,CAC7BlG,SCFa,WACE,IADemG,EAChB,uDADwB,GACrCC,EAAa,uCACVC,EAAW,eAAQF,GACvB,OAAQC,EAAON,MACb,IAAK,gBACHO,EAAcvG,KAAKC,MAAML,aAAaC,QAAQ2G,EAAQ1E,YAAa5B,SACnE,MACF,IAAK,cACH,IAAIuG,EAAMH,EAAOG,IACbC,EAAMJ,EAAOI,IACjBH,EAAYE,GAAOC,EACnB9G,aAAa+G,QAAQH,EAAQ1E,UAAW9B,KAAK4G,UAAU,CAAE1G,SAAUqG,KACnE,MACF,IAAK,eACH,IAAMM,EAAeN,EAAYxG,UAC7B9B,EAAWqI,EAAOnG,SAASlC,SACd,OAAbA,GAAkC,KAAbA,GACtB4I,EAAaC,MAAK,SAAC3G,GAAD,OAAwBA,EAASlC,WAAaA,MAEjEuI,EAAQlC,oBAAoBrG,EAAUqI,EAAO5G,SAE/C6G,EAAYxG,UAAZ,sBAA4BwG,EAAYxG,WAAxC,CAAmDuG,EAAOnG,WAC1DP,aAAa+G,QAAQH,EAAQ1E,UAAW9B,KAAK4G,UAAU,CAAE1G,SAAUqG,KACnE,MACF,IAAK,eACH,IAAIQ,EAAgBR,EAAYxG,UAC1BiH,EAAWD,EAAcE,WAAU,SAAC5G,GAAQ,OAAOA,EAAEC,OAASgG,EAAOhG,QAC3E,IAAkB,IAAd0G,EAAiB,CACnB,IAAIE,EAAmBH,EAAcI,OAAOH,EAAU,GAEtD,GAAgC,IAA5BE,EAAiBvC,OAAc,CAEjC,IAAMyC,EAAkBF,EAAiB,GACrCjJ,EAAWmJ,EAAgBnJ,SAC3BoJ,EAAyH,MAA9FN,EAAc3G,MAAK,SAACC,GAAD,OAAOA,EAAE2F,OAASnE,EAAayF,MAAQjH,EAAEC,OAAS8G,EAAgB9G,QAChHiH,EAAqI,MAA1GR,EAAc3G,MAAK,SAACC,GAAD,eAAOA,EAAE2F,OAASnE,EAAa2F,OAAQ,UAAAnH,EAAEhD,YAAF,eAAQA,SAAR,UAAiB+J,EAAgB/J,YAAjC,aAAiB,EAAsBA,SAChI,GAAIkK,EACF,OAAQH,EAAgBpB,MACtB,KAAKnE,EAAa2F,KAChB,IAAMnK,EAAO+J,EAAgB/J,KAE7B,GAAY,MAARA,EACF,MAGF,IADA,IAAMoK,EAAQpK,EAAKF,UAAUuK,MAAM,KANrC,WAOWC,GACP,IAAM1J,EAAWuI,EAAQzI,YAAYV,EAAKA,KAAMoK,EAAME,KACtDN,EAAiH,MAAtFN,EAAc3G,MAAK,SAACC,GAAD,OAAOA,EAAE2F,OAASnE,EAAayF,MAAQjH,EAAEpC,WAAaA,OAElGuI,EAAQjC,wBAAwBtG,IAJ3B0J,EAAI,EAAGA,EAAIF,EAAM9C,OAAQgD,IAAM,EAA/BA,GAOT,MACF,KAAK9F,EAAayF,KACZD,GACFb,EAAQjC,wBAAwBtG,KAM5CsI,EAAYxG,UAAZ,YAA4BgH,GAC5BnH,aAAa+G,QAAQH,EAAQ1E,UAAW9B,KAAK4G,UAAU,CAAE1G,SAAUqG,KACnE,MACF,IAAK,mBACHA,EAAYxG,UAAYuG,EAAOvG,UAC/BH,aAAa+G,QAAQH,EAAQ1E,UAAW9B,KAAK4G,UAAU,CAAE1G,SAAUqG,KACnE,MAEF,QAC0C,IAApC9J,OAAOD,KAAK+J,GAAa5B,SAC3B4B,EAAc,IAMhB,IAFA,IAAI/J,EAAO,CAAC,UAAW,YAAa,QAAS,YAAa,oBAAqB,gBAAiB,aAAc,WAAY,aAAc,eAAgB,aAAc,aAAc,aAChLoL,EAAO,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,EAAG,EAAG,GAAK,IAC3CC,EAAI,EAAGA,EAAIrL,EAAKmI,OAAQkD,SACFtH,IAAzBgG,EAAY/J,EAAKqL,MACnBtB,EAAY/J,EAAKqL,IAAMD,EAAKC,IAIpC,OAAOtB,GDjFGuB,YELG,WACE,IADezB,EAChB,uDADwB,GACrCC,EAAa,uCACVyB,EAAQ,eAAQ1B,GAChBI,EAAMH,EAAOG,IACbC,EAAMJ,EAAOI,IAEjB,OADAqB,EAAStB,GAAOC,EACRJ,EAAON,MACb,IAAK,kBACH,OAAO+B,EAKX,OAAO1B,K,ICgDJ2B,E,OC9DQC,G,OAOT,WAAYnL,GAAY,yBANxBoL,OAMuB,OALvBC,cAKuB,OAJvBC,WAIuB,OAHvB/K,UAGuB,OAFvBgL,UAEuB,EACnBpL,KAAKiL,EAAIpL,EAAKoL,EACdjL,KAAKkL,SAAWrL,EAAKwL,UACrBrL,KAAKmL,MAAQtL,EAAKsL,MAClBnL,KAAKI,KAAOP,EAAKO,KACjBJ,KAAKoL,KAAOvL,EAAKuL,OCkDVE,E,uKA3CH,IAAD,OACP,OACE,kBAAC,IAAD,CACEC,SAAS,SACTC,OAAQxL,KAAKyL,MAAMC,gBACnBC,OAAQ,2BACRC,UAAU,2BACVC,OAAQ,CACN,CACEC,KAAM,QACN/C,KAAM,SACNgD,YAAa,oCAGjBC,QAAS,CACP,CACErD,KAAM,eACNsD,KAAM,SACNV,SAAU,mBACVW,QAAS,kBAAM,EAAKT,MAAMU,WAE5B,CACExD,KAAM,2BACN4C,SAAU,iBACVW,QAAS,SAACE,GACR,EAAKX,MAAMU,SACX,EAAKV,MAAMY,QAAQC,KAAnB,0BAA2CF,EAAMG,UAGrD,CACE5D,KAAM,2BACN4C,SAAU,iBACVW,QAAS,SAACE,GACR,EAAKX,MAAMU,SACX,EAAKV,MAAMY,QAAQC,KAAnB,kCAAmDF,EAAMG,iB,GAvC7CC,IAAMC,W,iBCF1BC,EAAc,CAClB,CAAE5M,MAAO,mDAAY6M,IAAK,yBAC1B,CAAE7M,MAAO,mDAAY6M,IAAK,yBAC1B,CAAE7M,MAAO,uCAAU6M,IAAK,yBACxB,CAAE7M,MAAO,2EAAgB6M,IAAK,yBAC9B,CAAE7M,MAAO,iFAAiB6M,IAAK,yBAC/B,CAAE7M,MAAO,6CAAW6M,IAAK,yBACzB,CAAE7M,MAAO,uFAAkB6M,IAAK,yBAChC,CAAE7M,MAAO,6IAA2B6M,IAAK,yBACzC,CAAE7M,MAAO,uCAAU6M,IAAK,0BAuBpBC,E,kDACJ,WAAYnB,GAAa,IAAD,8BACtB,cAAMA,IACDrC,MAAQ,CACXyD,gBAAiB,EACjBC,YAAY,EACZC,SAAU,GACVC,UAAW,GACXtB,iBAAiB,EACjBuB,WAAW,GARS,E,+DAatBhL,QAAQ1B,IAAR,UAAeP,KAAKyL,MAAMyB,MAAMP,IAAhC,iBACA,IAAIE,GAAmB,EACvB,OAAQ7M,KAAKyL,MAAMyB,MAAMP,KACvB,IAAK,WAAYE,EAAkB,EAAG,MACtC,IAAK,mBAAoBA,EAAkB,EAAG,MAC9C,IAAK,kBAAmBA,EAAkB,EAAG,MAC7C,QAASA,GAAmB,EAE9B7M,KAAKmN,SAAS,CAAEN,gBAAiBA,IAEjC7M,KAAKoN,UAAUpN,KAAKyL,MAAMyB,MAAMG,OAAOC,Q,0CAIvCrL,QAAQ1B,IAAR,qBAA0BP,KAAKyL,MAAMyB,MAAMP,Q,yEA8B7BW,G,iFAEdtN,KAAKmN,SAAS,CAAEF,WAAW,IACvBF,EAAW,IAAI7H,MACf8H,EAAY,G,KAERhN,KAAKoJ,MAAMyD,gB,OACZ,I,MACA,I,QAEC,I,OA0BD,I,iDA3BI7M,KAAKuN,iBAAiBvN,KAAKoJ,MAAMyD,kB,iCAGpBtD,EAAQ/I,cAAcsB,IAAtB,2BAA8CwL,GAAQ,CACtE/J,aAAc,gB,eADVC,E,OAGAgK,EAAMzK,KAAKC,OAAM,IAAIU,aAAcE,OAAOJ,EAAIxB,OAC9CA,EAAOwL,EAAI1J,QACjBiJ,EAAW/K,EAAKtD,KAAI,SAACmB,GAAD,OAAU,IAAImL,EAAQnL,MAIvB,KAFAG,KAAKyN,WAAWH,GAGjCN,EAAYQ,EAAIrC,OAEVuC,EAAwBnE,EAAQ3D,iBAAiB0H,GACvDN,OAAuC1J,IAA1BoK,EAAuCA,EAAwBnE,EAAQ1D,iBAAiByH,IAGvGtN,KAAKmN,SAAS,CAAEL,YAAY,EAAOG,WAAW,EAAOF,SAAUA,EAAUC,c,mBAClE,G,yCAEP/K,QAAQC,MAAR,MACAD,QAAQC,OAAM,IAAI/C,OAAQgD,OAC1BnC,KAAKmN,SAAS,CAAEL,YAAY,EAAMG,WAAW,EAAOD,UAAW,K,mBACxD,G,eAGThN,KAAKmN,SAAS,CAAEL,YAAY,EAAOG,WAAW,EAAOD,UAAW,K,6KAKrDH,GACf,IAAIE,EAAW7H,QAETyI,EAAcd,EAAkBtD,EAAQ1D,iBAAmB0D,EAAQ3D,iBAazE,OAXApG,OAAOD,KAAKoO,GAAaC,SAAQ,SAACpE,GAChC,IAAMqE,EAAmB,CACvB5C,EAAGzB,EACH0B,SAAU,KACV9K,KAAM,KACN+K,MAAOwC,EAAYnE,GACnB4B,KAAM,MAER2B,EAAST,KAAKuB,MAEhB7N,KAAKmN,SAAS,CAAEL,YAAY,EAAOG,WAAW,EAAOF,SAAUA,EAAUC,UAAW,MAC7E,I,iCAOEM,GACT,IAAIQ,EAAQR,EAAK7C,MAAM,KAEvB,OADAqD,EAAMC,MACCD,EAAME,KAAK,O,2CAIlBhO,KAAKyL,MAAMwC,SAAS,CAClBlF,KAAM,eACN7F,SAAU,IAAI4F,EAAS,CACrBC,KAAMnE,EAAaoE,QACnB3F,KAAMrD,KAAKyL,MAAMyB,MAAMG,OAAOC,KAC9BrE,aAAcjJ,KAAKoJ,MAAM4D,UACzB9D,QAAS,GACTlI,SAAU,GACVZ,KAAM,W,2CAMVJ,KAAKyL,MAAMwC,SAAS,CAClBlF,KAAM,eACN1F,KAAMrD,KAAKyL,MAAMyB,MAAMG,OAAOC,S,gCASvB,IAAD,OACJY,EAAOhJ,QA0BX,OAzBAlF,KAAKoJ,MAAM2D,SAASa,SAAQ,SAACC,EAAkBM,GAC7C,IAAIC,EAAY,GACVC,EAAkC,SAArBR,EAAQ3C,SAEzBkD,EADEC,EACO,wBAAoBR,EAAQ5C,EAA5B,MACgB,MAAhB4C,EAAQzN,KACR,2BAAuByN,EAAQ5C,GAE/B,wBAAoB4C,EAAQzN,MAEvC8N,EAAK5B,KACH,kBAAC,IAAD,CAAS9C,IAAK,UAAGqE,EAAQ5C,EAAX,QAAqBkD,EAAOG,QAAQ,EAAMC,QAAO,uCAAE,WAAMzG,GAAN,SAAA7G,EAAA,sDAC/D6G,EAAMC,iBACN,EAAK0D,MAAMY,QAAQC,KAAK,CACtBkC,SAAUJ,EACVK,OAAQC,IAAY/E,UAAU0E,EAAa,CAAEjD,KAAMyC,EAAQzC,KAAOtL,MAAO+N,EAAQ1C,OAAU,MAJ9B,2CAAF,uDAO7D,yBAAKwD,SAAU,IACf,kBAAC,IAAD,CAAU5I,UAAU,uBAAuByD,IAAK,UAAGqE,EAAQ5C,EAAX,SAAsBkD,GACnEN,EAAQ1C,YAKV+C,I,0CAGY,IAAD,OACdA,EAAOhJ,QAaX,OAZAwH,EAAYkB,SAAQ,WAAiBlD,GAAO,IAArB5K,EAAoB,EAApBA,MAAO6M,EAAa,EAAbA,IAC5BuB,EAAK5B,KACH,kBAAC,IAAD,CAAS9C,IAAK,kBAAoBkB,EAAG4D,QAAQ,EAAMC,QAAO,uCAAE,WAAMzG,GAAN,SAAA7G,EAAA,sDAC1D,EAAKwK,MAAMY,QAAQC,KAAKK,GADkC,2CAAF,uDAGxD,yBAAKgC,SAAU,IACf,kBAAC,IAAD,CAAU5I,UAAU,uBAAuByD,IAAK,mBAAqBkB,GAClE5K,QAKFoO,I,+BAGC,IAAD,OAGHU,EAAO,kBAAC,IAAD,KACuB,IAA/B5O,KAAKoJ,MAAMyD,gBAAwB7M,KAAK6O,oBAAsB7O,KAAK8O,WAGtE,OACE,kBAAC,IAAD,KACE,kBAAC,IAAD,KACE,kBAAC,IAAD,KACE,kBAAC,IAAD,CAAWC,OAAQ/O,KAAKgP,aAAcC,KAAK,QAAQC,KAAK,QAAQX,QAAS,SAAArP,GAAC,OAAI,EAAKuM,MAAMY,QAAQ8C,WAC/F,kBAAC,IAAD,CAASC,KAAMC,IAAWH,KAAK,eAGjC,kBAAC,IAAD,CAAWH,QAAS/O,KAAKgP,aAAcE,KAAK,QAC1C9C,MAAOpM,KAAKoJ,MAAMyD,gBAClB7G,MAAO,CAAEC,SAAU,uBACnBqJ,UAAU,UACVC,iBAAkB,CAAEhE,SAAU,iBAC9BiE,YAAa,SAAAtQ,GACX,IACIuQ,EAAW,GACf,OAFcvQ,EAAEwQ,OAAOtD,OAGrB,KAAK,EAAGqD,EAAW,WAAY,MAC/B,KAAK,EAAGA,EAAW,mBAAoB,MACvC,KAAK,EAAGA,EAAW,kBAAmB,MACtC,KAAM,EAAGA,EAAW,EAAKhE,MAAMyB,MAAMP,IAEnC,EAAKlB,MAAMyB,MAAMP,MAAQ8C,GAC3B,EAAKhE,MAAMY,QAAQC,KAAKmD,KAG5B,kBAAC,IAAD,CAAiB1J,UAAU,SAASqG,MAAO,GAA3C,sBACA,kBAAC,IAAD,CAAiBrG,UAAU,SAASqG,MAAO,GAA3C,sBACA,kBAAC,IAAD,CAAiBrG,UAAU,SAASqG,MAAO,GAA3C,6BAGF,kBAAC,IAAD,CAAW2C,QAAS/O,KAAKoJ,MAAM0D,WAAYmC,KAAK,QAAQC,KAAK,MAAMX,QAAS,SAAArP,GAAC,OAAI,EAAKkO,UAAU,EAAK3B,MAAMyB,MAAMG,OAAOC,QACtH,kBAAC,IAAD,CAAS8B,KAAMO,IAAeT,KAAK,eAGrC,kBAAC,IAAD,CAAWH,OAAQ/O,KAAKgP,aAAcC,KAAK,QAAQW,MAAO5P,KAAK6P,YAAc,UAAY,UAAWX,KAAK,MAAMX,QAAS,SAAArP,GAAC,OAAI,EAAK2Q,YAAc,EAAKC,qBAAuB,EAAKC,uBAC/K,kBAAC,IAAD,CAASX,KAAMlM,IAAUgM,KAAK,eAGhC,kBAAC,IAAD,CAAWH,OAAQ/O,KAAKgP,aAAcC,KAAK,QAAQC,KAAK,MAAMX,QAAS,SAAArP,GAAC,OAAI,EAAKuM,MAAMY,QAAQC,KAAnB,WAA4B,EAAKb,MAAMyB,MAAMG,OAAO2C,QAC9H,kBAAC,IAAD,CAASZ,KAAMa,IAAMf,KAAK,eAG5B,kBAAC,IAAD,CAAWD,KAAK,QAAQC,KAAK,MAAMX,QAAS,SAAArP,GAAC,OAAI,EAAKiO,SAAS,CAAEzB,iBAAiB,MAChF,kBAAC,IAAD,CAAS0D,KAAMX,IAAQS,KAAK,eAG9B,kBAAC,IAAD,CAAWD,KAAK,QAAQC,KAAK,MAAMX,QAAS,SAAArP,GAC1C,EAAKuM,MAAMwC,SAAS,CAClBlF,KAAM,kBACNS,IAAK,iBACLC,IAAK,CACHyG,MAAM,EACNvH,KAAMwH,mBAAmBC,OAAOC,SAASlK,WAI7C,kBAAC,IAAD,CAASiJ,KAAMkB,IAAapB,KAAK,iBAIvC,kBAAC,IAAD,KACGlP,KAAKoJ,MAAM0D,WAAavD,EAAQzD,kBAC/B,oCACE,yBAAKC,UAAU,WAAWC,MAAO,CAAE4J,MAAO,6BAA+B5P,KAAKoJ,MAAM4D,WACnF4B,GAIL,kBAAC,EAAD,aAEIlD,gBAAiB1L,KAAKoJ,MAAMsC,gBAC5BS,OAAQ,WAAQ,EAAKgB,SAAS,CAAEzB,iBAAiB,MAAe1L,KAAKyL,QAIzE,yBAAKzF,MAAO,CAAEC,SAAU,sBAAuBsK,UAAW,WAAY,uBAAGpK,KAAK,gDAAgDC,OAAO,QAA/D,yCACtE,yBAAKJ,MAAO,CAAEC,SAAU,sBAAuBsK,UAAW,WAAY,uBAAGpK,KAAK,8CAA8CC,OAAO,QAA7D,yCAEtE,kBAAC,IAAD,CACEmF,SAAS,SACTC,OAAQxL,KAAKoJ,MAAM6D,UACnBuD,aAAc,kBAAM,EAAKrD,SAAS,CAAEF,WAAW,KAC/CwD,QAAS,8B,mCA7KC,IAAD,OACjB,MAAO,CAAC,WAAY,mBAAoB,mBAAmBC,QAAO,SAACC,EAAMC,GAAP,OAAgBD,GAAQC,IAAS,EAAKnF,MAAMyB,MAAMP,OAAK,K,kCA8BxG,IAAD,OAChB,OACwF,MADjF3M,KAAKyL,MAAM3I,UAAUK,MAC1B,SAACjE,GAAD,OAAOA,EAAE6J,OAASnE,EAAaoE,SAAW9J,EAAEmE,OAAS,EAAKoI,MAAMyB,MAAMG,OAAOC,Y,GAxJxDd,IAAMC,WAqT3BoE,EAAcC,YAAiBlE,GAEtBmE,eAXS,SAAC3H,GACvB,MAAO,CACLtG,UAAWsG,EAAMnG,SAASH,UAC1BsG,MAAOA,KAQI2H,CAEbF,GCtUIG,G,yDACJ,WAAYvF,GAAa,IAAD,8BACtB,cAAMA,IA+CRrE,UAAY,GA9CV,EAAKgC,MAAQ,CACXhJ,KAAM,KACNsL,iBAAiB,EACjBuF,qBAAqB,EACrBhE,WAAW,EACXH,YAAY,GAPQ,E,+DAatB9M,KAAKkR,UAAUlR,KAAKyL,MAAMyB,MAAMG,OAAOC,Q,sHAMzBA,G,kFACdtN,KAAKmN,SAAS,CAAEF,WAAW,KAEvBjN,KAAK6P,Y,gBACPzP,EAAOJ,KAAKkD,SAAU9C,K,gDAGFmJ,EAAQ/I,cAAcsB,IAAtB,sBAAyCwL,GAAQ,CACjE/J,aAAc,gB,cADVC,E,OAGAxB,EAAOe,KAAKC,OAAM,IAAIU,aAAcE,OAAOJ,EAAIxB,OAC/CmP,EAAQnP,EAAK8B,QACnB1D,EAAO+Q,EAAM,G,UAEQ5H,EAAQ/I,cAAcsB,IAAtB,oBAAuCwL,I,QAAtD8D,E,OACNhR,EAAKD,KAAQiR,EAAOpP,KAAK8B,QAAQ,GAAG3D,KAAuBzB,KAAI,SAAC2S,GAAD,OAAQ,IAAIzR,EAAYyR,M,yDAGvFpP,QAAQC,MAAR,MACAD,QAAQC,OAAM,IAAI/C,OAAQgD,OAC1BnC,KAAKmN,SAAS,CAAEL,YAAY,EAAMG,WAAW,I,mBACtC,G,eAIXjN,KAAKmN,SAAS,CAAEL,YAAY,EAAOG,WAAW,EAAO7M,KAAMA,I,mBACpD,G,yQAKHA,EAAOJ,KAAKoJ,MAAMhJ,KAClBoK,EAAQpK,EAAKF,UAAUuK,MAAM,KACxBC,EAAI,E,YAAGA,EAAIF,EAAM9C,Q,wBACxB1H,KAAKoH,UAAYoD,EAAME,G,kBAEHnB,EAAQnC,UAAUhH,EAAKA,KAAMJ,KAAKoH,UAAW,M,OAAzD5D,E,OACN+F,EAAQlC,oBAAoBkC,EAAQzI,YAAYV,EAAKA,KAAMJ,KAAKoH,WAAY5D,EAAIf,S,kDAEhFR,QAAQC,MAAR,wBAA+BwI,EAA/B,2BACAzI,QAAQC,OAAM,IAAI/C,OAAQgD,O,QAPIuI,I,uBAUlC1K,KAAKmN,SAAS,CAAE8D,qBAAqB,I,qRAI/BjR,KAAKsR,Y,OACXtR,KAAKyL,MAAMwC,SAAS,CAClBlF,KAAM,eACN7F,SAAU,IAAI4F,EAAS,CACrBC,KAAMnE,EAAa2F,KACnBlH,KAAMrD,KAAKyL,MAAMyB,MAAMG,OAAOC,KAC9BrE,aAAcjJ,KAAKoJ,MAAMhJ,KAAMN,MAC/BoJ,QAAS,GACTlI,SAAU,GACVZ,KAAMJ,KAAKoJ,MAAMhJ,S,iJAMrBJ,KAAKyL,MAAMwC,SAAS,CAClBlF,KAAM,eACN1F,KAAMrD,KAAKyL,MAAMyB,MAAMG,OAAOC,S,yCAqBhC,IAJkB,IAAD,OACblN,EAAOJ,KAAKoJ,MAAMhJ,KAChBD,EAAI,OAAGC,QAAH,IAAGA,OAAH,EAAGA,EAAMD,KACf+N,EAAOhJ,QAHM,WAIRwF,GACP,IAAI0D,EAAS,+BAAoBhO,QAApB,IAAoBA,OAApB,EAAoBA,EAAMA,KAA1B,YAAkCD,EAAMuK,GAAG3K,MACxDmO,EAAK5B,KACH,kBAAC,IAAD,CAAS9C,IAAK,cAAgBkB,EAAG4D,QAAQ,EAAMC,QAAO,uCAAE,WAAMzG,GAAN,SAAA7G,EAAA,sDACtD6G,EAAMC,iBACN,EAAK0D,MAAMY,QAAQC,KAAK,CACtBkC,SAAUJ,IAH0C,2CAAF,uDAMpD,yBAAKO,SAAU,IACf,kBAAC,IAAD,CAAU5I,UAAU,uBAAuByD,IAAK,eAAiBkB,GAC9DvK,EAAMuK,GAAG5K,UAXT4K,EAAI,EAAGA,IAAS,OAAJvK,QAAI,IAAJA,OAAA,EAAAA,EAAMuH,UAAW,GAAIgD,IAAM,EAAvCA,GAgBT,OAAOwD,I,sCAOP,IAJe,IAAD,OACV9N,EAAOJ,KAAKoJ,MAAMhJ,KAClB8N,EAAOhJ,QACPsF,EAAK,OAAGpK,QAAH,IAAGA,OAAH,EAAGA,EAAMF,UAAUuK,MAAM,KAHpB,WAILC,GAEP,IAAI0D,EAAS,+BAAoBhO,QAApB,IAAoBA,OAApB,EAAoBA,EAAMA,KAA1B,YAAkCoK,EAAOE,IACtDwD,EAAK5B,KACH,kBAAC,IAAD,CAAS9C,IAAK,WAAakB,EAAG4D,QAAQ,EAAMC,QAAO,uCAAE,WAAMzG,GAAN,SAAA7G,EAAA,sDACnD6G,EAAMC,iBACN,EAAK0D,MAAMY,QAAQC,KAAK,CACtBkC,SAAUJ,IAHuC,2CAAF,uDAMjD,yBAAKO,SAAU,IACf,kBAAC,IAAD,CAAU5I,UAAU,uBAAuByD,IAAK,YAAckB,GAA9D,SACIF,EAAOE,OAZRA,EAAI,EAAGA,IAAU,OAALF,QAAK,IAALA,OAAA,EAAAA,EAAO9C,UAAW,GAAIgD,IAAM,EAAxCA,GAiBT,OAAOwD,I,+BAIC,IAAD,SACP,OACE,kBAAC,IAAD,KACE,kBAAC,IAAD,KACE,kBAAC,IAAD,KACE,kBAAC,IAAD,CAAWa,OAAQ/O,KAAKuR,UAAWtC,KAAK,QAAQC,KAAK,QAAQX,QAAS,SAAArP,GAAC,OAAI,EAAKuM,MAAMY,QAAQ8C,WAC5F,kBAAC,IAAD,CAASC,KAAMC,IAAWH,KAAK,eAGjC,kBAAC,IAAD,CAAWA,KAAK,QAAQX,QAAS,SAAA/M,GAC/B,IAAMgQ,EAAkB,EAAK/F,MAAMgG,eAAiB9R,EAAa+R,WAAa/R,EAAagS,QAAUhS,EAAa+R,WAClH,EAAKjG,MAAMwC,SAAS,CAClBlF,KAAM,kBACNS,IAAK,eACLC,IAAK+H,MAGP,0BAAMzL,UAAU,SAASC,MAAO,CAAE4J,MAAO,iBAAmB5P,KAAKyL,MAAMgG,eAAiB9R,EAAa+R,WAAa,eAAO,iBAG3H,kBAAC,IAAD,CAAW3C,QAAS/O,KAAKoJ,MAAM0D,WAAYmC,KAAK,QAAQC,KAAK,MAAMX,QAAS,SAAArP,GAAC,OAAI,EAAKgS,UAAU,EAAKzF,MAAMyB,MAAMG,OAAOC,QACtH,kBAAC,IAAD,CAAS8B,KAAMO,IAAeT,KAAK,eAGrC,kBAAC,IAAD,CAAWD,KAAK,QAAQW,MAAO5P,KAAK6P,YAAc,UAAY,UAAWX,KAAK,MAAMX,QAAS,SAAArP,GAAC,OAAI,EAAK2Q,YAAc,EAAKC,qBAAuB,EAAKC,uBACpJ,kBAAC,IAAD,CAASX,KAAMlM,IAAUgM,KAAK,eAGhC,kBAAC,IAAD,CAAWD,KAAK,QAAQC,KAAK,MAAMX,QAAS,SAAArP,GAAC,OAAI,EAAKuM,MAAMY,QAAQC,KAAnB,WAA4B,EAAKb,MAAMyB,MAAMG,OAAO2C,QACnG,kBAAC,IAAD,CAASZ,KAAMa,IAAMf,KAAK,eAG5B,kBAAC,IAAD,CAAWD,KAAK,QAAQC,KAAK,MAAMX,QAAS,SAAArP,GAAC,OAAI,EAAKiO,SAAS,CAAEzB,iBAAiB,MAChF,kBAAC,IAAD,CAAS0D,KAAMX,IAAQS,KAAK,eAG9B,kBAAC,IAAD,CAAWD,KAAK,QAAQC,KAAK,MAAMX,QAAS,SAAArP,GAC1C,EAAKuM,MAAMwC,SAAS,CAClBlF,KAAM,kBACNS,IAAK,iBACLC,IAAK,CACHyG,MAAM,EACNvH,KAAMwH,mBAAmBC,OAAOC,SAASlK,WAI7C,kBAAC,IAAD,CAASiJ,KAAMkB,IAAapB,KAAK,iBAIvC,kBAAC,IAAD,KACE,yBAAKnJ,UAAU,WAAWC,MAAO,CAAE4J,MAAO,6BAA1C,UAAyE5P,KAAKoJ,MAAMhJ,YAApF,aAAyE,EAAiBN,OAExFE,KAAKoJ,MAAM0D,WAAavD,EAAQzD,kBAC9B,kBAAC,IAAD,KACG9F,KAAKyL,MAAMgG,eAAiB9R,EAAa+R,WAAa1R,KAAK4R,mBAAqB5R,KAAK6R,iBAI5F,kBAAC,EAAD,aAEInG,gBAAkB1L,KAAKoJ,MAAcsC,gBACrCS,OAAQ,WAAQ,EAAKgB,SAAS,CAAEzB,iBAAiB,MAAe1L,KAAKyL,QAIzE,kBAAC,IAAD,CACEF,SAAS,SACTC,OAAQxL,KAAKoJ,MAAM6H,oBACnBT,aAAc,kBAAM,EAAKrD,SAAS,CAAE8D,qBAAqB,KACzDR,QAAO,6CACPqB,SAAU,MAGZ,kBAAC,IAAD,CACEvG,SAAS,SACTC,OAAQxL,KAAKoJ,MAAM6D,UACnBuD,aAAc,kBAAM,EAAKrD,SAAS,CAAEF,WAAW,KAC/CwD,QAAS,8B,gCA1IjB,MAAgC,aAAzBzQ,KAAKyL,MAAMyB,MAAMP,M,+BAGV,IAAD,OACb,OAAO3M,KAAKyL,MAAM3I,UAAUK,MAC1B,SAACjE,GAAD,OAAOA,EAAE6J,OAASnE,EAAa2F,MAAQrL,EAAEmE,OAAS,EAAKoI,MAAMyB,MAAMG,OAAOC,U,kCAI5E,OAAwB,MAAjBtN,KAAKkD,a,GAlGQsJ,IAAMC,YA2OxBsF,GAAWjB,YAAiBE,GAYnBD,gBAVS,SAAC3H,GACvB,MAAO,CACLtG,UAAWsG,EAAMnG,SAASH,UAE1B2O,kBAAiDnO,IAAnC8F,EAAMyB,YAAY4G,aAA6BrI,EAAMyB,YAAY4G,aAAe9R,EAAagS,WAMhGZ,CAEbgB,I,wDJvQaC,K,8EAAf,8BAAA/Q,EAAA,sEACyBsI,EAAQxI,qBAAqBwI,EAAQ7D,cAD9D,cACQuM,EADR,OAEQC,EAAW,IAAK9B,OAAe+B,SAAS,MAAOF,GAFvD,SAGQC,EAASE,OAHjB,OAIGpS,KAAKiE,SAAiBoO,MAAMC,IAAIJ,GAJnC,iD,sBAOA,SAASK,KAA+B,IAAD,OACrCvS,KAAKiE,SAASuO,iBAAiB,YAAY5E,SAAQ,SAAC6E,GAClD,IAAMC,EAAQ,EAAKzO,SAAS0O,cAAc,MAC1CF,EAAGG,OAAOF,MAId,SAASG,KACPC,EAAQ,IAARA,CAAqC9S,KAAKoQ,OAAQpQ,KAAKiE,W,SA8BpD8G,O,yBAAAA,I,uBAAAA,I,kBAAAA,M,SK9DOgI,GL2FNC,G,kDAUJ,WAAYvH,GAAa,IAAD,8BACtB,cAAMA,IAVRlJ,cASwB,IARxB0Q,eAQwB,IAPxBC,UAOwB,IANxBC,eAMwB,IALxBC,UAKwB,IAJxBC,eAIwB,IAHxBC,cAGwB,IAFxBC,8BAEwB,IA+ExBC,QAAU,GA/Ec,EAgFxBC,eAAiB,GAhFO,EA0HxBC,0BAA4B,GA1HJ,EAsOxBC,aAAc,EAtOU,EAuOxBC,WAAuC,KAvOf,EAglBxBC,UAAY,EAhlBY,EAilBxBC,WAAa,EAjlBW,EAynBxBC,iBAAiC,GAznBT,EA0nBxBC,iBAAgC,GA1nBR,EA2nBxBC,aAAmC,GA3nBX,EA4nBxBC,eAAiC,GA5nBT,EA6nBxBC,SAAW,GA7nBa,EA8nBxBC,iBAAmB,EA9nBK,EAouBxBC,sBAAwB,EApuBA,EAwyBxBC,qBAAuB,IAxyBC,EAyyBxBC,UAA2B,GAzyBH,EA0yBxBC,eAAiB,EAxyBf,EAAKpL,MAAQ,CACX6D,WAAW,EACXH,YAAY,EACZjK,SAAU,IAAI5C,EAAK,IACnBwC,QAAS,KACTgS,YAAa,EACbC,UAAW,EACXC,mBAAmB,EACnBC,yBAAyB,EACzBC,wBAAwB,EACxBC,6BAA6B,EAC7BC,mBAAmB,EACnBC,qBAAqB,EACrBC,WAAY,GACZC,qBAAqB,EACrBC,WAAW,EACXC,aAAc,GACd1J,iBAAiB,EACjB2J,QAAS,CACPnF,MAAM,EACNpI,MAAO,MAETwN,kBAAmB,CACjBpF,MAAM,EACNlO,KAAM,IAERuT,YAAaxK,EAAYyK,WAE3B,EAAKjT,SAAW,GAChB,EAAK0Q,UAAY,GACjB,EAAKC,KAAO,KACZ,EAAKC,UAAY,KACjB,EAAKG,SAAW,GAChB,EAAKC,yBAA2B,IAAIkC,yBACpC,EAAKlC,yBAAyBmC,KAAO,QACrC,EAAKnC,yBAAyBoC,MAAQ,SAACnU,GACrC,GAAI,EAAK4H,MAAMmM,cAAgBxK,EAAYyK,UAA3C,CAIA,IAAMI,GAAiB,EAAKnK,MAAMoK,WAAa,EAAKrB,eAAiB,EAAKD,UAAU7M,OAAS,EACvFoO,EAAgB,EAAKrK,MAAMoK,WAAa,EAAKzM,MAAMqL,YAAc,EAAKrL,MAAMsL,UAC9EqB,EAAQ,GACZ,GAAIH,EACF,EAAKpB,gBAAkB,EACvBuB,EAAQ,EAAKxB,UAAU,EAAKC,oBACvB,KAAIsB,EAMT,OAFA,EAAK3I,SAAS,CAAEoI,YAAaxK,EAAYyK,iBACzCvT,QAAQ1B,IAAR,6BAJA,EAAKyV,WACLD,EAAQ,EAAKE,gBAAgB,EAAK7M,MAAMqL,aAM1C,EAAKlB,yBAAyB5K,KAAOoN,EACrCG,gBAAgBC,MAAM,EAAK5C,0BAC3BtR,QAAQ1B,IAAR,gDAAqDqV,EAAgB,EAAKpB,eAAiB,EAAKpL,MAAMqL,gBAExGxQ,SAASmS,iBAAiB,UAAW,EAAKC,YAAY3R,KAAjB,kBAA6B,GA5D5C,E,0LAkEG,KAFrB4R,EAAY,IAAIC,WAAWxT,KAAKC,MAAML,aAAaC,QAAQ,aAAe,QAEhE8E,O,gCAEM6B,EAAQ/I,cAAcsB,IAAtB,UAA6BsO,OAAOC,SAASmG,OAA7C,yBAA4E,CAC5FjT,aAAc,gB,OADVC,E,OAGN8S,EAAY,IAAIC,WAAW/S,EAAIxB,MAC3ByU,EAAU1T,KAAK4G,UAAUzE,MAAMC,KAAKmR,IACxC3T,aAAa+G,QAAQ,WAAY+M,G,OAE1B3D,EAAQ,IACd4D,cAAc,WAAYJ,G,2IAM7B,IAAIK,EAAcjI,IAAY1L,MAAMhD,KAAKyL,MAAM4E,SAAS5B,QACxDzO,KAAKuC,SAAWoU,EAAYvL,KAC5BpL,KAAKiT,UAAY0D,EAAY7W,MAC7BE,KAAKyT,eAAiBkD,EAAYzT,UAAY,GAC9C,IAAIkG,EAAQpJ,KAAKyL,MAAM4E,SAASjH,MAChCpJ,KAAKwT,QAAUpK,EAAQA,EAAM/F,KAAO,GAEpCrD,KAAKoN,c,oMAcLpN,KAAKmN,SAAS,CAAEF,WAAW,I,kBAEP1D,EAAQnC,UACxBpH,KAAKyL,MAAMyB,MAAMG,OAAOjN,KACxBJ,KAAKyL,MAAMyB,MAAMG,OAAOC,KACxBtN,KAAKuC,U,cAHDiB,E,gBAMAxD,KAAK4W,uB,OAGX5W,KAAKmN,SAAS,CAAwBL,YAAY,EAAOjK,SAAUW,EAAIX,SAAUJ,QAASe,EAAIf,U,kDAE9FR,QAAQC,MAAR,MACAD,QAAQC,OAAM,IAAI/C,OAAQgD,OAC1BnC,KAAKmN,SAAS,CAAEF,WAAW,EAAOH,YAAY,I,2JAMhD,IAAM7D,EAAejJ,KAAK6W,oBAC1B,GAAqB,KAAjB5N,EAAJ,CAKA,IAAIuK,EAAUnQ,OACdrD,KAAKyL,MAAMwC,SAAS,CAClBlF,KAAM,eAGNtG,QAASzC,KAAKoJ,MAAM3G,QACpBS,SAAU,IAAI4F,EAAS,CACrBC,KAAM/I,KAAKuC,SAAWqC,EAAakS,KAAOlS,EAAayF,KACvDhH,KAAMmQ,EACNvK,aAAcA,EACdC,QAASlJ,KAAK0T,0BACd1S,SAAUhB,KAAKuC,UAAL,UAAoBvC,KAAKyL,MAAMyB,MAAMG,OAAOjN,KAA5C,gBAAwDJ,KAAKyL,MAAMyB,MAAMG,OAAOC,KAAhF,SACVlN,KAAMZ,OAAOuX,OAAO/W,KAAKoJ,MAAMvG,SAAU,CACvC/C,MAAOE,KAAKuC,SAAWvC,KAAKiT,UAAYjT,KAAKoJ,MAAMvG,SAAS/C,MAC5DC,KAAMC,KAAKyL,MAAMyB,MAAMG,OAAOC,WAKpCtN,KAAKmN,SAAS,CAAE0H,wBAAwB,SAvBtC7U,KAAKmN,SAAS,CAAEyH,yBAAyB,M,yCA4CzB,IAAD,EACjBsB,gBAAgBc,SAChBhX,KAAKmN,SAAS,CAAE1K,QAAS,KAAMgS,YAAa,EAAGc,YAAaxK,EAAYyK,UAAWN,qBAAqB,IACxG,UAAAlV,KAAKkT,YAAL,SAAW+D,UACXjX,KAAKkT,KAAO,KACZlT,KAAK2T,aAAc,I,iCAGI,IACiC,EADjD1I,EAAe,uDAAH,EACfjL,KAAKyL,MAAMoK,WAAa7V,KAAKoJ,MAAMqL,YAAc,IACnD,UAAAzU,KAAKmT,iBAAL,SAAgBxC,KAAK1F,GAErBjL,KAAKmN,SAAS,CAAEsH,YAAazU,KAAKoJ,MAAMqL,YAAcxJ,O,iCAIjC,IACoD,EADpEA,EAAe,uDAAH,EACfjL,KAAKyL,MAAMoK,WAAa7V,KAAKoJ,MAAMqL,YAAczU,KAAKoJ,MAAMsL,YAC9D,UAAA1U,KAAKmT,iBAAL,SAAgB+D,KAAKjM,GAErBjL,KAAKmN,SAAS,CAAEsH,YAAazU,KAAKoJ,MAAMqL,YAAcxJ,O,iCAI/CkM,GACT,GAAa,IAATA,EAAJ,CAGAA,EAAOC,MAAMD,GAAQ,EAAIE,KAAKC,IAAID,KAAKE,IAAIvX,KAAKoJ,MAAMsL,UAAWyC,GAAO,GACxE,IAAM1C,EAAczU,KAAKoJ,MAAMqL,YAC3B+C,EAAO/C,EAAc0C,EAAO,GAAK,EACjCM,EAAOJ,KAAKK,IAAIP,EAAO1C,GACd,IAAT+C,EACFxX,KAAKgW,SAASyB,GAEdzX,KAAK2X,SAASF,M,kCAINvY,GACV,IAAIsK,EAAMtK,EAAE0Y,SAAW1Y,EAAE2Y,MAEzB5V,QAAQ1B,IAAIrB,EAAE6J,MAGVS,KAASxJ,KAAKyL,MAAMqM,kBAAoB,GAAK,KAC/C9X,KAAK+X,aAIHvO,KAASxJ,KAAKyL,MAAMqM,kBAAoB,GAAK,KAC/C9X,KAAKgY,cAGQ,OAAX9Y,EAAEE,MAAkBF,EAAE+Y,SAAmC,MAAxB/Y,EAAEsK,IAAI0O,iBACzChZ,EAAE6I,iBACF/H,KAAKmN,SAAS,CAAE+H,qBAAqB,EAAOF,qBAAqB,O,2JAOnEhV,KAAK2T,aAAc,EACnB3T,KAAKoT,KAAO+E,YAAiB,CAC3B7Y,GAAI,gBACJQ,MAAO,QACPsY,OAAQ,GACRC,SAAU,EACVC,OAAQ,SACRC,OAAQ,GACRC,MAAO,QACPC,KAAM,GACNC,UAAW,GACXC,UAAW,GACXC,UAAW,GACXC,SAAU,KACVC,YAAa,eACbC,SAAU/Y,KAAKoJ,MAAMvG,SAAS/C,MAC9BkZ,OAAQ,GACRC,OAAQ,CAAC,aACR,YAECC,EAAwBlZ,KAAKoJ,MAAM3G,QACnCzC,KAAKyL,MAAMqM,oBACboB,EAAwBA,EAAsB1U,QAAQ,eAAgB,eAMlE2U,EAAmBD,EAAqB,uCAK9ClZ,KAAKoT,KAAKgG,WAAW,GAAID,GAAkB,GAAM,G,qFASjDnZ,KAAKoT,KAAKiG,OAAV,6RAiBaC,iBAAiBrV,SAASG,MAAMmV,iBAAiB,sBAjB9D,6CAkBkBD,iBAAiBrV,SAASG,MAAMmV,iBAAiB,sBAlBnE,2tBAuCWD,iBAAiBrV,SAASG,MAAMmV,iBAAiB,oBAvC5D,gCAwCgBD,iBAAiBrV,SAASG,MAAMmV,iBAAiB,0BAxCjE,0zBAwEqC,GAAtBvZ,KAAKyL,MAAMxF,SAxE1B,qVA6FsBqT,iBAAiBrV,SAASG,MAAMmV,iBAAiB,oBA7FvE,wDAiGEvZ,KAAKyL,MAAMqM,kB,qFAAwC,GAjGrD,oDAoGiBwB,iBAAiBrV,SAASG,MAAMmV,iBAAiB,qBApGlE,+BAqGevZ,KAAKyL,MAAMxF,SArG1B,2EAyGajG,KAAKyL,MAAM+N,aAAe,QAAU,OAzGjD,mBA6GAxZ,KAAKoT,KAAKqG,WACR,SAACva,GACC+C,QAAQ1B,IAAR,iBAAsBrB,MAExB,IAAK,OAJP,sBAKE,sCAAA+B,EAAA,6DACMyY,EAAK5G,EAAQ,IACb6G,EAAiBD,EAAGE,aAAa,aACrC,EAAK1G,KAAO2G,aAAKF,EAAeG,OAAQ,CACtCC,OAAQ,WAEV,EAAK5G,UAAY,EAAKD,KAAK8G,SAAS,iBAAkB,CACpDC,MAAO,OAAQC,OAAQ,OACvBC,OAAQ,OACRC,KAAM,EAAK3O,MAAMoK,UAAY,YAAc,WAC3CwE,eAAgB9Q,EAAQ1I,uBAAuB,EAAK4K,MAAM5E,eAC1DyT,iBAAkB,EAAK7O,MAAMqM,kBAAoB,MAAQ,QAI3D,EAAK3E,UAAUoH,GAAG,YAAY,SAACjH,EAAeyF,GAC5C,EAAKrF,0BAA4BJ,KAQnC,EAAKH,UAAUoH,GAAGC,KAAOC,UAAUC,WAAW,WAC5C,EAAKC,qBAGP,EAAKxH,UAAUoH,GAAGC,KAAOI,MAAMC,UAAU,WACvC,EAAKC,sBA7BT,SAgCQ,EAAK3H,UAAU4H,QAAQ,EAAKtP,MAAMoK,UAAY,EAAK3M,aAAU5F,GAhCrE,UAkCO,EAAKmI,MAAMoK,UAlClB,4CAoCU,EAAK1C,iBApCf,aAoCU,EAAgB+D,OApC1B,mCAsCU,EAAK/D,iBAtCf,aAsCU,EAAgB+D,OAtC1B,QAuCI,EAAK4D,mBAvCT,QA2CE,GAFA,EAAK3N,SAAS,CAAEF,WAAW,IAEvB,EAAK4C,YACP,IACE,YAAKsD,iBAAL,SAAgB6H,YAAYC,UAAU,EAAK/R,SAC3C,MAAOhK,GACP+C,QAAQC,MAAMhD,GAIlB,YAAKgU,YAAL,SAAWgI,UAAUC,SAAS,KAnDhC,6C,+IAwDgB,IAAD,OACXC,EAAUnX,SAASoX,qBAAqB,UAC9C,GAAuB,IAAnBD,EAAQ1T,OAAc,CAAC,IAAD,EACxB1H,KAAK4T,WAAawH,EAAQ,GAC1B,UAAApb,KAAK4T,WAAW0H,uBAAhB,SAAiClF,iBAAiB,UAAWpW,KAAKqW,YAAY3R,KAAK1E,OAAO,GAC1F,IAAMub,EAAmBvb,KAAK4T,WAAY4H,cACtCrU,YAAW,WACboU,EAAiBnL,OAAOqL,cAAgBlS,EAAQ1B,4BACvCV,YAAW,SACnBoU,EAA4BtX,SAASyX,WAAanS,EAAQtB,wBAAwBvD,KAAK6W,IAE1FA,EAAiBvJ,cAAgBA,GACjCuJ,EAAiBvJ,gBACjBuJ,EAAiBhJ,mBAAqBA,GACtCgJ,EAAiBhJ,qBACjBgJ,EAAiB1I,gBAAkBA,GACnC0I,EAAiB1I,kBACjB0I,EAAiBtX,SAASmS,iBAAiB,UAAU,SAAClX,GACpD,GAAK,EAAKuM,MAAMoK,UAIhB,GAAI,EAAKpK,MAAMqM,kBACb,OAAQ5Y,EAAEwQ,OAAOiM,KACf,IAAK,OACH,EAAKhE,WACL,MACF,IAAK,QACH,EAAK3B,gBAIT,OAAQ9W,EAAEwQ,OAAOiM,KACf,IAAK,OACH,EAAKhE,WACL,MACF,IAAK,KACH,EAAK3B,eAKbhW,KAAK4b,wBAOIR,EAAQ1T,OAAS,EAC1BmU,MAAM,iEAEN5Z,QAAQC,MAAM,8B,wCAIC,IAAD,EACVmR,GAAY,UAACrT,KAAKmT,iBAAN,aAAC,EAAgB2I,mBAA0BC,MAAM1I,UACnErT,KAAKmN,SAAS,CAAEsH,YAAapB,EAAU8D,KAAMzC,UAAWrB,EAAU2I,U,0CAG/C,IAAD,IACd/S,EAAe,GACbgT,EAAG,UAAGjc,KAAK4T,kBAAR,iBAAG,EAAiB0H,uBAApB,aAAG,EAAkCnT,eAK9C,QAJQ,OAAH8T,QAAG,IAAHA,OAAA,EAAAA,EAAK7T,aAAc,GAAK,GAAK6T,EAAK3T,WAAW,GAAG4T,WAAWxU,OAAS,IACvEuB,EAAegT,EAAKC,WACjB,OAAHD,QAAG,IAAHA,KAAK1T,mBAEAU,I,8DAIP,IACIkT,EADAC,EAAYpc,KAAK4T,WAAY4H,cAAerT,eAGhD,GAAwB,UAApBiU,EAAWrT,KAAkB,CAC/B,IAAMsT,EAAOrc,KAAK4T,WAAY0H,gBAAiBgB,eAAe,QAC1DpU,EAAIkU,EAAW9T,WAAW,GAE9BJ,EAAEqU,OAAOF,EAAM,GAEf,IAAIG,EAActU,EAAEuU,gBACX,OAATL,QAAS,IAATA,KAAW7T,kBAGX,IAAIvE,EAAM,IAAI0Y,SACVC,EAAU3Y,EAAI2O,cAAc,QAChC3O,EAAI4Y,YAAYD,GAChBA,EAAQC,YAAYJ,GAGpBjT,EAAQhC,0BAA0BvD,EAAK,MACvCuF,EAAQhC,0BAA0BvD,EAAK,mBACvCmY,EAAoBnY,EAAIsY,eAAe,QAASO,UAGlD,OAAOV,I,sCAGOW,GAEd,OADe7Y,SAAS8Y,iBAAiBD,EAAME,WAAWC,a,yCAIzC9O,GACjB,IAAM+O,EAAcld,KAAKiU,aAAa9F,GAChC9F,EAAI,IAAI8U,MAGd,OAFA9U,EAAE+U,SAASF,EAAYG,KAAMH,EAAYI,QACzCjV,EAAEkU,OAAOW,EAAYG,KAAMH,EAAYI,OAAS,GACzCjV,I,qCAGMkV,GACb,OAAIvd,KAAKyL,MAAMqM,kBACNyF,EAAKC,EAELD,EAAKE,I,sDAIgBC,EAAqBC,EAAyBC,GAC5E,IAAMC,EAAkBF,EAAkBtG,KAAKyG,OAAOF,EAAmBD,GAAmB,GAC5F,GAAwB,IAApBE,EACF,OAAO,EACF,GAAIA,IAAoB7d,KAAKiU,aAAavM,OAAS,EACxD,OAAO1H,KAAKiU,aAAavM,OAAS,EAGpC,IAAMqW,EAAmB/d,KAAKge,mBAAmBH,GAC3CI,EAAmBje,KAAKge,mBAAmBH,EAAkB,GAC7DK,EAAQH,EAAiBI,wBACzBC,EAAQH,EAAiBE,wBAC3BE,EAAkBre,KAAKse,eAAeJ,GAASle,KAAKoU,iBACpDmK,EAAkBve,KAAKse,eAAeF,GAASpe,KAAKoU,iBAExD,OAAIiK,EAAkBX,GAAeA,GAAea,EAC3CV,EACEQ,EAAkBX,GAAeA,EAAca,EACjDve,KAAKwe,gCAAgCd,EAAaG,EAAkB,EAAGD,GACrES,GAAmBX,GAAeA,GAAea,EACnDve,KAAKwe,gCAAgCd,EAAaC,EAAiBE,IAE1E5b,QAAQC,MAAM,uBACN,K,sCAMI+I,GACd,IAAMwT,EAAY,IAAIC,KAEhBC,EAAK1T,EAAI,EACf,IAAKjL,KAAKkU,eAAeyK,GAAK,CAC5B,IAAMC,EAAkB5e,KAAK6T,WAAa5I,EAAI,GACxC4T,EAAgB7e,KAAK6T,UAAY5I,EACnC6T,EAAqB,EACf,IAAN7T,IAGA6T,EADE9e,KAAKkU,eAAeyK,EAAK,GACL3e,KAAKiU,aAAavM,OAAS,EAAK1H,KAAKiU,aAAa8K,QAAQC,UAAUhV,WAAU,SAACiV,GAAD,OAAQA,EAAG9H,OAAUlM,EAAI,KAAM,EAE9GjL,KAAKwe,gCAAgCI,EAAiB,EAAG5e,KAAKiU,aAAavM,OAAS,GAAK,GAIlH,IAAIwX,EAA4Blf,KAAKiU,aAAavM,OAAS,EACvDyX,EAAmBnf,KAAKiU,aAAavM,OAAS,EAC9CuD,IAAMjL,KAAKoJ,MAAMsL,YAGjByK,EADEnf,KAAKkU,eAAeyK,EAAK,GACR3e,KAAKiU,aAAajK,WAAU,SAACiV,GAAD,OAAQA,EAAG9H,OAAUlM,EAAI,KAAM,EAE3DjL,KAAKwe,gCAAgCK,EAAeC,EAAoBI,IAG/F,IAAK,IAAIxU,EAAIoU,EAAoBpU,GAAKyU,EAAkBzU,IACtD1K,KAAKiU,aAAavJ,GAAGyM,KAAOlM,EAE9BjL,KAAKkU,eAAeyK,IAAM,EAE5B,IAAM5I,EAAQ/V,KAAKiU,aAAamL,QAAO,SAACH,GAAD,OAAQA,EAAG9H,OAASlM,KAAGvM,KAAI,SAACugB,GAAD,OAAQA,EAAGI,QAAMrR,KAAK,IAElFsR,GADU,IAAIZ,MACKa,UAAYd,EAAUc,UAE/C,OADAtd,QAAQ1B,IAAR,kCAAuC+e,EAAW,IAAlD,MACOvJ,I,yCAUW,IAAD,OACXyJ,EAAgBxf,KAAK4T,WAAY0H,gBAAiBgB,eAAe,QACvE,GAAKkD,EAAL,CAIA,IAIInC,EAJEoC,EAAkBzf,KAAK0f,gBAAgBF,GAC7Cxf,KAAKgU,iBAAmB,GACxBhU,KAAKiU,aAAe,GACpBjU,KAAKkU,eAAiB,GAEtB,IAXiB,iBAYf,IAAIyL,EAAQtC,EACZ,GAAI,CAAC,IAAK,KAAM,eAAe3M,QAAO,SAACC,EAAMC,GAAP,aAAgBD,GAAQC,KAAI,UAAK+O,EAAMC,qBAAX,aAAK,EAAqB7Z,cAAW,GACrG,iBAGF,EAAKiO,iBAAiB1H,KAAK+Q,IANiB,OAAtCA,EAAOoC,EAAgBI,aAAqB,IASpD7f,KAAKmU,SAAWnU,KAAKgU,iBAAiBtV,KAAI,SAACuM,GAAD,OAAOA,EAAE6U,eAAa9R,KAAK,IAIrE,IADA,IAAItD,EAAI,EACCO,EAAI,EAAGA,EAAIjL,KAAKgU,iBAAiBtM,OAAQuD,IAEhD,IADA,IAAM8U,EAAkB/f,KAAKgU,iBAAiB/I,GACrC+U,EAAI,EAAGA,EAAKD,EAAwBrY,OAAQsY,IACnDhgB,KAAKiU,aAAa3H,KAAK,CAAE+Q,KAAM0C,EAAiBzC,OAAQ0C,EAAG7I,KAAM,EAAGkI,KAAMrf,KAAKmU,SAASzJ,KACxFA,IAGJ,IAAMuV,EAAgBhc,SAASic,cAAc,mBAC7ClgB,KAAK6T,UAAY7T,KAAKyL,MAAMqM,kBAAoBmI,EAAcE,aAAeF,EAAcG,YAC3FpgB,KAAK8T,WAAa9T,KAAK6T,UAAY7T,KAAKoJ,MAAMsL,UAC9C1U,KAAKkU,eAAiB,IAAIhP,MAAMlF,KAAKoJ,MAAMsL,WAC3C,IAAK,IAAIhK,EAAI,EAAGA,EAAI1K,KAAKkU,eAAexM,OAAQgD,IAC9C1K,KAAKkU,eAAexJ,IAAK,EAE3B,IAAMwT,EAAQle,KAAKge,mBAAmB,GAAGG,wBACzCne,KAAKoU,iBAAmBpU,KAAKyL,MAAMqM,kBAAoBoG,EAAMV,EAAIU,EAAMT,K,2CAGpDxI,GACnBjV,KAAK+T,iBAAmB,GACxB/T,KAAKqU,sBAAwB,EAG7B,IAAIgM,EAAmC,GACnCC,EAAa,EACbC,EAAkB,EACtB,EAAG,CAED,IAAyB,KADzBA,EAAkBvgB,KAAKmU,SAASqM,QAAQvL,EAAYqL,IAElD,MAEFA,EAAaC,EAAkBtL,EAAWvN,OAE1C2Y,EAAkB/T,KAAKiU,GAEvBF,EAAkB/T,KAAKiU,EAAkBtL,EAAWvN,cAC7C6Y,EAAkBvgB,KAAKmU,SAASzM,OAAS,GAElD,GAAiC,IAA7B2Y,EAAkB3Y,OAAtB,CAKA,IAAI+Y,EAA8B,GAC9B/V,EAAI,EACR6V,EAAkBF,EAAkBK,QACpC,IAAK,IAAIzV,EAAI,EAAGA,EAAIjL,KAAKgU,iBAAiBtM,OAAQuD,IAAK,CAErD,IADA,IAAM8U,EAAkB/f,KAAKgU,iBAAiB/I,GACrC+U,EAAI,EAAGA,EAAKD,EAAwBrY,SACvCgD,IAAM6V,IACRE,EAAgBnU,KAAK,CAAE+Q,KAAM0C,EAAiBzC,OAAQ0C,KAG7B,KAFzBO,EAAkBF,EAAkBK,UAAY,KAHCV,IASnDtV,IAGF,IAAyB,IAArB6V,EACF,MAKJ,IAAK,IAAI7V,EAAI,EAAGA,EAAI+V,EAAgB/Y,OAAS,EAAGgD,GAAK,EAAG,CACtD,IAAMrC,EAAI,IAAI8U,MACVpB,EAAQ0E,EAAoB,EAAJ/V,GACxBiW,EAAMF,EAAoB,EAAJ/V,EAAQ,GAClCrC,EAAE+U,SAASrB,EAAMsB,KAAMtB,EAAMuB,QAC7BjV,EAAEkU,OAAOoE,EAAItD,KAAMsD,EAAIrD,QACvBtd,KAAK+T,iBAAiBzH,KAAKjE,O,uCAMzBrI,KAAKqU,sBAAwB,GAC/BrU,KAAKqU,wBAEPrU,KAAK4gB,iBAAiB5gB,KAAKqU,yB,uCAIvBrU,KAAKqU,sBAAwBrU,KAAK+T,iBAAiBrM,OAAS,GAC9D1H,KAAKqU,wBAEPrU,KAAK4gB,iBAAiB5gB,KAAKqU,yB,uCAGZlG,GAAgB,IAAD,OAC9BnO,KAAK0T,0BAA4B,GACjC,IAAMuI,EAAMjc,KAAK4T,WAAY4H,cAAerT,eAC5C8T,EAAI1T,kBAEJC,YAAW,WACT,IAKMqY,EAQC,EAbDC,EAAQ,EAAK/M,iBAAiB5F,IACpC,EAAKyF,WAAY4H,cAAeuF,QAChC9E,EAAIxT,SAASqY,GAET,EAAKrV,MAAMoK,WAEbgL,EAAQG,aAAY,WAC0B,IAAD,EAAJ,KAAnC,EAAKtN,4BACPuN,cAAcJ,GACd,YAAK1N,iBAAL,SAAgB4H,QAAQ,EAAKrH,2BAA2BzU,MAAK,kBAG9D,KAEH,UAAA6hB,EAAMI,eAAetB,qBAArB,SAAoCuB,mBAErC,O,mCAICnhB,KAAKoJ,MAAM8L,oBACblV,KAAKohB,iBAELphB,KAAK2X,a,mCAKH3X,KAAKoJ,MAAM8L,oBACblV,KAAKqhB,iBAELrhB,KAAKgW,a,wCAISqH,GAChB,IAAIiE,EAAyCjE,EAAKuC,cAClD,EAAG,CAAC,IAAD,IACD,aAAI0B,SAAJ,aAAI,EAAQC,aAAa,KACvB,YAEMD,EAAM,UAAGA,SAAH,aAAG,EAAQ1B,eAC3B,OAAO0B,I,+BAQC,IAAD,OACH3V,EACF,kBAAC,IAAD,KACE,kBAAC,IAAD,KACE,kBAAC,IAAD,CAAU3F,MAAO,CAAEC,SAAU,yBAE7B,kBAAC,IAAD,CAAW8I,OAAQ/O,KAAKuR,UAAWtC,KAAK,QAAQC,KAAK,QAAQX,QAAS,SAAArP,GAAC,OAAI,EAAKuM,MAAMY,QAAQ8C,WAC5F,kBAAC,IAAD,CAASC,KAAMC,IAAWH,KAAK,eAGjC,kBAAC,IAAD,CAAWH,QAAS/O,KAAKoJ,MAAM0D,WAAYmC,KAAK,QAAQC,KAAK,MAAMX,QAAS,SAAArP,GAAC,OAAI,EAAKkO,cACpF,kBAAC,IAAD,CAASgC,KAAMO,IAAeT,KAAK,eAGrC,kBAAC,IAAD,CAAWH,QAAS/O,KAAKyL,MAAMoK,UAAW3G,KAAK,MAAMX,QAAS,SAAA/M,GAC5D,EAAK2L,SAAS,CAAEwH,mBAAmB,MAEnC,0BAAM5O,UAAU,SAASC,MAAO,CAAE4J,MAAO,iBAAzC,SAA6D5P,KAAKoJ,MAAMqL,YAAxE,IAAsFzU,KAAKoJ,MAAMsL,YAGnG,kBAAC,IAAD,CAAW3F,OAAQ/O,KAAKoJ,MAAM0D,WAAYmC,KAAK,QAAQC,KAAK,MAAMX,QAAS,SAAArP,GAAM,IAAD,MACxEsiB,EAAStL,gBAAgBuL,YAC/B,GAAsB,IAAlBD,EAAO9Z,OAIX,OAAQ,EAAK0B,MAAMmM,aACjB,KAAKxK,EAAYyK,UACf,IAAMkM,EAAYF,EAAOre,MAAK,SAACwe,GAC7B,OAAOA,EAAMjM,KAAK8K,QAAQ,UAAY,GAAKmB,EAAMjM,KAAK8K,QAAQ,UAAY,UAE1Dld,IAAdoe,IACF,EAAKnO,yBAAyBoO,MAAQD,GAWxC,IAAME,GAPF,EAAKnW,MAAMoK,UACL,EAAKI,gBAAgB,EAAK7M,MAAMqL,aAEhC,EAAKoN,2CAIO,UAAI,EAAKjO,kBAAT,iBAAI,EAAiB0H,uBAArB,iBAAI,EAAkCgB,eAAe,eAArD,aAAI,EAA0DO,YAAa,mDAEjG,EAAKtI,UAAY,GACjB,IAAK,IAAI7J,EAAI,EAAGA,EAAI2M,KAAKyK,KAAKF,EAASla,OAAS,EAAK4M,sBAAuB5J,IAC1E,EAAK6J,UAAUjI,KAAKsV,EAASG,UAAUrX,EAAI,EAAK4J,sBAAuB5J,EAAI,GAAK,EAAK4J,uBAGvF,EAAKE,eAAiB,EACtB,EAAKjB,yBAAyB5K,KAAO,EAAK4L,UAAU,EAAKC,gBACzD,EAAKjB,yBAAyByO,KAAO,EAAKvW,MAAMwW,WAEhD/L,gBAAgBc,SAChBd,gBAAgBC,MAAM,EAAK5C,0BAC3B,EAAKpG,SAAS,CAAEoI,YAAaxK,EAAYmX,WACzC,MACF,KAAKnX,EAAYmX,SAOfhM,gBAAgBc,SAChB,EAAK7J,SAAS,CAAEoI,YAAaxK,EAAYyK,YACzC,MACF,KAAKzK,EAAYoX,MACfjM,gBAAgBkM,SAChB,EAAKjV,SAAS,CAAEoI,YAAaxK,EAAYmX,cAI7C,kBAAC,IAAD,CAAS9S,KAAMpP,KAAKoJ,MAAMmM,cAAgBxK,EAAYmX,SAAWG,IAAaC,IAAcpT,KAAK,eAGnG,kBAAC,IAAD,CAAWH,OAAQ/O,KAAKoJ,MAAM0D,WAAYmC,KAAK,QAAQC,KAAK,MAAMX,QAAS,SAAArP,GACzE,EAAKiO,SAAS,CAAEkI,QAAS,CAAEnF,MAAM,EAAOpI,MAAO,QAC/C,EAAKiI,uBAEL,kBAAC,IAAD,CAASX,KAAMlM,IAAUgM,KAAK,eAGhC,kBAAC,IAAD,CAAWD,KAAK,QAAQC,KAAK,MAAMX,QAAS,SAAArP,GAAC,OAAI,EAAKiO,SAAS,CAAEkI,QAAS,CAAEnF,MAAM,EAAMpI,MAAO5I,EAAEqjB,iBAC/F,kBAAC,IAAD,CAASC,IAAKC,IAAoBC,GAAIC,IAAkBzT,KAAK,eAG/D,kBAAC,IAAD,CACE1D,OAAQxL,KAAKoJ,MAAMiM,QAAQnF,KAC3BpI,MAAO9H,KAAKoJ,MAAMiM,QAAQvN,MAC1B0I,aAAc,SAAAtR,GAAO,EAAKiO,SAAS,CAAEkI,QAAS,CAAEnF,MAAM,EAAOpI,MAAO,UAEpE,kBAAC,IAAD,KACE,kBAAC,IAAD,CAASwG,QAAM,EAACC,QAAS,SAAArP,GACvB,EAAKiO,SAAS,CAAEkI,QAAS,CAAEnF,MAAM,EAAOpI,MAAO,QAC/C,EAAK2D,MAAMY,QAAQC,KAAnB,wBAAyC,EAAKb,MAAMyB,MAAMG,OAAOjN,SAEjE,yBAAKuO,SAAU,IACf,kBAAC,IAAD,CAASS,KAAMa,IAAMf,KAAK,UAC1B,kBAAC,IAAD,CAAUnJ,UAAU,wBAApB,6BAGF,kBAAC,IAAD,CAASuI,QAAM,EAACC,QAAS,SAAArP,GACvB,EAAKuM,MAAMY,QAAQC,KAAnB,WAA4B,EAAKb,MAAMyB,MAAMG,OAAO2C,MACpD,EAAK7C,SAAS,CAAEkI,QAAS,CAAEnF,MAAM,EAAOpI,MAAO,UAE/C,yBAAK6G,SAAU,IACf,kBAAC,IAAD,CAASS,KAAMa,IAAMf,KAAK,UAC1B,kBAAC,IAAD,CAAUnJ,UAAU,wBAApB,uBAGF,kBAAC,IAAD,CAASuI,QAAM,EAACC,QAAS,SAAArP,GACvB,EAAKiO,SAAS,CAAEkI,QAAS,CAAEnF,MAAM,EAAOpI,MAAO,QAC/C,IAAMmB,EAAe,EAAK4N,oBAC1BtN,EAAQb,gBAAgBO,GACxB,EAAKkE,SAAS,CAAEgI,WAAW,EAAMC,aAAa,2CAE9C,yBAAKzG,SAAU,IACf,kBAAC,IAAD,CAASS,KAAMwT,IAAM1T,KAAK,UAC1B,kBAAC,IAAD,CAAUnJ,UAAU,wBAApB,6BAGF,kBAAC,IAAD,CAASuI,QAAM,EAACC,QAAS,SAAArP,GACvB,EAAKiO,SAAS,CAAEkI,QAAS,CAAEnF,MAAM,EAAOpI,MAAO,QAC/C,EAAKqF,SAAS,CAAE+H,qBAAqB,EAAOF,qBAAqB,MAEjE,yBAAKrG,SAAU,IACf,kBAAC,IAAD,CAASS,KAAMX,IAAQS,KAAK,UAC5B,kBAAC,IAAD,CAAUnJ,UAAU,wBAApB,6BAEF,kBAAC,IAAD,CAASuI,QAAM,EAACC,QAAS,SAAArP,GACvB,EAAKiO,SAAS,CAAEkI,QAAS,CAAEnF,MAAM,EAAOpI,MAAO,QAC/C,EAAKqF,SAAS,CAAEzB,iBAAiB,MAEjC,yBAAKiD,SAAU,IACf,kBAAC,IAAD,CAASS,KAAMX,IAAQS,KAAK,UAC5B,kBAAC,IAAD,CAAUnJ,UAAU,wBAApB,6BAGF,kBAAC,IAAD,CAASuI,QAAM,EAACC,QAAS,SAAArP,GACvB,EAAKiO,SAAS,CAAEkI,QAAS,CAAEnF,MAAM,EAAOpI,MAAO,QAC/C,IAAMmB,EAAe,EAAK4N,oBACL,KAAjB5N,EAKJ,EAAKwC,MAAMY,QAAQC,KAAK,CACtBkC,SAAS,sBAAD,OAAwBvF,KALhC,EAAKkE,SAAS,CAAEyH,yBAAyB,MAQ3C,yBAAKjG,SAAU,IACf,kBAAC,IAAD,CAASS,KAAM8D,IAAMhE,KAAK,UAC1B,kBAAC,IAAD,CAAUnJ,UAAU,wBAApB,uBAGF,kBAAC,IAAD,CAASuI,QAAM,EAACC,QAAS,SAAArP,GACvB,EAAKiO,SAAS,CAAEkI,QAAS,CAAEnF,MAAM,EAAOpI,MAAO,QAC/C,IAAMmB,EAAe,EAAK4N,oBACL,KAAjB5N,EAKJ,EAAKwC,MAAMY,QAAQC,KAAK,CACtBkC,SAAS,0BAAD,OAA4BvF,KALpC,EAAKkE,SAAS,CAAEyH,yBAAyB,MAQ3C,yBAAKjG,SAAU,IACf,kBAAC,IAAD,CAASS,KAAM8D,IAAMhE,KAAK,UAC1B,kBAAC,IAAD,CAAUnJ,UAAU,wBAApB,uBAGF,kBAAC,IAAD,CAASuI,QAAM,EAACC,QAAS,SAAArP,GAAM,IAAD,IAC5B,EAAKiO,SAAS,CAAEkI,QAAS,CAAEnF,MAAM,EAAOpI,MAAO,QAC/C,YAAK8L,kBAAL,mBAAiB4H,qBAAjB,SAAgCqH,UAEhC,yBAAKlU,SAAU,IACf,kBAAC,IAAD,CAASS,KAAMyT,IAAO3T,KAAK,UAC3B,kBAAC,IAAD,CAAUnJ,UAAU,wBAApB,iBAGF,kBAAC,IAAD,CAASuI,QAAM,EAACC,QAAS,SAAA/M,GAAO,IAAD,IAC7B,EAAK2L,SAAS,CAAEkI,QAAS,CAAEnF,MAAM,EAAOpI,MAAO,QAC/C,IAAMmU,EAAG,UAAG,EAAKrI,kBAAR,iBAAG,EAAiB0H,uBAApB,aAAG,EAAkCnT,eAC9C,IAAK8T,EAAI7T,YAAc,GAAK,GAAK6T,EAAI3T,WAAW,GAAG4T,WAAWxU,OAAS,EAAG,CAAC,IAAD,IAClEuB,EAAegT,EAAKC,WACpB4E,EAAQ7E,EAAI3T,WAAW,GACzBwa,EAAS,UAAG,EAAKC,kBAAkBjC,EAAMI,uBAAhC,aAAG,EAA8CK,aAAa,KACvEyB,EAAO,UAAG,EAAKD,kBAAkBjC,EAAMmC,qBAAhC,aAAG,EAA4C1B,aAAa,KAEvE,GADG,OAAHtF,QAAG,IAAHA,KAAK1T,kBACY,MAAbua,GAAgC,MAAXE,EAEvB,YADA,EAAK7V,SAAS,CAAE4H,mBAAmB,IAGrC,IAAMmO,EAAmB,8BAA8BC,KAAKL,GACtDM,EAAiB,UAAMF,EAAiB,IAAvB,OAA4BA,EAAiB,IAA7C,OAAkDA,EAAiB,IACpFG,EAAkB,8BAA8BF,KAAKH,GAAW,GAElEM,EAAQ,UAAMF,GACdN,IAAcE,IAChBM,GAAQ,WAAQD,IAElB,IAAME,EAAQ,gBAAO,EAAKna,MAAMvG,SAAS/C,MAA3B,uBAAqC,EAAK2L,MAAMyB,MAAMG,OAAOC,KAA7D,uBAAsErE,EAAtE,yBAA8F,EAAKG,MAAMvG,SAASxC,IAAlH,iBAA8H,cAAc8iB,KAAK,EAAK/Z,MAAMvG,SAASzC,MAAO,GAA5K,gBAAsLkjB,EAAtL,KACdhd,UAAUsC,WAAatC,UAAUsC,UAAUC,UAAU0a,GACrD,EAAKpW,SAAS,CAAE2H,6BAA6B,SAE7C,EAAK3H,SAAS,CAAEyH,yBAAyB,MAG3C,yBAAKjG,SAAU,IACf,kBAAC,IAAD,CAASS,KAAMkB,IAAapB,KAAK,UACjC,kBAAC,IAAD,CAAUnJ,UAAU,wBAApB,6BAGF,kBAAC,IAAD,CAASuI,QAAM,EAACC,QAAS,SAAA/M,GACvB,IAAIgiB,EAAYpT,OAAOC,SAASlK,KAAKsE,MAAM,KAAK,GAE3B,KADA,EAAKoM,sBAExB2M,GAAS,oBAAiB,EAAK9P,4BAGjC,EAAKjI,MAAMwC,SAAS,CAClBlF,KAAM,kBACNS,IAAK,iBACLC,IAAK,CACHyG,MAAM,EACNvH,KAAMwH,mBAAmBqT,QAI7B,yBAAK7U,SAAU,IACf,kBAAC,IAAD,CAASS,KAAMkB,IAAapB,KAAK,UACjC,kBAAC,IAAD,CAAUnJ,UAAU,wBAApB,iCASR0d,EAAc,oCAChB,kBAAC,IAAD,CAAQC,SAAS,SAASC,WAAW,QAAQzU,KAAK,SAChD,kBAAC,IAAD,CAAclJ,MAAO,CAAE4d,QAHF,IAG+BrV,QAAS,SAAArP,GAAC,OAAI,EAAKuM,MAAMqM,kBAAoB,EAAKC,aAAe,EAAKC,cACxH6L,cAAe,SAAA3kB,GACbA,EAAE4kB,cAAc9d,MAAM+d,YAAY,UAAW,MAE/CC,eAAgB,SAAA9kB,GACdA,EAAE4kB,cAAc9d,MAAM+d,YAAY,UAAW,MAE/CE,YAAa,SAAA/kB,GAEPqK,EAAQrC,iBACVhI,EAAE4kB,cAAc9d,MAAM+d,YAAY,UAAlC,UAbe,MAgBnBG,eAAgB,SAAAhlB,GACdA,EAAE4kB,cAAc9d,MAAM+d,YAAY,UAAlC,UAjBiB,OAmBnB,kBAAC,IAAD,CAAS3U,KAAMC,QAGnB,kBAAC,IAAD,CAAQqU,SAAS,SAASC,WAAW,MAAMzU,KAAK,SAC9C,kBAAC,IAAD,CAAclJ,MAAO,CAAE4d,QAvBF,IAuB+BrV,QAAS,SAAArP,GAAC,OAAI,EAAKuM,MAAMqM,kBAAoB,EAAKE,aAAe,EAAKD,cACxH8L,cAAe,SAAA3kB,GACbA,EAAE4kB,cAAc9d,MAAM+d,YAAY,UAAW,MAE/CC,eAAgB,SAAA9kB,GACdA,EAAE4kB,cAAc9d,MAAM+d,YAAY,UAAW,MAE/CE,YAAa,SAAA/kB,GACPqK,EAAQrC,iBACVhI,EAAE4kB,cAAc9d,MAAM+d,YAAY,UAAlC,UAhCe,MAmCnBG,eAAgB,SAAAhlB,GACdA,EAAE4kB,cAAc9d,MAAM+d,YAAY,UAAlC,UApCiB,OAsCnB,kBAAC,IAAD,CAAS3U,KAAM+U,SASrB,OAJKnkB,KAAK2T,aAAqC,MAAtB3T,KAAKoJ,MAAM3G,SAClCzC,KAAKokB,YAIL,kBAAC,IAAD,KACGzY,EACD,kBAAC,IAAD,KACG3L,KAAKyL,MAAMoK,WAAa7V,KAAKoJ,MAAM8L,oBAAsBuO,EAAa,qCAEvE,kBAAC,IAAD,CACElY,SAAS,SACTC,OAAQxL,KAAKoJ,MAAM6D,UACnBuD,aAAc,kBAAM,EAAKrD,SAAS,CAAEF,WAAW,KAC/CwD,QAAS,0BAGVzQ,KAAKoJ,MAAM0D,WAAavD,EAAQzD,kBAAoB,qCAErD,yBAAKxG,GAAG,iBAAiB0G,MAAO,CAAEiU,MAAO,OAAQC,OAAQ,OAAQmK,WAAY,OAAQC,iBAAkB,UAGvG,kBAAC,IAAD,CACE/Y,SAAS,SACTC,OAAQxL,KAAKoJ,MAAMuL,kBACnBhJ,OAAQ,eACRC,UAAS,6CAAe5L,KAAKoJ,MAAMsL,UAA1B,KACT7I,OAAQ,CACN,CACEC,KAAM,QACN/C,KAAM,SACNwO,IAAK,EACLD,IAAKtX,KAAKoJ,MAAMsL,UAChBtI,MAAOpM,KAAKoJ,MAAMqL,cAGtBzI,QAAS,CACP,CACErD,KAAM,eACNsD,KAAM,SACNV,SAAU,mBACVW,QAAS,kBAAM,EAAKiB,SAAS,CAAEwH,mBAAmB,MAEpD,CACEhM,KAAM,eACN4C,SAAU,iBACVW,QAAS,SAACE,GACR,EAAKe,SAAS,CAAEwH,mBAAmB,IACnC,EAAK4P,WAAWnY,EAAMG,YAM9B,kBAAC,EAAD,aAEIb,gBAAkB1L,KAAKoJ,MAAcsC,gBACrCS,OAAQ,WAAQ,EAAKgB,SAAS,CAAEzB,iBAAiB,MAAe1L,KAAKyL,QAIzE,kBAAC,IAAD,CACEF,SAAS,SACTC,OAAQxL,KAAKoJ,MAAMwL,wBACnB4P,iBAAiB,EACjB7Y,OAAO,eACP8E,QAAQ,8IACRzE,QAAS,CACP,CACErD,KAAM,eACN4C,SAAU,iBACVW,QAAS,SAACE,GACR,EAAKe,SAAS,CACZyH,yBAAyB,SAOnC,kBAAC,IAAD,CACErJ,SAAS,SACTC,OAAQxL,KAAKoJ,MAAMyL,uBACnBrE,aAAc,kBAAM,EAAKrD,SAAS,CAAE0H,wBAAwB,KAC5DpE,QAAQ,6CACRqB,SAAU,MAGZ,kBAAC,IAAD,CACEvG,SAAS,SACTC,OAAQxL,KAAKoJ,MAAM0L,4BACnBtE,aAAc,kBAAM,EAAKrD,SAAS,CAAE2H,6BAA6B,KACjErE,QAAQ,mDACRqB,SAAU,MAGZ,kBAAC,IAAD,CACEvG,SAAS,SACTC,OAAQxL,KAAKoJ,MAAM2L,kBACnBvE,aAAc,kBAAM,EAAKrD,SAAS,CAAE4H,mBAAmB,KACvDtE,QAAQ,yDACRqB,SAAU,MAGZ,kBAAC,IAAD,CACEvG,SAAS,SACTC,OAAQxL,KAAKoJ,MAAM4L,oBACnBrJ,OAAQ,2BACRC,UAAU,+OACVC,OAAQ,CACN,CACEC,KAAM,QACN/C,KAAM,SACNgD,YAAa,oCAGjBC,QAAS,CACP,CACErD,KAAM,eACNsD,KAAM,SACNV,SAAU,mBACVW,QAAS,kBAAM,EAAKiB,SAAS,CAAE6H,qBAAqB,MAEtD,CACErM,KAAM,eACN4C,SAAU,iBACVW,QAAS,SAACE,GACY,KAAhBA,EAAMG,OAKV,EAAKkY,qBAAqBrY,EAAMG,OACK,IAAjC,EAAKwH,iBAAiBrM,OACxB,EAAKyF,SAAS,CAAE6H,qBAAqB,EAAOG,WAAW,EAAMC,aAAa,uCAAD,OAAWhJ,EAAMG,UAE1F,EAAKY,SAAS,CAAE6H,qBAAqB,EAAOE,qBAAqB,EAAMD,WAAY7I,EAAMG,QACzF,EAAK6U,mBATL,EAAKjU,SAAS,CAAE6H,qBAAqB,SAgB/C,kBAAC,IAAD,CACEzJ,SAAS,SACTC,OAAQxL,KAAKoJ,MAAM8L,oBACnB1E,aAAc,kBAAM,EAAKrD,SAAS,CAAE+H,qBAAqB,KACzDzE,QAAO,4BAAQzQ,KAAKoJ,MAAM6L,YAC1BjJ,QAAS,CACP,CACErD,KAAM,eACNsD,KAAM,SACNC,QAAS,kBAAM,EAAKiB,SAAS,CAAE+H,qBAAqB,SAK1D,kBAAC,IAAD,CACE3J,SAAS,SACTC,OAAQxL,KAAKoJ,MAAM+L,UACnB3E,aAAc,kBAAM,EAAKrD,SAAS,CAAEgI,WAAW,KAC/C1E,QAASzQ,KAAKoJ,MAAMgM,aACpBtD,SAAU,U,+BA3oClB,OAAOvI,EAAQzI,YACbd,KAAKyL,MAAMyB,MAAMG,OAAOjN,KACxBJ,KAAKyL,MAAMyB,MAAMG,OAAOC,Q,gCAwD1B,MAAgC,aAAzBtN,KAAKyL,MAAMyB,MAAMP,M,+BAGV,IAAD,OACb,OAAO3M,KAAKyL,MAAM3I,UAAUK,MAC1B,SAACjE,GAAD,OAAOA,EAAE6J,OAASnE,EAAayF,MAAQnL,EAAEmE,OAAS,EAAKmQ,a,kCAIzD,MAA+B,KAAxBxT,KAAKyT,gBAA0C,MAAjBzT,KAAKkD,W,8BAI1C,MAA+B,KAAxBlD,KAAKyT,eAAwBzT,KAAKyT,eAAkC,MAAjBzT,KAAKkD,SAAmBlD,KAAKkD,SAAUgG,QAAU,mD,GAjLnFsD,IAAMC,WA0wC5BiY,GAAe5T,YAAiBkC,IAEvBjC,gBAfS,SAAC3H,GACvB,MAAO,CACLtG,UAAWsG,EAAMnG,SAASH,UAC1BmD,SAAUmD,EAAMnG,SAASgD,SACzBuT,aAAcpQ,EAAMnG,SAASuW,aAC7B3D,UAAWzM,EAAMnG,SAAS4S,UAC1BiC,kBAAmB1O,EAAMnG,SAAS6U,kBAClC7U,SAAUmG,EAAMnG,SAChB4D,cAAeuC,EAAMnG,SAAS4D,cAC9Bob,WAAY7Y,EAAMnG,SAASgf,cAMhBlR,CAEb2T,I,gGMn0CIC,G,kDACJ,WAAYlZ,GAAa,IAAD,8BACtB,cAAMA,IAEDrC,MAAQ,CACXwb,iBAAiB,EACjBC,qBAAsB,EACtBC,wBAAwB,GANJ,E,2DAUTC,EAA+BC,GAC5C,IAAMC,EAAcF,EAAa/a,WAAU,SAAC5G,GAAD,OAAiBA,EAAEC,OAAS2hB,EAAY3hB,SAC9D,IAAjB4hB,EACFhjB,QAAQC,MAAR,6EAAoF8iB,EAAY3hB,OAEhG0hB,EAAaE,GAAeD,I,+LAa9B,IAPAhlB,KAAKmN,SAAS,CAAE0X,qBAAsB,IAChCK,EAAwBllB,KAAKyL,MAAM3I,UAAUsc,QAAO,SAAChc,GAAD,OAAOA,EAAE2F,OAASnE,EAAa2F,QACnF4a,EAAwBnlB,KAAKyL,MAAM3I,UAAUsc,QAAO,SAAChc,GAAD,OAAOA,EAAE2F,OAASnE,EAAayF,QACnF+a,EAA0CD,EAAsB/F,QAAO,SAAChc,GAAD,OAAoF,IAA7E8hB,EAAsBlb,WAAU,SAACqb,GAAD,eAAQ,UAAAA,EAAGjlB,YAAH,eAASA,SAAT,UAAkBgD,EAAEhD,YAApB,aAAkB,EAAQA,YAGlJklB,EAAkBF,EAAwC1d,OACrDgD,EAAI,EAAGA,EAAIwa,EAAsBxd,OAAQgD,IAC1CtK,EAAO8kB,EAAsBxa,GAAGtK,KACtCklB,GAAmBllB,EAAKF,UAAUuK,MAAM,KAAK/C,OAG3C6d,EAAkB,EACb7a,EAAI,E,YAAGA,EAAIwa,EAAsBxd,Q,iBAClC8d,EAAmBN,EAAsBxa,GACzCtK,EAAOolB,EAAiBplB,KACxBoK,EAAQpK,EAAKF,UAAUuK,MAAM,KAC1Bgb,EAAI,E,aAAGA,EAAIjb,EAAM9C,Q,wBAClBN,EAAYoD,EAAMib,GACxBF,GAAmB,EACnBvlB,KAAKmN,SAAS,CAAE0X,qBAAsBU,EAAkBD,I,UACtC/b,EAAQnC,UAAUhH,EAAKA,KAAMgH,EAAW,MAAM,G,QAA1D5D,E,OACAxC,EAAWuI,EAAQzI,YAAYV,EAAKA,KAAMgH,GAEhDmC,EAAQlC,oBAAoBrG,EAAUwC,EAAIf,SAChC,IAANgjB,GAEFzlB,KAAK0lB,eAAe1lB,KAAKyL,MAAM3I,UAAWtD,OAAOuX,OAAOyO,EAAkB,CAAEplB,KAAMoD,EAAIX,YAExFZ,QAAQ1B,IAAR,sBAA2BS,I,QAZKykB,I,wBAJc/a,I,uBAmBzCA,EAAI,E,aAAGA,EAAI0a,EAAwC1d,Q,wBAC1D6d,GAAmB,EACnBvlB,KAAKmN,SAAS,CAAE0X,qBAAsBU,EAAkBD,IAClDE,EAAmBJ,EAAwC1a,GAC3DtK,EAAOolB,EAAiBplB,K,UACZmJ,EAAQnC,UAAUhH,EAAKA,KAAvB,UAAgCA,EAAKL,MAAQ,MAAM,G,QAA/DyD,E,OACAxC,EAAWuI,EAAQzI,YAAYV,EAAKA,KAAzB,UAAkCA,EAAKL,QACpD4lB,EAAUniB,EAAIX,UACV9C,KAAOK,EAAKL,KAEpBwJ,EAAQlC,oBAAoBrG,EAAUwC,EAAIf,SAE1CzC,KAAK0lB,eAAe1lB,KAAKyL,MAAM3I,UAAWtD,OAAOuX,OAAOyO,EAAkB,CAAEplB,KAAMulB,KAClF1jB,QAAQ1B,IAAR,sBAA2BS,I,QAbuC0J,I,wBAgBpE1K,KAAKyL,MAAMwC,SAAS,CAClBlF,KAAM,mBACNjG,UAAW9C,KAAKyL,MAAM3I,YAExB9C,KAAKmN,SAAS,CAAE2X,wBAAwB,I,sIAGhC,IAAD,OACP,OACE,kBAAC,IAAD,KACE,kBAAC,IAAD,KACE,kBAAC,IAAD,KACE,kBAAC,IAAD,CAAU/e,UAAU,UAApB,kBAGJ,kBAAC,IAAD,KACE,kBAAC,IAAD,KACE,kBAAC,IAAD,KACE,yBAAK4I,SAAU,IACf,kBAAC,IAAD,CAASS,KAAMkB,IAAapB,KAAK,UACjC,kBAAC,IAAD,CAAUnJ,UAAU,wBAApB,4CAAsD,uBAAGI,KAAK,+CAA+CC,OAAO,QAAQwf,GAAaC,UACzI,kBAAC,IAAD,CAAW3W,KAAK,MAAM4W,KAAK,QAAQ9f,MAAO,CAAEC,SAAU,uBAAyBsI,QAAS,SAAArP,GACtF,EAAKuM,MAAMwC,SAAS,CAClBlF,KAAM,kBACNS,IAAK,iBACLC,IAAK,CACHyG,MAAM,EACNvH,KAAMyH,OAAOC,SAASmG,YAN5B,iBAWF,kBAAC,IAAD,KACE,yBAAK7H,SAAU,IACf,kBAAC,IAAD,CAASS,KAAMO,IAAeT,KAAK,UACnC,kBAAC,IAAD,CAAUnJ,UAAU,wBAApB,kFACA,kBAAC,IAAD,CAAWmJ,KAAK,MAAM4W,KAAK,QAAQ9f,MAAO,CAAEC,SAAU,uBAAyBsI,QAAS,SAAArP,GACtFqK,EAAQlD,cADV,iBAIF,kBAAC,IAAD,KACE,yBAAKsI,SAAU,IACf,kBAAC,IAAD,CAASS,KAAM2W,IAAK7W,KAAK,UACzB,kBAAC,IAAD,CAAUnJ,UAAU,wBAAuB,uBAAGI,KAAK,8CAA8CC,OAAO,QAA7D,4CAC3C,kBAAC,IAAD,CAAW8I,KAAK,MAAM8W,QAAShmB,KAAKyL,MAAMwa,UAAWzW,YAAa,SAAAtQ,GAChE,IAAMgnB,EAAYhnB,EAAEwQ,OAAOsW,QAC3BE,EAAY3c,EAAQtE,eAAiBsE,EAAQjE,gBAC7C,EAAKmG,MAAMwC,SAAS,CAClBlF,KAAM,cACNS,IAAK,YACLC,IAAKyc,QAIX,kBAAC,IAAD,CAASnX,QAAS/O,KAAKyL,MAAMwa,WAC3B,yBAAKtX,SAAU,IACf,kBAAC,IAAD,CAASS,KAAM2W,IAAK7W,KAAK,UACzB,kBAAC,IAAD,CAAUnJ,UAAU,wBAApB,2CACA,kBAAC,IAAD,CAAWmJ,KAAK,MAAM4W,KAAK,QAAQ9f,MAAO,CAAEC,SAAU,uBAAyBsI,QAAS,SAAArP,GACtFkR,OAAOhP,KAAP,wGAA2D+kB,mBAAmB,uFAAwB7f,UAAU8f,UAAY,4BAAeR,GAAaC,QAAU,4BAAe9iB,KAAK4G,UAAU,EAAK8B,MAAMxI,UAAY,kBAAesG,EAAQvE,cADhP,iBAIF,kBAAC,IAAD,KACE,yBAAK2J,SAAU,IACf,kBAAC,IAAD,CAASS,KAAMiX,IAAUnX,KAAK,UAC9B,kBAAC,IAAD,CAAUnJ,UAAU,wBAApB,qCACA,kBAAC,IAAD,CAAW+f,KAAK,QAAQ9f,MAAO,CAAEC,SAAU,uBAAyBsI,QAAO,uCAAE,WAAOrP,GAAP,MAAA+B,EAAA,SAAAA,EAAA,sDACrEqlB,EADqE,uCACnBH,mBAAmBxjB,aAAaC,QAAQ,kBAAoB,MAC9G3B,EAAIgD,SAAS0O,cAAc,MAC/BxM,KAAOmgB,EACTrlB,EAAEolB,SAAW,gBACbplB,EAAEslB,QACFtlB,EAAEulB,SANyE,2CAAF,uDAA3E,gBAQA,2BAAOlnB,GAAG,kBAAkByJ,KAAK,OAAO0d,OAAO,QAAQzgB,MAAO,CAAE+U,QAAS,QAAU2L,SAAQ,uCAAE,WAAOllB,GAAP,mBAAAP,EAAA,6DACrFmK,EADqF,UAC9E5J,EAAG4E,OAAOugB,aADoE,aAC9E,EAAiBC,KAAK,GADwD,gBAEpExb,QAFoE,IAEpEA,OAFoE,EAEpEA,EAAMzC,OAF8D,gDAEpD,GAFoD,OAErFke,EAFqF,KAG3F,IAEE9jB,KAAKC,MAAM6jB,GACXlkB,aAAa+G,QAAQ,gBAAiBmd,GACtC,EAAKpb,MAAMwC,SAAS,CAAClF,KAAM,kBAC3B,EAAK+d,iBACL,MAAO5nB,GACP+C,QAAQC,MAAMhD,GACd+C,QAAQC,OAAM,IAAI/C,OAAQgD,OAE3B8B,SAASqY,eAAe,mBAAwClQ,MAAQ,GAbkB,2CAAF,wDAe3F,kBAAC,IAAD,CAAW0Z,KAAK,QAAQ9f,MAAO,CAAEC,SAAU,uBAAyBsI,QAAS,SAACrP,GAC3E+E,SAASic,cAAc,oBAAyCqG,UADnE,iBAIF,kBAAC,IAAD,KACE,yBAAK5X,SAAU,IACf,kBAAC,IAAD,CAASS,KAAMO,IAAeT,KAAK,UACnC,yBAAKlJ,MAAO,CAAEiU,MAAO,SACnB,kBAAC,IAAD,CAAUlU,UAAU,wBAApB,8CACA,kBAAC,IAAD,CAAgBqG,MAAOpM,KAAKoJ,MAAMyb,wBAEpC,kBAAC,IAAD,CAAW3V,KAAK,MAAM4W,KAAK,QAAQ9f,MAAO,CAAEC,SAAU,uBAAyBsI,QAAO,uCAAE,WAAOrP,GAAP,SAAA+B,EAAA,+EAAa,EAAK6lB,kBAAlB,2CAAF,uDAAtF,gBACA,kBAAC,IAAD,CACEvb,SAAS,SACTC,OAAQxL,KAAKoJ,MAAM0b,uBACnBtU,aAAc,kBAAM,EAAKrD,SAAS,CAAE2X,wBAAwB,KAC5DrU,QAAO,+DACPqB,SAAU,OAGd,kBAAC,IAAD,KACE,yBAAKnD,SAAU,IACf,kBAAC,IAAD,CAASS,KAAM2X,IAAc7X,KAAK,UAClC,kBAAC,IAAD,CAAUnJ,UAAU,wBAApB,4BACA,kBAAC,IAAD,CAAWmJ,KAAK,MACd9C,MAAOpM,KAAKyL,MAAMub,MAClBhhB,MAAO,CAAEC,SAAU,uBACnBqJ,UAAU,UACVC,iBAAkB,CAAEhE,SAAU,iBAC9BiE,YAAa,SAAAtQ,GACX,IAAMkN,EAAQlN,EAAEwQ,OAAOtD,MACvB,EAAKX,MAAMwC,SAAS,CAClBlF,KAAM,cACNS,IAAK,QACLC,IAAK2C,IAEPnI,SAASG,KAAK6iB,UAAUrZ,SAAQ,SAACnE,GAAD,OAASxF,SAASG,KAAK6iB,UAAUT,OAAO/c,MACxExF,SAASG,KAAK6iB,UAAUC,OAAxB,eAAuC9a,IAAS,KAElD,kBAAC,IAAD,CAAiBrG,UAAU,eAAeqG,MAAO,GAAjD,SACA,kBAAC,IAAD,CAAiBrG,UAAU,cAAcqG,MAAO,GAAhD,gBACA,kBAAC,IAAD,CAAiBrG,UAAU,eAAeqG,MAAO,GAAjD,gBACA,kBAAC,IAAD,CAAiBrG,UAAU,kBAAkBqG,MAAO,GAApD,gBACA,kBAAC,IAAD,CAAiBrG,UAAU,gBAAgBqG,MAAO,GAAlD,wBAGJ,kBAAC,IAAD,KACE,yBAAKuC,SAAU,IACf,kBAAC,IAAD,CAASS,KAAM+X,IAAcjY,KAAK,UAClC,kBAAC,IAAD,CAAUnJ,UAAU,wBAApB,gEACA,kBAAC,IAAD,CAAWmJ,KAAK,MAAM8W,QAAShmB,KAAKyL,MAAMqM,kBAAmBtI,YAAa,SAAAtQ,GACxE,IAAMgnB,EAAYhnB,EAAEwQ,OAAOsW,QAC3B,EAAKva,MAAMwC,SAAS,CAClBlF,KAAM,cACNS,IAAK,oBACLC,IAAKyc,QAIX,kBAAC,IAAD,KACE,yBAAKvX,SAAU,IACf,kBAAC,IAAD,CAASS,KAAM+X,IAAcjY,KAAK,UAClC,kBAAC,IAAD,CAAUnJ,UAAU,wBAApB,6BACA,kBAAC,IAAD,CAAWmJ,KAAK,MAAM8W,QAAShmB,KAAKyL,MAAMoK,UAAWrG,YAAa,SAAAtQ,GAChE,IAAMgnB,EAAYhnB,EAAEwQ,OAAOsW,QAC3B,EAAKva,MAAMwC,SAAS,CAClBlF,KAAM,cACNS,IAAK,YACLC,IAAKyc,QAIX,kBAAC,IAAD,KACE,yBAAKvX,SAAU,IACf,kBAAC,IAAD,CAASS,KAAM+X,IAAcjY,KAAK,UAClC,kBAAC,IAAD,CAAUnJ,UAAU,wBAApB,oDACA,kBAAC,IAAD,CAAWmJ,KAAK,MACd9C,MAAOpM,KAAKyL,MAAM5E,cAClBb,MAAO,CAAEC,SAAU,uBACnBqJ,UAAU,UACVC,iBAAkB,CAAEhE,SAAU,UAC9BiE,YAAa,SAAAtQ,GACX,IAAMkN,EAAQlN,EAAEwQ,OAAOtD,MACvB,EAAKX,MAAMwC,SAAS,CAClBlF,KAAM,cACNS,IAAK,gBACLC,IAAK2C,IAEP7C,EAAQ3C,cAAc,EAAK6E,MAAMxI,YAEnC,kBAAC,IAAD,CAAiB8C,UAAU,SAASqG,MAAO,GAA3C,UACA,kBAAC,IAAD,CAAiBrG,UAAU,SAASqG,MAAO,GAA3C,UACA,kBAAC,IAAD,CAAiBrG,UAAU,SAASqG,MAAO,GAA3C,YAGJ,kBAAC,IAAD,KACE,yBAAKuC,SAAU,IACf,kBAAC,IAAD,CAASS,KAAM+X,IAAcjY,KAAK,UAClC,kBAAC,IAAD,CAAUnJ,UAAU,wBAApB,0DACA,kBAAC,IAAD,CAAWmJ,KAAK,MAAM8W,QAAShmB,KAAKyL,MAAM+N,aAAchK,YAAa,SAAAtQ,GACnE,IAAMgnB,EAAYhnB,EAAEwQ,OAAOsW,QAC1B,EAAKva,MAAcwC,SAAS,CAC3BlF,KAAM,cACNS,IAAK,eACLC,IAAKyc,QAIX,kBAAC,IAAD,KACE,yBAAKvX,SAAU,IACf,kBAAC,IAAD,CAASS,KAAMzG,IAAMuG,KAAK,UAC1B,kBAAC,IAAD,CAAUnJ,UAAU,wBAApB,qFACA,kBAAC,IAAD,CAAWmJ,KAAK,MAAM8W,QAAShmB,KAAKyL,MAAMzE,WAAYwI,YAAa,SAAAtQ,GACjE,IAAMgnB,EAAYhnB,EAAEwQ,OAAOsW,QAC1B,EAAKva,MAAcwC,SAAS,CAC3BlF,KAAM,cACNS,IAAK,aACLC,IAAKyc,IAEP3c,EAAQ3C,cAAc,EAAK6E,MAAMxI,cAGrC,kBAAC,IAAD,KACE,yBAAK0L,SAAU,IACf,kBAAC,IAAD,CAASS,KAAMzG,IAAMuG,KAAK,UAC1B,yBAAKnJ,UAAU,gBACb,yBAAKC,MAAO,CAAEohB,cAAe,WAC3B,kBAAC,IAAD,CAAUrhB,UAAU,wBAApB,+BAAoD/F,KAAKyL,MAAMxE,YAC/D,kBAAC,IAAD,CAAUsQ,IAAK,GAAID,IAAK,IAAK+P,KAAK,EAAMC,OAAO,EAAMlb,MAAOpM,KAAKyL,MAAMxE,WAAYuI,YAAa,SAAAtQ,GAC9F,EAAKuM,MAAMwC,SAAS,CAClBlF,KAAM,cACNS,IAAK,aACLC,IAAKvK,EAAEwQ,OAAOtD,QAEhB7C,EAAQ3C,cAAc,EAAK6E,MAAMxI,gBAKzC,kBAAC,IAAD,KACE,yBAAK0L,SAAU,IACf,kBAAC,IAAD,CAASS,KAAMzG,IAAMuG,KAAK,UAC1B,yBAAKnJ,UAAU,gBACb,kBAAC,IAAD,CAAUA,UAAU,wBAApB,yCAAmD,0BAAMA,UAAU,YAAY/F,KAAKyL,MAAMxI,SAASgD,WACnG,kBAAC,IAAD,CAAUsR,IAAK,GAAID,IAAK,IAAK+P,KAAK,EAAMC,OAAO,EAAMlb,MAAOpM,KAAKyL,MAAMxI,SAASgD,SAAUuJ,YAAa,SAAAtQ,GACrG,EAAKuM,MAAMwC,SAAS,CAClBlF,KAAM,cACNS,IAAK,WACLC,IAAKvK,EAAEwQ,OAAOtD,QAEhB7C,EAAQ3C,cAAc,EAAK6E,MAAMxI,eAIvC,kBAAC,IAAD,KACE,yBAAK0L,SAAU,IACf,kBAAC,IAAD,CAASS,KAAMyT,IAAO3T,KAAK,UAC3B,kBAAC,IAAD,CAAUnJ,UAAU,wBAApB,wCACA,kBAAC,IAAD,CAAWmJ,KAAK,MACd9C,MAAOpM,KAAKyL,MAAM8b,WAClBvhB,MAAO,CAAEC,SAAU,uBACnBqJ,UAAU,UACVC,iBAAkB,CAAEhE,SAAU,iBAC9BiE,YAAa,SAAAtQ,GACX,IAAMkN,EAAQlN,EAAEwQ,OAAOtD,MACvB,EAAKX,MAAMwC,SAAS,CAClBlF,KAAM,cACNS,IAAK,aACLC,IAAK2C,IAEPnI,SAASG,KAAK6iB,UAAUrZ,SAAQ,SAACnE,GAC3B,QAAQ+d,KAAK/d,IACfxF,SAASG,KAAK6iB,UAAUT,OAAO/c,MAGnCxF,SAASG,KAAK6iB,UAAUC,OAAxB,eAAuC9a,IAAS,KAElD,kBAAC,IAAD,CAAiBrG,UAAU,6BAA6BqG,MAAO,GAA/D,4BACA,kBAAC,IAAD,CAAiBrG,UAAU,6BAA6BqG,MAAO,GAA/D,wBAGJ,kBAAC,IAAD,KACE,yBAAKuC,SAAU,IACf,kBAAC,IAAD,CAASS,KAAMkT,IAAcpT,KAAK,UAClC,yBAAKnJ,UAAU,gBACb,yBAAKC,MAAO,CAAEohB,cAAe,WAC3B,kBAAC,IAAD,CAAUrhB,UAAU,wBAAuB,uBAAGI,KAAK,mDAAmDC,OAAO,QAAlE,wCAA3C,KAAiIpG,KAAKyL,MAAMwW,YAC5I,kBAAC,IAAD,CAAU1K,IAAK,GAAKD,IAAK,IAAKE,KAAM,GAAK8P,OAAO,EAAMlb,MAAOpM,KAAKyL,MAAMwW,WAAYzS,YAAa,SAAAtQ,GAC/F,EAAKuM,MAAMwC,SAAS,CAClBlF,KAAM,cACNS,IAAK,aACLC,IAAMvK,EAAEwQ,OAAOtD,MAAiBqb,QAAQ,WAMlD,kBAAC,IAAD,KACE,yBAAK9Y,SAAU,IACf,kBAAC,IAAD,CAASS,KAAMsY,IAAYxY,KAAK,UAChC,yBAAKlJ,MAAO,CAAEC,SAAU,wBACtB,6CACA,6BAAK,uBAAGE,KAAK,+CAA+CC,OAAO,QAA9D,yCACL,6BAAK,uBAAGD,KAAK,uCAAuCC,OAAO,QAAtD,iEACL,uDAAmBmD,EAAQ/D,YAC3B,6BAAK,uBAAGW,KAAK,kCAAkCC,OAAO,QAAjD,sCACL,6BAAK,uBAAGD,KAAK,8CAA8CC,OAAO,QAA7D,oDACL,8DACA,6BAAK,uBAAGD,KAAK,sBAAsBC,OAAO,QAArC,iBACL,6BAAK,uBAAGD,KAAK,oDAAoDC,OAAO,QAAnE,sCACL,6BAAK,uBAAGD,KAAK,IAAIoI,QAAS,SAAArP,GACxBA,EAAE6I,iBACF,EAAKoF,SAAS,CAAEyX,iBAAiB,MAF9B,6DAMT,kBAAC,IAAD,CACErZ,SAAS,SACTC,OAAQxL,KAAKoJ,MAAMwb,gBACnBJ,iBAAiB,EACjB/T,QAAQ,iiBACRzE,QAAS,CACP,CACErD,KAAM,eACN4C,SAAU,iBACVW,QAAS,SAACE,GACR,EAAKe,SAAS,CACZyX,iBAAiB,MAIvB,CACEjc,KAAM,2BACN4C,SAAU,mBACVW,QAAS,SAACE,GACR,EAAKe,SAAS,CACZyX,iBAAiB,IAEnBxU,OAAOhP,KAAK,2C,GA7YLoL,IAAMC,WA0alBsE,gBAjBS,SAAC3H,GACvB,MAAO,CACLnG,SAAUmG,EAAMnG,SAChBgjB,UAAW7c,EAAMnG,SAASgjB,UAC1Be,MAAO5d,EAAMnG,SAAS+jB,MACtBxN,aAAcpQ,EAAMnG,SAASuW,aAC7B3D,UAAWzM,EAAMnG,SAAS4S,UAC1BiC,kBAAmB1O,EAAMnG,SAAS6U,kBAClCjR,cAAeuC,EAAMnG,SAAS4D,cAC9BG,WAAYoC,EAAMnG,SAAS+D,WAC3BC,WAAYmC,EAAMnG,SAASgE,WAC3BsgB,WAAYne,EAAMnG,SAASskB,WAC3BtF,WAAY7Y,EAAMnG,SAASgf,WAC3Bnf,UAAWsG,EAAMnG,SAASH,aAIfiO,CAEb4T,ICvbIgD,GAAU,oCACd,yBAAK3hB,MAAO,CAAEC,SAAU,sBAAuBsK,UAAW,WAA1D,8CAA8E,kBAAC,IAAD,CAASnB,KAAMiX,OAC7F,yBAAKrgB,MAAO,CAAEC,SAAU,sBAAuBsK,UAAW,WAAY,uBAAGpK,KAAK,+CAA+CC,OAAO,QAA9D,yCACtE,yBAAKJ,MAAO,CAAEC,SAAU,sBAAuBsK,UAAW,WAAY,uBAAGpK,KAAK,iDAAiDC,OAAO,QAAhE,8BAGlEwhB,G,kDAEJ,WAAYnc,GAAa,IAAD,8BACtB,cAAMA,IAFRoc,qBACwB,EAEtB,EAAKze,MAAQ,CACX0e,SAAS,EACT3S,WAAW,EACXC,aAAc,IAEhB,EAAKyS,gBAAkBrb,IAAMub,YAPP,E,+DAWtB,IAAIpR,EAAcjI,IAAY1L,MAAMhD,KAAKyL,MAAM4E,SAAS5B,QACxD,GAAIkI,EAAYiQ,MAAQjQ,EAAYiQ,KAAO5mB,KAAKyL,MAAM3I,UAAU4E,OAAQ,CAAC,IAAD,IAChExE,EAAWlD,KAAKyL,MAAM3I,UAAU6T,EAAYiQ,MAClD5mB,KAAKyL,MAAMY,QAAQC,KAAnB,kCAAyCpJ,EAAS9C,YAAlD,aAAyC,EAAeA,KAAxD,sBAAgE8C,EAAS9C,YAAzE,aAAgE,EAAeL,YACrEC,KAAK6P,cACf7P,KAAKmN,SAAS,CAAEgI,WAAW,EAAMC,aAAc,yFAC/CpV,KAAKyL,MAAMY,QAAQC,KAAnB,sB,yCAaekH,GACjBxT,KAAKyL,MAAMwC,SAAS,CAClBlF,KAAM,eACN1F,KAAMmQ,IAGHxT,KAAK6P,aACR7P,KAAKyL,MAAMY,QAAQC,KAAnB,qB,uCAIaxE,GACf,IAAMhF,EAAYgF,EAAM4H,OAAOsY,SAAShoB,KAAKyL,MAAM3I,WACnD9C,KAAKyL,MAAMwC,SAAS,CAClBlF,KAAM,mBACNjG,UAAWA,M,wCAII,IAAD,OACZA,EAAY9C,KAAKyL,MAAM3I,UACvBoL,EAAOhJ,QAoDX,OAnDApC,EAAU8K,SAAQ,SAAC1K,EAAUwH,GAAO,IAAD,YAC7B0D,EAAS,GACTjD,EAAK,UAAMjI,EAAS+F,cACpBoF,GAAa,EACjB,OAAQnL,EAAS6F,MACf,KAAKnE,EAAaoE,QAChBoF,EAAS,2BAAuBlL,EAASG,MAAQ,MACnD,KAAKuB,EAAa2F,KAChB6D,EAAS,wBAAoBlL,EAASG,MAAQ,MAChD,KAAKuB,EAAayF,KAChB+D,EAAS,kCAAoBlL,EAAS9C,YAA7B,aAAoB,EAAeA,KAAnC,sBAA2C8C,EAAS9C,YAApD,aAA2C,EAAeL,MACnEoL,EAAK,oBAAMjI,EAAS9C,YAAf,aAAM,EAAeN,MAArB,2BAA8BoD,EAAS9C,YAAvC,aAA8B,EAAeL,KAA7C,oBAAwDoL,GAAS,MACxE,KAAKvG,EAAakS,KAChBzI,GAAa,EACbD,EAAS,kCAAoBlL,EAAS9C,YAA7B,aAAoB,EAAeA,KAAnC,MACT+K,EAAK,oBAAMjI,EAAS9C,YAAf,aAAM,EAAeN,MAArB,cAAgCqL,GAEzC+C,EAAK5B,KACH,kBAAC,IAAD,CAAgB9C,IAAK,uBAAyBkB,GAC5C,kBAAC,IAAD,CAASlB,IAAK,gBAAkBkB,EAAG4D,QAAQ,EAAMC,QAAO,uCAAE,WAAMzG,GAAN,eAAA7G,EAAA,0DACpD,EAAKmI,MAAM0e,QADyC,uBAEtD,EAAK3a,SAAS,CAAEgI,WAAW,EAAMC,aAAc,qGAFO,0BAMxDtN,EAAMC,iBACN,EAAK0D,MAAMY,QAAQC,KAAK,CACtBkC,SAAUJ,EACVhF,MAAO,CACL/F,KAAMH,EAASG,MAEjBoL,OAAQC,IAAY/E,UAAU0E,EAAa,CAAEjD,KAAMlI,EAASlC,SAAUlB,MAAK,UAAEoD,EAAS9C,YAAX,aAAE,EAAeN,OAAU,MAZhD,2CAAF,uDAetD,yBAAK6O,SAAU,IACf,kBAAC,IAAD,CAAU5I,UAAU,uBAAuByD,IAAK,qBAAuBkB,GACpES,GAEFjI,EAAS6F,OAASnE,EAAaoE,QAAU,GAAK,kBAAC,IAAD,CAASoG,KAAMiX,IAAUnX,KAAK,QAC7E,kBAAC,IAAD,CAAYA,KAAK,SAGnB,kBAAC,IAAD,CAAgB+Y,KAAK,OACnB,kBAAC,IAAD,CAAejiB,MAAO,CAAEC,SAAU,uBAAyB2J,MAAM,SAASrB,QAAS,SAACrP,GAAO,IAAD,EACxF,EAAK4Q,mBAAmB5M,EAASG,MACjC,YAAKwkB,gBAAgBK,eAArB,SAA8BC,sBAFhC,sBAQDja,I,+BAGC,IAAD,OACDA,EAAOlO,KAAKooB,kBAElB,OACE,kBAAC,IAAD,CAAS5e,IAAG,uBAAkBxJ,KAAKqoB,eACjC,kBAAC,IAAD,KACE,kBAAC,IAAD,KACE,kBAAC,IAAD,CAAUriB,MAAO,CAAEC,SAAU,wBAA7B,gBAEA,kBAAC,IAAD,CAAWgJ,KAAMjP,KAAKoJ,MAAM0e,QAAU,QAAU,QAAS5Y,KAAK,MAC5DX,QAAS,SAAA/M,GAAE,OAAI,EAAK2L,SAAS,CAAE2a,SAAU,EAAK1e,MAAM0e,YACpD,kBAAC,IAAD,CAAS1Y,KAAMkZ,IAAcpZ,KAAK,iBAIxC,kBAAC,IAAD,KACGlP,KAAK6P,YACJ,oCACE,kBAAC,IAAD,CAASrG,IAAI,gBAAgB+e,IAAKvoB,KAAK6nB,iBACrC,kBAAC,IAAD,CAAiBW,UAAWxoB,KAAKoJ,MAAM0e,QAASW,iBAAkB,SAAC3gB,GAAiD,EAAK4gB,iBAAiB5gB,KACvIoG,IAGJyZ,IAEH,oCACE,kBAAC,IAAD,CAASne,IAAI,iBACV0E,GAEFyZ,IAIL,kBAAC,IAAD,CACEpc,SAAS,SACTC,OAAQxL,KAAKoJ,MAAM+L,UACnB3E,aAAc,kBAAM,EAAKrD,SAAS,CAAEgI,WAAW,KAC/C1E,QAASzQ,KAAKoJ,MAAMgM,aACpBtD,SAAU,U,kCAzHlB,OAAO9R,KAAKyL,MAAM3I,UAAU4E,OAAS,I,mCAIrC,MAAO,oBAAA1H,KAAKyL,MAAMyB,MAAMP,Q,GA7BAH,IAAMC,WAkK5Bkc,GAAe7X,YAAiB8W,IAEvB7W,gBAVS,SAAC3H,GACvB,MAAO,CACLtG,UAAWsG,EAAMnG,SAASH,aAQfiO,CAEb4X,ICvMWC,GAQT,WAAY/oB,GAAY,IAAD,2BAPvBkJ,UAOuB,OANvBkC,OAMuB,OALvBE,WAKuB,OAJvB/K,UAIuB,OAHvBN,WAGuB,OAFvB+oB,cAEuB,EACnB7oB,KAAK+I,KAAOlJ,EAAI,KAChBG,KAAKiL,EAAIpL,EAAI,EACbG,KAAKmL,MAAQtL,EAAI,MACjBG,KAAKI,KAAOP,EAAI,KAChBG,KAAKF,MAAQD,EAAI,MACjBG,KAAK6oB,SAAL,UAAgBhpB,EAAI,gBAApB,QAAoC,UCatCipB,G,kDACJ,WAAYrd,GAAa,IAAD,8BACtB,cAAMA,IACDrC,MAAQ,CACX0D,YAAY,EACZpB,iBAAiB,EACjBqd,SAAU,GACV9b,WAAW,GANS,E,4GAetBjN,KAAKyO,OAAOzO,KAAKyL,MAAMyB,MAAMG,OAAO2b,W,sEAGzBA,G,kFACXhpB,KAAKmN,SAAS,CAAEF,WAAW,I,kBAEP1D,EAAQ/I,cAAcsB,IAAtB,iBAAoCknB,GAAW,CAC/DzlB,aAAc,gB,cADVC,E,OAGAxB,EAAOe,KAAKC,OAAM,IAAIU,aAAcE,OAAOJ,EAAIxB,OAAO8B,QACtDilB,EAAW/mB,EAAKtD,KAAI,SAACmB,GAAD,OAAU,IAAI+oB,GAAO/oB,MAE/CG,KAAKmN,SAAS,CAAEL,YAAY,EAAOG,WAAW,EAAO8b,SAAUA,I,mBACxD,G,yCAEP9mB,QAAQC,MAAR,MACAD,QAAQC,OAAM,IAAI/C,OAAQgD,OAC1BnC,KAAKmN,SAAS,CAAEL,YAAY,EAAMG,WAAW,I,mBACtC,G,iJAQA,IAAD,OACJiB,EAAOhJ,QAoBX,OAnBiBlF,KAAKoJ,MAAM2f,SACnBnb,SAAQ,SAACa,EAAQ/D,GACxB,IAAMue,EAA4B,YAAhBxa,EAAO1F,KACrBoC,EAAQ8d,EAAYxa,EAAOtD,MAAV,UAAqBsD,EAAO3O,MAA5B,0BAAyC2O,EAAOoa,UACjEza,EAAY,WAAI,EAAK3C,MAAMyB,MAAMG,OAAO2C,MAASiZ,EAAS,mBAAexa,EAAOxD,GAAtB,gBAAqCwD,EAAOrO,OAC1G8N,EAAK5B,KACH,kBAAC,IAAD,CAAS9C,IAAK,cAAgBkB,EAAG4D,QAAQ,EAAMC,QAAO,uCAAE,WAAMzG,GAAN,SAAA7G,EAAA,sDACtD6G,EAAMC,iBACN,EAAK0D,MAAMY,QAAQC,KAAK,CACtBkC,SAAUJ,IAH0C,2CAAF,uDAMpD,yBAAKO,SAAU,IACf,kBAAC,IAAD,CAAU5I,UAAU,uBAAuByD,IAAK,eAAiBkB,GAC9DS,QAKF+C,I,+BAGC,IAAD,OACHA,EAAOlO,KAAK8O,UAChB,OACE,kBAAC,IAAD,KACE,kBAAC,IAAD,KACE,kBAAC,IAAD,KACE,kBAAC,IAAD,CAAU9I,MAAO,CAAEC,SAAU,wBAA7B,kBAA4DjG,KAAKyL,MAAMyB,MAAMG,OAAO2b,SACpF,kBAAC,IAAD,CAAWja,OAAQ/O,KAAKuR,UAAWtC,KAAK,QAAQC,KAAK,QAAQX,QAAS,SAAArP,GAAC,OAAI,EAAKuM,MAAMY,QAAQ8C,WAC5F,kBAAC,IAAD,CAASC,KAAMC,IAAWH,KAAK,eAGjC,kBAAC,IAAD,CAAWH,QAAS/O,KAAKoJ,MAAM0D,WAAYmC,KAAK,QAAQC,KAAK,MAAMX,QAAS,SAAArP,GAAC,OAAI,EAAKuP,OAAO,EAAKhD,MAAMyB,MAAMG,OAAO2b,WACnH,kBAAC,IAAD,CAAS5Z,KAAMO,IAAeT,KAAK,eAGrC,kBAAC,IAAD,CAAWD,KAAK,QAAQC,KAAK,MAAMX,QAAS,SAAArP,GAAC,OAAI,EAAKuM,MAAMY,QAAQC,KAAnB,WAA4B,EAAKb,MAAMyB,MAAMG,OAAO2C,QACnG,kBAAC,IAAD,CAASZ,KAAMa,IAAMf,KAAK,eAG5B,kBAAC,IAAD,CAAWD,KAAK,QAAQC,KAAK,MAAMX,QAAS,SAAArP,GAAC,OAAI,EAAKiO,SAAS,CAAEzB,iBAAiB,MAChF,kBAAC,IAAD,CAAS0D,KAAMX,IAAQS,KAAK,eAG9B,kBAAC,IAAD,CAAWD,KAAK,QAAQC,KAAK,MAAMX,QAAS,SAAArP,GAC1C,EAAKuM,MAAMwC,SAAS,CAClBlF,KAAM,kBACNS,IAAK,iBACLC,IAAK,CACHyG,MAAM,EACNvH,KAAMwH,mBAAmBC,OAAOC,SAASlK,WAI7C,kBAAC,IAAD,CAASiJ,KAAMkB,IAAapB,KAAK,iBAIvC,kBAAC,IAAD,KAEIlP,KAAKoJ,MAAM0D,WACTvD,EAAQzD,kBACR,kBAAC,IAAD,KACGoI,GAIP,kBAAC,IAAD,CACE3C,SAAS,SACTC,OAAQxL,KAAKoJ,MAAM6D,UACnBuD,aAAc,kBAAM,EAAKrD,SAAS,CAAEF,WAAW,KAC/CwD,QAAS,0BAGX,kBAAC,EAAD,aAEI/E,gBAAiB1L,KAAKoJ,MAAMsC,gBAC5BS,OAAQ,WAAQ,EAAKgB,SAAS,CAAEzB,iBAAiB,MAAe1L,KAAKyL,Y,gCAnF/E,MAAgC,aAAzBzL,KAAKyL,MAAMyB,MAAMP,Q,GAvCFH,IAAMC,WAmI1Byc,GAAapY,YAAiBgY,IASrB/X,gBAPS,SAAC3H,GACvB,MAAO,KAMM2H,CAEbmY,IC5IIC,G,kDAEJ,WAAY1d,GAAa,IAAD,8BACtB,cAAMA,IAFR2d,kBACwB,IAwFxBC,6BAA+B,GAtF7B,EAAKjgB,MAAQ,CACX4f,QAAS,GACTD,SAAU,GACVnU,yBAAyB,EACzBS,QAAS,CACPnF,MAAM,EACNpI,MAAO,MAETmF,WAAW,EACXH,YAAY,EACZqI,WAAW,EACXC,aAAc,IAEhB,EAAKgU,aAAe5c,IAAMub,YAfJ,E,+DAoBtB/nB,KAAKmN,SAAS,CAAE6b,QAAShpB,KAAKyL,MAAMyB,MAAMG,OAAO2b,UAC7ChpB,KAAKyL,MAAMyB,MAAMG,OAAO2b,QAC1BhpB,KAAKspB,WAAWtpB,KAAKyL,MAAMyB,MAAMG,OAAO2b,SAExChpB,KAAKmN,SAAS,CAAE4b,SAAU,O,0EAqBbC,G,8EACfhpB,KAAKmN,SAAS,CAAEF,WAAW,I,kBAEP1D,EAAQ/I,cAAcsB,IAAtB,UACbyH,EAAQ9D,eADK,wCACyCujB,GACzD,CACEzlB,aAAc,S,OAHZC,E,OAKNxD,KAAKmN,SAAS,CAAEL,YAAY,EAAOG,WAAW,EAAO8b,SAAUvlB,EAAIxB,O,uDAEnEC,QAAQC,MAAR,MACAD,QAAQC,OAAM,IAAI/C,OAAQgD,OAC1BnC,KAAKmN,SAAS,CAAEL,YAAY,EAAMG,WAAW,I,mBACtC,G,0JAKT,IAAMgP,EAAMhY,SAASkE,eACrB,QAAQ,OAAH8T,QAAG,IAAHA,OAAA,EAAAA,EAAK7T,aAAc,GAAK,GAAK6T,EAAK3T,WAAW,GAAG4T,WAAWxU,OAAS,EAChEuU,EAAK3T,WAAW,GAAG4T,WAEnB,K,gCAKT,IAAMla,EAAOhC,KAAKoJ,MAAM2f,SACpB7a,EAAOhJ,QAYX,OAXAlD,EAAK4L,SAAQ,SAACgZ,EAAgBzY,GAC5BD,EAAK5B,KACH,yBAAKtG,MAAO,CAAE+U,QAAS,aAAevR,IAAK,WAAa2E,GACtD,yBAAKpI,UAAU,aACb,yBAAKA,UAAU,yBAAyBC,MAAO,CAAE4J,MAAO,2BAA4B2Z,cAAe,QAAUC,wBAAyB,CAAEC,OAAQ7C,EAAK8C,gBACrJ,yBAAK3jB,UAAU,yBAAyByD,IAAK,gBAAkB2E,EAAOqb,wBAAyB,CAAEC,OAAQ7C,EAAK+C,cAM/Gzb,I,+BAIC,IAAD,OACP,OACE,kBAAC,IAAD,KACE,kBAAC,IAAD,KACE,kBAAC,IAAD,KACE,kBAAC,IAAD,CAAWa,OAAQ/O,KAAKuR,UAAWtC,KAAK,QAAQC,KAAK,QAAQX,QAAS,SAAArP,GAAC,OAAI,EAAKuM,MAAMY,QAAQ8C,WAC5F,kBAAC,IAAD,CAASC,KAAMC,IAAWH,KAAK,eAGjC,kBAAC,IAAD,CAAWA,KAAK,QAAQX,QAAS,SAAA/M,GAC/B,EAAKiK,MAAMY,QAAQC,KAAnB,4BAEA,0BAAMvG,UAAU,SAASC,MAAO,CAAE4J,MAAO,iBAAzC,6BAGF,kBAAC,IAAD,CAAWb,QAAS/O,KAAKoJ,MAAM0D,WAAYmC,KAAK,QAAQC,KAAK,MAAMX,QAAS,SAAArP,GAAC,OAAI,EAAKoqB,WAAW,EAAK7d,MAAMyB,MAAMG,OAAO2b,WACvH,kBAAC,IAAD,CAAS5Z,KAAMO,IAAeT,KAAK,eAGrC,kBAAC,IAAD,CAAWD,KAAK,QAAQC,KAAK,MAAMX,QAAS,SAAArP,GAC1C,EAAKuM,MAAMwC,SAAS,CAClBlF,KAAM,kBACNS,IAAK,iBACLC,IAAK,CACHyG,MAAM,EACNvH,KAAMwH,mBAAmBC,OAAOC,SAASlK,WAI7C,kBAAC,IAAD,CAASiJ,KAAMkB,IAAapB,KAAK,eAGnC,kBAAC,IAAD,CAAWD,KAAK,QAAQC,KAAK,MAAM2U,cAAe,SAAA3kB,GAGhD,EAAKmqB,6BAA+B,EAAKxS,qBAEzCtI,QAAS,SAAArP,GACP,EAAKiO,SAAS,CAAEkI,QAAS,CAAEnF,MAAM,EAAMpI,MAAO5I,EAAEqjB,iBAElD,kBAAC,IAAD,CAASC,IAAKC,IAAoBC,GAAIC,IAAkBzT,KAAK,eAG/D,kBAAC,IAAD,CACE1D,OAAQxL,KAAKoJ,MAAMiM,QAAQnF,KAC3BpI,MAAO9H,KAAKoJ,MAAMiM,QAAQvN,MAC1B0I,aAAc,SAAAtR,GACZ,EAAKmqB,6BAA+B,GACpC,EAAKlc,SAAS,CAAEkI,QAAS,CAAEnF,MAAM,EAAOpI,MAAO,UAGjD,kBAAC,IAAD,KACE,kBAAC,IAAD,CAASwG,QAAM,EAACC,QAAS,SAAArP,GACvB,EAAKuM,MAAMY,QAAQC,KAAnB,WAA4B,EAAKb,MAAMyB,MAAMG,OAAO2C,MACpD,EAAK7C,SAAS,CAAEkI,QAAS,CAAEnF,MAAM,EAAOpI,MAAO,UAE/C,yBAAK6G,SAAU,IACf,kBAAC,IAAD,CAASS,KAAMa,IAAMf,KAAK,UAC1B,kBAAC,IAAD,CAAUnJ,UAAU,wBAApB,uBAGF,kBAAC,IAAD,CAASuI,QAAM,EAACC,QAAS,SAAArP,GACvB,EAAKiO,SAAS,CAAEkI,QAAS,CAAEnF,MAAM,EAAOpI,MAAO,QAC/CyB,EAAQb,gBAAgB,EAAK2gB,8BAC7B,EAAKlc,SAAS,CAAEgI,WAAW,EAAMC,aAAa,2CAE9C,yBAAKzG,SAAU,IACf,kBAAC,IAAD,CAASS,KAAMwT,IAAM1T,KAAK,UAC1B,kBAAC,IAAD,CAAUnJ,UAAU,wBAApB,6BAGF,kBAAC,IAAD,CAASuI,QAAM,EAACC,QAAS,SAAArP,GACvB,EAAKiO,SAAS,CAAEkI,QAAS,CAAEnF,MAAM,EAAOpI,MAAO,QACL,KAAtC,EAAKuhB,6BAKT,EAAK5d,MAAMY,QAAQC,KAAK,CACtBkC,SAAS,sBAAD,OAAwB,EAAK6a,gCALrC,EAAKlc,SAAS,CAAEyH,yBAAyB,MAQ3C,yBAAKjG,SAAU,IACf,kBAAC,IAAD,CAASS,KAAM8D,IAAMhE,KAAK,UAC1B,kBAAC,IAAD,CAAUnJ,UAAU,wBAApB,uBAGF,kBAAC,IAAD,CAASuI,QAAM,EAACC,QAAS,SAAArP,GACvB,EAAKiO,SAAS,CAAEkI,QAAS,CAAEnF,MAAM,EAAOpI,MAAO,QACL,KAAtC,EAAKuhB,6BAKT,EAAK5d,MAAMY,QAAQC,KAAK,CACtBkC,SAAS,0BAAD,OAA4B,EAAK6a,gCALzC,EAAKlc,SAAS,CAAEyH,yBAAyB,MAQ3C,yBAAKjG,SAAU,IACf,kBAAC,IAAD,CAASS,KAAM8D,IAAMhE,KAAK,UAC1B,kBAAC,IAAD,CAAUnJ,UAAU,wBAApB,2BAMV,kBAAC,IAAD,KACE,kBAAC,IAAD,CAAcwiB,IAAKvoB,KAAKopB,aAAcrd,YAAY,0EAAmBK,MAAOpM,KAAKoJ,MAAM4f,QACrFY,QAAS,SAACpoB,GACR,IAAM4K,EAAQ5K,EAAG4E,OAAOgG,MACxB,EAAKe,SAAS,CAAE6b,QAAS5c,IACV,UAAX5K,EAAGgI,KACL,EAAKiC,MAAMY,QAAQC,KAAnB,6BAA8CF,OAQnDpM,KAAKoJ,MAAM0D,WACVvD,EAAQzD,kBACR,yBAAKE,MAAO,CAAE+U,QAAS,UACpB/a,KAAK8O,WAIV,yBAAK9I,MAAO,CAAEC,SAAU,sBAAuBsK,UAAW,WAAY,uBAAGpK,KAAK,kDAAkDC,OAAO,QAAjE,yCAEtE,kBAAC,IAAD,CACEmF,SAAS,SACTC,OAAQxL,KAAKoJ,MAAMwL,wBACnB4P,iBAAiB,EACjB7Y,OAAO,eACP8E,QAAQ,8IACRzE,QAAS,CACP,CACErD,KAAM,eACN4C,SAAU,iBACVW,QAAS,SAACE,GACR,EAAKe,SAAS,CACZyH,yBAAyB,SAOnC,kBAAC,IAAD,CACErJ,SAAS,SACTC,OAAQxL,KAAKoJ,MAAM6D,UACnBuD,aAAc,kBAAM,EAAKrD,SAAS,CAAEF,WAAW,KAC/CwD,QAAS,0BAGX,kBAAC,IAAD,CACElF,SAAS,SACTC,OAAQxL,KAAKoJ,MAAM+L,UACnB3E,aAAc,kBAAM,EAAKrD,SAAS,CAAEgI,WAAW,KAC/C1E,QAASzQ,KAAKoJ,MAAMgM,aACpBtD,SAAU,U,gCA/MlB,YAA2CxO,IAApCtD,KAAKyL,MAAMyB,MAAMG,OAAO2b,Y,GA5CLxc,IAAMC,WAmQ9Bod,GAAiB/Y,YAAiBqY,IASzBpY,gBAPS,SAAC3H,GACvB,MAAO,KAMM2H,CAEb8Y,IC3SWC,GAQT,WAAYjqB,GAAY,yBAPxBP,QAOuB,OANvByqB,eAMuB,OALvB3pB,UAKuB,OAJvBL,UAIuB,OAHvBD,WAGuB,OAFvB+oB,cAEuB,EACnB7oB,KAAKV,GAAKO,EAAKP,GACfU,KAAK+pB,UAAYlqB,EAAKkqB,UACtB/pB,KAAKI,KAAOP,EAAKO,KACjBJ,KAAKD,KAAOF,EAAKE,KACjBC,KAAKF,MAAQD,EAAKC,MAClBE,KAAK6oB,SAAWhpB,EAAKgpB,UCcvBC,G,kDACJ,WAAYrd,GAAa,IAAD,8BACtB,cAAMA,IAkBR0L,KAAO,EAnBiB,EAoBxBjJ,KAAO,GAlBL,EAAK9E,MAAQ,CACXsC,iBAAiB,EACjBqd,SAAU,GACViB,YAAY,EACZ/c,WAAW,EACXH,YAAY,GAPQ,E,4GAgBtB9M,KAAKyO,OAAOzO,KAAKyL,MAAMyB,MAAMG,OAAO2b,W,sEAKzBA,G,kFACXhpB,KAAKmN,SAAS,CAAEF,WAAW,I,SAEzBhL,QAAQ1B,IAAR,uBAA4BP,KAAKmX,O,SAEf5N,EAAQ/I,cAAcsB,IAAtB,oBAAuCknB,EAAvC,kBAAwDhpB,KAAKmX,KAA7D,iBAA0EnX,KAAKkO,MAAQ,CACvG3K,aAAc,gB,cADVC,E,OAGAxB,EAAOe,KAAKC,OAAM,IAAIU,aAAcE,OAAOJ,EAAIxB,OAAO8B,QACtDilB,EAAW/mB,EAAKtD,KAAI,SAACmB,GAAD,OAAU,IAAIiqB,GAAejqB,MAEvDG,KAAKmN,SAAS,CAAEL,YAAY,EAAOG,WAAW,EAAO8b,SAAS,GAAD,mBAAM/oB,KAAKoJ,MAAM2f,UAAjB,YAA8BA,IACzFiB,WAAYjB,EAASrhB,SAAW1H,KAAKkO,OAGvClO,KAAKmX,MAAQ,E,mBACN,G,yCAEPlV,QAAQC,MAAR,MACAD,QAAQC,OAAM,IAAI/C,OAAQgD,OAC1BnC,KAAKmN,SAAS,CAAEL,YAAY,EAAMG,WAAW,EAAO+c,YAAY,I,mBACzD,G,iJAQA,IAAD,OACJ9b,EAAOhJ,QAmBX,OAlBkBlF,KAAKoJ,MAAc2f,SAC5Bnb,SAAQ,SAACa,EAAQ/D,GACxB,IAAIS,EAAK,UAAMsD,EAAO3O,MAAb,iBAAsB2O,EAAO1O,KAA7B,0BAAyC0O,EAAOoa,UACrDza,EAAS,wBAAoBK,EAAOrO,KAA3B,YAAmCqO,EAAO1O,MACvDmO,EAAK5B,KACH,kBAAC,IAAD,CAAS9C,IAAK,cAAgBkB,EAAG4D,QAAQ,EAAMC,QAAO,uCAAE,WAAMzG,GAAN,SAAA7G,EAAA,sDACtD6G,EAAMC,iBACN,EAAK0D,MAAMY,QAAQC,KAAK,CACtBkC,SAAUJ,IAH0C,2CAAF,uDAMpD,yBAAKO,SAAU,IACf,kBAAC,IAAD,CAAU5I,UAAU,uBAAuByD,IAAK,eAAiBkB,GAC9DS,QAKF+C,I,+BAGC,IAAD,OACHA,EAAOlO,KAAK8O,UAChB,OACE,kBAAC,IAAD,KACE,kBAAC,IAAD,KACE,kBAAC,IAAD,KACE,kBAAC,IAAD,CAAU9I,MAAO,CAAEC,SAAU,wBAA7B,8BAA8DjG,KAAKyL,MAAMyB,MAAMG,OAAO2b,SACtF,kBAAC,IAAD,CAAWja,OAAQ/O,KAAKuR,UAAWtC,KAAK,QAAQC,KAAK,QAAQX,QAAS,SAAArP,GAAC,OAAI,EAAKuM,MAAMY,QAAQ8C,WAC5F,kBAAC,IAAD,CAASC,KAAMC,IAAWH,KAAK,eAGjC,kBAAC,IAAD,CAAWH,QAAS/O,KAAKoJ,MAAM0D,WAAYmC,KAAK,QAAQC,KAAK,MAAMX,QAAS,SAAArP,GAAC,OAAI,EAAKuP,OAAO,EAAKhD,MAAMyB,MAAMG,OAAO2b,WACnH,kBAAC,IAAD,CAAS5Z,KAAMO,IAAeT,KAAK,eAGrC,kBAAC,IAAD,CAAWD,KAAK,QAAQC,KAAK,MAAMX,QAAS,SAAArP,GAAC,OAAI,EAAKuM,MAAMY,QAAQC,KAAnB,WAA4B,EAAKb,MAAMyB,MAAMG,OAAO2C,QACnG,kBAAC,IAAD,CAASZ,KAAMa,IAAMf,KAAK,eAG5B,kBAAC,IAAD,CAAWD,KAAK,QAAQC,KAAK,MAAMX,QAAS,SAAArP,GAAC,OAAI,EAAKiO,SAAS,CAAEzB,iBAAiB,MAChF,kBAAC,IAAD,CAAS0D,KAAMX,IAAQS,KAAK,eAG9B,kBAAC,IAAD,CAAWD,KAAK,QAAQC,KAAK,MAAMX,QAAS,SAAArP,GAC1C,EAAKuM,MAAMwC,SAAS,CAClBlF,KAAM,kBACNS,IAAK,iBACLC,IAAK,CACHyG,MAAM,EACNvH,KAAMwH,mBAAmBC,OAAOC,SAASlK,WAI7C,kBAAC,IAAD,CAASiJ,KAAMkB,IAAapB,KAAK,iBAIvC,kBAAC,IAAD,KAEIlP,KAAKoJ,MAAM0D,WACTvD,EAAQzD,kBACR,kBAAC,IAAD,KACGoI,EACD,kBAAC,IAAD,CAAmB+b,UAAU,QAC3BzB,UAAWxoB,KAAKoJ,MAAM4gB,WACtBE,cAAe,SAAC1oB,GACd,EAAKiN,OAAO,EAAKhD,MAAMyB,MAAMG,OAAO2b,SACnCxnB,EAAG4E,OAAwC4hB,aAE9C,kBAAC,IAAD,CACEmC,YAAY,4BAMtB,kBAAC,IAAD,CACE5e,SAAS,SACTC,OAAQxL,KAAKoJ,MAAM6D,UACnBuD,aAAc,kBAAM,EAAKrD,SAAS,CAAEF,WAAW,KAC/CwD,QAAS,0BAGX,kBAAC,EAAD,aAEI/E,gBAAkB1L,KAAKoJ,MAAcsC,gBACrCS,OAAQ,WAAQ,EAAKgB,SAAS,CAAEzB,iBAAiB,MAAe1L,KAAKyL,Y,gCA5F/E,MAAgC,aAAzBzL,KAAKyL,MAAMyB,MAAMP,Q,GAhDFH,IAAMC,WAqJ1Byc,GAAapY,YAAiBgY,IASrB/X,gBAPS,SAAC3H,GACvB,MAAO,KAMM2H,CAEbmY,I,UCjIakB,G,6KArCX9jB,UAAUsC,WAAatC,UAAUsC,UAAUC,UAAU7I,KAAKyL,MAAM9C,MAChE,IAAM0hB,EAAYpmB,SAASqY,eAAe,aAE1C,OADAgO,YAAgBD,EAAWrqB,KAAKyL,MAAM9C,MAC/B0hB,I,+BAGC,IAAD,OACP,OACE,kBAAC,IAAD,CACE7e,OAAQxL,KAAKyL,MAAM8e,UACnBhf,SAAS,SACTif,cAAc,EAEdC,cAAe,kBAAM,EAAKC,gBAC1Bla,aAAc,kBAAM,EAAK/E,MAAMU,WAC/B,kBAAC,IAAD,KACE,yBAAKnG,MAAO,CAAC+U,QAAS,OAAQqM,cAAe,SAAUlN,OAAQ,OAAQyQ,WAAY,WACjF,6BACE,kBAAC,IAAD,CAAU5kB,UAAU,UAApB,gFAEF,6BACE,kBAAC,IAAD,CAAUA,UAAU,UAApB,uDAEF,yBAAKC,MAAO,CAAC4kB,SAAU,EAAG7P,QAAS,OAAQ4P,WAAY,WACrD,4BAAQrrB,GAAG,YAAY2a,MAAM,MAAMC,OAAO,MAAMlU,MAAO,CAAC6kB,OAAQ,eAElE,6BACE,kBAAC,IAAD,CAAW/E,KAAK,QAAQvX,QAAS,kBAAM,EAAK9C,MAAMU,WAAlD,wB,GAjCgBK,IAAMC,Y,SRhBxBsG,K,cAAAA,E,eAAAA,Q,KAKL,ISyBD+X,G,kDAEJ,WAAYrf,GAAa,IAAD,8BACtB,cAAMA,IAFR2d,kBACwB,IAiFxBC,6BAA+B,GA/E7B,EAAKjgB,MAAQ,CACX4f,QAAS,GACTva,OAAQ,KACRmG,yBAAyB,EACzBS,QAAS,CACPnF,MAAM,EACNpI,MAAO,MAETmF,WAAW,EACXH,YAAY,EACZqI,WAAW,EACXC,aAAc,IAEhB,EAAKgU,aAAe5c,IAAMub,YAfJ,E,+DAsBlB/nB,KAAKyL,MAAMyB,MAAMG,OAAO2b,UAC1BhpB,KAAKmN,SAAS,CAAE6b,QAAShpB,KAAKyL,MAAMyB,MAAMG,OAAO2b,UACjDhpB,KAAKspB,WAAWtpB,KAAKyL,MAAMyB,MAAMG,OAAO2b,Y,mKAe3BA,G,8EACfhpB,KAAKmN,SAAS,CAAEF,WAAW,I,kBAEP1D,EAAQ/I,cAAcsB,IAAtB,qCACcknB,EAAQjH,UAAU,EAAG,IACnD,CACExe,aAAc,S,OAHZC,E,OAKNxD,KAAKmN,SAAS,CAAEL,YAAY,EAAOG,WAAW,EAAOwB,OAAQjL,EAAIxB,KAAK+oB,a,uDAEtE9oB,QAAQC,MAAR,MACAD,QAAQC,OAAM,IAAI/C,OAAQgD,OAC1BnC,KAAKmN,SAAS,CAAEL,YAAY,EAAMG,WAAW,I,mBACtC,G,0JAKT,IAAMgP,EAAMhY,SAASkE,eACrB,QAAQ,OAAH8T,QAAG,IAAHA,OAAA,EAAAA,EAAK7T,aAAc,GAAK,GAAK6T,EAAK3T,WAAW,GAAG4T,WAAWxU,OAAS,EAChEuU,EAAK3T,WAAW,GAAG4T,WAEnB,K,gCAID8O,EAA0ClrB,GAClD,YAAgBwD,IAAT0nB,GAAsBA,EAAKtjB,OAAS,EAAI,oCAC7C,yBAAK8B,IAAKnG,OAAW2C,MAAO,CAAE4J,MAAO,6BAA+B9P,GACpE,wBAAI0J,IAAKnG,QAAT,OACE2nB,QADF,IACEA,OADF,EACEA,EAAMtsB,KAAI,SAACusB,GAAD,iBACR,wBAAIzhB,IAAKnG,QACP,yBAAKmG,IAAKnG,QAAY4nB,EAAEC,KAD1B,UAEGD,EAAEE,aAFL,aAEG,EAASzsB,KAAI,SAAC0sB,GAAD,OAAO,yBAAK5hB,IAAKnG,QAAY+nB,MAF7C,UAGGH,EAAEI,eAHL,aAGG,EAAW3sB,KAAI,SAACQ,GAAD,OAAO,yBAAKsK,IAAKnG,QAAYnE,MAH/C,UAIG+rB,EAAEK,YAJL,aAIG,EAAQ5sB,KAAI,SAAC6sB,GAAD,OAAO,yBAAK/hB,IAAKnG,QAAYkoB,YAI5C,uC,+BAIE,IAE6B,EAF9B,OACHC,EAAgB,GAChBxrB,KAAKyL,MAAMyB,MAAMG,OAAO2b,UAC1B,UAAAhpB,KAAKoJ,MAAMqF,cAAX,SAAmBb,SAAQ,SAAC5L,GAC1B,IAAMypB,EAAK,OAAGzpB,QAAH,IAAGA,OAAH,EAAGA,EAAM0pB,YAAYtM,QAAO,SAAC6L,GAAD,OAAOA,EAAEliB,OAASgK,GAAS4Y,QAC5DC,EAAK,OAAG5pB,QAAH,IAAGA,OAAH,EAAGA,EAAM0pB,YAAYtM,QAAO,SAAC6L,GAAD,OAAOA,EAAEliB,OAASgK,GAAS8Y,QAC5DC,EAAM,OAAG9pB,QAAH,IAAGA,OAAH,EAAGA,EAAM0pB,YAAYtM,QAAO,SAAC6L,GAAD,YAAkB3nB,IAAX2nB,EAAEliB,QAE3CgjB,EAAY,EAAKC,UAAUP,EAAO,gBAClCQ,EAAY,EAAKD,UAAUJ,EAAO,gBAClCM,EAAa,EAAKF,UAAUF,EAAQ,IAE1CN,EAASlf,KACP,yBAAK9C,IAAKnG,OAAW0C,UAAU,2BAC7B,yBAAKyD,IAAKnG,OAAW0C,UAAU,cAAc,EAAK0F,MAAMyB,MAAMG,OAAO2b,QAAQjH,UAAU,EAAG,KACrF,OAAJ/f,QAAI,IAAJA,OAAA,EAAAA,EAAMmqB,UAAW,yDAASnqB,QAAT,IAASA,OAAT,EAASA,EAAMmqB,UAAkB,MAC9C,OAAJnqB,QAAI,IAAJA,OAAA,EAAAA,EAAMoqB,QAAS,yDAASpqB,QAAT,IAASA,OAAT,EAASA,EAAMoqB,QAAgB,KAC9CL,EACAE,EACAC,QAKT,OACE,kBAAC,IAAD,KACE,kBAAC,IAAD,KACE,kBAAC,IAAD,KACE,kBAAC,IAAD,CAAWjd,KAAK,QAAQC,KAAK,QAAQX,QAAS,SAAArP,GAAC,OAAI,EAAKuM,MAAMY,QAAQ8C,WACpE,kBAAC,IAAD,CAASC,KAAMC,IAAWH,KAAK,eAGjC,kBAAC,IAAD,CAAWA,KAAK,QAAQX,QAAS,SAAA/M,GAC/B,EAAKiK,MAAMY,QAAQC,KAAnB,wBAEA,0BAAMvG,UAAU,SAASC,MAAO,CAAE4J,MAAO,iBAAzC,6BAGF,kBAAC,IAAD,CAAWb,QAAS/O,KAAKoJ,MAAM0D,WAAYmC,KAAK,QAAQC,KAAK,MAAMX,QAAS,SAAArP,GAAC,OAAI,EAAKoqB,WAAW,EAAK7d,MAAMyB,MAAMG,OAAO2b,WACvH,kBAAC,IAAD,CAAS5Z,KAAMO,IAAeT,KAAK,eAGrC,kBAAC,IAAD,CAAWD,KAAK,QAAQC,KAAK,MAAMX,QAAS,SAAArP,GAC1C,EAAKuM,MAAMwC,SAAS,CAClBlF,KAAM,kBACNS,IAAK,iBACLC,IAAK,CACHyG,MAAM,EACNvH,KAAMwH,mBAAmBC,OAAOC,SAASlK,WAI7C,kBAAC,IAAD,CAASiJ,KAAMkB,IAAapB,KAAK,eAGnC,kBAAC,IAAD,CAAWD,KAAK,QAAQC,KAAK,MAAM2U,cAAe,SAAA3kB,GAGhD,EAAKmqB,6BAA+B,EAAKxS,qBAEzCtI,QAAS,SAAArP,GACP,EAAKiO,SAAS,CAAEkI,QAAS,CAAEnF,MAAM,EAAMpI,MAAO5I,EAAEqjB,iBAElD,kBAAC,IAAD,CAASC,IAAKC,IAAoBC,GAAIC,IAAkBzT,KAAK,eAG/D,kBAAC,IAAD,CACE1D,OAAQxL,KAAKoJ,MAAMiM,QAAQnF,KAC3BpI,MAAO9H,KAAKoJ,MAAMiM,QAAQvN,MAC1B0I,aAAc,SAAAtR,GACZ,EAAKiO,SAAS,CAAEkI,QAAS,CAAEnF,MAAM,EAAOpI,MAAO,QAC/C,EAAKuhB,6BAA+B,KAGtC,kBAAC,IAAD,KACE,kBAAC,IAAD,CAAS/a,QAAM,EAACC,QAAS,SAAArP,GACvB,EAAKuM,MAAMY,QAAQC,KAAnB,WAA4B,EAAKb,MAAMyB,MAAMG,OAAO2C,MACpD,EAAK7C,SAAS,CAAEkI,QAAS,CAAEnF,MAAM,EAAOpI,MAAO,UAE/C,yBAAK6G,SAAU,IACf,kBAAC,IAAD,CAASS,KAAMa,IAAMf,KAAK,UAC1B,kBAAC,IAAD,CAAUnJ,UAAU,wBAApB,uBAGF,kBAAC,IAAD,CAASuI,QAAM,EAACC,QAAS,SAAArP,GACvB,EAAKiO,SAAS,CAAEkI,QAAS,CAAEnF,MAAM,EAAOpI,MAAO,QAC/CyB,EAAQb,gBAAgB,EAAK2gB,8BAC7B,EAAKlc,SAAS,CAAEgI,WAAW,EAAMC,aAAa,2CAE9C,yBAAKzG,SAAU,IACf,kBAAC,IAAD,CAASS,KAAMwT,IAAM1T,KAAK,UAC1B,kBAAC,IAAD,CAAUnJ,UAAU,wBAApB,6BAGF,kBAAC,IAAD,CAASuI,QAAM,EAACC,QAAS,SAAArP,GACvB,EAAKiO,SAAS,CAAEkI,QAAS,CAAEnF,MAAM,EAAOpI,MAAO,QACL,KAAtC,EAAKuhB,6BAKT,EAAK5d,MAAMY,QAAQC,KAAnB,6BAA8C,EAAK+c,+BAJjD,EAAKlc,SAAS,CAAEyH,yBAAyB,MAM3C,yBAAKjG,SAAU,IACf,kBAAC,IAAD,CAASS,KAAM8D,IAAMhE,KAAK,UAC1B,kBAAC,IAAD,CAAUnJ,UAAU,wBAApB,uBAGF,kBAAC,IAAD,CAASuI,QAAM,EAACC,QAAS,SAAArP,GACvB,EAAKiO,SAAS,CAAEkI,QAAS,CAAEnF,MAAM,EAAOpI,MAAO,QACL,KAAtC,EAAKuhB,6BAKT,EAAK5d,MAAMY,QAAQC,KAAK,CACtBkC,SAAS,0BAAD,OAA4B,EAAK6a,gCALzC,EAAKlc,SAAS,CAAEyH,yBAAyB,MAQ3C,yBAAKjG,SAAU,IACf,kBAAC,IAAD,CAASS,KAAM8D,IAAMhE,KAAK,UAC1B,kBAAC,IAAD,CAAUnJ,UAAU,wBAApB,2BAMV,kBAAC,IAAD,KACE,kBAAC,IAAD,CAAcwiB,IAAKvoB,KAAKopB,aAAcrd,YAAY,oEAAkBK,MAAOpM,KAAKoJ,MAAM4f,QACpFY,QAAS,SAACpoB,GACR,IAAM4K,EAAQ5K,EAAG4E,OAAOgG,MACxB,EAAKe,SAAS,CAAE6b,QAAS5c,IACV,UAAX5K,EAAGgI,KACL,EAAKiC,MAAMY,QAAQC,KAAnB,iCAAkDF,OAQvDpM,KAAKoJ,MAAM0D,WAAavD,EAAQzD,kBAAoB0lB,EAMrD,kBAAC,IAAD,CACEjgB,SAAS,SACTC,OAAQxL,KAAKoJ,MAAMwL,wBACnB4P,iBAAiB,EACjB7Y,OAAO,eACP8E,QAAQ,8IACRzE,QAAS,CACP,CACErD,KAAM,eACN4C,SAAU,iBACVW,QAAS,SAACE,GACR,EAAKe,SAAS,CACZyH,yBAAyB,SAOnC,kBAAC,IAAD,CACErJ,SAAS,SACTC,OAAQxL,KAAKoJ,MAAM6D,UACnBuD,aAAc,kBAAM,EAAKrD,SAAS,CAAEF,WAAW,KAC/CwD,QAAS,0BAGX,kBAAC,IAAD,CACElF,SAAS,SACTC,OAAQxL,KAAKoJ,MAAM+L,UACnB3E,aAAc,kBAAM,EAAKrD,SAAS,CAAEgI,WAAW,KAC/C1E,QAASzQ,KAAKoJ,MAAMgM,aACpBtD,SAAU,U,gCAhOlB,OAAO9R,KAAKyL,MAAMyB,MAAMP,MAAjB,WAA6B3M,KAAKyL,MAAMyB,MAAMG,OAAO2C,S,GAtC9BxD,IAAMC,WA8QlC4f,GAAqBvb,YAAiBga,IAS7B/Z,gBAPS,SAAC3H,GACvB,MAAO,KAMM2H,CAEbsb,ICvQEC,GCnCW,WACX,IAAIC,EAAmB5pB,aAAaC,QAAQ2G,EAAQ1E,WAQpD,OAPwB,MAApB0nB,EACaC,YAAYC,EAAS1pB,KAAKC,MAAMupB,IAGhCC,YAAYC,GD6BrBC,GAgBNtjB,GAAQkjB,GAAMK,WAEfvjB,GAAMnG,SAASgjB,WAClB1c,EAAQjE,gBAGVsnB,YAAY,CACVC,KAAM,KACNC,kBAAkB,IAGb,IAAIC,GAAuB,CAChCC,UAAW,SAAUC,KACrBC,SAAU,SAAUD,MAqBhBE,G,uKAEF,OACE,kBAAC,IAAD,CAAUb,MAAOA,IACf,kBAACc,GAAYptB,KAAKyL,Y,GAJPe,IAAMC,WAUnB4gB,G,kDAGJ,WAAY5hB,GAAa,IAAD,8BACtB,cAAMA,IAHR6hB,qBAEwB,IA0ExBC,cA1EwB,EAEtB,EAAKD,gBAAkB,KAGnBnmB,YAAW,WACbiJ,OAAOqL,cAAgBlS,EAAQ1B,4BACtBV,YAAW,SACpBlD,SAASyX,WAAanS,EAAQtB,wBAAwBvD,KAAK0L,SAE7DnM,SAASG,KAAK6iB,UAAUrZ,SAAQ,SAACnE,GAAD,OAASxF,SAASG,KAAK6iB,UAAUT,OAAO/c,MACxExF,SAASG,KAAK6iB,UAAUC,OAAxB,eAAuC9d,GAAMnG,SAAS+jB,QAAS,GAC/D/iB,SAASG,KAAK6iB,UAAUC,OAAxB,eAAuC9d,GAAMnG,SAASskB,aAAc,GACpEhe,EAAQ3C,cAAcwC,GAAMnG,UAE5B,EAAKmG,MAAQ,CACXokB,iBAAiB,GAGnBT,GAAqBG,SAAW,SAACD,GAC/B,EAAKK,gBAAkBL,EACvB,EAAK9f,SAAS,CAAEqgB,iBAAiB,KAGnCT,GAAqBC,UAAY,SAACC,KAIlC/W,gBAAgBuL,YAChBvL,gBAAgBc,SAEhB,EAAKyW,iBACL,EAAKzb,gBAhCiB,E,uLAoChB9Q,EAAYC,UAAUC,KAAKmI,EAAQhE,WAC/BmoB,gBAAkB,SAAU5lB,GAC1BA,EAAM1B,OAAe1E,OAC5BisB,kBAAkB,U,SAIjB,IAAI5uB,SAAQ,SAACsC,EAAIC,GACrBJ,EAAUK,UAAV,uCAAsB,WAAOC,GAAP,mBAAAP,EAAA,sDACdQ,EAAKP,EAAUQ,OAEfC,EAAQF,EAAGG,YAAY,CAAC,SAAU,cACpChD,EAAM+C,EAAME,YAAY,SAASC,IAAIyH,EAAQ7D,eAC7CnE,UAAJ,uCAAgB,WAAOQ,GAAP,iBAAAd,EAAA,yDACdgR,EAAWrT,EAAI8C,OADD,gCAGM6H,EAAQ/I,cAAcsB,IAAtB,UAA6BsO,OAAOC,SAASmG,OAA7C,YAAuDjN,EAAQ5D,eAAiB,CAChGpC,aAAc,cACd3C,QAAS,IALC,OAGN4C,EAHM,OAONpB,EAAaX,EAAGG,YAAY,CAAC,SAAU,aAC7CqQ,EAAWzO,EAAIxB,KACEI,EAAWP,YAAY,SAASQ,IAAI4P,EAAU1I,EAAQ7D,cAC9DnE,UAAY,SAACQ,GACpB,OAAOV,KAXG,gCAcPA,KAdO,4CAAhB,sDALoB,2CAAtB,yD,cAuBI6Q,EAAW,IAAK9B,OAAe+B,SAAS,MAAOF,G,SAC/CC,EAASE,O,OACdnO,SAAiBoO,MAAMC,IAAIJ,GAC5BjQ,QAAQ1B,IAAI,uC,yQAQO+C,KADXiqB,EAAYjnB,UAAkBinB,U,gCAEZA,EAASK,QAAQ,U,OAAvC5tB,KAAKutB,S,OACLtrB,QAAQ1B,IAAI,iC,uDAId0B,QAAQC,MAAR,UAAiB,KAAI4J,KAArB,aAA8B,KAAI2E,UAClCxO,QAAQC,OAAM,IAAI/C,OAAQgD,O,0JAa5BF,QAAQ1B,IAAI6P,OAAOC,SAAS5B,QAC5B,IAAMof,EAAe,gBAAgB1K,KAAK/S,OAAOC,SAAS5B,QACpDqf,EAAe,gBAAgB3K,KAAK/S,OAAOC,SAAS5B,QAC1D,GAAqB,OAAjBof,EAAuB,CACzB,IAAIE,EAAQ,GAIZ,OAHqB,OAAjBD,IACFC,EAAQ5d,mBAAmB2d,EAAa,KAEnC,kBAAC,IAAD,CAAUE,GAAIH,EAAa,GAAKE,IAClC,GAAiC,MAA7B3d,OAAOC,SAAS7B,SACzB,OAAO,kBAAC,IAAD,CAAUwf,GAAG,iB,+BAId,IAAD,WACP,OACE,kBAAC,IAAD,CAAQhoB,MAENuD,EAAQrC,gBAAkB,CAAEgT,OAAO,GAAD,OAAK9J,OAAO6d,YAAZ,OAAgC,IAElE,kBAAC,IAAD,KACE,kBAAC,IAAD,KACE,kBAAC,IAAD,CAAiBC,UAAU,GAEzB,kBAAC,IAAD,CAAO5gB,KAAK,4CAA4C6gB,OAAQ,SAAC1iB,GAAD,OAAgB,kBAAC,GAAiBA,IAAW2iB,OAAO,IACpH,kBAAC,IAAD,CAAO9gB,KAAK,mCAAmC6gB,OAAQ,SAAC1iB,GAAD,OAAgB,kBAAC,GAAiBA,IAAW2iB,OAAO,IAE3G,kBAAC,IAAD,CAAO9gB,KAAK,mCAAmC6gB,OAAQ,SAAC1iB,GAAD,OAAgB,kBAAC,GAAaA,IAAW2iB,OAAO,IACvG,kBAAC,IAAD,CAAO9gB,KAAK,4BAA4B6gB,OAAQ,SAAC1iB,GAAD,OAAgB,kBAAC,GAAaA,IAAW2iB,OAAO,IAChG,kBAAC,IAAD,CAAO9gB,KAAK,iCAAiC6gB,OAAQ,SAAA1iB,GAAK,OAAI,kBAAC,GAAeA,IAAW2iB,OAAO,IAChG,kBAAC,IAAD,CAAO9gB,KAAK,yCAAyC6gB,OAAQ,SAAA1iB,GAAK,OAAI,kBAAC4iB,GAAuB5iB,IAAW2iB,OAAO,IAEhH,kBAAC,IAAD,CAAO9gB,KAAK,sCAAsC6gB,OAAQ,SAAC1iB,GAAD,OAAgB,kBAAC,EAAgBA,IAAW2iB,OAAO,IAC7G,kBAAC,IAAD,CAAO9gB,KAAK,uDAAuD6gB,OAAQ,SAAC1iB,GAAD,OAAgB,kBAAC,EAAgBA,IAAW2iB,OAAO,IAC9H,kBAAC,IAAD,CAAO9gB,KAAK,mBAAmB6gB,OAAQ,SAAC1iB,GAAD,OAAgB,kBAAC,GAAiBA,IAAW2iB,OAAO,IAC3F,kBAAC,IAAD,CAAO9gB,KAAI,qCAAwC6gB,OAAQ,SAAC1iB,GAAD,OAAgB,kBAAC,GAAmBA,IAAW2iB,OAAO,IACjH,kBAAC,IAAD,CAAO9gB,KAAI,yCAA4C6gB,OAAQ,SAAC1iB,GAAD,OAAgB,kBAAC,GAAuBA,IAAW2iB,OAAO,IACzH,kBAAC,IAAD,CAAO9gB,KAAK,YAAY6gB,OAAQ,SAAC1iB,GAAD,OAAgB,kBAAC,GAAiBA,MAClE,kBAAC,IAAD,CAAO6B,KAAK,IAAI6gB,OAAQ,WAAQ,OAAO,EAAKG,sBAAyBF,OAAO,KAE9E,kBAAC,IAAD,CAAWlf,KAAK,UACd,kBAAC,IAAD,CAAcc,IAAI,YAAY7J,KAAK,cACjC,kBAAC,IAAD,CAASiJ,KAAMlM,OAEjB,kBAAC,IAAD,CAAc8M,IAAI,UAAU7J,KAAK,YAC/B,kBAAC,IAAD,CAASiJ,KAAMmf,OAEjB,kBAAC,IAAD,CAAcve,IAAI,YAAY7J,KAAK,sBACjC,kBAAC,IAAD,CAASiJ,KAAM8D,OAEjB,kBAAC,IAAD,CAAclD,IAAI,WAAW7J,KAAK,aAChC,kBAAC,IAAD,CAASiJ,KAAMnM,UAKvB,kBAAC,IAAD,CACEsI,SAAS,SACTC,OAAQxL,KAAKoJ,MAAMokB,gBACnBhJ,iBAAiB,EACjBgK,aAAc,SAAChtB,GAAQ,IAAD,QAGpB,YAAK8rB,uBAAL,mBAAsBmB,kBAAtB,SAAkCC,YAAY,CAAE3lB,KAAM,iBACtD,YAAKukB,uBAAL,mBAAsBqB,eAAtB,SAA+BD,YAAY,CAAE3lB,KAAM,kBAErD4C,OAAQ,4NACRK,QAAS,CACP,CACErD,KAAM,eACN4C,SAAU,iBACVW,QAAS,SAACE,GACR,EAAKe,SAAS,CACZqgB,iBAAiB,MAIvB,CACE7kB,KAAM,uCACN4C,SAAU,mBACVW,QAAS,SAACE,GACRgE,OAAOhP,KAAK,qDAMpB,kBAAC,GAAD,aAEIuH,KAAI,UAAE3I,KAAKyL,MAAMmjB,sBAAb,aAAE,EAA2BjmB,KACjC4hB,WAAW,UAAAvqB,KAAKyL,MAAMmjB,sBAAX,eAA2B1e,QAAQ,EAC9C/D,OAAQ,WACNmgB,GAAMre,SAAS,CACblF,KAAM,kBACNS,IAAK,iBACLC,IAAK,CAAEyG,MAAM,OAEXlQ,KAAKyL,a,GAtMAe,IAAMC,WAoNvB2gB,GAAUrc,aANQ,SAAC3H,GACvB,MAAO,CACLwlB,eAAgBxlB,EAAMyB,YAAY+jB,kBAItB7d,CAEdsc,IAKawB,GAFHC,YAAW3B,IEzTjB4B,GAAcC,QACW,cAA7B5e,OAAOC,SAAS4e,UAEe,UAA7B7e,OAAOC,SAAS4e,UAEhB7e,OAAOC,SAAS4e,SAAS/hB,MACvB,2DA8CN,SAASgiB,GAAgBC,EAAeC,GACtC9oB,UAAUC,cACP8oB,SAASF,GACTlwB,MAAK,SAAAguB,GAQJA,EAAaqC,cAAgB,WAE3B,IAAMC,EAAmBtC,EAAawB,WACd,MAApBc,IAGJA,EAAiBC,cAAgB,WAC/BvtB,QAAQ1B,IAAR,0CAA+CgvB,EAAiBnmB,QACjC,cAA3BmmB,EAAiBnmB,QACf9C,UAAUC,cAAckpB,YAI1BxtB,QAAQ1B,IACN,iHAKE6uB,GAAUA,EAAOlC,UACnBkC,EAAOlC,SAASD,KAMlBhrB,QAAQ1B,IAAI,sCAGR6uB,GAAUA,EAAOpC,WACnBoC,EAAOpC,UAAUC,WAO5ByC,OAAM,SAAAxtB,GACLD,QAAQC,MAAM,4CAA6CA,MCzGjEqH,EAAQtE,eAER0qB,IAASxB,OAAO,kBAAC,IAAD,KAAe,kBAAC,GAAD,OAAyBlqB,SAASqY,eAAe,SDiBzE,SAAkB8S,GACvB,GAA6C,kBAAmB9oB,UAAW,CAMzE,GAJkB,IAAIspB,IACpBC,GACAzf,OAAOC,SAASlK,MAEJqQ,SAAWpG,OAAOC,SAASmG,OAIvC,OAGFpG,OAAOgG,iBAAiB,QAAQ,WAC9B,IAAM+Y,EAAK,UAAMU,GAAN,sBAEPd,KAyEV,SAAiCI,EAAeC,GAE9CU,MAAMX,EAAO,CACXY,QAAS,CAAE,iBAAkB,YAE5B9wB,MAAK,SAAA+wB,GAEJ,IAAMC,EAAcD,EAASD,QAAQjuB,IAAI,gBAEnB,MAApBkuB,EAASE,QACO,MAAfD,IAA8D,IAAvCA,EAAYzP,QAAQ,cAG5Cla,UAAUC,cAAc4pB,MAAMlxB,MAAK,SAAAguB,GACjCA,EAAamD,aAAanxB,MAAK,WAC7BmR,OAAOC,SAASggB,eAKpBnB,GAAgBC,EAAOC,MAG1BM,OAAM,WACLztB,QAAQ1B,IACN,oEAhGA+vB,CAAwBnB,EAAOC,GAI/B9oB,UAAUC,cAAc4pB,MAAMlxB,MAAK,WACjCgD,QAAQ1B,IACN,iHAMJ2uB,GAAgBC,EAAOC,OC3C/B7oB,CAAuB,CACnBymB,UAAW,SAACC,GAA8ChrB,QAAQ1B,IAAI,wBAAyBwsB,GAAqBC,UAAUC,IAC9HC,SAAU,SAACD,GAA8ChrB,QAAQ1B,IAAI,sBAAuBwsB,GAAqBG,SAASD,Q","file":"static/js/main.9f3fb2a4.chunk.js","sourcesContent":["var map = {\n\t\"./ion-action-sheet.entry.js\": [\n\t\t432,\n\t\t5\n\t],\n\t\"./ion-alert.entry.js\": [\n\t\t433,\n\t\t6\n\t],\n\t\"./ion-app_8.entry.js\": [\n\t\t434,\n\t\t7\n\t],\n\t\"./ion-avatar_3.entry.js\": [\n\t\t435,\n\t\t17\n\t],\n\t\"./ion-back-button.entry.js\": [\n\t\t436,\n\t\t18\n\t],\n\t\"./ion-backdrop.entry.js\": [\n\t\t437,\n\t\t43\n\t],\n\t\"./ion-button_2.entry.js\": [\n\t\t438,\n\t\t19\n\t],\n\t\"./ion-card_5.entry.js\": [\n\t\t439,\n\t\t20\n\t],\n\t\"./ion-checkbox.entry.js\": [\n\t\t440,\n\t\t21\n\t],\n\t\"./ion-chip.entry.js\": [\n\t\t441,\n\t\t22\n\t],\n\t\"./ion-col_3.entry.js\": [\n\t\t442,\n\t\t44\n\t],\n\t\"./ion-datetime_3.entry.js\": [\n\t\t443,\n\t\t10\n\t],\n\t\"./ion-fab_3.entry.js\": [\n\t\t444,\n\t\t23\n\t],\n\t\"./ion-img.entry.js\": [\n\t\t445,\n\t\t45\n\t],\n\t\"./ion-infinite-scroll_2.entry.js\": [\n\t\t446,\n\t\t46\n\t],\n\t\"./ion-input.entry.js\": [\n\t\t447,\n\t\t24\n\t],\n\t\"./ion-item-option_3.entry.js\": [\n\t\t448,\n\t\t25\n\t],\n\t\"./ion-item_8.entry.js\": [\n\t\t449,\n\t\t26\n\t],\n\t\"./ion-loading.entry.js\": [\n\t\t450,\n\t\t27\n\t],\n\t\"./ion-menu_3.entry.js\": [\n\t\t451,\n\t\t28\n\t],\n\t\"./ion-modal.entry.js\": [\n\t\t452,\n\t\t8\n\t],\n\t\"./ion-nav_2.entry.js\": [\n\t\t453,\n\t\t14\n\t],\n\t\"./ion-popover.entry.js\": [\n\t\t454,\n\t\t9\n\t],\n\t\"./ion-progress-bar.entry.js\": [\n\t\t455,\n\t\t29\n\t],\n\t\"./ion-radio_2.entry.js\": [\n\t\t456,\n\t\t30\n\t],\n\t\"./ion-range.entry.js\": [\n\t\t457,\n\t\t31\n\t],\n\t\"./ion-refresher_2.entry.js\": [\n\t\t458,\n\t\t11\n\t],\n\t\"./ion-reorder_2.entry.js\": [\n\t\t459,\n\t\t16\n\t],\n\t\"./ion-ripple-effect.entry.js\": [\n\t\t460,\n\t\t47\n\t],\n\t\"./ion-route_4.entry.js\": [\n\t\t461,\n\t\t32\n\t],\n\t\"./ion-searchbar.entry.js\": [\n\t\t462,\n\t\t33\n\t],\n\t\"./ion-segment_2.entry.js\": [\n\t\t463,\n\t\t34\n\t],\n\t\"./ion-select_3.entry.js\": [\n\t\t464,\n\t\t35\n\t],\n\t\"./ion-slide_2.entry.js\": [\n\t\t465,\n\t\t48\n\t],\n\t\"./ion-spinner.entry.js\": [\n\t\t466,\n\t\t13\n\t],\n\t\"./ion-split-pane.entry.js\": [\n\t\t467,\n\t\t49\n\t],\n\t\"./ion-tab-bar_2.entry.js\": [\n\t\t468,\n\t\t36\n\t],\n\t\"./ion-tab_2.entry.js\": [\n\t\t469,\n\t\t15\n\t],\n\t\"./ion-text.entry.js\": [\n\t\t470,\n\t\t37\n\t],\n\t\"./ion-textarea.entry.js\": [\n\t\t471,\n\t\t38\n\t],\n\t\"./ion-toast.entry.js\": [\n\t\t472,\n\t\t39\n\t],\n\t\"./ion-toggle.entry.js\": [\n\t\t473,\n\t\t12\n\t],\n\t\"./ion-virtual-scroll.entry.js\": [\n\t\t474,\n\t\t50\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 217;\nmodule.exports = webpackAsyncContext;","var map = {\n\t\"./ion-icon.entry.js\": [\n\t\t476,\n\t\t57\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 219;\nmodule.exports = webpackAsyncContext;","export enum WorkListType {\n    // Don't change the order! Otherwise, it breaks file compatibility!\n    BY_CHAPTER,\n    BY_JUAN,\n}\n\nexport class WorkChapter {\n    title: string;\n    juan: number;\n\n    constructor(json: any) {\n        this.title = json.title;\n        this.juan = json.juan;\n    }\n}\n\nexport class Work {\n    title: string;\n    juan: number;\n    juan_list: string;\n    mulu: WorkChapter[];\n    work: string;\n    vol: string;\n\n    constructor(json: any) {\n        this.title = json.title;\n        this.juan = json.juan;\n        this.juan_list = json.juan_list;\n        this.mulu = json.mulu;\n        this.work = json.work;\n        this.vol = json.vol;\n    }\n}\n","import axios from 'axios';\nimport { isPlatform, IonLabel } from '@ionic/react';\nimport React from 'react';\nimport { Work } from './models/Work';\nimport { Bookmark } from './models/Bookmark';\n\nconst apiVersion = 'v1.2';\nconst cbetaApiUrl = `https://cbdata.dila.edu.tw/${apiVersion}`;\nconst dilaDictApiUrl = `https://glossaries.dila.edu.tw/search.json`;\nconst cbetardb = 'cbetardb';\nconst twKaiFontKey = 'twKaoFont';\n/* Font source: https://data.gov.tw/dataset/5961 */\nconst twKaiFontPath = '/assets/TW-Kai-98_1.woff';\nlet log = '';\n\nconst axiosInstance = axios.create({\n  baseURL: cbetaApiUrl,\n  timeout: 3000,\n});\n\nfunction scrollbarSizeIdToValue(id: number) {\n  switch (id) {\n    case 0: return 0;\n    case 1: return 20;\n    case 2: return 40;\n  }\n}\n\nfunction getFileName(work: string, juan: string) {\n  return `${work}_juan${juan}.html`;\n}\n\nasync function getFileFromIndexedDB(fileName: string) {\n  const dbOpenReq = indexedDB.open(cbetardb);\n\n  return new Promise(function (ok, fail) {\n    dbOpenReq.onsuccess = async function (ev) {\n      const db = dbOpenReq.result;\n\n      const trans = db.transaction([\"store\"], 'readwrite');\n      let req = trans.objectStore('store').get(fileName);\n      req.onsuccess = async function (_ev) {\n        const data = req.result;\n        if (!data) {\n          console.error(`${fileName} loading failed!`);\n          console.error(new Error().stack);\n          return fail();\n        }\n        return ok(data);\n      };\n    };\n  });\n}\n\nasync function saveFileToIndexedDB(fileName: string, data: any) {\n  const dbOpenReq = indexedDB.open(cbetardb);\n  return new Promise((ok, fail) => {\n    dbOpenReq.onsuccess = async (ev: Event) => {\n      const db = dbOpenReq.result;\n\n      const transWrite = db.transaction([\"store\"], 'readwrite')\n      const reqWrite = transWrite.objectStore('store').put(data, fileName);\n      reqWrite.onsuccess = (_ev: any) => {\n        return ok();\n      };\n    };\n  });\n}\n\nasync function removeFileFromIndexedDB(fileName: string) {\n  const dbOpenReq = indexedDB.open(cbetardb);\n  return new Promise((ok, fail) => {\n    dbOpenReq.onsuccess = async (ev: Event) => {\n      const db = dbOpenReq.result;\n\n      const transWrite = db.transaction([\"store\"], 'readwrite')\n      const reqWrite = transWrite.objectStore('store').delete(fileName);\n      reqWrite.onsuccess = (_ev: any) => {\n        return ok();\n      };\n    };\n  });\n}\n\n// Fetch juan or HTML file.\nasync function fetchJuan(work: string, juan: string, htmlFile: string | null, update: boolean = false) {\n  const fileName = htmlFile || getFileName(work, juan);\n  let htmlStr: string | null = null;\n  try {\n    htmlStr = await getFileFromIndexedDB(fileName) as string;\n  } catch {\n    // Ignore file not found.\n  }\n  const settingsStr = localStorage.getItem('Settings.json')\n\n  let workInfo = new Work({});\n  let bookmark: Bookmark | undefined;\n  if (settingsStr) {\n    const bookmarks: Array<Bookmark> = (JSON.parse(settingsStr) as any).settings.bookmarks;\n    bookmark = bookmarks.find((b) => b.fileName === fileName || b.uuid === work);\n  }\n\n  if (htmlStr !== null && bookmark !== undefined && !update) {\n    workInfo = bookmark.work!;\n  } else {\n    if (htmlFile) {\n      const res = await axiosInstance.get(`/${htmlFile}`, {\n        responseType: 'arraybuffer',\n      });\n      let tryDecoder = new TextDecoder();\n      let tryDecodeHtmlStr = tryDecoder.decode(res.data);\n      if (tryDecodeHtmlStr.includes('charset=big5')) {\n        htmlStr = new TextDecoder('big5').decode(res.data);\n      } else {\n        htmlStr = tryDecodeHtmlStr;\n      }\n    } else {\n      const res = await axiosInstance.get(`/juans?edition=CBETA&work_info=1&work=${work}&juan=${juan}`, {\n        responseType: 'arraybuffer',\n      });\n      let data = JSON.parse(new TextDecoder().decode(res.data));\n      htmlStr = data.results[0];\n      workInfo = data.work_info;\n    }\n\n    // Convert HTML to XML, because ePub requires XHTML.\n    // Bad structured HTML will cause DOMParser parse error on some browsers!\n    let doc = document.implementation.createHTMLDocument(\"\");\n    doc.body.innerHTML = htmlStr!;\n    htmlStr = new XMLSerializer().serializeToString(doc.body);\n    // Remove body tag.\n    htmlStr = htmlStr.replace('<body', '<div');\n    htmlStr = htmlStr.replace('/body>', '/div>');\n  }\n  return { htmlStr, workInfo };\n}\n\nfunction removeElementsByClassName(doc: Document, className: string) {\n  let elements = doc.getElementsByClassName(className);\n  while (elements.length > 0) {\n    elements[0].parentNode?.removeChild(elements[0]);\n  }\n}\n\nconst consoleLog = console.log.bind(console);\nconst consoleError = console.error.bind(console);\n\nfunction getLog() {\n  return log;\n}\n\nfunction enableAppLog() {\n  console.log = function () {\n    log += '----- Info ----\\n';\n    log += (Array.from(arguments)) + '\\n';\n    consoleLog.apply(console, arguments as any);\n  };\n\n  console.error = function () {\n    log += '----- Error ----\\n';\n    log += (Array.from(arguments)) + '\\n';\n    consoleError.apply(console, arguments as any);\n  };\n}\n\nfunction disableAppLog() {\n  log = '';\n  console.log = consoleLog;\n  console.error = consoleError;\n}\n\nfunction disableAndroidChromeCallout(event: any) {\n  event.preventDefault();\n  event.stopPropagation();\n  return false;\n}\n\n// Workable but imperfect.\nfunction disableIosSafariCallout(this: Window, event: any) {\n  const s = this.getSelection();\n  if ((s?.rangeCount || 0) > 0) {\n    const r = s?.getRangeAt(0);\n    s?.removeAllRanges();\n    setTimeout(() => {\n      s?.addRange(r!);\n    }, 50);\n  }\n}\n\nfunction copyToClipboard(text: string) {\n  navigator.clipboard && navigator.clipboard.writeText(text);\n}\n\nexport default {\n  storeFile: 'Settings.json',\n  fontSizeNorm: 24,\n  fontSizeLarge: 48,\n  getLog,\n  enableAppLog,\n  disableAppLog,\n  cbetardb,\n  apiVersion,\n  cbetaApiUrl,\n  dilaDictApiUrl,\n  twKaiFontKey,\n  twKaiFontPath,\n  axiosInstance,\n  topCatalogsByCat: {\n    \"CBETA\": \"CBETA 部類\",\n    \"Cat-T\": \"大正藏\",\n    \"Cat-X\": \"卍續藏\",\n    \"Cat-N\": \"南傳大藏經\",\n    \"others\": \"歷代藏經補輯\",\n    \"modern\": \"近代新編文獻\",\n  } as Record<string, string>,\n  topCatalogsByVol: {\n    \"Vol-T\": \"T 大正藏\",\n    \"Vol-X\": \"X 卍續藏\",\n    \"Vol-A\": \"A 趙城金藏\",\n    \"Vol-K\": \"K 高麗大藏經-新文豐版\",\n    \"Vol-S\": \"S 宋藏遺珍-新文豐版\",\n    \"Vol-F\": \"F 房山石經\",\n    \"Vol-C\": \"C 中華大藏經-中華書局版\",\n    \"Vol-U\": \"U 洪武南藏\",\n    \"Vol-P\": \"P 永樂北藏\",\n    \"Vol-J\": \"J 嘉興藏\",\n    \"Vol-L\": \"L 乾隆大藏經-新文豐版\",\n    \"Vol-G\": \"G 佛教大藏經\",\n    \"Vol-M\": \"M 卍正藏經-新文豐版\",\n    \"Vol-D\": \"D 國圖善本\",\n    \"Vol-N\": \"N 南傳大藏經(冊別)\",\n    \"Vol-ZS\": \"ZS 正史佛教資料類編\",\n    \"Vol-I\": \"I 北朝佛教石刻拓片百品\",\n    \"Vol-ZW\": \"ZW 藏外佛教文獻\",\n    \"Vol-B\": \"B 大藏經補編\",\n    \"Vol-GA\": \"GA 中國佛寺史志彙刊\",\n    \"Vol-GB\": \"GB 中國佛寺志叢刊\",\n    \"Vol-Y\": \"Y 印順法師佛學著作集\",\n    \"Vol-LC\": \"LC 呂澂佛學著作集\",\n  } as Record<string, string>,\n  fetchErrorContent: (\n    <IonLabel className='contentCenter'>\n      <div>\n        <div>連線失敗!</div>\n        <div style={{ fontSize: 'var(--ui-font-size)', paddingTop: 24 }}>如果問題持續發生，請執行<a href=\"/settings\" target=\"_self\">設定頁</a>的app異常回報功能。</div>\n      </div>\n    </IonLabel>),\n  updateApp: () => {\n    navigator.serviceWorker.getRegistrations().then(regs => {\n      return Promise.all(regs.map(reg => reg.update()));\n    });\n  },\n  scrollbarSizeIdToValue,\n  updateCssVars: (settings: any) => {\n    let scrollbarSize = scrollbarSizeIdToValue(settings.scrollbarSize);\n    document.documentElement.style.cssText = `--ion-font-family: ${settings.useFontKai ? 'Heiti, Times, Kai' : 'Times, Heiti'};\n        --scrollbar-size: ${scrollbarSize}px; --ui-font-size: ${settings.uiFontSize}px; --text-font-size: ${settings.fontSize}px`\n  },\n  isTouchDevice: () => {\n    return isPlatform('ios') || isPlatform('android');\n  },\n  fetchJuan,\n  getFileName,\n  getFileFromIndexedDB,\n  saveFileToIndexedDB,\n  removeFileFromIndexedDB,\n  removeElementsByClassName,\n  disableAndroidChromeCallout,\n  disableIosSafariCallout,\n  copyToClipboard,\n};\n","import { Work } from \"./Work\";\r\n\r\nexport enum BookmarkType {\r\n    // Don't change the order! Otherwise, it breaks file compatibility!\r\n    CATALOG,\r\n    WORK,\r\n    JUAN,\r\n    HTML,\r\n}\r\n\r\nexport class Bookmark {\r\n    type: BookmarkType = BookmarkType.CATALOG;\r\n    uuid: string = '';\r\n    work: Work | null | undefined = null;\r\n    selectedText: string = '';\r\n    epubcfi: string = '';\r\n    fileName: string = '';\r\n\r\n    constructor(json: Bookmark) {\r\n        this.type = json.type;\r\n        this.uuid = json.uuid;\r\n        this.work = json.work;\r\n        this.selectedText = json.selectedText;\r\n        this.epubcfi = json.epubcfi;\r\n        this.fileName = json.fileName;\r\n    }\r\n}\r\n","import { combineReducers } from \"redux\"\r\n\r\nimport settings from \"./setReducer\"\r\nimport tmpSettings from \"./tmpSetReducer\"\r\n\r\nexport default combineReducers({\r\n  settings, tmpSettings\r\n})\r\n","import Globals from '../../Globals';\nimport { Bookmark, BookmarkType } from '../../models/Bookmark';\n\n// Used to store settings. They will be saved to file.\nexport default function reducer(state = {\n}, action: any) {\n  var newSettings = { ...state } as any;\n  switch (action.type) {\n    case \"LOAD_SETTINGS\":\n      newSettings = JSON.parse(localStorage.getItem(Globals.storeFile)!).settings;\n      break;\n    case \"SET_KEY_VAL\":\n      var key = action.key;\n      var val = action.val;\n      newSettings[key] = val;\n      localStorage.setItem(Globals.storeFile, JSON.stringify({ settings: newSettings }));\n      break;\n    case \"ADD_BOOKMARK\":\n      const oldBookmarks = newSettings.bookmarks as [Bookmark];\n      let fileName = action.bookmark.fileName;\n      if (fileName !== null && fileName !== '' &&\n        !oldBookmarks.some((bookmark: Bookmark) => bookmark.fileName === fileName)\n      ) {\n        Globals.saveFileToIndexedDB(fileName, action.htmlStr);\n      }\n      newSettings.bookmarks = [...newSettings.bookmarks, action.bookmark];\n      localStorage.setItem(Globals.storeFile, JSON.stringify({ settings: newSettings }));\n      break;\n    case \"DEL_BOOKMARK\":\n      let bookmarksTemp = newSettings.bookmarks as [Bookmark];\n      const idxToDel = bookmarksTemp.findIndex((b) => { return b.uuid === action.uuid });\n      if (idxToDel !== -1) {\n        let deletedBookmarks = bookmarksTemp.splice(idxToDel, 1);\n\n        if (deletedBookmarks.length === 1) {\n          // Remove the HTML file from localStorage if all its bookmarks are deleted.\n          const deletedBookmark = deletedBookmarks[0];\n          let fileName = deletedBookmark.fileName;\n          let noJuanBookmarkUseTheFile = bookmarksTemp.find((b) => b.type === BookmarkType.JUAN && b.uuid === deletedBookmark.uuid) == null;\n          let noWorkBookmarkUseTheFile = bookmarksTemp.find((b) => b.type === BookmarkType.WORK && b.work?.work === deletedBookmark.work?.work) == null;\n          if (noWorkBookmarkUseTheFile) {\n            switch (deletedBookmark.type) {\n              case BookmarkType.WORK:\n                const work = deletedBookmark.work!;\n                // For back compatibility.\n                if (work == null) {\n                  break;\n                }\n                const juans = work.juan_list.split(',');\n                for (let i = 0; i < juans.length; i++) {\n                  const fileName = Globals.getFileName(work.work, juans[i]);\n                  noJuanBookmarkUseTheFile = bookmarksTemp.find((b) => b.type === BookmarkType.JUAN && b.fileName === fileName) == null;\n                  if (noJuanBookmarkUseTheFile) {\n                    Globals.removeFileFromIndexedDB(fileName);\n                  }\n                }\n                break;\n              case BookmarkType.JUAN:\n                if (noJuanBookmarkUseTheFile)\n                  Globals.removeFileFromIndexedDB(fileName);\n                break;\n            }\n          }\n        }\n      }\n      newSettings.bookmarks = [...bookmarksTemp];\n      localStorage.setItem(Globals.storeFile, JSON.stringify({ settings: newSettings }));\n      break;\n    case \"UPDATE_BOOKMARKS\": {\n      newSettings.bookmarks = action.bookmarks;\n      localStorage.setItem(Globals.storeFile, JSON.stringify({ settings: newSettings }));\n      break;\n    }\n    default:\n      if (Object.keys(newSettings).length === 0) {\n        newSettings = {};\n      }\n      // Setting default values.\n      // version is the setting file version.\n      var keys = ['version', 'hasAppLog', 'theme', 'paginated', 'rtlVerticalLayout', 'scrollbarSize', 'useFontKai', 'fontSize', 'uiFontSize', 'showComments', 'printStyle', 'speechRate', 'bookmarks'];\n      var vals = [1, 1, 0, 1, 1, 2, 1, 32, 24, 0, 0, 0.8, []];\n      for (let k = 0; k < keys.length; k++) {\n        if (newSettings[keys[k]] === undefined) {\n          newSettings[keys[k]] = vals[k];\n        }\n      }\n  }\n  return newSettings;\n}\n","// Used to store temp settings in RAM. They will not be saved to file.\r\nexport default function reducer(state = {\r\n}, action: any) {\r\n  var newState = { ...state } as any;\r\n  var key = action.key;\r\n  var val = action.val;\r\n  newState[key] = val;\r\n  switch (action.type) {\r\n    case \"TMP_SET_KEY_VAL\": {\r\n      return newState;\r\n    }\r\n    default:\r\n      break;\r\n  }\r\n  return state;\r\n}\r\n","//import * as fs from 'fs';\nimport React from 'react';\nimport { IonContent, IonHeader, IonPage, IonTitle, IonToolbar, IonButton, withIonLifeCycle, IonIcon, IonAlert, IonPopover, IonList, IonItem, IonLabel, IonFab, IonFabButton, IonToast, IonLoading, isPlatform } from '@ionic/react';\nimport { RouteComponentProps } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport * as uuid from 'uuid';\nimport queryString from 'query-string';\nimport './EPubViewPage.css';\nimport Globals from '../Globals';\nimport { bookmark, arrowBack, home, search, ellipsisHorizontal, ellipsisVertical, arrowForward, musicalNotes, stopCircle, book, shareSocial, print, refreshCircle, copy } from 'ionicons/icons';\nimport { Bookmark, BookmarkType } from '../models/Bookmark';\nimport { Work } from '../models/Work';\nimport SearchAlert from '../components/SearchAlert';\nimport ePub, { Book, Rendition, EVENTS } from 'epubjs-myh';\nimport * as nodepub from 'nodepub';\n\n// Load TW-Kai font in iframe.\nasync function loadTwKaiFont(this: any) {\n  const fontData = await Globals.getFileFromIndexedDB(Globals.twKaiFontKey);\n  const fontFace = new (window as any).FontFace('Kai', fontData);\n  await fontFace.load();\n  (this.document as any).fonts.add(fontFace);\n}\n\nfunction addCbetaLineBreaks(this: any) {\n  this.document.querySelectorAll('.pre .lb').forEach((el: HTMLElement) => {\n    const newBr = this.document.createElement('br');\n    el.before(newBr);\n  });\n}\n\nfunction addSwpiedEvents(this: Window) {\n  require('swiped-events-myh/src/add')(this.window, this.document);\n}\n\ninterface VisibleChar {\n  node: Node;\n  offset: number;\n  page: number;\n  char: string;\n}\n\ninterface Props {\n  dispatch: Function;\n  bookmarks: [Bookmark];\n  fontSize: number;\n  scrollbarSize: number;\n  settings: any;\n  showComments: boolean;\n  paginated: boolean;\n  rtlVerticalLayout: boolean;\n  useFontKai: boolean;\n  speechRate: number;\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n  tab: string;\n  work: string;\n  path: string;\n  label: string;\n}> { }\n\nenum SpeechState {\n  UNINITIAL,\n  SPEAKING,\n  PAUSE\n}\n\ninterface State {\n  isLoading: boolean;\n  fetchError: boolean;\n  workInfo: Work;\n  htmlStr: string | null;\n  currentPage: number;\n  pageCount: number;\n  showJumpPageAlert: boolean;\n  showNoSelectedTextAlert: boolean;\n  searchText: string;\n  showSearchTextToast: boolean;\n  showAddBookmarkSuccess: boolean;\n  showsCopyToClipboardSuccess: boolean;\n  showsCitationFail: boolean;\n  showSearchTextAlert: boolean;\n  showToast: boolean;\n  toastMessage: string;\n  showSearchAlert: boolean;\n  popover: any;\n  lookupDictPopover: any;\n  speechState: SpeechState;\n}\n\nclass _EPubViewPage extends React.Component<PageProps, State> {\n  htmlFile: string;\n  htmlTitle: string;\n  book: Book | null;\n  rendition: Rendition | null;\n  epub: any;\n  displayed: any;\n  cfiRange: string;\n  speechSynthesisUtterance: SpeechSynthesisUtterance;\n\n  constructor(props: any) {\n    super(props);\n    this.state = {\n      isLoading: false,\n      fetchError: false,\n      workInfo: new Work({}),\n      htmlStr: null,\n      currentPage: 1,\n      pageCount: 1,\n      showJumpPageAlert: false,\n      showNoSelectedTextAlert: false,\n      showAddBookmarkSuccess: false,\n      showsCopyToClipboardSuccess: false,\n      showsCitationFail: false,\n      showSearchTextAlert: false,\n      searchText: '',\n      showSearchTextToast: false,\n      showToast: false,\n      toastMessage: '',\n      showSearchAlert: false,\n      popover: {\n        show: false,\n        event: null,\n      },\n      lookupDictPopover: {\n        show: false,\n        data: [],\n      },\n      speechState: SpeechState.UNINITIAL,\n    }\n    this.htmlFile = '';\n    this.htmlTitle = '';\n    this.book = null;\n    this.rendition = null;\n    this.cfiRange = '';\n    this.speechSynthesisUtterance = new SpeechSynthesisUtterance();\n    this.speechSynthesisUtterance.lang = 'zh-TW';\n    this.speechSynthesisUtterance.onend = (ev: SpeechSynthesisEvent) => {\n      if (this.state.speechState === SpeechState.UNINITIAL) {\n        return;\n      }\n\n      const hasNextTexts1 = !this.props.paginated && this.workTextsIndex < this.workTexts.length - 1;\n      const hasNextTexts2 = this.props.paginated && this.state.currentPage < this.state.pageCount;\n      let texts = '';\n      if (hasNextTexts1) {\n        this.workTextsIndex += 1;\n        texts = this.workTexts[this.workTextsIndex];\n      } else if (hasNextTexts2) {\n        this.pageNext();\n        texts = this.findTextsInPage(this.state.currentPage);\n      } else {\n        this.setState({ speechState: SpeechState.UNINITIAL });\n        console.log(`Stop work text to speech.`);\n        return;\n      }\n      this.speechSynthesisUtterance.text = texts;\n      speechSynthesis.speak(this.speechSynthesisUtterance);\n      console.log(`Play work text to speech part / page: ${hasNextTexts1 ? this.workTextsIndex : this.state.currentPage}`);\n    };\n    document.addEventListener(\"keydown\", this.keyListener.bind(this), false);\n  }\n\n  async loadEpubCoverToMemFs() {\n    let logoArray = new Uint8Array(JSON.parse(localStorage.getItem('logo.png') || '[]'));\n\n    if (logoArray.length === 0) {\n      // Download book logo.\n      const res = await Globals.axiosInstance.get(`${window.location.origin}/assets/icon/icon.png`, {\n        responseType: 'arraybuffer',\n      });\n      logoArray = new Uint8Array(res.data);\n      let logoStr = JSON.stringify(Array.from(logoArray));\n      localStorage.setItem('logo.png', logoStr);\n    }\n    let fs = require('fs');\n    fs.writeFileSync('logo.png', logoArray);\n  }\n\n  uuidStr = '';\n  epubcfiFromUrl = '';\n  ionViewWillEnter() {\n    let queryParams = queryString.parse(this.props.location.search) as any;\n    this.htmlFile = queryParams.file;\n    this.htmlTitle = queryParams.title;\n    this.epubcfiFromUrl = queryParams.bookmark || '';\n    let state = this.props.location.state as any;\n    this.uuidStr = state ? state.uuid : '';\n    //console.log( 'view will enter' );\n    this.fetchData();\n  }\n\n  ionViewDidEnter() {\n  }\n\n  get fileName() {\n    return Globals.getFileName(\n      this.props.match.params.work,\n      this.props.match.params.path\n    );\n  }\n\n  async fetchData() {\n    this.setState({ isLoading: true });\n    try {\n      const res = await Globals.fetchJuan(\n        this.props.match.params.work,\n        this.props.match.params.path,\n        this.htmlFile,\n      );\n\n      await this.loadEpubCoverToMemFs();\n\n      // isLoading shall consider the epub.js loading time, thus disable it here.\n      this.setState({ /*isLoading: false, */fetchError: false, workInfo: res.workInfo, htmlStr: res.htmlStr });\n    } catch (e) {\n      console.error(e);\n      console.error(new Error().stack);\n      this.setState({ isLoading: false, fetchError: true });\n    }\n  }\n\n  epubcfiFromSelectedString = '';\n  addBookmarkHandler() {\n    const selectedText = this.getSelectedString();\n    if (selectedText === '') {\n      this.setState({ showNoSelectedTextAlert: true });\n      return;\n    }\n\n    let uuidStr = uuid.v4();\n    this.props.dispatch({\n      type: \"ADD_BOOKMARK\",\n      // IMPORTANT!!! Don't arbitrarily change the HTML structure of htmlStr.\n      // Otherwise, saved epubcfi bookmarks will become invalid!\n      htmlStr: this.state.htmlStr,\n      bookmark: new Bookmark({\n        type: this.htmlFile ? BookmarkType.HTML : BookmarkType.JUAN,\n        uuid: uuidStr,\n        selectedText: selectedText,\n        epubcfi: this.epubcfiFromSelectedString,\n        fileName: this.htmlFile || `${this.props.match.params.work}_juan${this.props.match.params.path}.html`,\n        work: Object.assign(this.state.workInfo, {\n          title: this.htmlFile ? this.htmlTitle : this.state.workInfo.title,\n          juan: this.props.match.params.path,\n        }\n        ),\n      }),\n    });\n    this.setState({ showAddBookmarkSuccess: true });\n    return;\n  }\n\n  get isTopPage() {\n    return this.props.match.url === '/catalog';\n  }\n\n  get bookmark() {\n    return this.props.bookmarks.find(\n      (e) => e.type === BookmarkType.JUAN && e.uuid === this.uuidStr);\n  }\n\n  get hasBookmark() {\n    return this.epubcfiFromUrl !== '' || this.bookmark != null;\n  }\n\n  get epubcfi() {\n    return this.epubcfiFromUrl !== '' ? this.epubcfiFromUrl : this.bookmark != null ? this.bookmark!.epubcfi : 'epubcfi(/6/6[s1]!/4/4/2/6[body]/6,/1:0,/1:1)';\n  }\n\n  ionViewWillLeave() {\n    speechSynthesis.cancel();\n    this.setState({ htmlStr: null, currentPage: 1, speechState: SpeechState.UNINITIAL, showSearchTextToast: false });\n    this.book?.destroy();\n    this.book = null;\n    this.bookCreated = false;\n  }\n\n  pagePrev(n: number = 1) {\n    if (this.props.paginated && this.state.currentPage > 1) {\n      this.rendition?.prev(n);\n      //console.log(this.visibleChars.filter((vc) => vc.page === (this.state.currentPage - n)).map((vc) => vc.char).join(''));\n      this.setState({ currentPage: this.state.currentPage - n });\n    }\n  }\n\n  pageNext(n: number = 1) {\n    if (this.props.paginated && this.state.currentPage < this.state.pageCount) {\n      this.rendition?.next(n);\n      //console.log(this.visibleChars.filter((vc) => vc.page === (this.state.currentPage + n)).map((vc) => vc.char).join(''));\n      this.setState({ currentPage: this.state.currentPage + n });\n    }\n  }\n\n  jumpToPage(page: number) {\n    if (page === 0) {\n      return;\n    }\n    page = isNaN(page) ? 1 : Math.max(Math.min(this.state.pageCount, page), 1);\n    const currentPage = this.state.currentPage;\n    let step = currentPage < page ? 1 : -1;\n    let diff = Math.abs(page - currentPage);\n    if (step === 1) {\n      this.pageNext(diff);\n    } else {\n      this.pagePrev(diff);\n    }\n  }\n\n  keyListener(e: KeyboardEvent) {\n    let key = e.keyCode || e.which;\n\n    console.log(e.type)\n\n    // Left/down Key\n    if (key === (this.props.rtlVerticalLayout ? 37 : 40)) {\n      this.buttonNext()\n    }\n\n    // Right/top Key\n    if (key === (this.props.rtlVerticalLayout ? 39 : 38)) {\n      this.buttonPrev();\n    }\n\n    if (e.code === 'F3' || (e.ctrlKey && e.key.toLowerCase() === 'f')) {\n      e.preventDefault();\n      this.setState({ showSearchTextToast: false, showSearchTextAlert: true });\n    }\n  };\n\n  bookCreated = false;\n  ePubIframe: HTMLIFrameElement | null = null;\n  async html2Epub() {\n    this.bookCreated = true;\n    this.epub = nodepub.document({\n      id: '123-123456789',\n      title: 'Title',\n      series: '',\n      sequence: 1,\n      author: 'Author',\n      fileAs: '',\n      genre: 'genre',\n      tags: '',\n      copyright: '',\n      publisher: '',\n      published: '',\n      language: 'en',\n      description: 'A temp book.',\n      contents: this.state.workInfo.title,\n      source: '',\n      images: ['logo.png'],\n    }, 'logo.png');\n\n    let htmlStrModifiedStyles = this.state.htmlStr!;\n    if (this.props.rtlVerticalLayout) {\n      htmlStrModifiedStyles = htmlStrModifiedStyles.replace(/margin-left/g, 'margin-top');\n    }\n    /* else {\n      htmlStrModifiedStyles = htmlStrModifiedStyles.replace(/margin-top/g, 'margin-left');\n    }*/\n\n    const htmlStrWithCssJs = htmlStrModifiedStyles + `\n    <script>\n    </script>\n    `;\n\n    this.epub.addSection('', htmlStrWithCssJs, true, false);\n\n    let rtlVerticalStyles = `\n    html {\n      writing-mode: vertical-rl;\n      direction: ltr;\n    }\n    `;\n\n    this.epub.addCSS(`\n    @page {\n      size: A4;\n      margin: 0.5in;\n    }\n\n    /* For double side printing for book bundling. */\n    @page :left {\n      margin-right: 1in;\n    }\n\n    @page :right {\n      margin-left: 1in;\n    }\n\n    @media print {\n      body {\n        color: ${getComputedStyle(document.body).getPropertyValue('--print-text-color')} !important;\n        background: ${getComputedStyle(document.body).getPropertyValue('--print-background')} !important;\n        padding: 0 !important;\n        width: 100% !important;\n        height: 100% !important;\n        column-gap: unset !important;\n        column-width: unset !important;\n      }\n    }\n\n    html {\n      /*\n      Because different fonts have different line heights with 'line-height: normal,'\n      the content size of epubjs iframe changes after the fallback font is swapped with the web font.\n      Unfortunately, epubjs can't detect the size change and update the iframe.\n      This problem causes the total page count is incorrect.\n      Fortunately, we can set the line height based on the same font size as below.\n      */\n      line-height: 1.2;\n    }\n\n    body {\n      color: ${getComputedStyle(document.body).getPropertyValue('--ion-text-color')};\n      background: ${getComputedStyle(document.body).getPropertyValue('--ion-background-color')};\n      /* Disable browser's swipe to forward / backward page navigation. */\n      overscroll-behavior-x: none;\n    }\n\n    @font-face {\n        font-family: 'Times';\n        src: local('Times New Roman');\n        unicode-range: U+0-007F;\n    }\n\n    /* Workaround parenthesis orientation problem of TW-Kai-98_1 on iOS Safari. */\n    @font-face {\n        font-family: 'Heiti';\n        src: local('Heiti TC');\n        unicode-range: U+3008-301B, U+FF01-FF60;\n    }\n\n    .lb {\n      display: none\n    }\n\n    /* In-HTML anchor jumps don't update this.state.currentPage.\n    Thus, we disable them. */\n    .noteAnchor {\n      pointer-events: none;\n      text-decoration: inherit;\n      color: inherit;\n      cursor: auto;\n    }\n\n    .doube-line-note, .doube-line-note .t {\n      font-size: ${this.props.fontSize * 0.8}px;\n    }\n\n    .doube-line-note::before {\n      content: \"（\";\n    }\n\n    .doube-line-note::after {\n      content: \"）\";\n    }\n\n    .bip-table {\n      display: table;\n    }\n\n    .bip-table-row {\n      display: table-row;\n    }\n\n    .bip-table-cell {\n      display: table-cell;\n      border: 1px solid ${getComputedStyle(document.body).getPropertyValue('--ion-text-color')};\n      text-align: center;\n    }\n  \n    ${this.props.rtlVerticalLayout ? rtlVerticalStyles : ''}\n\n    .t, p, div {\n      font-family: ${getComputedStyle(document.body).getPropertyValue('--ion-font-family')};\n      font-size: ${this.props.fontSize}px;\n    }\n    \n    #back, #cbeta-copyright {\n      display: ${this.props.showComments ? \"block\" : \"none\"};\n    }\n    `);\n    //await new Promise((ok, fail) => {\n    this.epub.writeEPUB(\n      (e: any) => {\n        console.log(`Error: ${e}`);\n      },\n      '.', 'temp',\n      async () => {\n        let fs = require('fs');\n        let tempEpubBuffer = fs.readFileSync('temp.epub');\n        this.book = ePub(tempEpubBuffer.buffer, {\n          openAs: 'binary',\n        });\n        this.rendition = this.book.renderTo('cbetarEPubView', {\n          width: \"100%\", height: \"100%\",\n          spread: 'none',\n          flow: this.props.paginated ? 'paginated' : 'scrolled',\n          scrollbarWidth: Globals.scrollbarSizeIdToValue(this.props.scrollbarSize),\n          defaultDirection: this.props.rtlVerticalLayout ? 'rtl' : 'ltr',\n        });\n        //this.rendition.on(\"keydown\", this.keyListener.bind(this));\n\n        this.rendition.on(\"selected\", (cfiRange: any, contents: any) => {\n          this.epubcfiFromSelectedString = cfiRange;\n          /*\n          this.rendition?.annotations.highlight(cfiRange, {}, (e: any) => {\n            console.log(\"highlight clicked\", e.target);\n          });*/\n          //contents.window.getSelection().removeAllRanges();\n        });\n\n        this.rendition.on(EVENTS.RENDITION.DISPLAYED, () => {\n          this.updatePageInfos();\n        });\n\n        this.rendition.on(EVENTS.VIEWS.RENDERED, () => {\n          this.updateEPubIframe();\n        });\n\n        await this.rendition.display(this.props.paginated ? this.epubcfi : undefined);\n        // Navigate to the first work page.\n        if (!this.props.paginated) {\n          // Skip cover page.\n          await this.rendition?.next();\n          // Skip TOC page.\n          await this.rendition?.next();\n          this.updateEPubIframe();\n        }\n        this.setState({ isLoading: false });\n\n        if (this.hasBookmark) {\n          try {\n            this.rendition?.annotations.highlight(this.epubcfi);\n          } catch (e) {\n            console.error(e);\n          }\n        }\n\n        this.book?.locations.generate(150);\n      }\n    );\n  }\n\n  updateEPubIframe() {\n    const iframes = document.getElementsByTagName('iframe');\n    if (iframes.length === 1) {\n      this.ePubIframe = iframes[0];\n      this.ePubIframe.contentDocument?.addEventListener('keydown', this.keyListener.bind(this), false);\n      const ePubIframeWindow = this.ePubIframe!.contentWindow! as any;\n      if (isPlatform('android')) {\n        ePubIframeWindow.window.oncontextmenu = Globals.disableAndroidChromeCallout;\n      } else if (isPlatform('ios')) {\n        (ePubIframeWindow as Window).document.ontouchend = Globals.disableIosSafariCallout.bind(ePubIframeWindow);\n      }\n      ePubIframeWindow.loadTwKaiFont = loadTwKaiFont;\n      ePubIframeWindow.loadTwKaiFont();\n      ePubIframeWindow.addCbetaLineBreaks = addCbetaLineBreaks;\n      ePubIframeWindow.addCbetaLineBreaks();\n      ePubIframeWindow.addSwpiedEvents = addSwpiedEvents;\n      ePubIframeWindow.addSwpiedEvents();\n      ePubIframeWindow.document.addEventListener('swiped', (e: any) => {\n        if (!this.props.paginated) {\n          return;\n        }\n\n        if (this.props.rtlVerticalLayout) {\n          switch (e.detail.dir) {\n            case 'left':\n              this.pagePrev();\n              break;\n            case 'right':\n              this.pageNext();\n              break;\n          }\n        } else {\n          switch (e.detail.dir) {\n            case 'down':\n              this.pagePrev();\n              break;\n            case 'up':\n              this.pageNext();\n              break;\n          }\n        }\n      });\n      this.findVisibleTexts();\n\n      /*\n      this.ePubIframe.contentWindow?.addEventListener('unload', () => {\n        console.log('iframe unloaded!');\n        this.ePubIframe?.contentDocument?.removeEventListener('keydown', this.keyListener.bind(this), false);\n      });*/\n    } else if (iframes.length > 1) {\n      alert('Error! This component locates ePub iframe by the only iframe.');\n    } else {\n      console.error('ePub iframes count is 0.');\n    }\n  }\n\n  updatePageInfos() {\n    const displayed = (this.rendition?.currentLocation() as any).start.displayed;\n    this.setState({ currentPage: displayed.page, pageCount: displayed.total });\n  }\n\n  getSelectedString() {\n    let selectedText = '';\n    const sel = this.ePubIframe?.contentDocument?.getSelection();\n    if ((sel?.rangeCount || 0) > 0 && sel!.getRangeAt(0).toString().length > 0) {\n      selectedText = sel!.toString();\n      sel?.removeAllRanges();\n    }\n    return selectedText;\n  }\n\n  getRemainingWorkTextFromSelectedRange() {\n    let selection = this.ePubIframe!.contentWindow!.getSelection();\n    let remainingWorkText;\n\n    if (selection!.type === 'Range') {\n      const back = this.ePubIframe!.contentDocument!.getElementById('back')!;\n      let s = selection!.getRangeAt(0);\n      // Get a range from selected texts to end of id='body' (start of id='back').\n      s.setEnd(back, 0);\n      // Get document fragment containing the range.\n      let docFragment = s.cloneContents();\n      selection?.removeAllRanges();\n\n      // For manipulate content of docFragment laterly.\n      let doc = new Document();\n      let docHtml = doc.createElement('html')\n      doc.appendChild(docHtml);\n      docHtml.appendChild(docFragment);\n\n      // Remove texts being not part of speech including line number and note texts in work texts.\n      Globals.removeElementsByClassName(doc, 'lb');\n      Globals.removeElementsByClassName(doc, 'doube-line-note');\n      remainingWorkText = doc.getElementById('body')!.innerText;\n    }\n\n    return remainingWorkText;\n  }\n\n  getAllTextNodes(root: any) {\n    const walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT);\n    return walker;\n  }\n\n  visibleCharToRange(index: number) {\n    const visibleChar = this.visibleChars[index];\n    const r = new Range();\n    r.setStart(visibleChar.node, visibleChar.offset);\n    r.setEnd(visibleChar.node, visibleChar.offset + 1);\n    return r;\n  }\n\n  rectBinDirSize(rect: DOMRect) {\n    if (this.props.rtlVerticalLayout) {\n      return rect.y;\n    } else {\n      return rect.x;\n    }\n  }\n\n  findBinBoundaryVisibleCharIndex(binBoundary: number, leftSearchIndex: number, rightSearchIndex: number): number {\n    const checkpointIndex = leftSearchIndex + Math.floor((rightSearchIndex - leftSearchIndex) / 2);\n    if (checkpointIndex === 0) {\n      return 0;\n    } else if (checkpointIndex === this.visibleChars.length - 1) {\n      return this.visibleChars.length - 1;\n    }\n\n    const checkpointRange0 = this.visibleCharToRange(checkpointIndex);\n    const checkpointRange1 = this.visibleCharToRange(checkpointIndex + 1);\n    const rect0 = checkpointRange0.getBoundingClientRect();\n    const rect1 = checkpointRange1.getBoundingClientRect();\n    let rect0BinDirSize = this.rectBinDirSize(rect0) - this.ePubIframeOffset;\n    let rect1BinDirSize = this.rectBinDirSize(rect1) - this.ePubIframeOffset;\n    // Find the classification point.\n    if (rect0BinDirSize < binBoundary && binBoundary <= rect1BinDirSize) {\n      return checkpointIndex;\n    } else if (rect0BinDirSize < binBoundary && binBoundary > rect1BinDirSize) {\n      return this.findBinBoundaryVisibleCharIndex(binBoundary, checkpointIndex + 1, rightSearchIndex);\n    } else if (rect0BinDirSize >= binBoundary && binBoundary <= rect1BinDirSize) {\n      return this.findBinBoundaryVisibleCharIndex(binBoundary, leftSearchIndex, checkpointIndex);\n    } else {\n      console.error('Unreasonable case!');\n      return -1;\n    }\n  }\n\n  pageWidth = 0;\n  pagesWidth = 0;\n  findTextsInPage(n: number) {\n    const timeStart = new Date();\n    // Zero-based index n.\n    const nZ = n - 1;\n    if (!this.isPageSearched[nZ]) {\n      const pageStartOffset = this.pageWidth * (n - 1);\n      const pageEndOffset = this.pageWidth * n;\n      let pageStartCharIndex = 0;\n      if (n !== 1) {\n        // Reuse the searched boundary if available.\n        if (this.isPageSearched[nZ - 1]) {\n          pageStartCharIndex = (this.visibleChars.length - 1) - this.visibleChars.slice().reverse().findIndex((vc) => vc.page === (n - 1)) + 1;\n        } else {\n          pageStartCharIndex = this.findBinBoundaryVisibleCharIndex(pageStartOffset, 0, this.visibleChars.length - 1) + 1;\n        }\n      }\n\n      let pageEndCharSearchRangeEnd = this.visibleChars.length - 1;\n      let pageEndCharIndex = this.visibleChars.length - 1;\n      if (n !== this.state.pageCount) {\n        // Reuse the searched boundary if available.\n        if (this.isPageSearched[nZ + 1]) {\n          pageEndCharIndex = this.visibleChars.findIndex((vc) => vc.page === (n + 1)) - 1;\n        } else {\n          pageEndCharIndex = this.findBinBoundaryVisibleCharIndex(pageEndOffset, pageStartCharIndex, pageEndCharSearchRangeEnd);\n        }\n      }\n      for (let i = pageStartCharIndex; i <= pageEndCharIndex; i++) {\n        this.visibleChars[i].page = n;\n      }\n      this.isPageSearched[nZ] = true;\n    }\n    const texts = this.visibleChars.filter((vc) => vc.page === n).map((vc) => vc.char).join('');\n    const timeEnd = new Date();\n    const timeDiff = timeEnd.getTime() - timeStart.getTime();\n    console.log(`findTextsInPage spends: ${timeDiff / 1e3}s`);\n    return texts;\n  }\n\n  searchTextRanges: Array<Range> = [];\n  visibleTextNodes: Array<Node> = [];\n  visibleChars: Array<VisibleChar> = [];\n  isPageSearched: Array<boolean> = [];\n  allTexts = '';\n  ePubIframeOffset = 0;\n\n  findVisibleTexts() {\n    const cbetaHtmlBody = this.ePubIframe!.contentDocument!.getElementById('body');\n    if (!cbetaHtmlBody) {\n      return;\n    }\n\n    const textNodesWalker = this.getAllTextNodes(cbetaHtmlBody);\n    this.visibleTextNodes = [];\n    this.visibleChars = [];\n    this.isPageSearched = [];\n    let node: Node | null;\n    while ((node = textNodesWalker.nextNode()) != null) {\n      let node2 = node!;\n      if (['t', 'pc', 'gaijiAnchor'].reduce((prev, curr) => prev && curr !== node2.parentElement?.className, true)) {\n        continue;\n      }\n\n      this.visibleTextNodes.push(node);\n    }\n\n    this.allTexts = this.visibleTextNodes.map((n) => n.textContent).join('');\n\n    // Convert visibleTextNodes to visibleChars.\n    let i = 0;\n    for (let n = 0; n < this.visibleTextNodes.length; n++) {\n      const visibleTextNode = this.visibleTextNodes[n];\n      for (let c = 0; c < (visibleTextNode as any).length; c++) {\n        this.visibleChars.push({ node: visibleTextNode, offset: c, page: 0, char: this.allTexts[i] });\n        i++;\n      }\n    }\n    const epubContainer = document.querySelector('.epub-container')!;\n    this.pageWidth = this.props.rtlVerticalLayout ? epubContainer.clientHeight : epubContainer.clientWidth;\n    this.pagesWidth = this.pageWidth * this.state.pageCount;\n    this.isPageSearched = new Array(this.state.pageCount);\n    for (let i = 0; i < this.isPageSearched.length; i++) {\n      this.isPageSearched[i] = false;\n    }\n    const rect0 = this.visibleCharToRange(0).getBoundingClientRect();\n    this.ePubIframeOffset = this.props.rtlVerticalLayout ? rect0.y : rect0.x;\n  }\n\n  findSearchTextRanges(searchText: string) {\n    this.searchTextRanges = [];\n    this.showedSearchTextIndex = 0;\n\n    // Search all keywords in allTexts and save their start and end indexes in searchTextIndexes;\n    let searchTextIndexes: Array<number> = []\n    let startIndex = 0;\n    let searchTextIndex = 1;\n    do {\n      searchTextIndex = this.allTexts.indexOf(searchText, startIndex);\n      if (searchTextIndex === -1) {\n        break;\n      }\n      startIndex = searchTextIndex + searchText.length;\n      // Save start index of this keyword.\n      searchTextIndexes.push(searchTextIndex);\n      // Save end index of this keyword.\n      searchTextIndexes.push(searchTextIndex + searchText.length);\n    } while (searchTextIndex < this.allTexts.length - 1);\n\n    if (searchTextIndexes.length === 0) {\n      return;\n    }\n\n    // Convert keyword indexes to visibleTextNode and offset.\n    let searchTextNodes: Array<any> = [];\n    let i = 0;\n    searchTextIndex = searchTextIndexes.shift()!;\n    for (let n = 0; n < this.visibleTextNodes.length; n++) {\n      const visibleTextNode = this.visibleTextNodes[n];\n      for (let c = 0; c < (visibleTextNode as any).length; c++) {\n        if (i === searchTextIndex) {\n          searchTextNodes.push({ node: visibleTextNode, offset: c });\n          searchTextIndex = searchTextIndexes.shift() || -1;\n\n          if (searchTextIndex === -1) {\n            break;\n          }\n        }\n        i++;\n      }\n\n      if (searchTextIndex === -1) {\n        break;\n      }\n    }\n\n    // Convert visibleTextNode and offset to range.\n    for (let i = 0; i < searchTextNodes.length / 2; i += 1) {\n      const r = new Range();\n      let start = searchTextNodes[i * 2];\n      let end = searchTextNodes[i * 2 + 1];\n      r.setStart(start.node, start.offset);\n      r.setEnd(end.node, end.offset);\n      this.searchTextRanges.push(r);\n    }\n  }\n\n  showedSearchTextIndex = 0;\n  searchTextPrev() {\n    if (this.showedSearchTextIndex > 0) {\n      this.showedSearchTextIndex--;\n    }\n    this.moveToSearchText(this.showedSearchTextIndex);\n  }\n\n  searchTextNext() {\n    if (this.showedSearchTextIndex < this.searchTextRanges.length - 1) {\n      this.showedSearchTextIndex++;\n    }\n    this.moveToSearchText(this.showedSearchTextIndex);\n  }\n\n  moveToSearchText(index: number) {\n    this.epubcfiFromSelectedString = '';\n    const sel = this.ePubIframe!.contentWindow!.getSelection()!;\n    sel.removeAllRanges();\n\n    setTimeout(() => {\n      const range = this.searchTextRanges[index];\n      this.ePubIframe!.contentWindow!.focus();\n      sel.addRange(range);\n\n      if (this.props.paginated) {\n        let timer: any;\n        timer = setInterval(() => {\n          if (this.epubcfiFromSelectedString !== '') {\n            clearInterval(timer);\n            this.rendition?.display(this.epubcfiFromSelectedString).then(() => {\n            });\n          }\n        }, 100);\n      } else {\n        range.startContainer.parentElement?.scrollIntoView();\n      }\n    }, 100);\n  }\n\n  buttonPrev() {\n    if (this.state.showSearchTextToast) {\n      this.searchTextPrev();\n    } else {\n      this.pagePrev();\n    }\n  }\n\n  buttonNext() {\n    if (this.state.showSearchTextToast) {\n      this.searchTextNext();\n    } else {\n      this.pageNext();\n    }\n  }\n\n  findCbetaHtmlLine(node: Node) {\n    let parent: HTMLElement | null | undefined = node.parentElement;\n    do {\n      if (parent?.getAttribute('l')) {\n        break;\n      }\n    } while ((parent = parent?.parentElement));\n    return parent;\n  }\n\n  // There is a max characters per utterance limit on Android Chrome.\n  // This max value is obtained by try and error.\n  maxCharsPerUtterance = 1000;\n  workTexts: Array<string> = [];\n  workTextsIndex = 0;\n  render() {\n    let header = (\n      <IonHeader>\n        <IonToolbar>\n          <IonTitle style={{ fontSize: 'var(--ui-font-size)' }}></IonTitle>\n\n          <IonButton hidden={this.isTopPage} fill=\"clear\" slot='start' onClick={e => this.props.history.goBack()}>\n            <IonIcon icon={arrowBack} slot='icon-only' />\n          </IonButton>\n\n          <IonButton hidden={!this.state.fetchError} fill=\"clear\" slot='end' onClick={e => this.fetchData()}>\n            <IonIcon icon={refreshCircle} slot='icon-only' />\n          </IonButton>\n\n          <IonButton hidden={!this.props.paginated} slot='end' onClick={ev => {\n            this.setState({ showJumpPageAlert: true });\n          }}>\n            <span className='uiFont' style={{ color: 'var(--color)' }}>頁{this.state.currentPage}/{this.state.pageCount}</span>\n          </IonButton>\n\n          <IonButton hidden={this.state.fetchError} fill=\"clear\" slot='end' onClick={e => {\n            const voices = speechSynthesis.getVoices();\n            if (voices.length === 0) {\n              return;\n            }\n\n            switch (this.state.speechState) {\n              case SpeechState.UNINITIAL:\n                const zhTwVoice = voices.find((voice: SpeechSynthesisVoice) => {\n                  return voice.lang.indexOf('zh-TW') > -1 || voice.lang.indexOf('zh_TW') > -1\n                })\n                if (zhTwVoice !== undefined) {\n                  this.speechSynthesisUtterance.voice = zhTwVoice;\n                }\n\n                let texts: string | undefined;\n                if (this.props.paginated) {\n                  texts = this.findTextsInPage(this.state.currentPage);\n                } else {\n                  texts = this.getRemainingWorkTextFromSelectedRange();\n                }\n\n                //const remainingWorkText = this.getRemainingWorkTextFromSelectedRange();\n                const workText = texts || this.ePubIframe?.contentDocument?.getElementById('body')?.innerText || '無法取得經文內容';\n\n                this.workTexts = [];\n                for (let i = 0; i < Math.ceil(workText.length / this.maxCharsPerUtterance); i++) {\n                  this.workTexts.push(workText.substring(i * this.maxCharsPerUtterance, (i + 1) * this.maxCharsPerUtterance));\n                }\n\n                this.workTextsIndex = 0;\n                this.speechSynthesisUtterance.text = this.workTexts[this.workTextsIndex];\n                this.speechSynthesisUtterance.rate = this.props.speechRate;\n                // Improve reliability by cancel first.\n                speechSynthesis.cancel();\n                speechSynthesis.speak(this.speechSynthesisUtterance);\n                this.setState({ speechState: SpeechState.SPEAKING });\n                break;\n              case SpeechState.SPEAKING:\n                // Unfortunately, pause() doesn't work on most Chrome browser.\n                // Instead, we support stop.\n                /*\n                speechSynthesis.pause();\n                this.setState({speechState: SpeechState.PAUSE});\n                */\n                speechSynthesis.cancel();\n                this.setState({ speechState: SpeechState.UNINITIAL });\n                break;\n              case SpeechState.PAUSE:\n                speechSynthesis.resume();\n                this.setState({ speechState: SpeechState.SPEAKING });\n                break;\n            }\n          }}>\n            <IonIcon icon={this.state.speechState === SpeechState.SPEAKING ? stopCircle : musicalNotes} slot='icon-only' />\n          </IonButton>\n\n          <IonButton hidden={this.state.fetchError} fill=\"clear\" slot='end' onClick={e => {\n            this.setState({ popover: { show: false, event: null } });\n            this.addBookmarkHandler();\n          }}>\n            <IonIcon icon={bookmark} slot='icon-only' />\n          </IonButton>\n\n          <IonButton fill=\"clear\" slot='end' onClick={e => this.setState({ popover: { show: true, event: e.nativeEvent } })}>\n            <IonIcon ios={ellipsisHorizontal} md={ellipsisVertical} slot='icon-only' />\n          </IonButton>\n\n          <IonPopover\n            isOpen={this.state.popover.show}\n            event={this.state.popover.event}\n            onDidDismiss={e => { this.setState({ popover: { show: false, event: null } }) }}\n          >\n            <IonList>\n              <IonItem button onClick={e => {\n                this.setState({ popover: { show: false, event: null } });\n                this.props.history.push(`/catalog/work/${this.props.match.params.work}`);\n              }}>\n                <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                <IonIcon icon={home} slot='start' />\n                <IonLabel className='ion-text-wrap uiFont'>回經目錄</IonLabel>\n              </IonItem>\n\n              <IonItem button onClick={e => {\n                this.props.history.push(`/${this.props.match.params.tab}`);\n                this.setState({ popover: { show: false, event: null } });\n              }}>\n                <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                <IonIcon icon={home} slot='start' />\n                <IonLabel className='ion-text-wrap uiFont'>回首頁</IonLabel>\n              </IonItem>\n\n              <IonItem button onClick={e => {\n                this.setState({ popover: { show: false, event: null } });\n                const selectedText = this.getSelectedString();\n                Globals.copyToClipboard(selectedText);\n                this.setState({ showToast: true, toastMessage: `複製文字成功` });\n              }}>\n                <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                <IonIcon icon={copy} slot='start' />\n                <IonLabel className='ion-text-wrap uiFont'>複製文字</IonLabel>\n              </IonItem>\n\n              <IonItem button onClick={e => {\n                this.setState({ popover: { show: false, event: null } });\n                this.setState({ showSearchTextToast: false, showSearchTextAlert: true });\n              }}>\n                <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                <IonIcon icon={search} slot='start' />\n                <IonLabel className='ion-text-wrap uiFont'>搜尋文字</IonLabel>\n              </IonItem>\n              <IonItem button onClick={e => {\n                this.setState({ popover: { show: false, event: null } });\n                this.setState({ showSearchAlert: true });\n              }}>\n                <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                <IonIcon icon={search} slot='start' />\n                <IonLabel className='ion-text-wrap uiFont'>搜尋經書</IonLabel>\n              </IonItem>\n\n              <IonItem button onClick={e => {\n                this.setState({ popover: { show: false, event: null } });\n                const selectedText = this.getSelectedString();\n                if (selectedText === '') {\n                  this.setState({ showNoSelectedTextAlert: true });\n                  return;\n                }\n\n                this.props.history.push({\n                  pathname: `/dictionary/search/${selectedText}`,\n                });\n              }}>\n                <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                <IonIcon icon={book} slot='start' />\n                <IonLabel className='ion-text-wrap uiFont'>查詞典</IonLabel>\n              </IonItem>\n\n              <IonItem button onClick={e => {\n                this.setState({ popover: { show: false, event: null } });\n                const selectedText = this.getSelectedString();\n                if (selectedText === '') {\n                  this.setState({ showNoSelectedTextAlert: true });\n                  return;\n                }\n\n                this.props.history.push({\n                  pathname: `/dictionary/searchWord/${selectedText}`,\n                });\n              }}>\n                <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                <IonIcon icon={book} slot='start' />\n                <IonLabel className='ion-text-wrap uiFont'>查字典</IonLabel>\n              </IonItem>\n\n              <IonItem button onClick={e => {\n                this.setState({ popover: { show: false, event: null } });\n                this.ePubIframe?.contentWindow?.print();\n              }}>\n                <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                <IonIcon icon={print} slot='start' />\n                <IonLabel className='ion-text-wrap uiFont'>列印</IonLabel>\n              </IonItem>\n\n              <IonItem button onClick={ev => {\n                this.setState({ popover: { show: false, event: null } });\n                const sel = this.ePubIframe?.contentDocument?.getSelection()!;\n                if ((sel.rangeCount || 0) > 0 && sel.getRangeAt(0).toString().length > 0) {\n                  const selectedText = sel!.toString();\n                  const range = sel.getRangeAt(0);\n                  let startLine = this.findCbetaHtmlLine(range.startContainer)?.getAttribute('l');\n                  let endLine = this.findCbetaHtmlLine(range.endContainer)?.getAttribute('l');\n                  sel?.removeAllRanges();\n                  if (startLine == null || endLine == null) {\n                    this.setState({ showsCitationFail: true });\n                    return;\n                  }\n                  const startLineMatches = /0*([1-9]*)([a-z])0*([1-9]*)/.exec(startLine!)!;\n                  const startLineModified = `${startLineMatches[1]}${startLineMatches[2]}${startLineMatches[3]}`;\n                  const endLineModified = /0*([1-9]*)([a-z])0*([1-9]*)/.exec(endLine!)![3];\n\n                  let lineInfo = `${startLineModified}`;\n                  if (startLine !== endLine) {\n                    lineInfo += `-${endLineModified}`;\n                  }\n                  const citation = `《${this.state.workInfo.title}》卷${this.props.match.params.path}：「${selectedText}」(CBETA, ${this.state.workInfo.vol}, no. ${/[^0-9]*(.*)/.exec(this.state.workInfo.work)![1]}, p. ${lineInfo})`;\n                  navigator.clipboard && navigator.clipboard.writeText(citation);\n                  this.setState({ showsCopyToClipboardSuccess: true });\n                } else {\n                  this.setState({ showNoSelectedTextAlert: true });\n                }\n              }}>\n                <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                <IonIcon icon={shareSocial} slot='start' />\n                <IonLabel className='ion-text-wrap uiFont'>引用文章</IonLabel>\n              </IonItem>\n\n              <IonItem button onClick={ev => {\n                let sharedUrl = window.location.href.split('?')[0];\n                const selectedText = this.getSelectedString();\n                if (selectedText !== '') {\n                  sharedUrl += `?bookmark=${this.epubcfiFromSelectedString}`;\n                }\n\n                this.props.dispatch({\n                  type: \"TMP_SET_KEY_VAL\",\n                  key: 'shareTextModal',\n                  val: {\n                    show: true,\n                    text: decodeURIComponent(sharedUrl),\n                  },\n                });\n              }}>\n                <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                <IonIcon icon={shareSocial} slot='start' />\n                <IonLabel className='ion-text-wrap uiFont'>分享此頁</IonLabel>\n              </IonItem>\n            </IonList>\n          </IonPopover>\n        </IonToolbar>\n      </IonHeader>\n    );\n\n    const fabButtonOpacity = 0.2;\n    let navButtons = (<>\n      <IonFab vertical='center' horizontal='start' slot='fixed'>\n        <IonFabButton style={{ opacity: fabButtonOpacity }} onClick={e => this.props.rtlVerticalLayout ? this.buttonNext() : this.buttonPrev()}\n          onPointerDown={e => {\n            e.currentTarget.style.setProperty('opacity', '1');\n          }}\n          onPointerEnter={e => {\n            e.currentTarget.style.setProperty('opacity', '1');\n          }}\n          onPointerUp={e => {\n            // Hide button on pointer up for touch devices.\n            if (Globals.isTouchDevice()) {\n              e.currentTarget.style.setProperty('opacity', `${fabButtonOpacity}`);\n            }\n          }}\n          onPointerLeave={e => {\n            e.currentTarget.style.setProperty('opacity', `${fabButtonOpacity}`);\n          }}>\n          <IonIcon icon={arrowBack} />\n        </IonFabButton>\n      </IonFab>\n      <IonFab vertical='center' horizontal='end' slot='fixed'>\n        <IonFabButton style={{ opacity: fabButtonOpacity }} onClick={e => this.props.rtlVerticalLayout ? this.buttonPrev() : this.buttonNext()}\n          onPointerDown={e => {\n            e.currentTarget.style.setProperty('opacity', '1');\n          }}\n          onPointerEnter={e => {\n            e.currentTarget.style.setProperty('opacity', '1');\n          }}\n          onPointerUp={e => {\n            if (Globals.isTouchDevice()) {\n              e.currentTarget.style.setProperty('opacity', `${fabButtonOpacity}`);\n            }\n          }}\n          onPointerLeave={e => {\n            e.currentTarget.style.setProperty('opacity', `${fabButtonOpacity}`);\n          }}>\n          <IonIcon icon={arrowForward} />\n        </IonFabButton>\n      </IonFab>\n    </>);\n\n    if (!this.bookCreated && this.state.htmlStr != null) {\n      this.html2Epub();\n    }\n\n    return (\n      <IonPage>\n        {header}\n        <IonContent>\n          {this.props.paginated || this.state.showSearchTextToast ? navButtons : <></>}\n\n          <IonLoading\n            cssClass='uiFont'\n            isOpen={this.state.isLoading}\n            onDidDismiss={() => this.setState({ isLoading: false })}\n            message={'載入中...'}\n          />\n\n          {this.state.fetchError ? Globals.fetchErrorContent : <></>}\n\n          <div id='cbetarEPubView' style={{ width: '100%', height: '100%', userSelect: \"text\", WebkitUserSelect: \"text\" }}>\n          </div>\n\n          <IonAlert\n            cssClass='uiFont'\n            isOpen={this.state.showJumpPageAlert}\n            header={'跳頁'}\n            subHeader={`請輸入頁碼(1 - ${this.state.pageCount})`}\n            inputs={[\n              {\n                name: 'name0',\n                type: 'number',\n                min: 1,\n                max: this.state.pageCount,\n                value: this.state.currentPage,\n              },\n            ]}\n            buttons={[\n              {\n                text: '取消',\n                role: 'cancel',\n                cssClass: 'secondary uiFont',\n                handler: () => this.setState({ showJumpPageAlert: false }),\n              },\n              {\n                text: '確定',\n                cssClass: 'primary uiFont',\n                handler: (value) => {\n                  this.setState({ showJumpPageAlert: false });\n                  this.jumpToPage(value.name0);\n                },\n              }\n            ]}\n          />\n\n          <SearchAlert\n            {...{\n              showSearchAlert: (this.state as any).showSearchAlert,\n              finish: () => { this.setState({ showSearchAlert: false }) }, ...this.props\n            }}\n          />\n\n          <IonAlert\n            cssClass='uiFont'\n            isOpen={this.state.showNoSelectedTextAlert}\n            backdropDismiss={false}\n            header='失敗'\n            message='請確認是否已選擇一段文字，然後再執行所選的功能!'\n            buttons={[\n              {\n                text: '確定',\n                cssClass: 'primary uiFont',\n                handler: (value) => {\n                  this.setState({\n                    showNoSelectedTextAlert: false,\n                  });\n                },\n              }\n            ]}\n          />\n\n          <IonToast\n            cssClass='uiFont'\n            isOpen={this.state.showAddBookmarkSuccess}\n            onDidDismiss={() => this.setState({ showAddBookmarkSuccess: false })}\n            message=\"書籤新增成功！\"\n            duration={2000}\n          />\n\n          <IonToast\n            cssClass='uiFont'\n            isOpen={this.state.showsCopyToClipboardSuccess}\n            onDidDismiss={() => this.setState({ showsCopyToClipboardSuccess: false })}\n            message=\"已複製到剪貼簿！\"\n            duration={2000}\n          />\n\n          <IonToast\n            cssClass='uiFont'\n            isOpen={this.state.showsCitationFail}\n            onDidDismiss={() => this.setState({ showsCitationFail: false })}\n            message=\"所選文字無法引用！\"\n            duration={2000}\n          />\n\n          <IonAlert\n            cssClass='uiFont'\n            isOpen={this.state.showSearchTextAlert}\n            header={'搜尋文字'}\n            subHeader='按下搜尋後，左右方向鈕變為搜尋文字方向鈕。按下方通知UI關閉鈕，離開搜尋文字模式。'\n            inputs={[\n              {\n                name: 'name0',\n                type: 'search',\n                placeholder: '例:如是我聞'\n              },\n            ]}\n            buttons={[\n              {\n                text: '取消',\n                role: 'cancel',\n                cssClass: 'secondary uiFont',\n                handler: () => this.setState({ showSearchTextAlert: false }),\n              },\n              {\n                text: '搜尋',\n                cssClass: 'primary uiFont',\n                handler: (value) => {\n                  if (value.name0 === '') {\n                    this.setState({ showSearchTextAlert: false });\n                    return;\n                  }\n\n                  this.findSearchTextRanges(value.name0);\n                  if (this.searchTextRanges.length === 0) {\n                    this.setState({ showSearchTextAlert: false, showToast: true, toastMessage: `找不到文字：${value.name0}` });\n                  } else {\n                    this.setState({ showSearchTextAlert: false, showSearchTextToast: true, searchText: value.name0 });\n                    this.searchTextPrev();\n                  }\n                },\n              },\n            ]}\n          />\n\n          <IonToast\n            cssClass='uiFont'\n            isOpen={this.state.showSearchTextToast}\n            onDidDismiss={() => this.setState({ showSearchTextToast: false })}\n            message={`搜尋：${this.state.searchText}`}\n            buttons={[\n              {\n                text: '關閉',\n                role: 'cancel',\n                handler: () => this.setState({ showSearchTextToast: false })\n              }\n            ]}\n          />\n\n          <IonToast\n            cssClass='uiFont'\n            isOpen={this.state.showToast}\n            onDidDismiss={() => this.setState({ showToast: false })}\n            message={this.state.toastMessage}\n            duration={2000}\n          />\n        </IonContent>\n      </IonPage>\n    );\n  }\n};\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n    bookmarks: state.settings.bookmarks,\n    fontSize: state.settings.fontSize,\n    showComments: state.settings.showComments,\n    paginated: state.settings.paginated,\n    rtlVerticalLayout: state.settings.rtlVerticalLayout,\n    settings: state.settings,\n    scrollbarSize: state.settings.scrollbarSize,\n    speechRate: state.settings.speechRate,\n  }\n};\n\nconst EPubViewPage = withIonLifeCycle(_EPubViewPage);\n\nexport default connect(\n  mapStateToProps,\n)(EPubViewPage);\n","export class Catalog {\r\n    n: string;\r\n    nodeType: string | null | undefined;\r\n    label: string;\r\n    work: string | null | undefined;\r\n    file: string | null | undefined;\r\n\r\n    constructor(json: any) {\r\n        this.n = json.n;\r\n        this.nodeType = json.node_type;\r\n        this.label = json.label;\r\n        this.work = json.work;\r\n        this.file = json.file;\r\n    }\r\n}\r\n","import React from 'react';\nimport { IonAlert } from '@ionic/react';\nimport { RouteComponentProps } from 'react-router-dom';\n\ninterface Props {\n  showSearchAlert: boolean;\n  finish: Function;\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n  tab: string;\n  path: string;\n}> { }\n\nclass SearchAlert extends React.Component<PageProps> {\n  /*constructor(props: any) {\n    super(props);\n  }*/\n\n  render() {\n    return (\n      <IonAlert\n        cssClass='uiFont'\n        isOpen={this.props.showSearchAlert}\n        header={'搜尋經書'}\n        subHeader='輸入搜尋'\n        inputs={[\n          {\n            name: 'name0',\n            type: 'search',\n            placeholder: '例:金剛般若'\n          },\n        ]}\n        buttons={[\n          {\n            text: '取消',\n            role: 'cancel',\n            cssClass: 'secondary uiFont',\n            handler: () => this.props.finish(),\n          },\n          {\n            text: '搜尋目錄',\n            cssClass: 'primary uiFont',\n            handler: (value) => {\n              this.props.finish();\n              this.props.history.push(`/catalog/search/${value.name0}`);\n            },\n          },\n          {\n            text: '全文檢索',\n            cssClass: 'primary uiFont',\n            handler: (value) => {\n              this.props.finish();\n              this.props.history.push(`/catalog/fulltextsearch/${value.name0}`);\n            },\n          }\n        ]}\n      />\n    );\n  }\n};\n\nexport default SearchAlert;\n","import React from 'react';\nimport { IonContent, IonHeader, IonPage, IonToolbar, IonList, IonItem, IonLabel, IonButton, IonIcon, withIonLifeCycle, IonLoading, IonSelectOption, IonSelect } from '@ionic/react';\nimport { RouteComponentProps } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport './CatalogPage.css';\nimport { Catalog } from '../models/Catalog';\nimport Globals from '../Globals';\nimport { Bookmark, BookmarkType } from '../models/Bookmark';\nimport { bookmark, arrowBack, home, search, shareSocial, refreshCircle } from 'ionicons/icons';\nimport SearchAlert from '../components/SearchAlert';\nimport queryString from 'query-string';\n\nconst famousJuans = [\n  { title: '般若波羅蜜多心經', url: '/catalog/juan/T0251/1' },\n  { title: '金剛般若波羅蜜經', url: '/catalog/juan/T0235/1' },\n  { title: '佛說阿彌陀經', url: '/catalog/juan/T0366/1' },\n  { title: '藥師琉璃光如來本願功德經', url: '/catalog/juan/T0450/1' },\n  { title: '佛說觀彌勒菩薩上生兜率天經', url: '/catalog/juan/T0452/1' },\n  { title: '地藏菩薩本願經', url: '/catalog/juan/T0412/1' },\n  { title: '妙法蓮華經觀世音菩薩普門品經', url: '/catalog/juan/T0262/7' },\n  { title: '大佛頂如來密因修證了義諸菩薩萬行首楞嚴經卷第一', url: '/catalog/juan/T0945/1' },\n  { title: '佛說法滅盡經', url: '/catalog/juan/T0396/1' },\n];\n\ninterface Props {\n  dispatch: Function;\n  bookmarks: [Bookmark];\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n  tab: string;\n  type: string;\n  path: string;\n}> { }\n\ninterface State {\n  topCatalogsType: number;\n  showSearchAlert: boolean;\n  fetchError: boolean;\n  catalogs: Array<Catalog>;\n  pathLabel: string;\n  isLoading: boolean;\n}\n\nclass _CatalogPage extends React.Component<PageProps, State> {\n  constructor(props: any) {\n    super(props);\n    this.state = {\n      topCatalogsType: 0,\n      fetchError: false,\n      catalogs: [],\n      pathLabel: '',\n      showSearchAlert: false,\n      isLoading: false,\n    };\n  }\n\n  ionViewWillEnter() {\n    console.log(`${this.props.match.url} will enter.`);\n    let topCatalogsType = -1;\n    switch (this.props.match.url) {\n      case '/catalog': topCatalogsType = 0; break;\n      case '/catalog/volumes': topCatalogsType = 1; break;\n      case '/catalog/famous': topCatalogsType = 2; break;\n      default: topCatalogsType = -1; break;\n    }\n    this.setState({ topCatalogsType: topCatalogsType });\n    //console.log(this.props.history.length);\n    this.fetchData(this.props.match.params.path);\n  }\n\n  componentDidMount() {\n    console.log(`did mount: ${this.props.match.url}`);\n  }\n\n  /* * /\n  ionViewDidEnter() {\n    console.log(`${this.props.match.url} did enter.`);\n    //console.log(this.props.history.length);\n  }\n\n  ionViewWillLeave() {\n    console.log(`${this.props.match.url} will leave.`);\n    //console.log(this.props.history.length);\n  }\n\n  ionViewDidLeave() {\n    console.log(`${this.props.match.url} did leave.`);\n    //console.log(this.props.history.length);\n  }\n\n  componentWillUnmount() {\n    console.log(`${this.props.match.url} unmount`);\n  }\n\n\n  componentWillReceiveProps(nextProps: any) {\n    console.log(`route changed: ${nextProps.match.url}`)\n  }\n\n  /**/\n\n  async fetchData(path: string) {\n    //console.log('fetch');\n    this.setState({ isLoading: true });\n    let catalogs = new Array<Catalog>();\n    let pathLabel = '';\n\n    switch (this.state.topCatalogsType) {\n      case 0:\n      case 1:\n        return this.fetchTopCatalogs(this.state.topCatalogsType);\n      case -1:\n        try {\n          const res = await Globals.axiosInstance.get(`/catalog_entry?q=${path}`, {\n            responseType: 'arraybuffer',\n          });\n          const obj = JSON.parse(new TextDecoder().decode(res.data)) as any;\n          const data = obj.results as [any];\n          catalogs = data.map((json) => new Catalog(json));\n\n          const parentPath = this.parentPath(path);\n          // path is not a top catalog.\n          if (parentPath !== '') {\n            pathLabel = obj.label;\n          } else {\n            const topCatalogsByCatLabel = Globals.topCatalogsByCat[path];\n            pathLabel = (topCatalogsByCatLabel !== undefined) ? topCatalogsByCatLabel : Globals.topCatalogsByVol[path];\n          }\n\n          this.setState({ fetchError: false, isLoading: false, catalogs: catalogs, pathLabel });\n          return true;\n        } catch (e) {\n          console.error(e);\n          console.error(new Error().stack);\n          this.setState({ fetchError: true, isLoading: false, pathLabel: '' });\n          return false;\n        }\n      case 2:\n        this.setState({ fetchError: false, isLoading: false, pathLabel: '' });\n        break;\n    }\n  }\n\n  fetchTopCatalogs(topCatalogsType: number) {\n    let catalogs = Array<Catalog>();\n\n    const topCatalogs = topCatalogsType ? Globals.topCatalogsByVol : Globals.topCatalogsByCat;\n\n    Object.keys(topCatalogs).forEach((key) => {\n      const catalog: Catalog = {\n        n: key,\n        nodeType: null,\n        work: null,\n        label: topCatalogs[key],\n        file: null,\n      };\n      catalogs.push(catalog);\n    });\n    this.setState({ fetchError: false, isLoading: false, catalogs: catalogs, pathLabel: '' });\n    return true;\n  }\n\n  get isTopCatalog() {\n    return ['/catalog', '/catalog/volumes', '/catalog/famous'].reduce((prev, curr) => prev || curr === this.props.match.url, false);\n  }\n\n  parentPath(path: string) {\n    let paths = path.split('.');\n    paths.pop();\n    return paths.join('.');\n  }\n\n  addBookmarkHandler() {\n    this.props.dispatch({\n      type: \"ADD_BOOKMARK\",\n      bookmark: new Bookmark({\n        type: BookmarkType.CATALOG,\n        uuid: this.props.match.params.path,\n        selectedText: this.state.pathLabel,\n        epubcfi: '',\n        fileName: '',\n        work: null,\n      }),\n    });\n  }\n\n  delBookmarkHandler() {\n    this.props.dispatch({\n      type: \"DEL_BOOKMARK\",\n      uuid: this.props.match.params.path,\n    });\n  }\n\n  get hasBookmark() {\n    return this.props.bookmarks.find(\n      (e) => e.type === BookmarkType.CATALOG && e.uuid === this.props.match.params.path) != null;\n  }\n\n  getRows() {\n    let rows = Array<object>();\n    this.state.catalogs.forEach((catalog: Catalog, index: number) => {\n      let routeLink = '';\n      const isHtmlNode = catalog.nodeType === 'html';\n      if (isHtmlNode) {\n        routeLink = `/catalog/juan/${catalog.n}/1`;\n      } else if (catalog.work == null) {\n        routeLink = `/catalog/catalog/${catalog.n}`;\n      } else {\n        routeLink = `/catalog/work/${catalog.work}`;\n      }\n      rows.push(\n        <IonItem key={`${catalog.n}item` + index} button={true} onClick={async event => {\n          event.preventDefault();\n          this.props.history.push({\n            pathname: routeLink,\n            search: queryString.stringify(isHtmlNode ? { file: catalog.file!, title: catalog.label } : {}),\n          });\n        }}>\n          <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n          <IonLabel className='ion-text-wrap uiFont' key={`${catalog.n}label` + index}>\n            {catalog.label}\n          </IonLabel>\n        </IonItem>\n      );\n    });\n    return rows;\n  }\n\n  getFamousJuanRows() {\n    let rows = Array<object>();\n    famousJuans.forEach(({ title, url }, i) => {\n      rows.push(\n        <IonItem key={`famousJuanItem_` + i} button={true} onClick={async event => {\n          this.props.history.push(url);\n        }}>\n          <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n          <IonLabel className='ion-text-wrap uiFont' key={`famousItemLabel_` + i}>\n            {title}\n          </IonLabel>\n        </IonItem>\n      );\n    });\n    return rows;\n  }\n\n  render() {\n    //console.log(`${this.props.match.url} render`)\n\n    let list = <IonList>\n      {this.state.topCatalogsType === 2 ? this.getFamousJuanRows() : this.getRows()}\n    </IonList>\n\n    return (\n      <IonPage>\n        <IonHeader>\n          <IonToolbar>\n            <IonButton hidden={this.isTopCatalog} fill=\"clear\" slot='start' onClick={e => this.props.history.goBack()}>\n              <IonIcon icon={arrowBack} slot='icon-only' />\n            </IonButton>\n\n            <IonSelect hidden={!this.isTopCatalog} slot='start'\n              value={this.state.topCatalogsType}\n              style={{ fontSize: 'var(--ui-font-size)' }}\n              interface='popover'\n              interfaceOptions={{ cssClass: 'cbetar2themes' }}\n              onIonChange={e => {\n                const value = e.detail.value;\n                let nextPage = '';\n                switch (value) {\n                  case 0: nextPage = '/catalog'; break;\n                  case 1: nextPage = '/catalog/volumes'; break;\n                  case 2: nextPage = '/catalog/famous'; break;\n                  case -1: nextPage = this.props.match.url; break;\n                }\n                if (this.props.match.url !== nextPage) {\n                  this.props.history.push(nextPage);\n                }\n              }}>\n              <IonSelectOption className='uiFont' value={0}>部分類</IonSelectOption>\n              <IonSelectOption className='uiFont' value={1}>冊分類</IonSelectOption>\n              <IonSelectOption className='uiFont' value={2}>知名經典</IonSelectOption>\n            </IonSelect>\n\n            <IonButton hidden={!this.state.fetchError} fill=\"clear\" slot='end' onClick={e => this.fetchData(this.props.match.params.path)}>\n              <IonIcon icon={refreshCircle} slot='icon-only' />\n            </IonButton>\n\n            <IonButton hidden={this.isTopCatalog} fill=\"clear\" color={this.hasBookmark ? 'warning' : 'primary'} slot='end' onClick={e => this.hasBookmark ? this.delBookmarkHandler() : this.addBookmarkHandler()}>\n              <IonIcon icon={bookmark} slot='icon-only' />\n            </IonButton>\n\n            <IonButton hidden={this.isTopCatalog} fill=\"clear\" slot='end' onClick={e => this.props.history.push(`/${this.props.match.params.tab}`)}>\n              <IonIcon icon={home} slot='icon-only' />\n            </IonButton>\n\n            <IonButton fill=\"clear\" slot='end' onClick={e => this.setState({ showSearchAlert: true })}>\n              <IonIcon icon={search} slot='icon-only' />\n            </IonButton>\n\n            <IonButton fill=\"clear\" slot='end' onClick={e => {\n              this.props.dispatch({\n                type: \"TMP_SET_KEY_VAL\",\n                key: 'shareTextModal',\n                val: {\n                  show: true,\n                  text: decodeURIComponent(window.location.href),\n                },\n              });\n            }}>\n              <IonIcon icon={shareSocial} slot='icon-only' />\n            </IonButton>\n          </IonToolbar>\n        </IonHeader>\n        <IonContent>\n          {this.state.fetchError ? Globals.fetchErrorContent :\n            <>\n              <div className='uiFontX2' style={{ color: 'var(--ion-color-primary)' }}>{this.state.pathLabel}</div>\n              {list}\n            </>\n          }\n\n          <SearchAlert\n            {...{\n              showSearchAlert: this.state.showSearchAlert,\n              finish: () => { this.setState({ showSearchAlert: false }) }, ...this.props\n            }}\n          />\n\n          <div style={{ fontSize: 'var(--ui-font-size)', textAlign: 'center' }}><a href=\"https://github.com/MrMYHuang/cbetar2#bookmark\" target=\"_new\">書籤新增說明</a></div>\n          <div style={{ fontSize: 'var(--ui-font-size)', textAlign: 'center' }}><a href=\"https://github.com/MrMYHuang/cbetar2#search\" target=\"_new\">搜尋經書教學</a></div>\n\n          <IonLoading\n            cssClass='uiFont'\n            isOpen={this.state.isLoading}\n            onDidDismiss={() => this.setState({ isLoading: false })}\n            message={'載入中...'}\n          />\n        </IonContent>\n      </IonPage>\n    );\n  }\n};\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n    bookmarks: state.settings.bookmarks,\n    state: state,\n  }\n};\n\n//const mapDispatchToProps = {};\n\nconst CatalogPage = withIonLifeCycle(_CatalogPage);\n\nexport default connect(\n  mapStateToProps,\n)(CatalogPage);\n","import React from 'react';\nimport { IonContent, IonHeader, IonPage, IonToolbar, IonList, IonItem, IonLabel, withIonLifeCycle, IonButton, IonIcon, IonToast, IonLoading } from '@ionic/react';\nimport { RouteComponentProps } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport './WorkPage.css';\nimport { Work, WorkChapter, WorkListType } from '../models/Work';\nimport Globals from '../Globals';\nimport { bookmark, arrowBack, home, search, shareSocial, refreshCircle } from 'ionicons/icons';\nimport { Bookmark, BookmarkType } from '../models/Bookmark';\nimport SearchAlert from '../components/SearchAlert';\n\ninterface Props {\n  dispatch: Function;\n  bookmarks: [Bookmark];\n  workListType: WorkListType;\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n  tab: string;\n  path: string;\n  label: string;\n}> { }\n\ninterface State {\n  work: Work | null;\n  showSearchAlert: boolean;\n  showAddBookmarkDone: boolean;\n  isLoading: boolean;\n  fetchError: boolean;\n}\n\nclass _WorkPage extends React.Component<PageProps, State> {\n  constructor(props: any) {\n    super(props);\n    this.state = {\n      work: null,\n      showSearchAlert: false,\n      showAddBookmarkDone: false,\n      isLoading: false,\n      fetchError: false,\n    }\n  }\n\n  ionViewWillEnter() {\n    //console.log( `${this.props.match.params} will enter` );\n    this.fetchWork(this.props.match.params.path);\n  }\n\n  componentDidMount() {\n  }\n\n  async fetchWork(path: string) {\n    this.setState({ isLoading: true });\n    let work: Work | null;\n    if (this.hasBookmark) {\n      work = this.bookmark!.work!;\n    } else {\n      try {\n        const res = await Globals.axiosInstance.get(`/works?work=${path}`, {\n          responseType: 'arraybuffer',\n        });\n        const data = JSON.parse(new TextDecoder().decode(res.data));\n        const works = data.results as [Work];\n        work = works[0];\n\n        const resToc = await Globals.axiosInstance.get(`/toc?work=${path}`) as any;\n        work.mulu = (resToc.data.results[0].mulu as WorkChapter[]).map((wc) => new WorkChapter(wc));\n\n      } catch (err) {\n        console.error(err);\n        console.error(new Error().stack);\n        this.setState({ fetchError: true, isLoading: false });\n        return false;\n      }\n    }\n\n    this.setState({ fetchError: false, isLoading: false, work: work });\n    return true;\n  }\n\n  fetchJuan = '';\n  async saveJuans() {\n    let work = this.state.work!;\n    let juans = work.juan_list.split(',');\n    for (let i = 0; i < juans.length; i++) {\n      this.fetchJuan = juans[i];\n      try {\n        const res = await Globals.fetchJuan(work.work, this.fetchJuan, null);\n        Globals.saveFileToIndexedDB(Globals.getFileName(work.work, this.fetchJuan), res.htmlStr);\n      } catch (err) {\n        console.error(`Fetching juan ${i} failed! ${err}`);\n        console.error(new Error().stack);\n      }\n    }\n    this.setState({ showAddBookmarkDone: true });\n  }\n\n  async addBookmarkHandler() {\n    await this.saveJuans();\n    this.props.dispatch({\n      type: \"ADD_BOOKMARK\",\n      bookmark: new Bookmark({\n        type: BookmarkType.WORK,\n        uuid: this.props.match.params.path,\n        selectedText: this.state.work!.title,\n        epubcfi: '',\n        fileName: '',\n        work: this.state.work!,\n      }),\n    });\n  }\n\n  delBookmarkHandler() {\n    this.props.dispatch({\n      type: \"DEL_BOOKMARK\",\n      uuid: this.props.match.params.path,\n    });\n  }\n\n  get isTopPage() {\n    return this.props.match.url === '/catalog';\n  }\n\n  get bookmark() {\n    return this.props.bookmarks.find(\n      (e) => e.type === BookmarkType.WORK && e.uuid === this.props.match.params.path);\n  }\n\n  get hasBookmark() {\n    return this.bookmark != null;\n  }\n\n  getRowsByChapter() {\n    let work = this.state.work;\n    const mulu = work?.mulu;\n    let rows = Array<object>();\n    for (let i = 0; i < (mulu?.length || -1); i++) {\n      let routeLink = `/catalog/juan/${work?.work}/${mulu![i].juan}`;\n      rows.push(\n        <IonItem key={`chapterItem` + i} button={true} onClick={async event => {\n          event.preventDefault();\n          this.props.history.push({\n            pathname: routeLink,\n          });\n        }}>\n          <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n          <IonLabel className='ion-text-wrap uiFont' key={`chapterLabel` + i}>\n            {mulu![i].title}\n          </IonLabel>\n        </IonItem>\n      );\n    }\n    return rows;\n  }\n\n  getRowsByJuan() {\n    let work = this.state.work;\n    let rows = Array<object>();\n    let juans = work?.juan_list.split(',');\n    for (let i = 0; i < (juans?.length || -1); i++) {\n      //if (work.nodeType == 'html')\n      let routeLink = `/catalog/juan/${work?.work}/${juans![i]}`;\n      rows.push(\n        <IonItem key={`juanItem` + i} button={true} onClick={async event => {\n          event.preventDefault();\n          this.props.history.push({\n            pathname: routeLink,\n          });\n        }}>\n          <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n          <IonLabel className='ion-text-wrap uiFont' key={`juanLabel` + i}>\n            卷{juans![i]}\n          </IonLabel>\n        </IonItem>\n      );\n    }\n    return rows;\n  }\n\n  //work = this.works[0] as Work;\n  render() {\n    return (\n      <IonPage>\n        <IonHeader>\n          <IonToolbar>\n            <IonButton hidden={this.isTopPage} fill=\"clear\" slot='start' onClick={e => this.props.history.goBack()}>\n              <IonIcon icon={arrowBack} slot='icon-only' />\n            </IonButton>\n\n            <IonButton slot='start' onClick={ev => {\n              const newWorkListType = this.props.workListType === WorkListType.BY_CHAPTER ? WorkListType.BY_JUAN : WorkListType.BY_CHAPTER;\n              this.props.dispatch({\n                type: \"TMP_SET_KEY_VAL\",\n                key: 'workListType',\n                val: newWorkListType\n              });\n            }}>\n              <span className='uiFont' style={{ color: 'var(--color)' }}>{this.props.workListType === WorkListType.BY_CHAPTER ? '分品' : '分卷'}</span>\n            </IonButton>\n\n            <IonButton hidden={!this.state.fetchError} fill=\"clear\" slot='end' onClick={e => this.fetchWork(this.props.match.params.path)}>\n              <IonIcon icon={refreshCircle} slot='icon-only' />\n            </IonButton>\n\n            <IonButton fill=\"clear\" color={this.hasBookmark ? 'warning' : 'primary'} slot='end' onClick={e => this.hasBookmark ? this.delBookmarkHandler() : this.addBookmarkHandler()}>\n              <IonIcon icon={bookmark} slot='icon-only' />\n            </IonButton>\n\n            <IonButton fill=\"clear\" slot='end' onClick={e => this.props.history.push(`/${this.props.match.params.tab}`)}>\n              <IonIcon icon={home} slot='icon-only' />\n            </IonButton>\n\n            <IonButton fill=\"clear\" slot='end' onClick={e => this.setState({ showSearchAlert: true })}>\n              <IonIcon icon={search} slot='icon-only' />\n            </IonButton>\n\n            <IonButton fill=\"clear\" slot='end' onClick={e => {\n              this.props.dispatch({\n                type: \"TMP_SET_KEY_VAL\",\n                key: 'shareTextModal',\n                val: {\n                  show: true,\n                  text: decodeURIComponent(window.location.href),\n                },\n              });\n            }}>\n              <IonIcon icon={shareSocial} slot='icon-only' />\n            </IonButton>\n          </IonToolbar>\n        </IonHeader>\n        <IonContent>\n          <div className='uiFontX2' style={{ color: 'var(--ion-color-primary)' }}>{this.state.work?.title}</div>\n          {\n            this.state.fetchError ? Globals.fetchErrorContent :\n              <IonList>\n                {this.props.workListType === WorkListType.BY_CHAPTER ? this.getRowsByChapter() : this.getRowsByJuan()}\n              </IonList>\n          }\n\n          <SearchAlert\n            {...{\n              showSearchAlert: (this.state as any).showSearchAlert,\n              finish: () => { this.setState({ showSearchAlert: false }) }, ...this.props\n            }}\n          />\n\n          <IonToast\n            cssClass='uiFont'\n            isOpen={this.state.showAddBookmarkDone}\n            onDidDismiss={() => this.setState({ showAddBookmarkDone: false })}\n            message={`書籤新增成功！`}\n            duration={2000}\n          />\n\n          <IonLoading\n            cssClass='uiFont'\n            isOpen={this.state.isLoading}\n            onDidDismiss={() => this.setState({ isLoading: false })}\n            message={'載入中...'}\n          />\n        </IonContent>\n      </IonPage>\n    );\n  }\n};\n\nconst WorkPage = withIonLifeCycle(_WorkPage);\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n    bookmarks: state.settings.bookmarks,\n    // Default to WorkListType.BY_JUAN, because work list by chapter might be empty.\n    workListType: state.tmpSettings.workListType !== undefined ? state.tmpSettings.workListType : WorkListType.BY_JUAN,\n  }\n};\n\n//const mapDispatchToProps = {};\n\nexport default connect(\n  mapStateToProps,\n)(WorkPage);\n","export enum WordType {\n    NOUN = '名',\n    VERB = '動'\n}\n\nexport class DictWordDefItem {\n    def: string;\n    quote: Array<string> | null;\n    example: Array<string> | null;\n    link: Array<string> | null;\n    type: WordType | undefined;\n\n    constructor(json: DictWordDefItem) {\n        this.def = json.def;\n        this.quote = json.quote;\n        this.example = json.example;\n        this.link = json.link;\n        this.type = json.type;\n    }\n}\n\nexport class DictWordItem {\n    bopomofo: string;\n    bopomofo2: string;\n    pinyin: string;\n    definitions: Array<DictWordDefItem>;\n\n    constructor(json: any) {\n        this.bopomofo = json.bopomofo;\n        this.bopomofo2 = json.bopomofo2;\n        this.pinyin = json.pinyin;\n        this.definitions = json.definitions;\n    }\n}\n","import React from 'react';\nimport { IonContent, IonHeader, IonPage, IonTitle, IonToolbar, IonList, IonItem, IonRange, IonIcon, IonLabel, IonToggle, IonButton, IonAlert, IonSelect, IonSelectOption, IonProgressBar, IonToast } from '@ionic/react';\nimport { connect } from 'react-redux';\nimport { RouteComponentProps } from 'react-router-dom';\nimport Globals from '../Globals';\nimport { helpCircle, text, documentText, refreshCircle, musicalNotes, colorPalette, shareSocial, bug, download, print } from 'ionicons/icons';\nimport './SettingsPage.css';\nimport PackageInfos from '../../package.json';\nimport { Bookmark, BookmarkType } from '../models/Bookmark';\n\ninterface StateProps {\n  showFontLicense: boolean;\n  juansDownloadedRatio: number;\n  showUpdateAllJuansDone: boolean;\n}\n\ninterface Props {\n  dispatch: Function;\n  hasAppLog: boolean;\n  theme: number;\n  uiFontSize: number;\n  scrollbarSize: number;\n  settings: any;\n  showComments: boolean;\n  paginated: boolean;\n  rtlVerticalLayout: boolean;\n  useFontKai: boolean;\n  printStyle: number;\n  speechRate: number;\n  bookmarks: [Bookmark];\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n  tab: string;\n  path: string;\n  label: string;\n}> { }\n\nclass SettingsPage extends React.Component<PageProps, StateProps> {\n  constructor(props: any) {\n    super(props);\n\n    this.state = {\n      showFontLicense: false,\n      juansDownloadedRatio: 0,\n      showUpdateAllJuansDone: false,\n    }\n  }\n\n  updateBookmark(newBookmarks: Array<Bookmark>, newBookmark: Bookmark) {\n    const updateIndex = newBookmarks.findIndex((b: Bookmark) => b.uuid === newBookmark.uuid);\n    if (updateIndex === -1) {\n      console.error(`Update bookmark fails! Can't find the original bookmark with UUID: ${newBookmark.uuid}`);\n    } else {\n      newBookmarks[updateIndex] = newBookmark;\n    }\n    return;\n  }\n\n  async updateAllJuans() {\n    this.setState({ juansDownloadedRatio: 0 });\n    const workBookmarksWithHtml = this.props.bookmarks.filter((b) => b.type === BookmarkType.WORK);\n    const juanBookmarksWithHtml = this.props.bookmarks.filter((b) => b.type === BookmarkType.JUAN);\n    const juanBookmarksNotInWorkBookmarksWithHtml = juanBookmarksWithHtml.filter((b) => workBookmarksWithHtml.findIndex((wb) => wb.work?.work === b.work?.work) === -1);\n\n    // Total juans to download.\n    let juansToDownload = juanBookmarksNotInWorkBookmarksWithHtml.length;\n    for (let i = 0; i < workBookmarksWithHtml.length; i++) {\n      const work = workBookmarksWithHtml[i].work!;\n      juansToDownload += work.juan_list.split(',').length;\n    }\n\n    let juansDownloaded = 0;\n    for (let i = 0; i < workBookmarksWithHtml.length; i++) {\n      const bookmarkWithHtml = workBookmarksWithHtml[i];\n      const work = bookmarkWithHtml.work!;\n      const juans = work.juan_list.split(',');\n      for (let j = 0; j < juans.length; j++) {\n        const fetchJuan = juans[j];\n        juansDownloaded += 1;\n        this.setState({ juansDownloadedRatio: juansDownloaded / juansToDownload });\n        const res = await Globals.fetchJuan(work.work, fetchJuan, null, true);\n        const fileName = Globals.getFileName(work.work, fetchJuan);\n        // Update HTML.\n        Globals.saveFileToIndexedDB(fileName, res.htmlStr);\n        if (j === 0) {\n          // Update bookmarks for once.\n          this.updateBookmark(this.props.bookmarks, Object.assign(bookmarkWithHtml, { work: res.workInfo }));\n        }\n        console.log(`File saved: ${fileName}`);\n      }\n    }\n    for (let i = 0; i < juanBookmarksNotInWorkBookmarksWithHtml.length; i++) {\n      juansDownloaded += 1;\n      this.setState({ juansDownloadedRatio: juansDownloaded / juansToDownload });\n      const bookmarkWithHtml = juanBookmarksNotInWorkBookmarksWithHtml[i];\n      const work = bookmarkWithHtml.work!;\n      const res = await Globals.fetchJuan(work.work, `${work.juan}`, null, true);\n      const fileName = Globals.getFileName(work.work, `${work.juan}`);\n      let newWork = res.workInfo;\n      newWork.juan = work.juan;\n      // Update HTML.\n      Globals.saveFileToIndexedDB(fileName, res.htmlStr);\n      // Update bookmarks\n      this.updateBookmark(this.props.bookmarks, Object.assign(bookmarkWithHtml, { work: newWork }));\n      console.log(`File saved: ${fileName}`);\n    }\n\n    this.props.dispatch({\n      type: \"UPDATE_BOOKMARKS\",\n      bookmarks: this.props.bookmarks,\n    });\n    this.setState({ showUpdateAllJuansDone: true });\n  }\n\n  render() {\n    return (\n      <IonPage>\n        <IonHeader>\n          <IonToolbar>\n            <IonTitle className='uiFont'>設定</IonTitle>\n          </IonToolbar>\n        </IonHeader>\n        <IonContent>\n          <IonList>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={shareSocial} slot='start' />\n              <IonLabel className='ion-text-wrap uiFont'>電子佛典app版本: <a href=\"https://github.com/MrMYHuang/cbetar2#history\" target=\"_new\">{PackageInfos.version}</a></IonLabel>\n              <IonButton slot='end' size='large' style={{ fontSize: 'var(--ui-font-size)' }} onClick={e => {\n                this.props.dispatch({\n                  type: \"TMP_SET_KEY_VAL\",\n                  key: 'shareTextModal',\n                  val: {\n                    show: true,\n                    text: window.location.origin,\n                  },\n                });\n              }}>分享</IonButton>\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={refreshCircle} slot='start' />\n              <IonLabel className='ion-text-wrap uiFont'>檢查app更新 (若無更新則無回應)</IonLabel>\n              <IonButton slot='end' size='large' style={{ fontSize: 'var(--ui-font-size)' }} onClick={e => {\n                Globals.updateApp();\n              }}>檢查</IonButton>\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={bug} slot='start' />\n              <IonLabel className='ion-text-wrap uiFont'><a href=\"https://github.com/MrMYHuang/cbetar2#report\" target=\"_new\">啟用app異常記錄</a></IonLabel>\n              <IonToggle slot='end' checked={this.props.hasAppLog} onIonChange={e => {\n                const isChecked = e.detail.checked;\n                isChecked ? Globals.enableAppLog() : Globals.disableAppLog();\n                this.props.dispatch({\n                  type: \"SET_KEY_VAL\",\n                  key: 'hasAppLog',\n                  val: isChecked\n                });\n              }} />\n            </IonItem>\n            <IonItem hidden={!this.props.hasAppLog}>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={bug} slot='start' />\n              <IonLabel className='ion-text-wrap uiFont'>回報app異常記錄</IonLabel>\n              <IonButton slot='end' size='large' style={{ fontSize: 'var(--ui-font-size)' }} onClick={e => {\n                window.open(`mailto:myh@live.com?subject=電子佛典異常記錄回報&body=${encodeURIComponent(\"問題描述(建議填寫)：\\n\\n瀏覽器：\" + navigator.userAgent + \"\\n\\nApp版本：\" + PackageInfos.version + \"\\n\\nApp設定：\" + JSON.stringify(this.props.settings) + \"\\n\\nLog：\\n\" + Globals.getLog())}`);\n              }}>回報</IonButton>\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={download} slot='start' />\n              <IonLabel className='ion-text-wrap uiFont'>App設定與書籤</IonLabel>\n              <IonButton size='large' style={{ fontSize: 'var(--ui-font-size)' }} onClick={async (e) => {\n                const settingsJsonUri = `data:text/json;charset=utf-8,${encodeURIComponent(localStorage.getItem('Settings.json') || '')}`;\n                const a = document.createElement('a');\n                a.href = settingsJsonUri;\n                a.download = 'Settings.json';\n                a.click();\n                a.remove();\n              }}>匯出</IonButton>\n              <input id='importJsonInput' type='file' accept='.json' style={{ display: 'none' }} onChange={async (ev) => {\n                const file = ev.target.files?.item(0);\n                const fileText = await file?.text() || '';\n                try {\n                  // JSON text validation.\n                  JSON.parse(fileText);\n                  localStorage.setItem('Settings.json', fileText);\n                  this.props.dispatch({type: 'LOAD_SETTINGS'});\n                  this.updateAllJuans();\n                } catch (e) {\n                  console.error(e);\n                  console.error(new Error().stack);\n                }\n                (document.getElementById('importJsonInput') as HTMLInputElement).value = '';\n              }} />\n              <IonButton size='large' style={{ fontSize: 'var(--ui-font-size)' }} onClick={(e) => {\n                (document.querySelector('#importJsonInput') as HTMLInputElement).click();\n              }}>匯入</IonButton>\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={refreshCircle} slot='start' />\n              <div style={{ width: '100%' }}>\n                <IonLabel className='ion-text-wrap uiFont'>更新離線經文檔</IonLabel>\n                <IonProgressBar value={this.state.juansDownloadedRatio} />\n              </div>\n              <IonButton slot='end' size='large' style={{ fontSize: 'var(--ui-font-size)' }} onClick={async (e) => this.updateAllJuans()}>更新</IonButton>\n              <IonToast\n                cssClass='uiFont'\n                isOpen={this.state.showUpdateAllJuansDone}\n                onDidDismiss={() => this.setState({ showUpdateAllJuansDone: false })}\n                message={`離線經文檔更新完畢！`}\n                duration={2000}\n              />\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={colorPalette} slot='start' />\n              <IonLabel className='ion-text-wrap uiFont'>佈景主題</IonLabel>\n              <IonSelect slot='end'\n                value={this.props.theme}\n                style={{ fontSize: 'var(--ui-font-size)' }}\n                interface='popover'\n                interfaceOptions={{ cssClass: 'cbetar2themes' }}\n                onIonChange={e => {\n                  const value = e.detail.value;\n                  this.props.dispatch({\n                    type: \"SET_KEY_VAL\",\n                    key: 'theme',\n                    val: value,\n                  });\n                  document.body.classList.forEach((val) => document.body.classList.remove(val));\n                  document.body.classList.toggle(`theme${value}`, true);\n                }}>\n                <IonSelectOption className='uiFont cbeta' value={0}>CBETA</IonSelectOption>\n                <IonSelectOption className='uiFont dark' value={1}>暗色</IonSelectOption>\n                <IonSelectOption className='uiFont light' value={2}>亮色</IonSelectOption>\n                <IonSelectOption className='uiFont oldPaper' value={3}>舊書</IonSelectOption>\n                <IonSelectOption className='uiFont marble' value={4}>大理石</IonSelectOption>\n              </IonSelect>\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={documentText} slot='start' />\n              <IonLabel className='ion-text-wrap uiFont'>經文直排、右至左書寫</IonLabel>\n              <IonToggle slot='end' checked={this.props.rtlVerticalLayout} onIonChange={e => {\n                const isChecked = e.detail.checked;\n                this.props.dispatch({\n                  type: \"SET_KEY_VAL\",\n                  key: 'rtlVerticalLayout',\n                  val: isChecked\n                });\n              }} />\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={documentText} slot='start' />\n              <IonLabel className='ion-text-wrap uiFont'>單頁/分頁</IonLabel>\n              <IonToggle slot='end' checked={this.props.paginated} onIonChange={e => {\n                const isChecked = e.detail.checked;\n                this.props.dispatch({\n                  type: \"SET_KEY_VAL\",\n                  key: 'paginated',\n                  val: isChecked\n                });\n              }} />\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={documentText} slot='start' />\n              <IonLabel className='ion-text-wrap uiFont'>單頁經文捲軸大小</IonLabel>\n              <IonSelect slot='end'\n                value={this.props.scrollbarSize}\n                style={{ fontSize: 'var(--ui-font-size)' }}\n                interface='popover'\n                interfaceOptions={{ cssClass: 'uiFont' }}\n                onIonChange={e => {\n                  const value = e.detail.value;\n                  this.props.dispatch({\n                    type: \"SET_KEY_VAL\",\n                    key: 'scrollbarSize',\n                    val: value,\n                  });\n                  Globals.updateCssVars(this.props.settings);\n                }}>\n                <IonSelectOption className='uiFont' value={0}>無</IonSelectOption>\n                <IonSelectOption className='uiFont' value={1}>中</IonSelectOption>\n                <IonSelectOption className='uiFont' value={2}>大</IonSelectOption>\n              </IonSelect>\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={documentText} slot='start' />\n              <IonLabel className='ion-text-wrap uiFont'>顯示經文註解、版權</IonLabel>\n              <IonToggle slot='end' checked={this.props.showComments} onIonChange={e => {\n                const isChecked = e.detail.checked;\n                (this.props as any).dispatch({\n                  type: \"SET_KEY_VAL\",\n                  key: 'showComments',\n                  val: isChecked\n                });\n              }} />\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={text} slot='start' />\n              <IonLabel className='ion-text-wrap uiFont'>黑體/楷書字體(初次載入要等待)</IonLabel>\n              <IonToggle slot='end' checked={this.props.useFontKai} onIonChange={e => {\n                const isChecked = e.detail.checked;\n                (this.props as any).dispatch({\n                  type: \"SET_KEY_VAL\",\n                  key: 'useFontKai',\n                  val: isChecked\n                });\n                Globals.updateCssVars(this.props.settings);\n              }} />\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={text} slot='start' />\n              <div className=\"contentBlock\">\n                <div style={{ flexDirection: \"column\" }}>\n                  <IonLabel className='ion-text-wrap uiFont'>UI字型大小: {this.props.uiFontSize}</IonLabel>\n                  <IonRange min={10} max={128} pin={true} snaps={true} value={this.props.uiFontSize} onIonChange={e => {\n                    this.props.dispatch({\n                      type: \"SET_KEY_VAL\",\n                      key: 'uiFontSize',\n                      val: e.detail.value,\n                    });\n                    Globals.updateCssVars(this.props.settings);\n                  }} />\n                </div>\n              </div>\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={text} slot='start' />\n              <div className=\"contentBlock\">\n                <IonLabel className='ion-text-wrap uiFont'>經文字型大小: <span className='textFont'>{this.props.settings.fontSize}</span></IonLabel>\n                <IonRange min={10} max={128} pin={true} snaps={true} value={this.props.settings.fontSize} onIonChange={e => {\n                  this.props.dispatch({\n                    type: \"SET_KEY_VAL\",\n                    key: 'fontSize',\n                    val: e.detail.value,\n                  });                  \n                  Globals.updateCssVars(this.props.settings);\n                }} />\n              </div>\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={print} slot='start' />\n              <IonLabel className='ion-text-wrap uiFont'>經文列印樣式</IonLabel>\n              <IonSelect slot='end'\n                value={this.props.printStyle}\n                style={{ fontSize: 'var(--ui-font-size)' }}\n                interface='popover'\n                interfaceOptions={{ cssClass: 'cbetar2themes' }}\n                onIonChange={e => {\n                  const value = e.detail.value;\n                  this.props.dispatch({\n                    type: \"SET_KEY_VAL\",\n                    key: 'printStyle',\n                    val: value,\n                  });\n                  document.body.classList.forEach((val) => {\n                    if (/print/.test(val)) {\n                      document.body.classList.remove(val);\n                    }\n                  });\n                  document.body.classList.toggle(`print${value}`, true);\n                }}>\n                <IonSelectOption className='uiFont blackWhite printVar' value={0}>白底黑字</IonSelectOption>\n                <IonSelectOption className='uiFont manuscript printVar' value={1}>抄經本</IonSelectOption>\n              </IonSelect>\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={musicalNotes} slot='start' />\n              <div className=\"contentBlock\">\n                <div style={{ flexDirection: \"column\" }}>\n                  <IonLabel className='ion-text-wrap uiFont'><a href=\"https://github.com/MrMYHuang/cbetar2#text2speech\" target=\"_new\">合成語音語速</a>: {this.props.speechRate}</IonLabel>\n                  <IonRange min={0.1} max={1.5} step={0.1} snaps={true} value={this.props.speechRate} onIonChange={e => {\n                    this.props.dispatch({\n                      type: \"SET_KEY_VAL\",\n                      key: 'speechRate',\n                      val: (e.detail.value as number).toFixed(1),\n                    });\n                  }} />\n                </div>\n              </div>\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={helpCircle} slot='start' />\n              <div style={{ fontSize: 'var(--ui-font-size)' }}>\n                <div>關於</div>\n                <div><a href=\"https://github.com/MrMYHuang/cbetar2#web-app\" target=\"_new\">程式安裝說明</a></div>\n                <div><a href=\"https://github.com/MrMYHuang/cbetar2\" target=\"_new\">操作說明與開放原始碼</a></div>\n                <div>CBETA API版本: {Globals.apiVersion}</div>\n                <div><a href=\"http://cbdata.dila.edu.tw/v1.2/\" target=\"_new\">CBETA API參考文件</a></div>\n                <div><a href=\"http://glossaries.dila.edu.tw/?locale=zh-TW\" target=\"_new\">DILA 佛學術語字辭典</a></div>\n                <div>作者: Meng-Yuan Huang</div>\n                <div><a href=\"mailto:myh@live.com\" target=\"_new\">myh@live.com</a></div>\n                <div><a href=\"https://github.com/MrMYHuang/cbetar2#contributors\" target=\"_new\">App相關貢獻者</a></div>\n                <div><a href='/' onClick={e => {\n                  e.preventDefault();\n                  this.setState({ showFontLicense: true });\n                }}>全字庫字型版權聲明</a></div>\n              </div>\n            </IonItem>\n            <IonAlert\n              cssClass='uiFont'\n              isOpen={this.state.showFontLicense}\n              backdropDismiss={false}\n              message=\"此app使用的全字庫字型(2020-08-18版)由國家發展委員會提供。此開放資料依政府資料開放授權條款 (Open Government Data License) 進行公眾釋出，使用者於遵守本條款各項規定之前提下，得利用之。政府資料開放授權條款：https://data.gov.tw/license\"\n              buttons={[\n                {\n                  text: '關閉',\n                  cssClass: 'primary uiFont',\n                  handler: (value) => {\n                    this.setState({\n                      showFontLicense: false,\n                    });\n                  },\n                },\n                {\n                  text: '開啟授權',\n                  cssClass: 'secondary uiFont',\n                  handler: (value) => {\n                    this.setState({\n                      showFontLicense: false,\n                    });\n                    window.open('https://data.gov.tw/license');\n                  },\n                }\n              ]}\n            />\n          </IonList>\n        </IonContent>\n      </IonPage>\n    );\n  }\n};\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n    settings: state.settings,\n    hasAppLog: state.settings.hasAppLog,\n    theme: state.settings.theme,\n    showComments: state.settings.showComments,\n    paginated: state.settings.paginated,\n    rtlVerticalLayout: state.settings.rtlVerticalLayout,\n    scrollbarSize: state.settings.scrollbarSize,\n    useFontKai: state.settings.useFontKai,\n    uiFontSize: state.settings.uiFontSize,\n    printStyle: state.settings.printStyle,\n    speechRate: state.settings.speechRate,\n    bookmarks: state.settings.bookmarks,\n  }\n};\n\nexport default connect(\n  mapStateToProps,\n)(SettingsPage);\n","import React from 'react';\nimport { IonContent, IonHeader, IonPage, IonTitle, IonToolbar, IonList, IonReorderGroup, IonReorder, IonItem, IonLabel, withIonLifeCycle, IonItemSliding, IonItemOptions, IonItemOption, IonIcon, IonButton, IonToast } from '@ionic/react';\nimport { ItemReorderEventDetail } from '@ionic/core';\nimport { RouteComponentProps } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport './WorkPage.css';\nimport { Bookmark, BookmarkType } from '../models/Bookmark';\nimport { download, swapVertical } from 'ionicons/icons';\nimport queryString from 'query-string';\n\ninterface Props {\n  dispatch: Function;\n  bookmarks: [Bookmark];\n  fontSize: number;\n}\n\ninterface State {\n  reorder: boolean;\n  showToast: boolean;\n  toastMessage: string;\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n  tab: string;\n  path: string;\n}> { }\n\nconst helpDoc = <>\n  <div style={{ fontSize: 'var(--ui-font-size)', textAlign: 'center' }}>可離線瀏覽圖示 <IonIcon icon={download} /></div>\n  <div style={{ fontSize: 'var(--ui-font-size)', textAlign: 'center' }}><a href=\"https://github.com/MrMYHuang/cbetar2#web-app\" target=\"_new\">程式安裝說明</a></div>\n  <div style={{ fontSize: 'var(--ui-font-size)', textAlign: 'center' }}><a href=\"https://github.com/MrMYHuang/cbetar2#shortcuts\" target=\"_new\">程式捷徑</a></div>\n</>;\n\nclass _BookmarkPage extends React.Component<PageProps, State> {\n  bookmarkListRef: React.RefObject<HTMLIonListElement>;\n  constructor(props: any) {\n    super(props);\n    this.state = {\n      reorder: false,\n      showToast: false,\n      toastMessage: '',\n    }\n    this.bookmarkListRef = React.createRef<HTMLIonListElement>();\n  }\n\n  ionViewWillEnter() {\n    let queryParams = queryString.parse(this.props.location.search) as any;\n    if (queryParams.item && queryParams.item < this.props.bookmarks.length) {\n      const bookmark = this.props.bookmarks[queryParams.item];\n      this.props.history.push(`/catalog/juan/${bookmark.work?.work}/${bookmark.work?.juan}`);\n    } else if (!this.hasBookmark) {\n      this.setState({ showToast: true, toastMessage: '無書籤！請從目錄頁新增書籤。' });\n      this.props.history.push(`/catalog/famous`);\n    }\n    //console.log( 'view will enter' );\n  }\n\n  get hasBookmark() {\n    return this.props.bookmarks.length > 0;\n  }\n\n  get isFamousPage() {\n    return this.props.match.url === `/catalog/famous`;\n  }\n\n  delBookmarkHandler(uuidStr: string) {\n    this.props.dispatch({\n      type: \"DEL_BOOKMARK\",\n      uuid: uuidStr,\n    });\n\n    if (!this.hasBookmark) {\n      this.props.history.push(`/catalog/famous`);\n    }\n  }\n\n  reorderBookmarks(event: CustomEvent<ItemReorderEventDetail>) {\n    const bookmarks = event.detail.complete(this.props.bookmarks);\n    this.props.dispatch({\n      type: \"UPDATE_BOOKMARKS\",\n      bookmarks: bookmarks,\n    });\n  }\n\n  getBookmarkRows() {\n    let bookmarks = this.props.bookmarks;\n    let rows = Array<object>();\n    bookmarks.forEach((bookmark, i) => {\n      let routeLink = ``;\n      let label = `${bookmark.selectedText}`;\n      let isHtmlNode = false;\n      switch (bookmark.type) {\n        case BookmarkType.CATALOG:\n          routeLink = `/catalog/catalog/${bookmark.uuid}`; break;\n        case BookmarkType.WORK:\n          routeLink = `/catalog/work/${bookmark.uuid}`; break;\n        case BookmarkType.JUAN:\n          routeLink = `/catalog/juan/${bookmark.work?.work}/${bookmark.work?.juan}`;\n          label = `${bookmark.work?.title}第${bookmark.work?.juan}卷 - ${label}`; break;\n        case BookmarkType.HTML:\n          isHtmlNode = true;\n          routeLink = `/catalog/juan/${bookmark.work?.work}/1`;\n          label = `${bookmark.work?.title} - ${label}`; break;\n      }\n      rows.push(\n        <IonItemSliding key={`bookmarkItemSliding_` + i}>\n          <IonItem key={`bookmarkItem_` + i} button={true} onClick={async event => {\n            if (this.state.reorder) {\n              this.setState({ showToast: true, toastMessage: '請先關閉排列功能，才可點擊書籤！' });\n              return;\n            }\n\n            event.preventDefault();\n            this.props.history.push({\n              pathname: routeLink,\n              state: {\n                uuid: bookmark.uuid,\n              },\n              search: queryString.stringify(isHtmlNode ? { file: bookmark.fileName, title: bookmark.work?.title } : {}),\n            });\n          }}>\n            <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n            <IonLabel className='ion-text-wrap uiFont' key={`bookmarkItemLabel_` + i}>\n              {label}\n            </IonLabel>\n            {bookmark.type === BookmarkType.CATALOG ? '' : <IonIcon icon={download} slot='end' />}\n            <IonReorder slot='end' />\n          </IonItem>\n\n          <IonItemOptions side=\"end\">\n            <IonItemOption style={{ fontSize: 'var(--ui-font-size)' }} color='danger' onClick={(e) => {\n              this.delBookmarkHandler(bookmark.uuid);\n              this.bookmarkListRef.current?.closeSlidingItems();\n            }}>刪除</IonItemOption>\n          </IonItemOptions>\n        </IonItemSliding>\n      );\n    });\n    return rows;\n  }\n\n  render() {\n    const rows = this.getBookmarkRows();\n\n    return (\n      <IonPage key={`bookmarksPage${this.isFamousPage}`}>\n        <IonHeader>\n          <IonToolbar>\n            <IonTitle style={{ fontSize: 'var(--ui-font-size)' }}>書籤</IonTitle>\n\n            <IonButton fill={this.state.reorder ? 'solid' : 'clear'} slot='end'\n              onClick={ev => this.setState({ reorder: !this.state.reorder })}>\n              <IonIcon icon={swapVertical} slot='icon-only' />\n            </IonButton>\n          </IonToolbar>\n        </IonHeader>\n        <IonContent>\n          {this.hasBookmark ?\n            <>\n              <IonList key='bookmarkList0' ref={this.bookmarkListRef}>\n                <IonReorderGroup disabled={!this.state.reorder} onIonItemReorder={(event: CustomEvent<ItemReorderEventDetail>) => { this.reorderBookmarks(event); }}>\n                  {rows}\n                </IonReorderGroup>\n              </IonList>\n              {helpDoc}\n            </> :\n            <>\n              <IonList key='bookmarkList1'>\n                {rows}\n              </IonList>\n              {helpDoc}\n            </>\n          }\n\n          <IonToast\n            cssClass='uiFont'\n            isOpen={this.state.showToast}\n            onDidDismiss={() => this.setState({ showToast: false })}\n            message={this.state.toastMessage}\n            duration={2000}\n          />\n        </IonContent>\n      </IonPage>\n    );\n  }\n};\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n    bookmarks: state.settings.bookmarks,\n  }\n};\n\n//const mapDispatchToProps = {};\n\nconst BookmarkPage = withIonLifeCycle(_BookmarkPage);\n\nexport default connect(\n  mapStateToProps,\n)(BookmarkPage);\n","export class Search {\r\n    type: string;\r\n    n: string;\r\n    label: string;\r\n    work: string;\r\n    title: string;\r\n    creators: string;\r\n\r\n    constructor(json: any) {\r\n        this.type = json[\"type\"];\r\n        this.n = json[\"n\"];\r\n        this.label = json[\"label\"];\r\n        this.work = json[\"work\"];\r\n        this.title = json[\"title\"];\r\n        this.creators = json[\"creators\"] ?? '無';\r\n    }\r\n}\r\n","import React from 'react';\nimport { IonContent, IonHeader, IonPage, IonTitle, IonToolbar, IonList, IonItem, IonLabel, withIonLifeCycle, IonButton, IonIcon, IonLoading } from '@ionic/react';\nimport { RouteComponentProps } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport Globals from '../Globals';\nimport { Search } from '../models/Search';\nimport SearchAlert from '../components/SearchAlert';\nimport { home, search, arrowBack, shareSocial, refreshCircle } from 'ionicons/icons';\n\ninterface Props {\n  dispatch: Function;\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n  tab: string;\n  path: string;\n  label: string;\n  keyword: string;\n}> { }\n\ninterface State {\n  fetchError: boolean;\n  showSearchAlert: boolean;\n  searches: Array<Search>;\n  isLoading: boolean;\n}\n\nclass _SearchPage extends React.Component<PageProps, State> {\n  constructor(props: any) {\n    super(props);\n    this.state = {\n      fetchError: false,\n      showSearchAlert: false,\n      searches: [],\n      isLoading: false,\n    }\n  }\n\n  ionViewWillEnter() {\n    //console.log( 'view will enter' );\n  }\n\n  componentDidMount() {\n    this.search(this.props.match.params.keyword);\n  }\n\n  async search(keyword: string) {\n    this.setState({ isLoading: true });\n    try {\n      const res = await Globals.axiosInstance.get(`/toc?q=${keyword}`, {\n        responseType: 'arraybuffer',\n      });\n      const data = JSON.parse(new TextDecoder().decode(res.data)).results as [any];\n      const searches = data.map((json) => new Search(json));\n\n      this.setState({ fetchError: false, isLoading: false, searches: searches });\n      return true;\n    } catch (e) {\n      console.error(e);\n      console.error(new Error().stack);\n      this.setState({ fetchError: true, isLoading: false });\n      return false;\n    }\n  }\n\n  get isTopPage() {\n    return this.props.match.url === '/catalog';\n  }\n\n  getRows() {\n    let rows = Array<object>();\n    const searches = this.state.searches;\n    searches.forEach((search, i) => {\n      const isCatalog = search.type === 'catalog';\n      let label = isCatalog ? search.label : `${search.title}\\n作者:${search.creators}`;\n      let routeLink = `/${this.props.match.params.tab}` + (isCatalog ? `/catalog/${search.n}` : `/work/${search.work}`);\n      rows.push(\n        <IonItem key={`searchItem_` + i} button={true} onClick={async event => {\n          event.preventDefault();\n          this.props.history.push({\n            pathname: routeLink,\n          });\n        }}>\n          <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n          <IonLabel className='ion-text-wrap uiFont' key={`searchLabel_` + i}>\n            {label}\n          </IonLabel>\n        </IonItem>\n      );\n    });\n    return rows;\n  }\n\n  render() {\n    let rows = this.getRows();\n    return (\n      <IonPage>\n        <IonHeader>\n          <IonToolbar>\n            <IonTitle style={{ fontSize: 'var(--ui-font-size)' }}>搜尋 - {this.props.match.params.keyword}</IonTitle>\n            <IonButton hidden={this.isTopPage} fill=\"clear\" slot='start' onClick={e => this.props.history.goBack()}>\n              <IonIcon icon={arrowBack} slot='icon-only' />\n            </IonButton>\n\n            <IonButton hidden={!this.state.fetchError} fill=\"clear\" slot='end' onClick={e => this.search(this.props.match.params.keyword)}>\n              <IonIcon icon={refreshCircle} slot='icon-only' />\n            </IonButton>\n\n            <IonButton fill=\"clear\" slot='end' onClick={e => this.props.history.push(`/${this.props.match.params.tab}`)}>\n              <IonIcon icon={home} slot='icon-only' />\n            </IonButton>\n\n            <IonButton fill=\"clear\" slot='end' onClick={e => this.setState({ showSearchAlert: true })}>\n              <IonIcon icon={search} slot='icon-only' />\n            </IonButton>\n\n            <IonButton fill=\"clear\" slot='end' onClick={e => {\n              this.props.dispatch({\n                type: \"TMP_SET_KEY_VAL\",\n                key: 'shareTextModal',\n                val: {\n                  show: true,\n                  text: decodeURIComponent(window.location.href),\n                },\n              });\n            }}>\n              <IonIcon icon={shareSocial} slot='icon-only' />\n            </IonButton>\n          </IonToolbar>\n        </IonHeader>\n        <IonContent>\n          {\n            this.state.fetchError ?\n              Globals.fetchErrorContent :\n              <IonList>\n                {rows}\n              </IonList>\n          }\n\n          <IonLoading\n            cssClass='uiFont'\n            isOpen={this.state.isLoading}\n            onDidDismiss={() => this.setState({ isLoading: false })}\n            message={'載入中...'}\n          />\n\n          <SearchAlert\n            {...{\n              showSearchAlert: this.state.showSearchAlert,\n              finish: () => { this.setState({ showSearchAlert: false }) }, ...this.props\n            }}\n          />\n        </IonContent>\n      </IonPage>\n    );\n  }\n};\n\nconst SearchPage = withIonLifeCycle(_SearchPage);\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n  }\n};\n\n//const mapDispatchToProps = {};\n\nexport default connect(\n  mapStateToProps,\n)(SearchPage);\n","import React from 'react';\nimport { IonContent, IonHeader, IonPage, IonToolbar, withIonLifeCycle, IonButton, IonIcon, IonSearchbar, IonAlert, IonPopover, IonList, IonItem, IonLabel, IonLoading, IonToast } from '@ionic/react';\nimport { RouteComponentProps } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport Globals from '../Globals';\nimport { home, shareSocial, book, ellipsisHorizontal, ellipsisVertical, refreshCircle, copy, arrowBack } from 'ionicons/icons';\nimport { DictItem } from '../models/DictItem';\n\ninterface Props {\n  dispatch: Function;\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n  tab: string;\n  path: string;\n  keyword: string;\n}> { }\n\ninterface State {\n  keyword: string;\n  searches: Array<DictItem>;\n  showNoSelectedTextAlert: boolean;\n  popover: any;\n  isLoading: boolean;\n  fetchError: boolean;\n  showToast: boolean;\n  toastMessage: string;\n}\n\nclass _DictionaryPage extends React.Component<PageProps, State> {\n  searchBarRef: React.RefObject<HTMLIonSearchbarElement>;\n  constructor(props: any) {\n    super(props);\n    this.state = {\n      keyword: '',\n      searches: [],\n      showNoSelectedTextAlert: false,\n      popover: {\n        show: false,\n        event: null,\n      },\n      isLoading: false,\n      fetchError: false,\n      showToast: false,\n      toastMessage: '',\n    }\n    this.searchBarRef = React.createRef<HTMLIonSearchbarElement>();\n  }\n\n  ionViewWillEnter() {\n    //console.log(`${this.props.match.url} will enter`);\n    this.setState({ keyword: this.props.match.params.keyword });\n    if (this.props.match.params.keyword) {\n      this.lookupDict(this.props.match.params.keyword);\n    } else {\n      this.setState({ searches: [] });      \n    }\n  }\n\n  /*\n  componentDidMount() {\n    //console.log(`did mount: ${this.props.match.url}`);\n  }\n  \n  componentWillUnmount() {\n    console.log(`${this.props.match.url} unmount`);\n  }\n\n  ionViewWillLeave() {\n  }\n  */\n\n  get isTopPage() {\n    return this.props.match.params.keyword === undefined;\n  }\n\n  async lookupDict(keyword: string) {\n    this.setState({ isLoading: true });\n    try {\n      const res = await Globals.axiosInstance.get(\n        `${Globals.dilaDictApiUrl}/?type=match&dicts=dila&term=${keyword}`,\n        {\n          responseType: 'json',\n        });\n      this.setState({ fetchError: false, isLoading: false, searches: res.data });\n    } catch (e) {\n      console.error(e);\n      console.error(new Error().stack);\n      this.setState({ fetchError: true, isLoading: false });\n      return false;\n    }\n  }\n\n  getSelectedString() {\n    const sel = document.getSelection();\n    if ((sel?.rangeCount || 0) > 0 && sel!.getRangeAt(0).toString().length > 0) {\n      return sel!.getRangeAt(0).toString();\n    } else {\n      return '';\n    }\n  }\n\n  getRows() {\n    const data = this.state.searches as [DictItem];\n    let rows = Array<object>();\n    data.forEach((item: DictItem, index: number) => {\n      rows.push(\n        <div style={{ display: 'table-row' }} key={`dictItem` + index}>\n          <div className='tableCell'>\n            <div className='ion-text-wrap textFont' style={{ color: 'var(--ion-color-primary)', paddingBottom: '18pt' }} dangerouslySetInnerHTML={{ __html: item.dict_name_zh }}></div>\n            <div className='ion-text-wrap textFont' key={`dictItemLabel` + index} dangerouslySetInnerHTML={{ __html: item.desc }}>\n            </div>\n          </div>\n        </div>\n      );\n    });\n    return rows;\n  }\n\n  selectedTextBeforeIonPopover = '';\n  render() {\n    return (\n      <IonPage>\n        <IonHeader>\n          <IonToolbar>\n            <IonButton hidden={this.isTopPage} fill=\"clear\" slot='start' onClick={e => this.props.history.goBack()}>\n              <IonIcon icon={arrowBack} slot='icon-only' />\n            </IonButton>\n\n            <IonButton slot='start' onClick={ev => {\n              this.props.history.push(`/dictionary/searchWord`);\n            }}>\n              <span className='uiFont' style={{ color: 'var(--color)' }}>佛學詞典</span>\n            </IonButton>\n\n            <IonButton hidden={!this.state.fetchError} fill=\"clear\" slot='end' onClick={e => this.lookupDict(this.props.match.params.keyword)}>\n              <IonIcon icon={refreshCircle} slot='icon-only' />\n            </IonButton>\n\n            <IonButton fill=\"clear\" slot='end' onClick={e => {\n              this.props.dispatch({\n                type: \"TMP_SET_KEY_VAL\",\n                key: 'shareTextModal',\n                val: {\n                  show: true,\n                  text: decodeURIComponent(window.location.href),\n                },\n              });\n            }}>\n              <IonIcon icon={shareSocial} slot='icon-only' />\n            </IonButton>\n\n            <IonButton fill=\"clear\" slot='end' onPointerDown={e => {\n              // Because after showing IonPopover, document.getSelection() changes.\n              // Thus, we must capture the selected text in advance.\n              this.selectedTextBeforeIonPopover = this.getSelectedString();\n            }}\n              onClick={e => {\n                this.setState({ popover: { show: true, event: e.nativeEvent } });\n              }}>\n              <IonIcon ios={ellipsisHorizontal} md={ellipsisVertical} slot='icon-only' />\n            </IonButton>\n\n            <IonPopover\n              isOpen={this.state.popover.show}\n              event={this.state.popover.event}\n              onDidDismiss={e => {\n                this.selectedTextBeforeIonPopover = '';\n                this.setState({ popover: { show: false, event: null } });\n              }}\n            >\n              <IonList>\n                <IonItem button onClick={e => {\n                  this.props.history.push(`/${this.props.match.params.tab}`);\n                  this.setState({ popover: { show: false, event: null } });\n                }}>\n                  <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                  <IonIcon icon={home} slot='start' />\n                  <IonLabel className='ion-text-wrap uiFont'>回首頁</IonLabel>\n                </IonItem>\n\n                <IonItem button onClick={e => {\n                  this.setState({ popover: { show: false, event: null } });\n                  Globals.copyToClipboard(this.selectedTextBeforeIonPopover);\n                  this.setState({ showToast: true, toastMessage: `複製文字成功` });\n                }}>\n                  <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                  <IonIcon icon={copy} slot='start' />\n                  <IonLabel className='ion-text-wrap uiFont'>複製文字</IonLabel>\n                </IonItem>\n\n                <IonItem button onClick={e => {\n                  this.setState({ popover: { show: false, event: null } });\n                  if (this.selectedTextBeforeIonPopover === '') {\n                    this.setState({ showNoSelectedTextAlert: true });\n                    return;\n                  }\n\n                  this.props.history.push({\n                    pathname: `/dictionary/search/${this.selectedTextBeforeIonPopover}`,\n                  });\n                }}>\n                  <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                  <IonIcon icon={book} slot='start' />\n                  <IonLabel className='ion-text-wrap uiFont'>查詞典</IonLabel>\n                </IonItem>\n\n                <IonItem button onClick={e => {\n                  this.setState({ popover: { show: false, event: null } });\n                  if (this.selectedTextBeforeIonPopover === '') {\n                    this.setState({ showNoSelectedTextAlert: true });\n                    return;\n                  }\n\n                  this.props.history.push({\n                    pathname: `/dictionary/searchWord/${this.selectedTextBeforeIonPopover}`,\n                  });\n                }}>\n                  <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                  <IonIcon icon={book} slot='start' />\n                  <IonLabel className='ion-text-wrap uiFont'>查字典</IonLabel>\n                </IonItem>\n              </IonList>\n            </IonPopover>\n          </IonToolbar>\n        </IonHeader>\n        <IonContent>\n          <IonSearchbar ref={this.searchBarRef} placeholder='請輸入字詞，再按鍵盤Enter鍵' value={this.state.keyword}\n            onKeyUp={(ev: any) => {\n              const value = ev.target.value;\n              this.setState({ keyword: value })\n              if (ev.key === 'Enter') {\n                this.props.history.push(`/dictionary/search/${value}`);\n              }\n            }} />\n          {/*\n              <IonButton slot='end' size='large' style={{ fontSize: 'var(--ui-font-size)' }} onClick={e => {\n                this.lookupDict(this.state.keyword);\n              }}>搜尋</IonButton>*/}\n\n          {this.state.fetchError ?\n            Globals.fetchErrorContent :\n            <div style={{ display: 'table' }}>\n              {this.getRows()}\n            </div>\n          }\n\n          <div style={{ fontSize: 'var(--ui-font-size)', textAlign: 'center' }}><a href=\"https://github.com/MrMYHuang/cbetar2#dictionary\" target=\"_new\">佛學詞典說明</a></div>\n\n          <IonAlert\n            cssClass='uiFont'\n            isOpen={this.state.showNoSelectedTextAlert}\n            backdropDismiss={false}\n            header='失敗'\n            message='請確認是否已選擇一段文字，然後再執行所選的功能!'\n            buttons={[\n              {\n                text: '確定',\n                cssClass: 'primary uiFont',\n                handler: (value) => {\n                  this.setState({\n                    showNoSelectedTextAlert: false,\n                  });\n                },\n              }\n            ]}\n          />\n\n          <IonLoading\n            cssClass='uiFont'\n            isOpen={this.state.isLoading}\n            onDidDismiss={() => this.setState({ isLoading: false })}\n            message={'載入中...'}\n          />\n\n          <IonToast\n            cssClass='uiFont'\n            isOpen={this.state.showToast}\n            onDidDismiss={() => this.setState({ showToast: false })}\n            message={this.state.toastMessage}\n            duration={2000}\n          />\n        </IonContent>\n      </IonPage>\n    );\n  }\n};\n\nconst DictionaryPage = withIonLifeCycle(_DictionaryPage);\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n  }\n};\n\n//const mapDispatchToProps = {};\n\nexport default connect(\n  mapStateToProps,\n)(DictionaryPage);\n","export class FullTextSearch {\n    id: number;\n    term_hits: number;\n    work: string;\n    juan: number;\n    title: string;\n    creators: string;\n\n    constructor(json: any) {\n        this.id = json.id;\n        this.term_hits = json.term_hits;\n        this.work = json.work;\n        this.juan = json.juan;\n        this.title = json.title;\n        this.creators = json.creators;\n    }\n}\n","import React from 'react';\nimport { IonContent, IonHeader, IonPage, IonTitle, IonToolbar, IonList, IonItem, IonLabel, withIonLifeCycle, IonButton, IonIcon, IonLoading, IonInfiniteScroll, IonInfiniteScrollContent } from '@ionic/react';\nimport { RouteComponentProps } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport Globals from '../Globals';\nimport SearchAlert from '../components/SearchAlert';\nimport { home, search, arrowBack, shareSocial, refreshCircle } from 'ionicons/icons';\nimport { FullTextSearch } from '../models/FullTextSearch';\n\ninterface Props {\n  dispatch: Function;\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n  tab: string;\n  path: string;\n  label: string;\n  keyword: string;\n}> { }\n\ninterface State {\n  showSearchAlert: boolean;\n  searches: Array<FullTextSearch>;\n  isScrollOn: boolean;\n  isLoading: boolean;\n  fetchError: boolean;\n}\n\nclass _SearchPage extends React.Component<PageProps, State> {\n  constructor(props: any) {\n    super(props);\n    this.state = {\n      showSearchAlert: false,\n      searches: [],\n      isScrollOn: false,\n      isLoading: false,\n      fetchError: false,\n    }\n  }\n\n  ionViewWillEnter() {\n    //console.log( 'view will enter' );\n  }\n\n  componentDidMount() {\n    this.search(this.props.match.params.keyword);\n  }\n\n  page = 0;\n  rows = 20;\n  async search(keyword: string) {\n    this.setState({ isLoading: true });\n    try {\n      console.log(`Loading page ${this.page}`);\n\n      const res = await Globals.axiosInstance.get(`/sphinx?q=${keyword}&start=${this.page}&rows=${this.rows}`, {\n        responseType: 'arraybuffer',\n      });\n      const data = JSON.parse(new TextDecoder().decode(res.data)).results as [any];\n      const searches = data.map((json) => new FullTextSearch(json));\n\n      this.setState({ fetchError: false, isLoading: false, searches: [...this.state.searches, ...searches],\n        isScrollOn: searches.length === this.rows,\n      });\n\n      this.page += 1;\n      return true;\n    } catch (e) {\n      console.error(e);\n      console.error(new Error().stack);\n      this.setState({ fetchError: true, isLoading: false, isScrollOn: false });\n      return false;\n    }\n  }\n\n  get isTopPage() {\n    return this.props.match.url === '/catalog';\n  }\n\n  getRows() {\n    let rows = Array<object>();\n    const searches = (this.state as any).searches as [FullTextSearch];\n    searches.forEach((search, i) => {\n      let label = `${search.title}卷${search.juan}\\n作者:${search.creators}`;\n      let routeLink = `/catalog/juan/${search.work}/${search.juan}`;\n      rows.push(\n        <IonItem key={`searchItem_` + i} button={true} onClick={async event => {\n          event.preventDefault();\n          this.props.history.push({\n            pathname: routeLink,\n          });\n        }}>\n          <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n          <IonLabel className='ion-text-wrap uiFont' key={`searchLabel_` + i}>\n            {label}\n          </IonLabel>\n        </IonItem>\n      );\n    });\n    return rows;\n  }\n\n  render() {\n    let rows = this.getRows();\n    return (\n      <IonPage>\n        <IonHeader>\n          <IonToolbar>\n            <IonTitle style={{ fontSize: 'var(--ui-font-size)' }}>全文檢索 - {this.props.match.params.keyword}</IonTitle>\n            <IonButton hidden={this.isTopPage} fill=\"clear\" slot='start' onClick={e => this.props.history.goBack()}>\n              <IonIcon icon={arrowBack} slot='icon-only' />\n            </IonButton>\n\n            <IonButton hidden={!this.state.fetchError} fill=\"clear\" slot='end' onClick={e => this.search(this.props.match.params.keyword)}>\n              <IonIcon icon={refreshCircle} slot='icon-only' />\n            </IonButton>\n\n            <IonButton fill=\"clear\" slot='end' onClick={e => this.props.history.push(`/${this.props.match.params.tab}`)}>\n              <IonIcon icon={home} slot='icon-only' />\n            </IonButton>\n\n            <IonButton fill=\"clear\" slot='end' onClick={e => this.setState({ showSearchAlert: true })}>\n              <IonIcon icon={search} slot='icon-only' />\n            </IonButton>\n\n            <IonButton fill=\"clear\" slot='end' onClick={e => {\n              this.props.dispatch({\n                type: \"TMP_SET_KEY_VAL\",\n                key: 'shareTextModal',\n                val: {\n                  show: true,\n                  text: decodeURIComponent(window.location.href),\n                },\n              });\n            }}>\n              <IonIcon icon={shareSocial} slot='icon-only' />\n            </IonButton>\n          </IonToolbar>\n        </IonHeader>\n        <IonContent>\n          {\n            this.state.fetchError ?\n              Globals.fetchErrorContent :\n              <IonList>\n                {rows}\n                <IonInfiniteScroll threshold=\"100px\"\n                  disabled={!this.state.isScrollOn}\n                  onIonInfinite={(ev: CustomEvent<void>) => {\n                    this.search(this.props.match.params.keyword);\n                    (ev.target as HTMLIonInfiniteScrollElement).complete();\n                  }}>\n                  <IonInfiniteScrollContent\n                    loadingText=\"載入中...\">\n                  </IonInfiniteScrollContent>\n                </IonInfiniteScroll>\n              </IonList>\n          }\n\n          <IonLoading\n            cssClass='uiFont'\n            isOpen={this.state.isLoading}\n            onDidDismiss={() => this.setState({ isLoading: false })}\n            message={'載入中...'}\n          />\n\n          <SearchAlert\n            {...{\n              showSearchAlert: (this.state as any).showSearchAlert,\n              finish: () => { this.setState({ showSearchAlert: false }) }, ...this.props\n            }}\n          />\n        </IonContent>\n      </IonPage>\n    );\n  }\n};\n\nconst SearchPage = withIonLifeCycle(_SearchPage);\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n  }\n};\n\n//const mapDispatchToProps = {};\n\nexport default connect(\n  mapStateToProps,\n)(SearchPage);\n","import React from 'react';\r\nimport { IonButton, IonContent, IonLabel, IonModal } from '@ionic/react';\r\nimport { RouteComponentProps } from 'react-router-dom';\r\nimport * as qrcode from 'qrcode';\r\n\r\ninterface Props {\r\n  showModal: boolean;\r\n  text: string;\r\n  finish: Function;\r\n}\r\n\r\ninterface PageProps extends Props, RouteComponentProps<{\r\n  tab: string;\r\n  path: string;\r\n}> { }\r\n\r\nclass _ShareTextModal extends React.Component<PageProps> {\r\n  /*constructor(props: any) {\r\n    super(props);\r\n  }*/\r\n\r\n  updateQrCode() {\r\n    navigator.clipboard && navigator.clipboard.writeText(this.props.text);\r\n    const qrcCanvas = document.getElementById('qrcCanvas');\r\n    qrcode.toCanvas(qrcCanvas, this.props.text);\r\n    return qrcCanvas;\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <IonModal\r\n        isOpen={this.props.showModal}\r\n        cssClass='uiFont'\r\n        swipeToClose={true}\r\n        //presentingElement={router || undefined}\r\n        onWillPresent={() => this.updateQrCode()}\r\n        onDidDismiss={() => this.props.finish()}>\r\n        <IonContent>\r\n          <div style={{display: 'flex', flexDirection: 'column', height: '100%', alignItems: 'center'}}>\r\n            <div>\r\n              <IonLabel className='uiFont'>此頁app連結已複製至剪貼簿！</IonLabel>\r\n            </div>\r\n            <div>\r\n              <IonLabel className='uiFont'>也可以使用QR Code分享:</IonLabel>\r\n            </div>\r\n            <div style={{flexGrow: 1, display: 'flex', alignItems: 'center'}}>\r\n              <canvas id='qrcCanvas' width='500' height='500' style={{margin: '0px auto'}} />\r\n            </div>\r\n            <div>\r\n              <IonButton size='large' onClick={() => this.props.finish()}>關閉</IonButton>\r\n            </div>\r\n          </div>\r\n        </IonContent>\r\n      </IonModal>\r\n    );\r\n  }\r\n};\r\n\r\nconst ShareTextModal = (_ShareTextModal);\r\nexport default ShareTextModal;\r\n","import React from 'react';\nimport { IonContent, IonHeader, IonPage, IonToolbar, withIonLifeCycle, IonButton, IonIcon, IonSearchbar, IonAlert, IonPopover, IonList, IonItem, IonLabel, IonLoading, IonToast } from '@ionic/react';\nimport { RouteComponentProps } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport * as uuid from 'uuid';\nimport Globals from '../Globals';\nimport { home, shareSocial, book, ellipsisHorizontal, ellipsisVertical, refreshCircle, copy, arrowBack } from 'ionicons/icons';\nimport { DictWordDefItem, DictWordItem, WordType } from '../models/DictWordItem';\n\ninterface Props {\n  dispatch: Function;\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n  tab: string;\n  path: string;\n  keyword: string;\n}> { }\n\ninterface State {\n  keyword: string;\n  search: [DictWordItem] | null;\n  showNoSelectedTextAlert: boolean;\n  popover: any;\n  isLoading: boolean;\n  fetchError: boolean;\n  showToast: boolean;\n  toastMessage: string;\n}\n\nclass _WordDictionaryPage extends React.Component<PageProps, State> {\n  searchBarRef: React.RefObject<HTMLIonSearchbarElement>;\n  constructor(props: any) {\n    super(props);\n    this.state = {\n      keyword: '',\n      search: null,\n      showNoSelectedTextAlert: false,\n      popover: {\n        show: false,\n        event: null,\n      },\n      isLoading: false,\n      fetchError: false,\n      showToast: false,\n      toastMessage: '',\n    }\n    this.searchBarRef = React.createRef<HTMLIonSearchbarElement>();\n  }\n\n  ionViewWillEnter() {\n    //console.log( 'view will enter' );\n    //console.log(this.props.match.url);\n    //console.log(this.props.history.length);\n    if (this.props.match.params.keyword) {\n      this.setState({ keyword: this.props.match.params.keyword });\n      this.lookupDict(this.props.match.params.keyword);\n    }\n  }\n\n  componentDidMount() {\n    //console.log(`did mount: ${this.props.match.url}`);\n  }\n\n  ionViewWillLeave() {\n  }\n\n  get isTopPage() {\n    return this.props.match.url === `/${this.props.match.params.tab}`;\n  }\n\n  async lookupDict(keyword: string) {\n    this.setState({ isLoading: true });\n    try {\n      const res = await Globals.axiosInstance.get(\n        `https://www.moedict.tw/uni/${keyword.substring(0, 1)}`,\n        {\n          responseType: 'json',\n        });\n      this.setState({ fetchError: false, isLoading: false, search: res.data.heteronyms });\n    } catch (e) {\n      console.error(e);\n      console.error(new Error().stack);\n      this.setState({ fetchError: true, isLoading: false });\n      return false;\n    }\n  }\n\n  getSelectedString() {\n    const sel = document.getSelection();\n    if ((sel?.rangeCount || 0) > 0 && sel!.getRangeAt(0).toString().length > 0) {\n      return sel!.getRangeAt(0).toString();\n    } else {\n      return '';\n    }\n  }\n\n  defToView(defs: Array<DictWordDefItem> | undefined, title: string) {\n    return defs !== undefined && defs.length > 0 ? <>\n      <div key={uuid.v4()} style={{ color: 'var(--ion-color-primary)' }}>{title}</div>\n      <ol key={uuid.v4()}>{\n        defs?.map((d) =>\n          <li key={uuid.v4()}>\n            <div key={uuid.v4()}>{d.def}</div>\n            {d.quote?.map((q) => <div key={uuid.v4()}>{q}</div>)}\n            {d.example?.map((e) => <div key={uuid.v4()}>{e}</div>)}\n            {d.link?.map((l) => <div key={uuid.v4()}>{l}</div>)}\n          </li>\n        )}\n      </ol>\n    </> : <></>;\n  }\n\n  selectedTextBeforeIonPopover = '';\n  render() {\n    let dictView: any = [];\n    if (this.props.match.params.keyword) {\n      this.state.search?.forEach((data) => {\n        const nouns = data?.definitions.filter((d) => d.type === WordType.NOUN);\n        const verbs = data?.definitions.filter((d) => d.type === WordType.VERB);\n        const others = data?.definitions.filter((d) => d.type === undefined);\n\n        const nounsView = this.defToView(nouns, '名詞');\n        const verbsView = this.defToView(verbs, '動詞');\n        const othersView = this.defToView(others, '');\n\n        dictView.push(\n          <div key={uuid.v4()} className='textFont textSelectable'>\n            <div key={uuid.v4()} className='textFontX3'>{this.props.match.params.keyword.substring(0, 1)}</div>\n            {data?.bopomofo ? <div>注音：{data?.bopomofo}</div> : null}\n            {data?.pinyin ? <div>拼音：{data?.pinyin}</div> : null}\n            {nounsView}\n            {verbsView}\n            {othersView}\n          </div>);\n      });\n    }\n\n    return (\n      <IonPage>\n        <IonHeader>\n          <IonToolbar>\n            <IonButton fill=\"clear\" slot='start' onClick={e => this.props.history.goBack()}>\n              <IonIcon icon={arrowBack} slot='icon-only' />\n            </IonButton>\n\n            <IonButton slot='start' onClick={ev => {\n              this.props.history.push(`/dictionary/search`);\n            }}>\n              <span className='uiFont' style={{ color: 'var(--color)' }}>萌典字典</span>\n            </IonButton>\n\n            <IonButton hidden={!this.state.fetchError} fill=\"clear\" slot='end' onClick={e => this.lookupDict(this.props.match.params.keyword)}>\n              <IonIcon icon={refreshCircle} slot='icon-only' />\n            </IonButton>\n\n            <IonButton fill=\"clear\" slot='end' onClick={e => {\n              this.props.dispatch({\n                type: \"TMP_SET_KEY_VAL\",\n                key: 'shareTextModal',\n                val: {\n                  show: true,\n                  text: decodeURIComponent(window.location.href),\n                },\n              });\n            }}>\n              <IonIcon icon={shareSocial} slot='icon-only' />\n            </IonButton>\n\n            <IonButton fill=\"clear\" slot='end' onPointerDown={e => {\n              // Because after showing IonPopover, document.getSelection() changes.\n              // Thus, we must capture the selected text in advance.\n              this.selectedTextBeforeIonPopover = this.getSelectedString();\n            }}\n              onClick={e => {\n                this.setState({ popover: { show: true, event: e.nativeEvent } });\n              }}>\n              <IonIcon ios={ellipsisHorizontal} md={ellipsisVertical} slot='icon-only' />\n            </IonButton>\n\n            <IonPopover\n              isOpen={this.state.popover.show}\n              event={this.state.popover.event}\n              onDidDismiss={e => {\n                this.setState({ popover: { show: false, event: null } });\n                this.selectedTextBeforeIonPopover = '';\n              }}\n            >\n              <IonList>\n                <IonItem button onClick={e => {\n                  this.props.history.push(`/${this.props.match.params.tab}`);\n                  this.setState({ popover: { show: false, event: null } });\n                }}>\n                  <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                  <IonIcon icon={home} slot='start' />\n                  <IonLabel className='ion-text-wrap uiFont'>回首頁</IonLabel>\n                </IonItem>\n\n                <IonItem button onClick={e => {\n                  this.setState({ popover: { show: false, event: null } });\n                  Globals.copyToClipboard(this.selectedTextBeforeIonPopover);\n                  this.setState({ showToast: true, toastMessage: `複製文字成功` });\n                }}>\n                  <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                  <IonIcon icon={copy} slot='start' />\n                  <IonLabel className='ion-text-wrap uiFont'>複製文字</IonLabel>\n                </IonItem>\n\n                <IonItem button onClick={e => {\n                  this.setState({ popover: { show: false, event: null } });\n                  if (this.selectedTextBeforeIonPopover === '') {\n                    this.setState({ showNoSelectedTextAlert: true });\n                    return;\n                  }\n\n                  this.props.history.push(`/dictionary/search/${this.selectedTextBeforeIonPopover}`);\n                }}>\n                  <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                  <IonIcon icon={book} slot='start' />\n                  <IonLabel className='ion-text-wrap uiFont'>查詞典</IonLabel>\n                </IonItem>\n\n                <IonItem button onClick={e => {\n                  this.setState({ popover: { show: false, event: null } });\n                  if (this.selectedTextBeforeIonPopover === '') {\n                    this.setState({ showNoSelectedTextAlert: true });\n                    return;\n                  }\n\n                  this.props.history.push({\n                    pathname: `/dictionary/searchWord/${this.selectedTextBeforeIonPopover}`,\n                  });\n                }}>\n                  <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                  <IonIcon icon={book} slot='start' />\n                  <IonLabel className='ion-text-wrap uiFont'>查字典</IonLabel>\n                </IonItem>\n              </IonList>\n            </IonPopover>\n          </IonToolbar>\n        </IonHeader>\n        <IonContent>\n          <IonSearchbar ref={this.searchBarRef} placeholder='請輸入字，再按鍵盤Enter鍵' value={this.state.keyword}\n            onKeyUp={(ev: any) => {\n              const value = ev.target.value;\n              this.setState({ keyword: value })\n              if (ev.key === 'Enter') {\n                this.props.history.push(`/dictionary/searchWord/${value}`);\n              }\n            }} />\n          {/*\n              <IonButton slot='end' size='large' style={{ fontSize: 'var(--ui-font-size)' }} onClick={e => {\n                this.lookupDict(this.state.keyword);\n              }}>搜尋</IonButton>*/}\n\n          {this.state.fetchError ? Globals.fetchErrorContent : dictView}\n\n          {/*\n          <div style={{ fontSize: 'var(--ui-font-size)', textAlign: 'center' }}><a href=\"https://github.com/MrMYHuang/cbetar2#WordDictionary\" target=\"_new\">佛學詞典說明</a></div>\n          */}\n\n          <IonAlert\n            cssClass='uiFont'\n            isOpen={this.state.showNoSelectedTextAlert}\n            backdropDismiss={false}\n            header='失敗'\n            message='請確認是否已選擇一段文字，然後再執行所選的功能!'\n            buttons={[\n              {\n                text: '確定',\n                cssClass: 'primary uiFont',\n                handler: (value) => {\n                  this.setState({\n                    showNoSelectedTextAlert: false,\n                  });\n                },\n              }\n            ]}\n          />\n\n          <IonLoading\n            cssClass='uiFont'\n            isOpen={this.state.isLoading}\n            onDidDismiss={() => this.setState({ isLoading: false })}\n            message={'載入中...'}\n          />\n\n          <IonToast\n            cssClass='uiFont'\n            isOpen={this.state.showToast}\n            onDidDismiss={() => this.setState({ showToast: false })}\n            message={this.state.toastMessage}\n            duration={2000}\n          />\n        </IonContent>\n      </IonPage>\n    );\n  }\n};\n\nconst WordDictionaryPage = withIonLifeCycle(_WordDictionaryPage);\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n  }\n};\n\n//const mapDispatchToProps = {};\n\nexport default connect(\n  mapStateToProps,\n)(WordDictionaryPage);\n","import React from 'react';\nimport { Redirect, Route, RouteComponentProps, withRouter } from 'react-router-dom';\nimport {\n  setupConfig,\n  IonApp,\n  IonIcon,\n  IonRouterOutlet,\n  IonTabBar,\n  IonTabButton,\n  IonTabs,\n  IonAlert,\n  isPlatform,\n} from '@ionic/react';\nimport { IonReactRouter } from '@ionic/react-router';\nimport { connect, Provider } from 'react-redux';\nimport getSavedStore from './redux/store';\nimport { bookmark, settings, library, book } from 'ionicons/icons';\nimport CatalogPage from './pages/CatalogPage';\nimport WorkPage from './pages/WorkPage';\nimport EPubViewPage from './pages/EPubViewPage';\n\n/* Core CSS required for Ionic components to work properly */\nimport '@ionic/react/css/core.css';\n\n/* Basic CSS for apps built with Ionic */\nimport '@ionic/react/css/normalize.css';\nimport '@ionic/react/css/structure.css';\nimport '@ionic/react/css/typography.css';\n\n/* Optional CSS utils that can be commented out */\nimport '@ionic/react/css/padding.css';\nimport '@ionic/react/css/float-elements.css';\nimport '@ionic/react/css/text-alignment.css';\nimport '@ionic/react/css/text-transformation.css';\nimport '@ionic/react/css/flex-utils.css';\nimport '@ionic/react/css/display.css';\n\n/* Theme variables */\nimport './theme/variables.css';\nimport SettingsPage from './pages/SettingsPage';\nimport BookmarkPage from './pages/BookmarkPage';\nimport SearchPage from './pages/SearchPage';\nimport Globals from './Globals';\nimport DictionaryPage from './pages/DictionaryPage';\nimport FullTextSearchPage from './pages/FullTextSearchPage';\nimport ShareTextModal from './components/ShareTextModal';\nimport WordDictionaryPage from './pages/WordDictionaryPage';\n\nlet store = getSavedStore();\n/*\nclass DebugRouter extends IonReactRouter {\n  constructor(props: any) {\n    super(props);\n    console.log('initial history is: ', JSON.stringify(this.history, null, 2))\n    this.history.listen((location, action) => {\n      console.log(\n        `The current URL is ${location.pathname}${location.search}${location.hash}`\n      )\n      console.log(`The last navigation action was ${action}`, JSON.stringify(this.history, null, 2));\n    });\n  }\n}\n*/\n\nconst state = store.getState();\n\nif (!state.settings.hasAppLog) {\n  Globals.disableAppLog();\n}\n\nsetupConfig({\n  mode: 'md',\n  swipeBackEnabled: false,\n});\n\nexport var serviceWorkCallbacks = {\n  onSuccess: function (registration: ServiceWorkerRegistration) { },\n  onUpdate: function (registration: ServiceWorkerRegistration) { },\n};\n\ninterface Props {\n  shareTextModal: any;\n}\n\ninterface PageProps extends RouteComponentProps<{\n  tab: string;\n  path: string;\n}> { }\n\ninterface AppOrigProps extends Props, RouteComponentProps<{\n  tab: string;\n  path: string;\n}> { }\n\ninterface State {\n  showUpdateAlert: boolean;\n}\n\nclass _App extends React.Component<PageProps, State> {\n  render() {\n    return (\n      <Provider store={store}>\n        <AppOrig {...this.props} />\n      </Provider>\n    );\n  }\n}\n\nclass _AppOrig extends React.Component<AppOrigProps, State> {\n  registrationNew: ServiceWorkerRegistration | null;\n\n  constructor(props: any) {\n    super(props);\n    this.registrationNew = null;\n    // ----- Initializing UI settings -----\n    // Apply the theme setting.\n    if (isPlatform('android')) {\n      window.oncontextmenu = Globals.disableAndroidChromeCallout;\n    } else if (isPlatform('ios')) {\n      document.ontouchend = Globals.disableIosSafariCallout.bind(window);\n    }\n    document.body.classList.forEach((val) => document.body.classList.remove(val));\n    document.body.classList.toggle(`theme${state.settings.theme}`, true);\n    document.body.classList.toggle(`print${state.settings.printStyle}`, true);\n    Globals.updateCssVars(state.settings);\n\n    this.state = {\n      showUpdateAlert: false,\n    };\n\n    serviceWorkCallbacks.onUpdate = (registration: ServiceWorkerRegistration) => {\n      this.registrationNew = registration;\n      this.setState({ showUpdateAlert: true });\n    };\n\n    serviceWorkCallbacks.onSuccess = (registration: ServiceWorkerRegistration) => {\n    };\n\n    // Preload speechSynthesis.\n    speechSynthesis.getVoices();\n    speechSynthesis.cancel();\n\n    this.wakeLockScreen();\n    this.loadTwKaiFont();\n  }\n\n  async loadTwKaiFont() {\n    const dbOpenReq = indexedDB.open(Globals.cbetardb);\n    dbOpenReq.onupgradeneeded = function (event: IDBVersionChangeEvent) {\n      var db = (event.target as any).result;\n      db.createObjectStore('store');\n    };\n\n    let fontData: any;\n    await new Promise((ok, fail) => {\n      dbOpenReq.onsuccess = async (ev: Event) => {\n        const db = dbOpenReq.result;\n\n        const trans = db.transaction([\"store\"], 'readwrite');\n        let req = trans.objectStore('store').get(Globals.twKaiFontKey);\n        req.onsuccess = async (_ev: any) => {\n          fontData = req.result;\n          if (!fontData) {\n            const res = await Globals.axiosInstance.get(`${window.location.origin}/${Globals.twKaiFontPath}`, {\n              responseType: 'arraybuffer',\n              timeout: 0,\n            });\n            const transWrite = db.transaction([\"store\"], 'readwrite');\n            fontData = res.data;\n            const reqWrite = transWrite.objectStore('store').put(fontData, Globals.twKaiFontKey);\n            reqWrite.onsuccess = (_ev: any) => {\n              return ok();\n            };\n          }\n          return ok();\n        };\n      };\n    });\n    const fontFace = new (window as any).FontFace('Kai', fontData);\n    await fontFace.load();\n    (document as any).fonts.add(fontFace);\n    console.log('[Main] TW-Kai font loading success!');\n  }\n\n  // Prevent from device sleeping.\n  wakeLock: any;\n  async wakeLockScreen() {\n    try {\n      const wakeLock = (navigator as any).wakeLock;\n      if (wakeLock !== undefined) {\n        this.wakeLock = await wakeLock.request('screen');\n        console.log('Auto screen lock is disabled.');\n      }\n    } catch (err) {\n      // the wake lock request fails - usually system related, such low as battery\n      console.error(`${err.name}, ${err.message}`);\n      console.error(new Error().stack);\n    }\n  }\n\n  routeByQueryString() {\n    // This app uses client side routing. \n    // Without the first loading of this app,\n    // any client side route becomes a server side route!\n    // These invalid server side routings cause 404 errors.\n    // To workaround these errors, we can use GitHub 404.html redirection\n    // to pass the client side routes to this app by using query string.\n    // After this app loads, it can use the query string to correctly redirect to\n    // a client side route!\n    console.log(window.location.search);\n    const routeMatches = /route=([^&]*)/.exec(window.location.search);\n    const queryMatches = /query=([^&]*)/.exec(window.location.search);\n    if (routeMatches !== null) {\n      let query = ''\n      if (queryMatches !== null) {\n        query = decodeURIComponent(queryMatches[1]);\n      }\n      return <Redirect to={routeMatches[1] + query} />;\n    } else if (window.location.pathname === '/') {\n      return <Redirect to=\"/bookmarks\" />;\n    }\n  }\n\n  render() {\n    return (\n      <IonApp style={\n        // Without this, window height shrinks after Android soft keyboard poping up.\n        Globals.isTouchDevice() ? { height: `${window.innerHeight}px` } : {}\n      }>\n        <IonReactRouter>\n          <IonTabs>\n            <IonRouterOutlet animated={false}>\n              {/* The following route is for backward compatibility. */}\n              <Route path=\"/:tab(catalog)/webview/:work/:path/:label\" render={(props: any) => <EPubViewPage {...props} />} exact={true} />\n              <Route path=\"/:tab(catalog)/juan/:work/:path/\" render={(props: any) => <EPubViewPage {...props} />} exact={true} />\n              {/* The following route is for backward compatibility. */}\n              <Route path=\"/:tab(catalog)/work/:path/:label\" render={(props: any) => <WorkPage {...props} />} exact={true} />\n              <Route path=\"/:tab(catalog)/work/:path\" render={(props: any) => <WorkPage {...props} />} exact={true} />\n              <Route path=\"/:tab(catalog)/search/:keyword\" render={props => <SearchPage {...props} />} exact={true} />\n              <Route path=\"/:tab(catalog)/fulltextsearch/:keyword\" render={props => <FullTextSearchPage {...props} />} exact={true} />\n              {/* The following route is for backward compatibility. */}\n              <Route path=\"/:tab(catalog)/catalog/:path/:label\" render={(props: any) => <CatalogPage {...props} />} exact={true} />\n              <Route path=\"/:tab(catalog)/:type(catalog|volumes|famous)?/:path?\" render={(props: any) => <CatalogPage {...props} />} exact={true} />\n              <Route path=\"/:tab(bookmarks)\" render={(props: any) => <BookmarkPage {...props} />} exact={true} />\n              <Route path={`/:tab(dictionary)/search/:keyword?`} render={(props: any) => <DictionaryPage {...props} />} exact={true} />\n              <Route path={`/:tab(dictionary)/searchWord/:keyword?`} render={(props: any) => <WordDictionaryPage {...props} />} exact={true} />\n              <Route path=\"/settings\" render={(props: any) => <SettingsPage {...props} />} />\n              <Route path=\"/\" render={() => { return this.routeByQueryString(); }} exact={true} />\n            </IonRouterOutlet>\n            <IonTabBar slot=\"bottom\">\n              <IonTabButton tab=\"bookmarks\" href=\"/bookmarks\">\n                <IonIcon icon={bookmark} />\n              </IonTabButton>\n              <IonTabButton tab=\"catalog\" href=\"/catalog\">\n                <IonIcon icon={library} />\n              </IonTabButton>\n              <IonTabButton tab=\"dictionay\" href=\"/dictionary/search\">\n                <IonIcon icon={book} />\n              </IonTabButton>\n              <IonTabButton tab=\"settings\" href=\"/settings\">\n                <IonIcon icon={settings} />\n              </IonTabButton>\n            </IonTabBar>\n          </IonTabs>\n        </IonReactRouter>\n        <IonAlert\n          cssClass='uiFont'\n          isOpen={this.state.showUpdateAlert}\n          backdropDismiss={false}\n          onDidPresent={(ev) => {\n            // Run SKIP_WAITING at onDidPresent event to avoid a race condition of\n            // an old page fetching old JS chunks with a new service worker!\n            this.registrationNew?.installing?.postMessage({ type: 'SKIP_WAITING' });\n            this.registrationNew?.waiting?.postMessage({ type: 'SKIP_WAITING' });\n          }}\n          header={'發現app更新，避免運作異常，請重啟app或關閉相關分頁!然後可至設定頁檢查版本號。'}\n          buttons={[\n            {\n              text: '關閉',\n              cssClass: 'primary uiFont',\n              handler: (value) => {\n                this.setState({\n                  showUpdateAlert: false,\n                });\n              },\n            },\n            {\n              text: '顯示版本歷史',\n              cssClass: 'secondary uiFont',\n              handler: (value) => {\n                window.open('https://github.com/MrMYHuang/cbetar2#history');\n              },\n            }\n          ]}\n        />\n\n        <ShareTextModal\n          {...{\n            text: this.props.shareTextModal?.text,\n            showModal: this.props.shareTextModal?.show || false,\n            finish: () => {\n              store.dispatch({\n                type: \"TMP_SET_KEY_VAL\",\n                key: 'shareTextModal',\n                val: { show: false },\n              });\n            }, ...this.props\n          }}\n        />\n      </IonApp>\n    );\n  }\n}\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n    shareTextModal: state.tmpSettings.shareTextModal,\n  }\n};\n\nconst AppOrig = connect(\n  mapStateToProps,\n)(_AppOrig);\n\n\nconst App = withRouter(_App);\n\nexport default App;\n","import { /*applyMiddleware,*/ createStore, Store } from \"redux\";\r\n\r\n//import { logger } from \"redux-logger\"\r\n//import thunk from \"redux-thunk\"\r\n//import promise from \"redux-promise-middleware\"\r\n\r\nimport reducer from \"./reducers\";\r\nimport Globals from \"../Globals\";\r\n\r\n//const middleware = applyMiddleware(promise(), thunk, logger)\r\n\r\nvar savedStore: Store;\r\n\r\nexport default function getSavedStore() {\r\n    var savedSettingsStr = localStorage.getItem(Globals.storeFile);\r\n    if (savedSettingsStr != null) {\r\n        savedStore = createStore(reducer, JSON.parse(savedSettingsStr));//, middleware)\r\n    }\r\n    else {\r\n        savedStore = createStore(reducer);//, middleware)\r\n    }\r\n\r\n    return savedStore;\r\n}\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\ntype Config = {\r\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\r\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\r\n};\r\n\r\nexport function register(config?: Config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(\r\n      process.env.PUBLIC_URL,\r\n      window.location.href\r\n    );\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl: string, config?: Config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      /*\r\n      if(registration.waiting) {\r\n        const reg = registration.waiting;\r\n        reg.postMessage({ type: 'SKIP_WAITING' });\r\n        alert('Skip waiting.');\r\n      }*/\r\n\r\n      registration.onupdatefound = () => {\r\n        //alert('onupdatefound.');\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          console.log(`installingWorker stage changed: ${installingWorker.state}`);\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' }\r\n  })\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport { BrowserRouter } from \"react-router-dom\";\r\nimport App, {serviceWorkCallbacks} from './App';\r\nimport Globals from './Globals';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\n// Enable at the very start for logging most messages.\r\nGlobals.enableAppLog();\r\n\r\nReactDOM.render(<BrowserRouter><App /></BrowserRouter>, document.getElementById('root'));\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.register({\r\n    onSuccess: (registration: ServiceWorkerRegistration) => { console.log('Precache app loaded!'); serviceWorkCallbacks.onSuccess(registration); },\r\n    onUpdate: (registration: ServiceWorkerRegistration) => { console.log('Found app updated!'); serviceWorkCallbacks.onUpdate(registration); },\r\n});\r\n"],"sourceRoot":""}