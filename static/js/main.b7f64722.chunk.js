(this.webpackJsonpcbetar2=this.webpackJsonpcbetar2||[]).push([[1],{129:function(t){t.exports=JSON.parse('{"name":"cbetar2","productName":"\u96fb\u5b50\u4f5b\u5178","pwaVersion":"4.19.2","version":"10.5.0","license":"MIT","keywords":["CBETA","\u96fb\u5b50\u4f5b\u5178","\u4f5b\u5178","\u4f5b\u7d93","\u5927\u85cf\u7d93","Tripitaka","Buddhist Canon","Buddhist text"],"description":"CBETA\u96fb\u5b50\u4f5b\u5178\u95b1\u8b80\u56682(\u975e\u5b98\u65b9)\uff0c\u4f7f\u7528CBETA API\u5b58\u53d6\u96fb\u5b50\u4f5b\u7d93\u3002","repository":"https://github.com/MrMYHuang/cbetar2","author":{"name":"Meng-Yuan Huang","email":"myh@live.com"},"private":false,"files":["README.md"],"main":"buildElectron/main.js","scripts":{"start":"react-app-rewired start","build":"react-app-rewired build && powershell -file CopyBuild.ps1","build_linux":"react-app-rewired build && ./CopyBuild.sh","test":"react-app-rewired test","eject":"react-scripts eject","build-electron":"tsc -b tsconfigElectron.json","start-electron":"npm run build-electron && electron .","dist-win":"npm run build-electron && electron-builder -w -c electronBuilderConfigs/win.json","dist-deb":"npm run build-electron && electron-builder -l deb -c electronBuilderConfigs/deb.json","dist-rpm":"npm run build-electron && electron-builder -l rpm -c electronBuilderConfigs/rpm.json","dist-snap":"npm run build-electron && rm -f dist/*.snap && electron-builder -l snap -c electronBuilderConfigs/snap.json","publish-snap":"snapcraft upload --release=stable dist/*.snap","dist-mac":"npm run build-electron && electron-builder -m pkg -c electronBuilderConfigs/mac.json","icons-mas":"cd buildElectron && iconutil -c icns icon.iconset","dist-mas":"npm run build-electron && electron-builder -m mas -c electronBuilderConfigs/mas.json","dist-mas-dev":"npm run build-electron && electron-builder -m mas-dev -c electronBuilderConfigs/masDev.json"},"eslintConfig":{"extends":"react-app"},"dependencies":{"electron-window-state":"^5.0.3"},"devDependencies":{"@ionic/react":"^5.5.2","@ionic/react-router":"^5.5.2","@testing-library/jest-dom":"^5.11.4","@testing-library/react":"^11.1.0","@testing-library/user-event":"^12.1.10","@types/jest":"^26.0.15","@types/node":"^12.0.0","@types/qrcode":"^1.3.5","@types/react":"^16.9.53","@types/react-dom":"^16.9.8","@types/react-redux":"^7.1.11","@types/react-router":"^5.1.8","@types/react-router-dom":"^5.1.6","@types/uuid":"^8.3.0","axios":"^0.21.1","customize-cra":"^1.0.0","electron":"^11.1.0","electron-builder":"^22.9.1","electron-builder-notarize-pkg":"^1.2.0","epubjs-myh":"^0.3.111","history":"^4.10.1","ionicons":"^5.2.3","memfs":"^3.2.0","nodepub":"^2.2.0","qrcode":"^1.4.4","query-string":"^6.13.7","react":"^17.0.1","react-app-rewired":"^2.1.7","react-dom":"^17.0.1","react-redux":"^7.2.2","react-router":"^5.2.0","react-router-dom":"^5.2.0","react-scripts":"^4.0.1","redux":"^4.0.5","swiped-events-myh":"^1.2.0","typescript":"^4.1.3","uuid":"^8.3.1","workbox-background-sync":"^5.1.3","workbox-broadcast-update":"^5.1.3","workbox-cacheable-response":"^5.1.3","workbox-core":"^5.1.3","workbox-expiration":"^5.1.3","workbox-google-analytics":"^5.1.3","workbox-navigation-preload":"^5.1.3","workbox-precaching":"^5.1.3","workbox-range-requests":"^5.1.3","workbox-routing":"^5.1.3","workbox-strategies":"^5.1.3","workbox-streams":"^5.1.3"},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]}}')},145:function(t,e,n){},230:function(t,e,n){var s={"./ion-action-sheet.entry.js":[445,5],"./ion-alert.entry.js":[446,6],"./ion-app_8.entry.js":[447,7],"./ion-avatar_3.entry.js":[448,17],"./ion-back-button.entry.js":[449,18],"./ion-backdrop.entry.js":[450,43],"./ion-button_2.entry.js":[451,19],"./ion-card_5.entry.js":[452,20],"./ion-checkbox.entry.js":[453,21],"./ion-chip.entry.js":[454,22],"./ion-col_3.entry.js":[455,44],"./ion-datetime_3.entry.js":[456,10],"./ion-fab_3.entry.js":[457,23],"./ion-img.entry.js":[458,45],"./ion-infinite-scroll_2.entry.js":[459,46],"./ion-input.entry.js":[460,24],"./ion-item-option_3.entry.js":[461,25],"./ion-item_8.entry.js":[462,26],"./ion-loading.entry.js":[463,27],"./ion-menu_3.entry.js":[464,28],"./ion-modal.entry.js":[465,8],"./ion-nav_2.entry.js":[466,14],"./ion-popover.entry.js":[467,9],"./ion-progress-bar.entry.js":[468,29],"./ion-radio_2.entry.js":[469,30],"./ion-range.entry.js":[470,31],"./ion-refresher_2.entry.js":[471,11],"./ion-reorder_2.entry.js":[472,16],"./ion-ripple-effect.entry.js":[473,47],"./ion-route_4.entry.js":[474,32],"./ion-searchbar.entry.js":[475,33],"./ion-segment_2.entry.js":[476,34],"./ion-select_3.entry.js":[477,35],"./ion-slide_2.entry.js":[478,48],"./ion-spinner.entry.js":[479,13],"./ion-split-pane.entry.js":[480,49],"./ion-tab-bar_2.entry.js":[481,36],"./ion-tab_2.entry.js":[482,15],"./ion-text.entry.js":[483,37],"./ion-textarea.entry.js":[484,38],"./ion-toast.entry.js":[485,39],"./ion-toggle.entry.js":[486,12],"./ion-virtual-scroll.entry.js":[487,50]};function o(t){if(!n.o(s,t))return Promise.resolve().then((function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}));var e=s[t],o=e[0];return n.e(e[1]).then((function(){return n(o)}))}o.keys=function(){return Object.keys(s)},o.id=230,t.exports=o},232:function(t,e,n){var s={"./ion-icon.entry.js":[489,57]};function o(t){if(!n.o(s,t))return Promise.resolve().then((function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}));var e=s[t],o=e[0];return n.e(e[1]).then((function(){return n(o)}))}o.keys=function(){return Object.keys(s)},o.id=232,t.exports=o},266:function(t,e,n){},267:function(t,e,n){},308:function(t,e){},310:function(t,e){},344:function(t,e){},346:function(t,e){},362:function(t,e){},364:function(t,e){},386:function(t,e){},388:function(t,e){},394:function(t,e){},396:function(t,e){},421:function(t,e,n){},422:function(t,e,n){},443:function(t,e,n){"use strict";n.r(e);var s,o=n(0),r=n(2),a=n.n(r),i=n(68),c=n.n(i),l=n(94),u=n(5),h=n.n(u),p=n(10),d=n(18),b=n(4),j=n(6),f=n(12),v=n(13),x=n(19),g=n(1),m=n(213),k=n(25),y=n(49),w=n.n(y),O=n(55),S=n(24),T=n(215),C=n.n(T);!function(t){t[t.BY_CHAPTER=0]="BY_CHAPTER",t[t.BY_JUAN=1]="BY_JUAN"}(s||(s={}));var A=function t(e){Object(b.a)(this,t),this.title=void 0,this.juan=void 0,this.title=e.title,this.juan=e.juan},I=function t(e){Object(b.a)(this,t),this.title=void 0,this.juan=void 0,this.juan_list=void 0,this.mulu=void 0,this.work=void 0,this.vol=void 0,this.title=e.title,this.juan=e.juan,this.juan_list=e.juan_list,this.mulu=e.mulu,this.work=e.work,this.vol=e.vol},E="v1.2",F="https://cbdata.dila.edu.tw/".concat(E),L="cbetardb",N="",P=C.a.create({baseURL:F,timeout:5e3});function D(t){switch(t){case 0:return 0;case 1:return 20;case 2:return 40}}function B(t,e){return"".concat(t,"_juan").concat(e,".html")}function _(t){return R.apply(this,arguments)}function R(){return(R=Object(p.a)(h.a.mark((function t(e){var n;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=indexedDB.open(L),t.abrupt("return",new Promise((function(t,s){n.onsuccess=function(){var o=Object(p.a)(h.a.mark((function o(r){var a,i,c;return h.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:a=n.result,i=a.transaction(["store"],"readwrite"),(c=i.objectStore("store").get(e)).onsuccess=function(){var n=Object(p.a)(h.a.mark((function n(o){var r;return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=c.result){n.next=5;break}return console.error("".concat(e," loading failed!")),console.error((new Error).stack),n.abrupt("return",s());case 5:return n.abrupt("return",t(r));case 6:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}();case 4:case"end":return o.stop()}}),o)})));return function(t){return o.apply(this,arguments)}}()})));case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function V(){return(V=Object(p.a)(h.a.mark((function t(e,n){var s;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=indexedDB.open(L),t.abrupt("return",new Promise((function(t,o){s.onsuccess=function(){var r=Object(p.a)(h.a.mark((function r(a){var i,c,l;return h.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:i=s.result,c=i.transaction(["store"],"readwrite"),(l=c.objectStore("store").put(n,e)).onsuccess=function(e){return t()},l.onerror=function(t){return o()};case 5:case"end":return r.stop()}}),r)})));return function(t){return r.apply(this,arguments)}}()})));case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function M(){return(M=Object(p.a)(h.a.mark((function t(e){var n;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=indexedDB.open(L),t.abrupt("return",new Promise((function(t,s){n.onsuccess=function(){var o=Object(p.a)(h.a.mark((function o(r){var a,i,c;return h.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:a=n.result,i=a.transaction(["store"],"readwrite"),(c=i.objectStore("store").delete(e)).onsuccess=function(e){return t()},c.onerror=function(t){return s()};case 5:case"end":return o.stop()}}),o)})));return function(t){return o.apply(this,arguments)}}()})));case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function z(){return U.apply(this,arguments)}function U(){return(U=Object(p.a)(h.a.mark((function t(){var e;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=indexedDB.open(L),t.abrupt("return",new Promise((function(t,n){e.onsuccess=function(){var s=Object(p.a)(h.a.mark((function s(o){var r,a,i;return h.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:r=e.result,a=r.transaction(["store"],"readwrite"),(i=a.objectStore("store").clear()).onsuccess=function(e){return t()},i.onerror=function(t){return n()};case 5:case"end":return s.stop()}}),s)})));return function(t){return s.apply(this,arguments)}}()})));case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function K(){return(K=Object(p.a)(h.a.mark((function t(){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return localStorage.clear(),t.next=3,z();case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function H(){return(H=Object(p.a)(h.a.mark((function t(e,n,s){var o,r,a,i,c,l,u,p,d,b,j,f,v,x=arguments;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=x.length>3&&void 0!==x[3]&&x[3],r=s||B(e,n),a=null,t.prev=3,t.next=6,_(r);case 6:a=t.sent,t.next=11;break;case 9:t.prev=9,t.t0=t.catch(3);case 11:if(i=localStorage.getItem("Settings.json"),c=new I({}),i&&(u=JSON.parse(i).settings.bookmarks,l=u.find((function(t){return t.fileName===r||t.uuid===e}))),null===a||void 0===l||o){t.next=18;break}c=l.work,t.next=38;break;case 18:if(!s){t.next=27;break}return t.next=21,P.get("/".concat(s),{responseType:"arraybuffer"});case 21:p=t.sent,d=new TextDecoder,b=d.decode(p.data),a=b.includes("charset=big5")?new TextDecoder("big5").decode(p.data):b,t.next=33;break;case 27:return t.next=29,P.get("/juans?edition=CBETA&work_info=1&work=".concat(e,"&juan=").concat(n),{responseType:"arraybuffer"});case 29:j=t.sent,f=JSON.parse((new TextDecoder).decode(j.data)),a=f.results[0],c=f.work_info;case 33:(v=document.implementation.createHTMLDocument("")).body.innerHTML=a,a=(a=(a=(new XMLSerializer).serializeToString(v.body)).replace("<body","<div")).replace("/body>","/div>");case 38:return t.abrupt("return",{htmlStr:a,workInfo:c});case 39:case"end":return t.stop()}}),t,null,[[3,9]])})))).apply(this,arguments)}var J=console.log.bind(console),W=console.error.bind(console);var Y=window.webkit;function G(){return Object(g.S)("ios")&&"MacIntel"===navigator.platform}var q,X={storeFile:"Settings.json",fontSizeNorm:24,fontSizeLarge:48,getLog:function(){return N},enableAppLog:function(){console.log=function(){N+="----- Info ----\n",N+=Array.from(arguments)+"\n",J.apply(console,arguments)},console.error=function(){N+="----- Error ----\n",N+=Array.from(arguments)+"\n",W.apply(console,arguments)}},disableAppLog:function(){N="",console.log=J,console.error=W},cbetardb:L,apiVersion:E,cbetaApiUrl:F,dilaDictApiUrl:"https://glossaries.dila.edu.tw/search.json",twKaiFontKey:"twKaiFont",twKaiFontPath:"/assets/TW-Kai-98_1.woff",axiosInstance:P,topCatalogsByCat:{CBETA:"CBETA \u90e8\u985e","Cat-T":"\u5927\u6b63\u85cf","Cat-X":"\u534d\u7e8c\u85cf","Cat-N":"\u5357\u50b3\u5927\u85cf\u7d93",others:"\u6b77\u4ee3\u85cf\u7d93\u88dc\u8f2f",modern:"\u8fd1\u4ee3\u65b0\u7de8\u6587\u737b"},topCatalogsByVol:{"Vol-T":"T \u5927\u6b63\u85cf","Vol-X":"X \u534d\u7e8c\u85cf","Vol-A":"A \u8d99\u57ce\u91d1\u85cf","Vol-K":"K \u9ad8\u9e97\u5927\u85cf\u7d93-\u65b0\u6587\u8c50\u7248","Vol-S":"S \u5b8b\u85cf\u907a\u73cd-\u65b0\u6587\u8c50\u7248","Vol-F":"F \u623f\u5c71\u77f3\u7d93","Vol-C":"C \u4e2d\u83ef\u5927\u85cf\u7d93-\u4e2d\u83ef\u66f8\u5c40\u7248","Vol-U":"U \u6d2a\u6b66\u5357\u85cf","Vol-P":"P \u6c38\u6a02\u5317\u85cf","Vol-J":"J \u5609\u8208\u85cf","Vol-L":"L \u4e7e\u9686\u5927\u85cf\u7d93-\u65b0\u6587\u8c50\u7248","Vol-G":"G \u4f5b\u6559\u5927\u85cf\u7d93","Vol-M":"M \u534d\u6b63\u85cf\u7d93-\u65b0\u6587\u8c50\u7248","Vol-D":"D \u570b\u5716\u5584\u672c","Vol-N":"N \u5357\u50b3\u5927\u85cf\u7d93(\u518a\u5225)","Vol-ZS":"ZS \u6b63\u53f2\u4f5b\u6559\u8cc7\u6599\u985e\u7de8","Vol-I":"I \u5317\u671d\u4f5b\u6559\u77f3\u523b\u62d3\u7247\u767e\u54c1","Vol-ZW":"ZW \u85cf\u5916\u4f5b\u6559\u6587\u737b","Vol-B":"B \u5927\u85cf\u7d93\u88dc\u7de8","Vol-GA":"GA \u4e2d\u570b\u4f5b\u5bfa\u53f2\u5fd7\u5f59\u520a","Vol-GB":"GB \u4e2d\u570b\u4f5b\u5bfa\u5fd7\u53e2\u520a","Vol-Y":"Y \u5370\u9806\u6cd5\u5e2b\u4f5b\u5b78\u8457\u4f5c\u96c6","Vol-LC":"LC \u5442\u6f82\u4f5b\u5b78\u8457\u4f5c\u96c6"},appSettings:{theme:"\u4f48\u666f\u4e3b\u984c",rtlVerticalLayout:"\u7d93\u6587\u76f4\u6392\u3001\u53f3\u81f3\u5de6\u66f8\u5beb",paginated:"\u55ae\u9801/\u5206\u9801",showComments:"\u986f\u793a\u7d93\u6587\u8a3b\u89e3\u3001\u7248\u6b0a",useFontKai:"\u9ed1\u9ad4/\u6977\u66f8\u5b57\u9ad4",uiFontSize:"UI\u5b57\u578b\u5927\u5c0f",fontSize:"\u7d93\u6587\u5b57\u578b\u5927\u5c0f",printStyle:"\u7d93\u6587\u5217\u5370\u6a23\u5f0f"},fetchErrorContent:Object(o.jsx)("div",{className:"contentCenter",children:Object(o.jsx)(g.o,{children:Object(o.jsxs)("div",{children:[Object(o.jsx)("div",{children:"\u9023\u7dda\u5931\u6557!"}),Object(o.jsxs)("div",{style:{fontSize:"var(--ui-font-size)",paddingTop:24},children:["\u5982\u679c\u554f\u984c\u6301\u7e8c\u767c\u751f\uff0c\u8acb\u57f7\u884c",Object(o.jsx)("a",{href:"/settings",target:"_self",children:"\u8a2d\u5b9a\u9801"}),"\u7684app\u7570\u5e38\u56de\u5831\u529f\u80fd\u3002"]})]})})}),updateApp:function(){return new Promise(function(){var t=Object(p.a)(h.a.mark((function t(e){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:navigator.serviceWorker.getRegistrations().then(function(){var t=Object(p.a)(h.a.mark((function t(n){var s;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(n.map((function(t){return t.update().then((function(t){return null!==t.installing||null!==t.waiting}))})));case 2:s=t.sent,e(s.reduce((function(t,e){return t||e}),!1));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},scrollbarSizeIdToValue:D,updateCssVars:function(t){var e=D(t.scrollbarSize);document.documentElement.style.cssText="--ion-font-family: ".concat(t.useFontKai?"Heiti, Times, Kai":"Times, Heiti",";\n        --scrollbar-size: ").concat(e,"px; --ui-font-size: ").concat(t.uiFontSize,"px; --text-font-size: ").concat(t.fontSize,"px")},isMacCatalyst:G,isTouchDevice:function(){return Object(g.S)("ios")&&!G()||Object(g.S)("android")},fetchJuan:function(t,e,n){return H.apply(this,arguments)},getFileName:B,getFileFromIndexedDB:_,saveFileToIndexedDB:function(t,e){return V.apply(this,arguments)},removeFileFromIndexedDB:function(t){return M.apply(this,arguments)},clearAppData:function(){return K.apply(this,arguments)},removeElementsByClassName:function(t,e){for(var n=t.getElementsByClassName(e);n.length>0;){var s;null===(s=n[0].parentNode)||void 0===s||s.removeChild(n[0])}},disableAndroidChromeCallout:function(t){return t.preventDefault(),t.stopPropagation(),!1},disableIosSafariCallout:function(t){var e=this.getSelection();if(((null===e||void 0===e?void 0:e.rangeCount)||0)>0){var n=null===e||void 0===e?void 0:e.getRangeAt(0);null===e||void 0===e||e.removeAllRanges(),setTimeout((function(){null===e||void 0===e||e.addRange(n)}),50)}},copyToClipboard:function(t){G()?Y.messageHandlers.swiftCallbackHandler.postMessage({event:"copy",text:t}):navigator.clipboard&&navigator.clipboard.writeText(t)},zhVoices:function(){return speechSynthesis.getVoices().filter((function(t){return["zh-TW","zh_TW","zh-CN","zh_CN","zh-HK","zh_HK"].some((function(e){return t.localService&&t.lang.indexOf(e)>-1}))}))}};!function(t){t[t.CATALOG=0]="CATALOG",t[t.WORK=1]="WORK",t[t.JUAN=2]="JUAN",t[t.HTML=3]="HTML"}(q||(q={}));var Q=function t(e){Object(b.a)(this,t),this.type=q.CATALOG,this.uuid="",this.work=null,this.selectedText="",this.epubcfi="",this.fileName="",this.type=e.type,this.uuid=e.uuid,this.work=e.work,this.selectedText=e.selectedText,this.epubcfi=e.epubcfi,this.fileName=e.fileName};var Z=Object(O.b)({settings:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0,n=Object(d.a)({},t);switch(e.type){case"LOAD_SETTINGS":n=JSON.parse(localStorage.getItem(X.storeFile)).settings;break;case"SET_KEY_VAL":var s=e.key,o=e.val;switch(s){case"theme":document.body.classList.forEach((function(t){/theme/.test(t)&&document.body.classList.remove(t)})),document.body.classList.toggle("theme".concat(o),!0);break;case"printStyle":document.body.classList.forEach((function(t){/print/.test(t)&&document.body.classList.remove(t)})),document.body.classList.toggle("print".concat(o),!0)}n[s]=o,localStorage.setItem(X.storeFile,JSON.stringify({settings:n}));break;case"ADD_BOOKMARK":var r=n.bookmarks,a=e.bookmark.fileName;null===a||""===a||r.some((function(t){return t.fileName===a}))||X.saveFileToIndexedDB(a,e.htmlStr),n.bookmarks=[].concat(Object(S.a)(n.bookmarks),[e.bookmark]),localStorage.setItem(X.storeFile,JSON.stringify({settings:n}));break;case"DEL_BOOKMARK":var i=n.bookmarks,c=i.findIndex((function(t){return t.uuid===e.uuid}));if(-1!==c){var l=i.splice(c,1);if(1===l.length){var u=l[0],h=u.fileName,p=null==i.find((function(t){return t.type===q.JUAN&&t.uuid===u.uuid})),b=null==i.find((function(t){var e,n;return t.type===q.WORK&&(null===(e=t.work)||void 0===e?void 0:e.work)===(null===(n=u.work)||void 0===n?void 0:n.work)}));if(b)switch(u.type){case q.WORK:var j=u.work;if(null==j)break;for(var f=j.juan_list.split(","),v=function(t){var e=X.getFileName(j.work,f[t]);(p=null==i.find((function(t){return t.type===q.JUAN&&t.fileName===e})))&&X.removeFileFromIndexedDB(e)},x=0;x<f.length;x++)v(x);break;case q.JUAN:p&&X.removeFileFromIndexedDB(h)}}}n.bookmarks=Object(S.a)(i),localStorage.setItem(X.storeFile,JSON.stringify({settings:n}));break;case"UPDATE_BOOKMARKS":n.bookmarks=e.bookmarks,localStorage.setItem(X.storeFile,JSON.stringify({settings:n}));break;case"DEFAULT_SETTINGS":n={};default:0===Object.keys(n).length&&(n={});for(var g=["version","hasAppLog","theme","paginated","rtlVerticalLayout","scrollbarSize","useFontKai","fontSize","uiFontSize","showComments","printStyle","voiceURI","speechRate","bookmarks","dictionaryHistory","wordDictionaryHistory"],m=[1,1,0,1,1,2,1,32,24,0,0,null,.8,[],[],[]],k=0;k<g.length;k++)void 0===n[g[k]]&&(n[g[k]]=m[k])}return n},tmpSettings:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0,n=Object(d.a)({},t),s=e.key,o=e.val;switch(n[s]=o,e.type){case"TMP_SET_KEY_VAL":return n}return t}});var $,tt=n(7),et=(n(266),function t(e){Object(b.a)(this,t),this.n=void 0,this.nodeType=void 0,this.label=void 0,this.work=void 0,this.file=void 0,this.n=e.n,this.nodeType=e.node_type,this.label=e.label,this.work=e.work,this.file=e.file}),nt=function(t){Object(f.a)(n,t);var e=Object(v.a)(n);function n(){return Object(b.a)(this,n),e.apply(this,arguments)}return Object(j.a)(n,[{key:"render",value:function(){var t=this;return Object(o.jsx)(g.a,{cssClass:"uiFont",isOpen:this.props.showSearchAlert,header:"\u641c\u5c0b\u7d93\u66f8",subHeader:"\u8f38\u5165\u641c\u5c0b",inputs:[{name:"name0",type:"search",placeholder:"\u4f8b:\u91d1\u525b\u822c\u82e5"}],buttons:[{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary uiFont",handler:function(){return t.props.finish()}},{text:"\u641c\u5c0b\u76ee\u9304",cssClass:"primary uiFont",handler:function(e){t.props.finish(),t.props.history.push("/catalog/search/".concat(e.name0))}},{text:"\u5168\u6587\u6aa2\u7d22",cssClass:"primary uiFont",handler:function(e){t.props.finish(),t.props.history.push("/catalog/fulltextsearch/".concat(e.name0))}}]})}}]),n}(a.a.Component),st=[{title:"\u822c\u82e5\u6ce2\u7f85\u871c\u591a\u5fc3\u7d93",url:"/catalog/juan/T0251/1"},{title:"\u91d1\u525b\u822c\u82e5\u6ce2\u7f85\u871c\u7d93",url:"/catalog/juan/T0235/1"},{title:"\u4f5b\u8aaa\u963f\u5f4c\u9640\u7d93",url:"/catalog/juan/T0366/1"},{title:"\u85e5\u5e2b\u7409\u7483\u5149\u5982\u4f86\u672c\u9858\u529f\u5fb7\u7d93",url:"/catalog/juan/T0450/1"},{title:"\u4f5b\u8aaa\u89c0\u5f4c\u52d2\u83e9\u85a9\u4e0a\u751f\u515c\u7387\u5929\u7d93",url:"/catalog/juan/T0452/1"},{title:"\u5730\u85cf\u83e9\u85a9\u672c\u9858\u7d93",url:"/catalog/juan/T0412/1"},{title:"\u5999\u6cd5\u84ee\u83ef\u7d93\u89c0\u4e16\u97f3\u83e9\u85a9\u666e\u9580\u54c1\u7d93",url:"/catalog/juan/T0262/7"},{title:"\u5927\u4f5b\u9802\u5982\u4f86\u5bc6\u56e0\u4fee\u8b49\u4e86\u7fa9\u8af8\u83e9\u85a9\u842c\u884c\u9996\u695e\u56b4\u7d93\u5377\u7b2c\u4e00",url:"/catalog/juan/T0945/1"},{title:"\u4f5b\u8aaa\u6cd5\u6ec5\u76e1\u7d93",url:"/catalog/juan/T0396/1"}],ot=function(t){Object(f.a)(n,t);var e=Object(v.a)(n);function n(t){var s;return Object(b.a)(this,n),(s=e.call(this,t)).state={topCatalogsType:0,fetchError:!1,catalogs:[],pathLabel:"",showSearchAlert:!1,isLoading:!1},s}return Object(j.a)(n,[{key:"ionViewWillEnter",value:function(){console.log("".concat(this.props.match.url," will enter."));var t=-1;switch(this.props.match.url){case"/catalog":t=0;break;case"/catalog/volumes":t=1;break;case"/catalog/famous":t=2;break;default:t=-1}this.setState({topCatalogsType:t}),this.fetchData(this.props.match.params.path)}},{key:"componentDidMount",value:function(){console.log("did mount: ".concat(this.props.match.url))}},{key:"fetchData",value:function(){var t=Object(p.a)(h.a.mark((function t(e){var n,s,o,r,a,i;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.setState({isLoading:!0}),n=new Array,s="",t.t0=this.state.topCatalogsType,t.next=0===t.t0||1===t.t0?6:-1===t.t0?7:2===t.t0?26:28;break;case 6:return t.abrupt("return",this.fetchTopCatalogs(this.state.topCatalogsType));case 7:return t.prev=7,t.next=10,X.axiosInstance.get("/catalog_entry?q=".concat(e),{responseType:"arraybuffer"});case 10:return o=t.sent,r=JSON.parse((new TextDecoder).decode(o.data)),a=r.results,n=a.map((function(t){return new et(t)})),""!==this.parentPath(e)?s=r.label:(i=X.topCatalogsByCat[e],s=void 0!==i?i:X.topCatalogsByVol[e]),this.setState({fetchError:!1,isLoading:!1,catalogs:n,pathLabel:s}),t.abrupt("return",!0);case 20:return t.prev=20,t.t1=t.catch(7),console.error(t.t1),console.error((new Error).stack),this.setState({fetchError:!0,isLoading:!1,pathLabel:""}),t.abrupt("return",!1);case 26:return this.setState({fetchError:!1,isLoading:!1,pathLabel:""}),t.abrupt("break",28);case 28:case"end":return t.stop()}}),t,this,[[7,20]])})));return function(e){return t.apply(this,arguments)}}()},{key:"fetchTopCatalogs",value:function(t){var e=Array(),n=t?X.topCatalogsByVol:X.topCatalogsByCat;return Object.keys(n).forEach((function(t){var s={n:t,nodeType:null,work:null,label:n[t],file:null};e.push(s)})),this.setState({fetchError:!1,isLoading:!1,catalogs:e,pathLabel:""}),!0}},{key:"parentPath",value:function(t){var e=t.split(".");return e.pop(),e.join(".")}},{key:"addBookmarkHandler",value:function(){this.props.dispatch({type:"ADD_BOOKMARK",bookmark:new Q({type:q.CATALOG,uuid:this.props.match.params.path,selectedText:this.state.pathLabel,epubcfi:"",fileName:"",work:null})})}},{key:"delBookmarkHandler",value:function(){this.props.dispatch({type:"DEL_BOOKMARK",uuid:this.props.match.params.path})}},{key:"getRows",value:function(){var t=this,e=Array();return this.state.catalogs.forEach((function(n,s){var r="",a="html"===n.nodeType;r=a?"/catalog/juan/".concat(n.n,"/1"):null==n.work?"/catalog/catalog/".concat(n.n):"/catalog/work/".concat(n.work),e.push(Object(o.jsxs)(g.k,{button:!0,onClick:function(){var e=Object(p.a)(h.a.mark((function e(s){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s.preventDefault(),t.props.history.push({pathname:r,search:w.a.stringify(a?{file:n.file,title:n.label}:{})});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:n.label},"".concat(n.n,"label")+s)]},"".concat(n.n,"item")+s))})),e}},{key:"getFamousJuanRows",value:function(){var t=this,e=Array();return st.forEach((function(n,s){var r=n.title,a=n.url;e.push(Object(o.jsxs)(g.k,{button:!0,onClick:function(){var e=Object(p.a)(h.a.mark((function e(n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.props.history.push(a);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:r},"famousItemLabel_"+s)]},"famousJuanItem_"+s))})),e}},{key:"render",value:function(){var t=this,e=Object(o.jsx)(g.p,{children:2===this.state.topCatalogsType?this.getFamousJuanRows():this.getRows()});return Object(o.jsxs)(g.s,{children:[Object(o.jsx)(g.g,{children:Object(o.jsxs)(g.J,{children:[Object(o.jsx)(g.c,{hidden:this.isTopCatalog,fill:"clear",slot:"start",onClick:function(e){return t.props.history.goBack()},children:Object(o.jsx)(g.h,{icon:tt.a,slot:"icon-only"})}),Object(o.jsxs)(g.B,{hidden:!this.isTopCatalog,slot:"start",value:this.state.topCatalogsType,className:"buttonRounded",interface:"popover",interfaceOptions:{cssClass:"cbetar2themes"},onIonChange:function(e){var n="";switch(e.detail.value){case 0:n="/catalog";break;case 1:n="/catalog/volumes";break;case 2:n="/catalog/famous";break;case-1:n=t.props.match.url}t.props.match.url!==n&&t.props.history.push(n)},children:[Object(o.jsx)(g.C,{className:"uiFont",value:0,children:"\u90e8\u5206\u985e"}),Object(o.jsx)(g.C,{className:"uiFont",value:1,children:"\u518a\u5206\u985e"}),Object(o.jsx)(g.C,{className:"uiFont",value:2,children:"\u77e5\u540d\u7d93\u5178"})]}),Object(o.jsx)(g.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(e){return t.fetchData(t.props.match.params.path)},children:Object(o.jsx)(g.h,{icon:tt.C,slot:"icon-only"})}),Object(o.jsx)(g.c,{hidden:this.isTopCatalog,fill:this.hasBookmark?"solid":"clear",slot:"end",onClick:function(e){return t.hasBookmark?t.delBookmarkHandler():t.addBookmarkHandler()},children:Object(o.jsx)(g.h,{icon:tt.g,slot:"icon-only"})}),Object(o.jsx)(g.c,{hidden:this.isTopCatalog,fill:"clear",slot:"end",onClick:function(e){return t.props.history.push("/".concat(t.props.match.params.tab))},children:Object(o.jsx)(g.h,{icon:tt.v,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"clear",slot:"end",onClick:function(e){return t.setState({showSearchAlert:!0})},children:Object(o.jsx)(g.h,{icon:tt.F,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"clear",slot:"end",onClick:function(e){t.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})},children:Object(o.jsx)(g.h,{icon:tt.J,slot:"icon-only"})})]})}),Object(o.jsxs)(g.d,{children:[this.state.fetchError?X.fetchErrorContent:Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)("div",{className:"uiFontX2",style:{color:"var(--ion-color-primary)"},children:this.state.pathLabel}),e]}),Object(o.jsx)(nt,Object(d.a)({},Object(d.a)({showSearchAlert:this.state.showSearchAlert,finish:function(){t.setState({showSearchAlert:!1})}},this.props))),Object(o.jsx)("div",{style:{fontSize:"var(--ui-font-size)",textAlign:"center"},children:Object(o.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2#bookmark",target:"_new",children:"\u66f8\u7c64\u8207\u96e2\u7dda\u700f\u89bd\u8aaa\u660e"})}),Object(o.jsx)("div",{style:{fontSize:"var(--ui-font-size)",textAlign:"center"},children:Object(o.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2#search",target:"_new",children:"\u641c\u5c0b\u7d93\u66f8\u6559\u5b78"})}),Object(o.jsx)(g.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return t.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."})]})]})}},{key:"isTopCatalog",get:function(){var t=this;return["/catalog","/catalog/volumes","/catalog/famous"].reduce((function(e,n){return e||n===t.props.match.url}),!1)}},{key:"hasBookmark",get:function(){var t=this;return null!=this.props.bookmarks.find((function(e){return e.type===q.CATALOG&&e.uuid===t.props.match.params.path}))}}]),n}(a.a.Component),rt=Object(g.U)(ot),at=Object(k.b)((function(t){return{bookmarks:t.settings.bookmarks,state:t}}))(rt),it=(n(145),function(t){Object(f.a)(n,t);var e=Object(v.a)(n);function n(t){var s;return Object(b.a)(this,n),(s=e.call(this,t)).fetchJuan="",s.state={work:null,showSearchAlert:!1,showAddBookmarkDone:!1,isLoading:!1,fetchError:!1},s}return Object(j.a)(n,[{key:"ionViewWillEnter",value:function(){this.fetchWork(this.props.match.params.path)}},{key:"componentDidMount",value:function(){}},{key:"fetchWork",value:function(){var t=Object(p.a)(h.a.mark((function t(e){var n,s,o,r,a;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.setState({isLoading:!0}),!this.hasBookmark){t.next=5;break}n=this.bookmark.work,t.next=24;break;case 5:return t.prev=5,t.next=8,X.axiosInstance.get("/works?work=".concat(e),{responseType:"arraybuffer"});case 8:return s=t.sent,o=JSON.parse((new TextDecoder).decode(s.data)),r=o.results,n=r[0],t.next=14,X.axiosInstance.get("/toc?work=".concat(e));case 14:a=t.sent,n.mulu=a.data.results[0].mulu.map((function(t){return new A(t)})),t.next=24;break;case 18:return t.prev=18,t.t0=t.catch(5),console.error(t.t0),console.error((new Error).stack),this.setState({fetchError:!0,isLoading:!1}),t.abrupt("return",!1);case 24:return this.setState({fetchError:!1,isLoading:!1,work:n}),t.abrupt("return",!0);case 26:case"end":return t.stop()}}),t,this,[[5,18]])})));return function(e){return t.apply(this,arguments)}}()},{key:"saveJuans",value:function(){var t=Object(p.a)(h.a.mark((function t(){var e,n,s,o;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=this.state.work,n=e.juan_list.split(","),s=0;case 3:if(!(s<n.length)){t.next=19;break}return this.fetchJuan=n[s],t.prev=5,t.next=8,X.fetchJuan(e.work,this.fetchJuan,null);case 8:o=t.sent,X.saveFileToIndexedDB(X.getFileName(e.work,this.fetchJuan),o.htmlStr),t.next=16;break;case 12:t.prev=12,t.t0=t.catch(5),console.error("Fetching juan ".concat(s," failed! ").concat(t.t0)),console.error((new Error).stack);case 16:s++,t.next=3;break;case 19:this.setState({showAddBookmarkDone:!0});case 20:case"end":return t.stop()}}),t,this,[[5,12]])})));return function(){return t.apply(this,arguments)}}()},{key:"addBookmarkHandler",value:function(){var t=Object(p.a)(h.a.mark((function t(){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.saveJuans();case 2:this.props.dispatch({type:"ADD_BOOKMARK",bookmark:new Q({type:q.WORK,uuid:this.props.match.params.path,selectedText:this.state.work.title,epubcfi:"",fileName:"",work:this.state.work})});case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"delBookmarkHandler",value:function(){this.props.dispatch({type:"DEL_BOOKMARK",uuid:this.props.match.params.path})}},{key:"getRowsByChapter",value:function(){for(var t=this,e=this.state.work,n=null===e||void 0===e?void 0:e.mulu,s=Array(),r=function(r){var a="/catalog/juan/".concat(null===e||void 0===e?void 0:e.work,"/").concat(n[r].juan);s.push(Object(o.jsxs)(g.k,{button:!0,onClick:function(){var e=Object(p.a)(h.a.mark((function e(n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.preventDefault(),t.props.history.push({pathname:a});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:n[r].title},"chapterLabel"+r)]},"chapterItem"+r))},a=0;a<((null===n||void 0===n?void 0:n.length)||-1);a++)r(a);return s}},{key:"getRowsByJuan",value:function(){for(var t=this,e=this.state.work,n=Array(),s=null===e||void 0===e?void 0:e.juan_list.split(","),r=function(r){var a="/catalog/juan/".concat(null===e||void 0===e?void 0:e.work,"/").concat(s[r]);n.push(Object(o.jsxs)(g.k,{button:!0,onClick:function(){var e=Object(p.a)(h.a.mark((function e(n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.preventDefault(),t.props.history.push({pathname:a});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsxs)(g.o,{className:"ion-text-wrap uiFont",children:["\u5377",s[r]]},"juanLabel"+r)]},"juanItem"+r))},a=0;a<((null===s||void 0===s?void 0:s.length)||-1);a++)r(a);return n}},{key:"render",value:function(){var t,e=this;return Object(o.jsxs)(g.s,{children:[Object(o.jsx)(g.g,{children:Object(o.jsxs)(g.J,{children:[Object(o.jsx)(g.c,{hidden:this.isTopPage,fill:"clear",slot:"start",onClick:function(t){return e.props.history.goBack()},children:Object(o.jsx)(g.h,{icon:tt.a,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"outline",shape:"round",size:"large",slot:"start",onClick:function(t){var n=e.props.workListType===s.BY_CHAPTER?s.BY_JUAN:s.BY_CHAPTER;e.props.dispatch({type:"TMP_SET_KEY_VAL",key:"workListType",val:n})},children:Object(o.jsx)("span",{className:"uiFont",style:{color:"var(--color)"},children:this.props.workListType===s.BY_CHAPTER?"\u5206\u54c1":"\u5206\u5377"})}),Object(o.jsx)(g.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(t){return e.fetchWork(e.props.match.params.path)},children:Object(o.jsx)(g.h,{icon:tt.C,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:this.hasBookmark?"solid":"clear",slot:"end",onClick:function(t){return e.hasBookmark?e.delBookmarkHandler():e.addBookmarkHandler()},children:Object(o.jsx)(g.h,{icon:tt.g,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"clear",slot:"end",onClick:function(t){return e.props.history.push("/".concat(e.props.match.params.tab))},children:Object(o.jsx)(g.h,{icon:tt.v,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"clear",slot:"end",onClick:function(t){return e.setState({showSearchAlert:!0})},children:Object(o.jsx)(g.h,{icon:tt.F,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"clear",slot:"end",onClick:function(t){e.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})},children:Object(o.jsx)(g.h,{icon:tt.J,slot:"icon-only"})})]})}),Object(o.jsxs)(g.d,{children:[Object(o.jsx)("div",{className:"uiFontX2",style:{color:"var(--ion-color-primary)"},children:null===(t=this.state.work)||void 0===t?void 0:t.title}),this.state.fetchError?X.fetchErrorContent:Object(o.jsx)(g.p,{children:this.props.workListType===s.BY_CHAPTER?this.getRowsByChapter():this.getRowsByJuan()}),Object(o.jsx)(nt,Object(d.a)({},Object(d.a)({showSearchAlert:this.state.showSearchAlert,finish:function(){e.setState({showSearchAlert:!1})}},this.props))),Object(o.jsx)(g.H,{cssClass:"uiFont",isOpen:this.state.showAddBookmarkDone,onDidDismiss:function(){return e.setState({showAddBookmarkDone:!1})},message:"\u66f8\u7c64\u65b0\u589e\u6210\u529f\uff01",duration:2e3}),Object(o.jsx)(g.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return e.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."})]})]})}},{key:"isTopPage",get:function(){return"/catalog"===this.props.match.url}},{key:"bookmark",get:function(){var t=this;return this.props.bookmarks.find((function(e){return e.type===q.WORK&&e.uuid===t.props.match.params.path}))}},{key:"hasBookmark",get:function(){return null!=this.bookmark}}]),n}(a.a.Component)),ct=Object(g.U)(it),lt=Object(k.b)((function(t){return{bookmarks:t.settings.bookmarks,workListType:void 0!==t.tmpSettings.workListType?t.tmpSettings.workListType:s.BY_JUAN}}))(ct),ut=n(17),ht=n(491),pt=(n(267),n(98)),dt=n(219);function bt(){return jt.apply(this,arguments)}function jt(){return(jt=Object(p.a)(h.a.mark((function t(){var e,n;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,X.getFileFromIndexedDB(X.twKaiFontKey);case 2:return e=t.sent,n=new window.FontFace("Kai",e),t.next=6,n.load();case 6:this.document.fonts.add(n);case 7:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}function ft(){var t=this;this.document.querySelectorAll(".pre .lb").forEach((function(e){var n=t.document.createElement("br");e.before(n)}))}function vt(){n(410)(this.window,this.document)}!function(t){t[t.UNINITIAL=0]="UNINITIAL",t[t.SPEAKING=1]="SPEAKING",t[t.PAUSE=2]="PAUSE"}($||($={}));var xt,gt=function(t){Object(f.a)(s,t);var e=Object(v.a)(s);function s(t){var n;return Object(b.a)(this,s),(n=e.call(this,t)).htmlFile=void 0,n.htmlTitle=void 0,n.book=void 0,n.rendition=void 0,n.epub=void 0,n.displayed=void 0,n.cfiRange=void 0,n.speechSynthesisUtterance=void 0,n.currentWork="",n.uuidStr="",n.epubcfiFromUrl="",n.lastPage=0,n.epubcfiFromSelectedString="",n.bookCreated=!1,n.ePubIframe=null,n.pageWidth=0,n.pagesWidth=0,n.searchTextRanges=[],n.visibleTextNodes=[],n.visibleChars=[],n.isPageSearched=[],n.allTexts="",n.ePubIframeOffset=0,n.showedSearchTextIndex=0,n.maxCharsPerUtterance=1e3,n.workTexts=[],n.workTextsIndex=0,n.state={isLoading:!1,fetchError:!1,workInfo:new I({}),htmlStr:null,currentPage:1,pageCount:1,showJumpPageAlert:!1,showNoSelectedTextAlert:!1,showSearchTextAlert:!1,searchText:"",showSearchTextToast:!1,showToast:!1,toastMessage:"",showSearchAlert:!1,popover:{show:!1,event:null},lookupDictPopover:{show:!1,data:[]},canTextToSpeech:"undefined"!==typeof SpeechSynthesisUtterance,speechState:$.UNINITIAL},n.htmlFile="",n.htmlTitle="",n.book=null,n.rendition=null,n.cfiRange="",n.speechSynthesisUtterance=null,n.state.canTextToSpeech&&(n.speechSynthesisUtterance=new SpeechSynthesisUtterance,n.speechSynthesisUtterance.onend=function(t){if(speechSynthesis.cancel(),n.state.speechState!==$.UNINITIAL){var e,s=n.workTextsIndex<n.workTexts.length-1,o=n.props.paginated&&n.state.currentPage<n.state.pageCount;if(s)n.workTextsIndex+=1;else{if(!o)return n.setState({speechState:$.UNINITIAL}),void console.log("Stop work text to speech.");n.pageNext(),n.findTextsInPageAndChunking()}e=n.workTexts[n.workTextsIndex],n.speechSynthesisUtterance.text=e,speechSynthesis.speak(n.speechSynthesisUtterance),console.log("Play work text to speech part / page: ".concat(s?n.workTextsIndex:n.state.currentPage))}}),document.addEventListener("keydown",n.keyListener.bind(Object(ut.a)(n)),!1),n}return Object(j.a)(s,[{key:"loadEpubCoverToMemFs",value:function(){var t=Object(p.a)(h.a.mark((function t(){var e,s,o;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==(e=new Uint8Array(JSON.parse(localStorage.getItem("logo.png")||"[]"))).length){t.next=8;break}return t.next=4,X.axiosInstance.get("".concat(window.location.origin,"/assets/icon/icon.png"),{responseType:"arraybuffer"});case 4:s=t.sent,e=new Uint8Array(s.data),o=JSON.stringify(Array.from(e)),localStorage.setItem("logo.png",o);case 8:n(48).writeFileSync("logo.png",e);case 10:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"ionViewWillEnter",value:function(){var t=w.a.parse(this.props.location.search);this.htmlFile=t.file,this.htmlTitle=t.title,this.epubcfiFromUrl=t.bookmark||"";var e=this.props.location.state;this.uuidStr=e?e.uuid:"",this.currentWork!==this.workJuanId&&(this.currentWork=this.workJuanId,this.lastPage=0),this.fetchData()}},{key:"ionViewDidEnter",value:function(){}},{key:"ionViewWillLeave",value:function(){var t;this.state.canTextToSpeech&&speechSynthesis.cancel(),this.lastPage=this.state.currentPage,this.setState({htmlStr:null,currentPage:1,speechState:$.UNINITIAL,showSearchTextToast:!1}),null===(t=this.book)||void 0===t||t.destroy(),this.book=null,this.bookCreated=!1}},{key:"fetchData",value:function(){var t=Object(p.a)(h.a.mark((function t(){var e;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.setState({isLoading:!0}),t.prev=1,t.next=4,X.fetchJuan(this.props.match.params.work,this.props.match.params.path,this.htmlFile);case 4:return e=t.sent,t.next=7,this.loadEpubCoverToMemFs();case 7:this.setState({fetchError:!1,workInfo:e.workInfo,htmlStr:e.htmlStr}),t.next=15;break;case 10:t.prev=10,t.t0=t.catch(1),console.error(t.t0),console.error((new Error).stack),this.setState({isLoading:!1,fetchError:!0});case 15:case"end":return t.stop()}}),t,this,[[1,10]])})));return function(){return t.apply(this,arguments)}}()},{key:"addBookmarkHandler",value:function(){var t=this.getSelectedString();if(""!==t){var e=ht.a();this.props.dispatch({type:"ADD_BOOKMARK",htmlStr:this.state.htmlStr,bookmark:new Q({type:this.htmlFile?q.HTML:q.JUAN,uuid:e,selectedText:t,epubcfi:this.epubcfiFromSelectedString,fileName:this.htmlFile||"".concat(this.props.match.params.work,"_juan").concat(this.props.match.params.path,".html"),work:Object.assign(this.state.workInfo,{title:this.htmlFile?this.htmlTitle:this.state.workInfo.title,juan:this.props.match.params.path})})}),this.setState({showToast:!0,toastMessage:"\u66f8\u7c64\u65b0\u589e\u6210\u529f\uff01"})}else this.setState({showNoSelectedTextAlert:!0})}},{key:"pagePrev",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.props.paginated&&this.state.currentPage>1&&(null===(t=this.rendition)||void 0===t||t.prev(e),this.setState({currentPage:this.state.currentPage-e}))}},{key:"pageNext",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.props.paginated&&this.state.currentPage<this.state.pageCount&&(null===(t=this.rendition)||void 0===t||t.next(e),this.setState({currentPage:this.state.currentPage+e}))}},{key:"jumpToPage",value:function(t){if(0!==t){t=isNaN(t)?1:Math.max(Math.min(this.state.pageCount,t),1);var e=this.state.currentPage,n=e<t?1:-1,s=Math.abs(t-e);1===n?this.pageNext(s):this.pagePrev(s)}}},{key:"keyListener",value:function(t){var e=t.keyCode||t.which;console.log(t.type),e===(this.props.rtlVerticalLayout?37:40)&&this.buttonNext(),e===(this.props.rtlVerticalLayout?39:38)&&this.buttonPrev(),("F3"===t.code||t.ctrlKey&&"f"===t.key.toLowerCase())&&(t.preventDefault(),this.setState({showSearchTextToast:!1,showSearchTextAlert:!0}))}},{key:"html2Epub",value:function(){var t=Object(p.a)(h.a.mark((function t(){var e,s,o=this;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.bookCreated=!0,this.epub=dt.document({id:"123-123456789",title:"Title",series:"",sequence:1,author:"Author",fileAs:"",genre:"genre",tags:"",copyright:"",publisher:"",published:"",language:"en",description:"A temp book.",contents:this.state.workInfo.title,source:"",images:["logo.png"]},"logo.png"),e=this.state.htmlStr,this.props.rtlVerticalLayout&&(e=e.replace(/margin-left/g,"margin-top")),s=e+"\n    <script>\n    <\/script>\n    ",this.epub.addSection("",s,!0,!1),"\n    html {\n      writing-mode: vertical-rl;\n      direction: ltr;\n    }\n    ",this.epub.addCSS("\n    @page {\n      size: A4;\n      margin: 0.5in;\n    }\n\n    /* For double side printing for book bundling. */\n    @page :left {\n      margin-right: 1in;\n    }\n\n    @page :right {\n      margin-left: 1in;\n    }\n\n    @media print {\n      body {\n        color: ".concat(getComputedStyle(document.body).getPropertyValue("--print-text-color")," !important;\n        background: ").concat(getComputedStyle(document.body).getPropertyValue("--print-background")," !important;\n        padding: 0 !important;\n        width: 100% !important;\n        height: 100% !important;\n        column-gap: unset !important;\n        column-width: unset !important;\n      }\n    }\n\n    html {\n      /*\n      Because different fonts have different line heights with 'line-height: normal,'\n      the content size of epubjs iframe changes after the fallback font is swapped with the web font.\n      Unfortunately, epubjs can't detect the size change and update the iframe.\n      This problem causes the total page count is incorrect.\n      Fortunately, we can set the line height based on the same font size as below.\n      */\n      line-height: 1.2;\n      -webkit-text-size-adjust: none;\n      text-size-adjust: none;\n    }\n\n    body {\n      color: ").concat(getComputedStyle(document.body).getPropertyValue("--ion-text-color"),";\n      background: ").concat(getComputedStyle(document.body).getPropertyValue("--ion-background-color"),";\n      /* Disable browser's swipe to forward / backward page navigation. */\n      overscroll-behavior-x: none;\n    }\n\n    @font-face {\n        font-family: 'Times';\n        src: local('Times New Roman');\n        unicode-range: U+0-007F;\n    }\n\n    /* Workaround parenthesis orientation problem of TW-Kai-98_1 on iOS Safari. */\n    @font-face {\n        font-family: 'Heiti';\n        src: local('Heiti TC');\n        unicode-range: U+3008-301B, U+FF01-FF60;\n    }\n\n    .lb {\n      display: none\n    }\n\n    /* In-HTML anchor jumps don't update this.state.currentPage.\n    Thus, we disable them. */\n    .noteAnchor {\n      pointer-events: none;\n      text-decoration: inherit;\n      color: inherit;\n      cursor: auto;\n    }\n\n    .doube-line-note, .doube-line-note .t {\n      font-size: ").concat(.8*this.props.fontSize,'px;\n    }\n\n    .doube-line-note::before {\n      content: "\uff08";\n    }\n\n    .doube-line-note::after {\n      content: "\uff09";\n    }\n\n    .bip-table {\n      display: table;\n    }\n\n    .bip-table-row {\n      display: table-row;\n    }\n\n    .bip-table-cell {\n      display: table-cell;\n      border: 1px solid ').concat(getComputedStyle(document.body).getPropertyValue("--ion-text-color"),";\n      text-align: center;\n    }\n  \n    ").concat(this.props.rtlVerticalLayout?"\n    html {\n      writing-mode: vertical-rl;\n      direction: ltr;\n    }\n    ":"","\n\n    .t, p, div {\n      font-family: ").concat(getComputedStyle(document.body).getPropertyValue("--ion-font-family"),";\n      font-size: ").concat(this.props.fontSize,"px;\n    }\n    \n    #back, #cbeta-copyright {\n      display: ").concat(this.props.showComments?"block":"none",";\n    }\n    ")),this.epub.writeEPUB((function(t){console.log("Error: ".concat(t))}),".","temp",Object(p.a)(h.a.mark((function t(){var e,s,r,a,i,c;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=n(48),r=s.readFileSync("temp.epub"),o.book=Object(pt.b)(r.buffer,{openAs:"binary"}),o.rendition=o.book.renderTo("cbetarEPubView",{width:"100%",height:"100%",spread:"none",flow:o.props.paginated?"paginated":"scrolled",scrollbarWidth:X.scrollbarSizeIdToValue(o.props.scrollbarSize),defaultDirection:o.props.rtlVerticalLayout?"rtl":"ltr"}),o.rendition.on("selected",(function(t,e){o.epubcfiFromSelectedString=t})),o.rendition.on(pt.a.RENDITION.DISPLAYED,(function(){o.updatePageInfos()})),o.rendition.on(pt.a.VIEWS.RENDERED,(function(){o.updateEPubIframe()})),t.next=9,o.rendition.display(o.props.paginated?o.epubcfi:void 0);case 9:if(o.props.paginated){t.next=15;break}return t.next=12,null===(a=o.rendition)||void 0===a?void 0:a.next();case 12:return t.next=14,null===(i=o.rendition)||void 0===i?void 0:i.next();case 14:o.updateEPubIframe();case 15:if(0!==o.lastPage&&null==o.bookmark&&o.lastPage!==o.state.currentPage&&o.jumpToPage(o.lastPage),o.setState({isLoading:!1}),o.hasBookmark)try{null===(c=o.rendition)||void 0===c||c.annotations.highlight(o.epubcfi)}catch(l){console.error(l)}null===(e=o.book)||void 0===e||e.locations.generate(150);case 19:case"end":return t.stop()}}),t)}))));case 9:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"updateEPubIframe",value:function(){var t=this,e=document.getElementsByTagName("iframe");if(1===e.length){var n;this.ePubIframe=e[0],null===(n=this.ePubIframe.contentDocument)||void 0===n||n.addEventListener("keydown",this.keyListener.bind(this),!1);var s=this.ePubIframe.contentWindow;Object(g.S)("android")?s.window.oncontextmenu=X.disableAndroidChromeCallout:Object(g.S)("ios")&&(s.document.ontouchend=X.disableIosSafariCallout.bind(s)),s.loadTwKaiFont=bt,s.loadTwKaiFont(),s.addCbetaLineBreaks=ft,s.addCbetaLineBreaks(),s.addSwpiedEvents=vt,s.addSwpiedEvents(),s.document.addEventListener("swiped",(function(e){if(t.props.paginated)if(t.props.rtlVerticalLayout)switch(e.detail.dir){case"left":t.pagePrev();break;case"right":t.pageNext()}else switch(e.detail.dir){case"down":t.pagePrev();break;case"up":t.pageNext()}})),this.findVisibleTexts()}else e.length>1?alert("Error! This component locates ePub iframe by the only iframe."):console.error("ePub iframes count is 0.")}},{key:"updatePageInfos",value:function(){var t,e=(null===(t=this.rendition)||void 0===t?void 0:t.currentLocation()).start.displayed;this.setState({currentPage:e.page,pageCount:e.total})}},{key:"getSelectedString",value:function(){var t,e,n="",s=null===(t=this.ePubIframe)||void 0===t||null===(e=t.contentDocument)||void 0===e?void 0:e.getSelection();return((null===s||void 0===s?void 0:s.rangeCount)||0)>0&&s.getRangeAt(0).toString().length>0&&(n=s.toString(),null===s||void 0===s||s.removeAllRanges()),n}},{key:"getRemainingWorkTextFromSelectedRange",value:function(){var t,e=this.ePubIframe.contentWindow.getSelection();if("Range"===e.type){var n=this.ePubIframe.contentDocument.getElementById("back"),s=e.getRangeAt(0);s.setEnd(n,0);var o=s.cloneContents();null===e||void 0===e||e.removeAllRanges();var r=new Document,a=r.createElement("html");r.appendChild(a),a.appendChild(o),X.removeElementsByClassName(r,"lb"),X.removeElementsByClassName(r,"doube-line-note"),t=r.getElementById("body").innerText}return t}},{key:"getAllTextNodes",value:function(t){return document.createTreeWalker(t,NodeFilter.SHOW_TEXT)}},{key:"visibleCharToRange",value:function(t){var e=this.visibleChars[t],n=new Range;return n.setStart(e.node,e.offset),n.setEnd(e.node,e.offset+1),n}},{key:"rectBinDirSize",value:function(t){return this.props.rtlVerticalLayout?t.y:t.x}},{key:"findBinBoundaryVisibleCharIndex",value:function(t,e,n){var s=e+Math.floor((n-e)/2);if(0===s)return 0;if(s===this.visibleChars.length-1)return this.visibleChars.length-1;var o=this.visibleCharToRange(s),r=this.visibleCharToRange(s+1),a=o.getBoundingClientRect(),i=r.getBoundingClientRect(),c=this.rectBinDirSize(a)-this.ePubIframeOffset,l=this.rectBinDirSize(i)-this.ePubIframeOffset;return c<t&&t<=l?s:c<t&&t>l?this.findBinBoundaryVisibleCharIndex(t,s+1,n):c>=t&&t<=l?this.findBinBoundaryVisibleCharIndex(t,e,s):(console.error("Unreasonable case!"),-1)}},{key:"findTextsInPage",value:function(t){var e=new Date,n=t-1;if(!this.isPageSearched[n]){var s=this.pageWidth*(t-1),o=this.pageWidth*t,r=0;1!==t&&(r=this.isPageSearched[n-1]?this.visibleChars.length-1-this.visibleChars.slice().reverse().findIndex((function(e){return e.page===t-1}))+1:this.findBinBoundaryVisibleCharIndex(s,0,this.visibleChars.length-1)+1);var a=this.visibleChars.length-1,i=this.visibleChars.length-1;t!==this.state.pageCount&&(i=this.isPageSearched[n+1]?this.visibleChars.findIndex((function(e){return e.page===t+1}))-1:this.findBinBoundaryVisibleCharIndex(o,r,a));for(var c=r;c<=i;c++)this.visibleChars[c].page=t;this.isPageSearched[n]=!0}var l=this.visibleChars.filter((function(e){return e.page===t})).map((function(t){return t.char})).join(""),u=(new Date).getTime()-e.getTime();return console.log("findTextsInPage spends: ".concat(u/1e3,"s")),l}},{key:"findVisibleTexts",value:function(){var t=this,e=this.ePubIframe.contentDocument.getElementById("body");if(e){var n,s=this.getAllTextNodes(e);this.visibleTextNodes=[],this.visibleChars=[],this.isPageSearched=[];for(var o=function(){var e=n;if(["t","pc","gaijiAnchor"].reduce((function(t,n){var s;return t&&n!==(null===(s=e.parentElement)||void 0===s?void 0:s.className)}),!0))return"continue";t.visibleTextNodes.push(n)};null!=(n=s.nextNode());)o();this.allTexts=this.visibleTextNodes.map((function(t){return t.textContent})).join("");for(var r=0,a=0;a<this.visibleTextNodes.length;a++)for(var i=this.visibleTextNodes[a],c=0;c<i.length;c++)this.visibleChars.push({node:i,offset:c,page:0,char:this.allTexts[r]}),r++;var l=document.querySelector(".epub-container");this.pageWidth=this.props.rtlVerticalLayout?l.clientHeight:l.clientWidth,this.pagesWidth=this.pageWidth*this.state.pageCount,this.isPageSearched=new Array(this.state.pageCount);for(var u=0;u<this.isPageSearched.length;u++)this.isPageSearched[u]=!1;var h=this.visibleCharToRange(0).getBoundingClientRect();this.ePubIframeOffset=this.props.rtlVerticalLayout?h.y:h.x}}},{key:"findSearchTextRanges",value:function(t){this.searchTextRanges=[],this.showedSearchTextIndex=0;var e=[],n=0,s=1;do{if(-1===(s=this.allTexts.indexOf(t,n)))break;n=s+t.length,e.push(s),e.push(s+t.length)}while(s<this.allTexts.length-1);if(0!==e.length){var o=[],r=0;s=e.shift();for(var a=0;a<this.visibleTextNodes.length;a++){for(var i=this.visibleTextNodes[a],c=0;c<i.length&&(r!==s||(o.push({node:i,offset:c}),-1!==(s=e.shift()||-1)));c++)r++;if(-1===s)break}for(var l=0;l<o.length/2;l+=1){var u=new Range,h=o[2*l],p=o[2*l+1];u.setStart(h.node,h.offset),u.setEnd(p.node,p.offset),this.searchTextRanges.push(u)}}}},{key:"searchTextPrev",value:function(){this.showedSearchTextIndex>0&&this.showedSearchTextIndex--,this.moveToSearchText(this.showedSearchTextIndex)}},{key:"searchTextNext",value:function(){this.showedSearchTextIndex<this.searchTextRanges.length-1&&this.showedSearchTextIndex++,this.moveToSearchText(this.showedSearchTextIndex)}},{key:"moveToSearchText",value:function(t){var e=this;this.epubcfiFromSelectedString="";var n=this.ePubIframe.contentWindow.getSelection();n.removeAllRanges(),setTimeout((function(){var s,o,r=e.searchTextRanges[t];(e.ePubIframe.contentWindow.focus(),n.addRange(r),e.props.paginated)?s=setInterval((function(){var t;""!==e.epubcfiFromSelectedString&&(clearInterval(s),null===(t=e.rendition)||void 0===t||t.display(e.epubcfiFromSelectedString).then((function(){})))}),100):null===(o=r.startContainer.parentElement)||void 0===o||o.scrollIntoView()}),100)}},{key:"buttonPrev",value:function(){this.state.showSearchTextToast?this.searchTextPrev():this.pagePrev()}},{key:"buttonNext",value:function(){this.state.showSearchTextToast?this.searchTextNext():this.pageNext()}},{key:"findCbetaHtmlLine",value:function(t){var e=t.parentElement;do{var n,s;if(null===(s=e)||void 0===s?void 0:s.getAttribute("l"))break}while(e=null===(n=e)||void 0===n?void 0:n.parentElement);return e}},{key:"findTextsInPageAndChunking",value:function(){var t,e,n,s=(this.props.paginated?this.findTextsInPage(this.state.currentPage):this.getRemainingWorkTextFromSelectedRange())||(null===(t=this.ePubIframe)||void 0===t||null===(e=t.contentDocument)||void 0===e||null===(n=e.getElementById("body"))||void 0===n?void 0:n.innerText)||"\u7121\u6cd5\u53d6\u5f97\u7d93\u6587\u5167\u5bb9";this.workTexts=[];for(var o=0;o<Math.ceil(s.length/this.maxCharsPerUtterance);o++)this.workTexts.push(s.substring(o*this.maxCharsPerUtterance,(o+1)*this.maxCharsPerUtterance));this.workTextsIndex=0}},{key:"render",value:function(){var t=this,e=Object(o.jsx)(g.g,{children:Object(o.jsxs)(g.J,{children:[Object(o.jsx)(g.G,{style:{fontSize:"var(--ui-font-size)"}}),Object(o.jsx)(g.c,{hidden:this.isTopPage,fill:"clear",slot:"start",onClick:function(e){return t.props.history.goBack()},children:Object(o.jsx)(g.h,{icon:tt.a,slot:"icon-only"})}),Object(o.jsx)(g.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(e){return t.fetchData()},children:Object(o.jsx)(g.h,{icon:tt.C,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"outline",shape:"round",hidden:!this.props.paginated,slot:"end",onClick:function(e){t.setState({showJumpPageAlert:!0})},children:Object(o.jsx)(g.o,{className:"uiFont",children:this.state.currentPage})}),Object(o.jsx)(g.c,{hidden:this.state.fetchError||!this.state.canTextToSpeech,fill:"clear",slot:"end",onClick:function(e){var n=X.zhVoices();switch(t.state.speechState){case $.UNINITIAL:var s=n.find((function(e){return e.voiceURI===t.props.voiceURI}))||n[0];void 0!==s&&(t.speechSynthesisUtterance.voice=s),t.findTextsInPageAndChunking(),t.speechSynthesisUtterance.text=t.workTexts[t.workTextsIndex],t.speechSynthesisUtterance.rate=t.props.speechRate,speechSynthesis.cancel(),speechSynthesis.speak(t.speechSynthesisUtterance),t.setState({speechState:$.SPEAKING,showToast:!0,toastMessage:"\u7d93\u6587\u5538\u8aa6\u975e\u771f\u4eba\u767c\u97f3\uff0c\u50c5\u4f5c\u53c3\u8003\uff01"});break;case $.SPEAKING:speechSynthesis.cancel(),t.setState({speechState:$.UNINITIAL});break;case $.PAUSE:speechSynthesis.resume(),t.setState({speechState:$.SPEAKING})}},children:Object(o.jsx)(g.h,{icon:this.state.speechState===$.SPEAKING?tt.K:tt.A,slot:"icon-only"})}),Object(o.jsx)(g.c,{hidden:this.state.fetchError,fill:"clear",slot:"end",onClick:function(e){t.setState({popover:{show:!1,event:null}}),t.addBookmarkHandler()},children:Object(o.jsx)(g.h,{icon:tt.g,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"clear",slot:"end",onClick:function(e){return t.setState({popover:{show:!0,event:e.nativeEvent}})},children:Object(o.jsx)(g.h,{ios:tt.s,md:tt.t,slot:"icon-only"})}),Object(o.jsx)(g.t,{isOpen:this.state.popover.show,event:this.state.popover.event,onDidDismiss:function(e){t.setState({popover:{show:!1,event:null}})},children:Object(o.jsxs)(g.p,{children:[Object(o.jsxs)(g.k,{button:!0,onClick:function(e){t.setState({popover:{show:!1,event:null}}),t.props.history.push("/catalog/work/".concat(t.props.match.params.work))},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.v,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u56de\u7d93\u76ee\u9304"})]}),Object(o.jsxs)(g.k,{button:!0,onClick:function(e){t.props.history.push("/".concat(t.props.match.params.tab)),t.setState({popover:{show:!1,event:null}})},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.v,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u56de\u9996\u9801"})]}),Object(o.jsxs)(g.k,{button:!0,onClick:function(e){t.setState({popover:{show:!1,event:null}});var n=t.getSelectedString();X.copyToClipboard(n),t.setState({showToast:!0,toastMessage:"\u8907\u88fd\u6587\u5b57\u6210\u529f\uff01"})},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.p,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u8907\u88fd\u6587\u5b57"})]}),Object(o.jsxs)(g.k,{button:!0,onClick:function(e){t.setState({popover:{show:!1,event:null}}),t.setState({showSearchTextToast:!1,showSearchTextAlert:!0})},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.F,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u641c\u5c0b\u6587\u5b57"})]}),Object(o.jsxs)(g.k,{button:!0,onClick:function(e){t.setState({popover:{show:!1,event:null}}),t.setState({showSearchAlert:!0})},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.F,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u641c\u5c0b\u7d93\u66f8"})]}),Object(o.jsxs)(g.k,{button:!0,onClick:function(e){t.setState({popover:{show:!1,event:null}});var n=t.getSelectedString();""!==n?t.props.history.push({pathname:"/dictionary/search/".concat(n)}):t.setState({showNoSelectedTextAlert:!0})},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.f,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u67e5\u8a5e\u5178"})]}),Object(o.jsxs)(g.k,{button:!0,onClick:function(e){t.setState({popover:{show:!1,event:null}});var n=t.getSelectedString();""!==n?t.props.history.push({pathname:"/dictionary/searchWord/".concat(n)}):t.setState({showNoSelectedTextAlert:!0})},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.f,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u67e5\u5b57\u5178"})]}),Object(o.jsxs)(g.k,{hidden:X.isMacCatalyst(),button:!0,onClick:function(e){var n,s;t.setState({popover:{show:!1,event:null}}),null===(n=t.ePubIframe)||void 0===n||null===(s=n.contentWindow)||void 0===s||s.print()},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.B,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u5217\u5370"})]}),Object(o.jsxs)(g.k,{button:!0,onClick:function(e){var n,s;t.setState({popover:{show:!1,event:null}});var o=null===(n=t.ePubIframe)||void 0===n||null===(s=n.contentDocument)||void 0===s?void 0:s.getSelection();if((o.rangeCount||0)>0&&o.getRangeAt(0).toString().length>0){var r,a,i=o.toString(),c=o.getRangeAt(0),l=null===(r=t.findCbetaHtmlLine(c.startContainer))||void 0===r?void 0:r.getAttribute("l"),u=null===(a=t.findCbetaHtmlLine(c.endContainer))||void 0===a?void 0:a.getAttribute("l");if(null===o||void 0===o||o.removeAllRanges(),null==l||null==u)return void t.setState({showToast:!0,toastMessage:"\u6240\u9078\u6587\u5b57\u7121\u6cd5\u5f15\u7528\uff01"});var h=/0*([1-9]*)([a-z])0*([1-9]*)/.exec(l),p="".concat(h[1]).concat(h[2]).concat(h[3]),d=/0*([1-9]*)([a-z])0*([1-9]*)/.exec(u)[3],b="".concat(p);l!==u&&(b+="-".concat(d));var j="\u300a".concat(t.state.workInfo.title,"\u300b\u5377").concat(t.props.match.params.path,"\uff1a\u300c").concat(i,"\u300d(CBETA, ").concat(t.state.workInfo.vol,", no. ").concat(/[^0-9]*(.*)/.exec(t.state.workInfo.work)[1],", p. ").concat(b,")");X.copyToClipboard(j),t.setState({showToast:!0,toastMessage:"\u5df2\u8907\u88fd\u5230\u526a\u8cbc\u7c3f\uff01"})}else t.setState({showNoSelectedTextAlert:!0})},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.J,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u5f15\u7528\u6587\u7ae0"})]}),Object(o.jsxs)(g.k,{button:!0,onClick:function(e){var n=window.location.href.split("?")[0];""!==t.getSelectedString()&&(n+="?bookmark=".concat(t.epubcfiFromSelectedString)),t.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(n)}})},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.J,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u5206\u4eab\u6b64\u9801"})]})]})}),Object(o.jsx)(g.u,{reversed:this.props.rtlVerticalLayout,value:this.state.currentPage/this.state.pageCount})]})}),n=.2,s=Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(g.e,{vertical:"center",horizontal:"start",slot:"fixed",children:Object(o.jsx)(g.f,{style:{opacity:n},onClick:function(e){return t.props.rtlVerticalLayout?t.buttonNext():t.buttonPrev()},onPointerDown:function(t){t.currentTarget.style.setProperty("opacity","1")},onPointerEnter:function(t){t.currentTarget.style.setProperty("opacity","1")},onPointerUp:function(t){X.isTouchDevice()&&t.currentTarget.style.setProperty("opacity","".concat(n))},onPointerLeave:function(t){t.currentTarget.style.setProperty("opacity","".concat(n))},children:Object(o.jsx)(g.h,{icon:this.props.rtlVerticalLayout?tt.a:tt.e})})}),Object(o.jsx)(g.e,{vertical:"center",horizontal:"end",slot:"fixed",children:Object(o.jsx)(g.f,{style:{opacity:n},onClick:function(e){return t.props.rtlVerticalLayout?t.buttonPrev():t.buttonNext()},onPointerDown:function(t){t.currentTarget.style.setProperty("opacity","1")},onPointerEnter:function(t){t.currentTarget.style.setProperty("opacity","1")},onPointerUp:function(t){X.isTouchDevice()&&t.currentTarget.style.setProperty("opacity","".concat(n))},onPointerLeave:function(t){t.currentTarget.style.setProperty("opacity","".concat(n))},children:Object(o.jsx)(g.h,{icon:this.props.rtlVerticalLayout?tt.d:tt.c})})})]});return this.bookCreated||null==this.state.htmlStr||this.html2Epub(),Object(o.jsxs)(g.s,{children:[e,Object(o.jsxs)(g.d,{children:[this.props.paginated||this.state.showSearchTextToast?s:Object(o.jsx)(o.Fragment,{}),Object(o.jsx)(g.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return t.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."}),this.state.fetchError?X.fetchErrorContent:Object(o.jsx)(o.Fragment,{}),Object(o.jsx)("div",{id:"cbetarEPubView",style:{width:"100%",height:"100%",userSelect:"text",WebkitUserSelect:"text"}}),Object(o.jsx)(g.a,{cssClass:"uiFont",isOpen:this.state.showJumpPageAlert,header:"\u8df3\u9801",subHeader:"\u8acb\u8f38\u5165\u9801\u78bc(1 - ".concat(this.state.pageCount,")"),inputs:[{name:"name0",type:"number",min:1,max:this.state.pageCount,value:this.state.currentPage}],buttons:[{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary uiFont",handler:function(){return t.setState({showJumpPageAlert:!1})}},{text:"\u78ba\u5b9a",cssClass:"primary uiFont",handler:function(e){t.setState({showJumpPageAlert:!1}),t.jumpToPage(e.name0)}}]}),Object(o.jsx)(nt,Object(d.a)({},Object(d.a)({showSearchAlert:this.state.showSearchAlert,finish:function(){t.setState({showSearchAlert:!1})}},this.props))),Object(o.jsx)(g.a,{cssClass:"uiFont",isOpen:this.state.showNoSelectedTextAlert,backdropDismiss:!1,header:"\u5931\u6557",message:"\u8acb\u78ba\u8a8d\u662f\u5426\u5df2\u9078\u64c7\u4e00\u6bb5\u6587\u5b57\uff0c\u7136\u5f8c\u518d\u57f7\u884c\u6240\u9078\u7684\u529f\u80fd!",buttons:[{text:"\u78ba\u5b9a",cssClass:"primary uiFont",handler:function(e){t.setState({showNoSelectedTextAlert:!1})}}]}),Object(o.jsx)(g.a,{cssClass:"uiFont",isOpen:this.state.showSearchTextAlert,header:"\u641c\u5c0b\u6587\u5b57",subHeader:"\u6309\u4e0b\u641c\u5c0b\u5f8c\uff0c\u5de6\u53f3\u65b9\u5411\u9215\u8b8a\u70ba\u641c\u5c0b\u6587\u5b57\u65b9\u5411\u9215\u3002\u6309\u4e0b\u65b9\u901a\u77e5UI\u95dc\u9589\u9215\uff0c\u96e2\u958b\u641c\u5c0b\u6587\u5b57\u6a21\u5f0f\u3002",inputs:[{name:"name0",type:"search",placeholder:"\u4f8b:\u5982\u662f\u6211\u805e"}],buttons:[{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary uiFont",handler:function(){return t.setState({showSearchTextAlert:!1})}},{text:"\u641c\u5c0b",cssClass:"primary uiFont",handler:function(e){""!==e.name0?(t.findSearchTextRanges(e.name0),0===t.searchTextRanges.length?t.setState({showSearchTextAlert:!1,showToast:!0,toastMessage:"\u627e\u4e0d\u5230\u6587\u5b57\uff1a".concat(e.name0)}):(t.setState({showSearchTextAlert:!1,showSearchTextToast:!0,searchText:e.name0}),t.searchTextPrev())):t.setState({showSearchTextAlert:!1})}}]}),Object(o.jsx)(g.H,{cssClass:"uiFont",isOpen:this.state.showSearchTextToast,onDidDismiss:function(){return t.setState({showSearchTextToast:!1})},message:"\u641c\u5c0b\uff1a".concat(this.state.searchText),buttons:[{text:"\u95dc\u9589",role:"cancel",handler:function(){return t.setState({showSearchTextToast:!1})}}]}),Object(o.jsx)(g.H,{cssClass:"uiFont",isOpen:this.state.showToast,onDidDismiss:function(){return t.setState({showToast:!1})},message:this.state.toastMessage,duration:2e3})]})]})}},{key:"workJuanId",get:function(){return"".concat(this.props.match.params.work,"/").concat(this.props.match.params.path)}},{key:"fileName",get:function(){return X.getFileName(this.props.match.params.work,this.props.match.params.path)}},{key:"isTopPage",get:function(){return"/catalog"===this.props.match.url}},{key:"bookmark",get:function(){var t=this;return this.props.bookmarks.find((function(e){return e.type===q.JUAN&&e.uuid===t.uuidStr}))}},{key:"hasBookmark",get:function(){return""!==this.epubcfiFromUrl||null!=this.bookmark}},{key:"epubcfi",get:function(){return""!==this.epubcfiFromUrl?this.epubcfiFromUrl:null!=this.bookmark?this.bookmark.epubcfi:"epubcfi(/6/6[s1]!/4/4/2/6[body]/6,/1:0,/1:1)"}}]),s}(a.a.Component),mt=Object(g.U)(gt),kt=Object(k.b)((function(t){return{bookmarks:t.settings.bookmarks,fontSize:t.settings.fontSize,showComments:t.settings.showComments,paginated:t.settings.paginated,rtlVerticalLayout:t.settings.rtlVerticalLayout,settings:t.settings,scrollbarSize:t.settings.scrollbarSize,voiceURI:t.settings.voiceURI,speechRate:t.settings.speechRate}}))(mt),yt=(n(411),n(412),n(413),n(414),n(415),n(416),n(417),n(418),n(419),n(420),n(421),n(422),n(129)),wt=window.electronBackendApi,Ot=function(t){Object(f.a)(n,t);var e=Object(v.a)(n);function n(t){var s;return Object(b.a)(this,n),(s=e.call(this,t)).state={showFontLicense:!1,juansDownloadedRatio:0,showUpdateAllJuansDone:!1,showClearAlert:!1,showToast:!1,toastMessage:"",mainVersion:null},null===wt||void 0===wt||wt.receive("fromMain",(function(t){switch(t.event){case"version":s.setState({mainVersion:t.version})}})),s}return Object(j.a)(n,[{key:"ionViewWillEnter",value:function(){null===wt||void 0===wt||wt.send("toMain",{event:"ready"})}},{key:"updateBookmark",value:function(t,e){var n=t.findIndex((function(t){return t.uuid===e.uuid}));-1===n?console.error("Update bookmark fails! Can't find the original bookmark with UUID: ".concat(e.uuid)):t[n]=e}},{key:"updateAllJuans",value:function(){var t=Object(p.a)(h.a.mark((function t(){var e,n,s,o,r,a,i,c,l,u,p,d,b,j,f,v,x,g,m,k,y;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(this.setState({juansDownloadedRatio:0}),e=this.props.bookmarks.filter((function(t){return t.type===q.WORK})),n=this.props.bookmarks.filter((function(t){return t.type===q.JUAN})),s=n.filter((function(t){return-1===e.findIndex((function(e){var n,s;return(null===(n=e.work)||void 0===n?void 0:n.work)===(null===(s=t.work)||void 0===s?void 0:s.work)}))})),o=s.length,r=0;r<e.length;r++)a=e[r].work,o+=a.juan_list.split(",").length;i=0,c=0;case 8:if(!(c<e.length)){t.next=30;break}l=e[c],u=l.work,p=u.juan_list.split(","),d=0;case 13:if(!(d<p.length)){t.next=27;break}return b=p[d],i+=1,this.setState({juansDownloadedRatio:i/o}),t.next=19,X.fetchJuan(u.work,b,null,!0);case 19:j=t.sent,f=X.getFileName(u.work,b),X.saveFileToIndexedDB(f,j.htmlStr),0===d&&this.updateBookmark(this.props.bookmarks,Object.assign(l,{work:j.workInfo})),console.log("File saved: ".concat(f));case 24:d++,t.next=13;break;case 27:c++,t.next=8;break;case 30:v=0;case 31:if(!(v<s.length)){t.next=48;break}return i+=1,this.setState({juansDownloadedRatio:i/o}),x=s[v],g=x.work,t.next=38,X.fetchJuan(g.work,"".concat(g.juan),null,!0);case 38:m=t.sent,k=X.getFileName(g.work,"".concat(g.juan)),(y=m.workInfo).juan=g.juan,X.saveFileToIndexedDB(k,m.htmlStr),this.updateBookmark(this.props.bookmarks,Object.assign(x,{work:y})),console.log("File saved: ".concat(k));case 45:v++,t.next=31;break;case 48:this.props.dispatch({type:"UPDATE_BOOKMARKS",bookmarks:this.props.bookmarks}),this.setState({showUpdateAllJuansDone:!0});case 50:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t=this;return Object(o.jsxs)(g.s,{children:[Object(o.jsx)(g.g,{children:Object(o.jsx)(g.J,{children:Object(o.jsx)(g.G,{className:"uiFont",children:"\u8a2d\u5b9a"})})}),Object(o.jsxs)(g.d,{children:[Object(o.jsxs)(g.p,{children:[Object(o.jsxs)(g.k,{children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.J,slot:"start"}),Object(o.jsxs)(g.o,{className:"ion-text-wrap uiFont",onClick:function(){var e=Object(p.a)(h.a.mark((function e(n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.updateApp();case 2:e.sent||t.setState({showToast:!0,toastMessage:"App\u5df2\u662f\u6700\u65b0\u7248"});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:["PWA\u7248\u672c: ",Object(o.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2#history",target:"_new",children:yt.pwaVersion})]}),Object(o.jsx)(g.c,{fill:"outline",shape:"round",slot:"end",size:"large",style:{fontSize:"var(--ui-font-size)"},onClick:function(e){t.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:window.location.origin}})},children:"\u5206\u4eab"})]}),Object(o.jsxs)(g.k,{hidden:!this.state.mainVersion,children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.w,slot:"start"}),Object(o.jsxs)(g.o,{className:"ion-text-wrap uiFont",children:["Electron app\u7248\u672c: ",this.state.mainVersion]})]}),Object(o.jsxs)(g.k,{children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.h,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:Object(o.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2#report",target:"_new",children:"\u555f\u7528app\u7570\u5e38\u8a18\u9304"})}),Object(o.jsx)(g.I,{slot:"end",checked:this.props.hasAppLog,onIonChange:function(e){var n=e.detail.checked;t.props.hasAppLog!==n&&(n?X.enableAppLog():X.disableAppLog(),t.props.dispatch({type:"SET_KEY_VAL",key:"hasAppLog",val:n}))}})]}),Object(o.jsxs)(g.k,{hidden:!this.props.hasAppLog,children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.h,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u56de\u5831app\u7570\u5e38\u8a18\u9304"}),Object(o.jsx)(g.c,{fill:"outline",shape:"round",slot:"end",size:"large",style:{fontSize:"var(--ui-font-size)"},onClick:function(e){window.open("mailto:myh@live.com?subject=\u96fb\u5b50\u4f5b\u5178\u7570\u5e38\u8a18\u9304\u56de\u5831&body=".concat(encodeURIComponent("\u554f\u984c\u63cf\u8ff0(\u5efa\u8b70\u586b\u5beb)\uff1a\n\n\u700f\u89bd\u5668\uff1a"+navigator.userAgent+"\n\nApp\u7248\u672c\uff1a"+yt.pwaVersion+"\n\nApp\u8a2d\u5b9a\uff1a"+JSON.stringify(t.props.settings)+"\n\nLog\uff1a\n"+X.getLog())))},children:"\u56de\u5831"})]}),Object(o.jsxs)(g.k,{children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.r,slot:"start"}),Object(o.jsx)("div",{className:"contentBlock",children:Object(o.jsxs)("div",{style:{flexDirection:"column"},children:[Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"App\u8a2d\u5b9a\u8207\u66f8\u7c64"}),Object(o.jsxs)("div",{style:{textAlign:"right"},children:[Object(o.jsx)(g.c,{fill:"outline",shape:"round",size:"large",style:{fontSize:"var(--ui-font-size)"},onClick:function(){var t=Object(p.a)(h.a.mark((function t(e){var n,s;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n="data:text/json;charset=utf-8,".concat(encodeURIComponent(localStorage.getItem("Settings.json")||"")),(s=document.createElement("a")).href=n,s.download="Settings.json",s.click(),s.remove();case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),children:"\u532f\u51fa"}),Object(o.jsx)("input",{id:"importJsonInput",type:"file",accept:".json",style:{display:"none"},onChange:function(){var e=Object(p.a)(h.a.mark((function e(n){var s,o,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=null===(s=n.target.files)||void 0===s?void 0:s.item(0),e.next=3,null===o||void 0===o?void 0:o.text();case 3:if(e.t0=e.sent,e.t0){e.next=6;break}e.t0="";case 6:r=e.t0;try{JSON.parse(r),localStorage.setItem("Settings.json",r),t.props.dispatch({type:"LOAD_SETTINGS"}),t.updateAllJuans()}catch(a){console.error(a),console.error((new Error).stack)}document.getElementById("importJsonInput").value="";case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),Object(o.jsx)(g.c,{fill:"outline",shape:"round",size:"large",style:{fontSize:"var(--ui-font-size)"},onClick:function(t){document.querySelector("#importJsonInput").click()},children:"\u532f\u5165"}),Object(o.jsx)(g.c,{fill:"outline",shape:"round",size:"large",style:{fontSize:"var(--ui-font-size)"},onClick:function(e){t.setState({showClearAlert:!0})},children:"\u91cd\u7f6e"}),Object(o.jsx)(g.a,{cssClass:"uiFont",isOpen:this.state.showClearAlert,backdropDismiss:!1,onDidPresent:function(t){},header:"\u91cd\u7f6e\u6703\u9084\u539fapp\u8a2d\u5b9a\u9810\u8a2d\u503c\u4e26\u6e05\u9664\u66f8\u7c64\u3001\u5b57\u578b\u6a94\uff01\u78ba\u5b9a\u91cd\u7f6e\uff1f",buttons:[{text:"\u53d6\u6d88",cssClass:"primary uiFont",handler:function(e){t.setState({showClearAlert:!1})}},{text:"\u91cd\u7f6e",cssClass:"secondary uiFont",handler:function(){var e=Object(p.a)(h.a.mark((function e(n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.clearAppData();case 2:for(t.props.dispatch({type:"DEFAULT_SETTINGS"});document.body.classList.length>0;)document.body.classList.remove(document.body.classList.item(0));document.body.classList.toggle("theme".concat(t.props.theme),!0),document.body.classList.toggle("print".concat(t.props.printStyle),!0),t.setState({showClearAlert:!1,showToast:!0,toastMessage:"\u6e05\u9664\u6210\u529f!"});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]})]})]})})]}),Object(o.jsxs)(g.k,{children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.C,slot:"start"}),Object(o.jsxs)("div",{style:{width:"100%"},children:[Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u66f4\u65b0\u96e2\u7dda\u7d93\u6587\u6a94"}),Object(o.jsx)(g.u,{value:this.state.juansDownloadedRatio})]}),Object(o.jsx)(g.c,{fill:"outline",shape:"round",slot:"end",size:"large",style:{fontSize:"var(--ui-font-size)"},onClick:function(){var e=Object(p.a)(h.a.mark((function e(n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.updateAllJuans());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:"\u66f4\u65b0"}),Object(o.jsx)(g.H,{cssClass:"uiFont",isOpen:this.state.showUpdateAllJuansDone,onDidDismiss:function(){return t.setState({showUpdateAllJuansDone:!1})},message:"\u96e2\u7dda\u7d93\u6587\u6a94\u66f4\u65b0\u5b8c\u7562\uff01",duration:2e3})]}),Object(o.jsxs)(g.k,{children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.o,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:X.appSettings.theme}),Object(o.jsxs)(g.B,{slot:"end",value:this.props.theme,style:{fontSize:"var(--ui-font-size)"},interface:"popover",interfaceOptions:{cssClass:"cbetar2themes"},onIonChange:function(e){var n=e.detail.value;t.props.theme!==n&&t.props.dispatch({type:"SET_KEY_VAL",key:"theme",val:n})},children:[Object(o.jsx)(g.C,{className:"uiFont cbeta",value:0,children:"CBETA"}),Object(o.jsx)(g.C,{className:"uiFont dark",value:1,children:"\u6697\u8272"}),Object(o.jsx)(g.C,{className:"uiFont light",value:2,children:"\u4eae\u8272"}),Object(o.jsx)(g.C,{className:"uiFont oldPaper",value:3,children:"\u820a\u66f8"}),Object(o.jsx)(g.C,{className:"uiFont marble",value:4,children:"\u5927\u7406\u77f3"})]})]}),Object(o.jsxs)(g.k,{children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.q,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:X.appSettings.rtlVerticalLayout}),Object(o.jsx)(g.I,{slot:"end",checked:this.props.rtlVerticalLayout,onIonChange:function(e){var n=e.detail.checked;t.props.rtlVerticalLayout!==n&&t.props.dispatch({type:"SET_KEY_VAL",key:"rtlVerticalLayout",val:n})}})]}),Object(o.jsxs)(g.k,{children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.q,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:X.appSettings.paginated}),Object(o.jsx)(g.I,{slot:"end",checked:this.props.paginated,onIonChange:function(e){var n=e.detail.checked;t.props.paginated!==n&&t.props.dispatch({type:"SET_KEY_VAL",key:"paginated",val:n})}})]}),Object(o.jsxs)(g.k,{children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.q,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u55ae\u9801\u7d93\u6587\u6372\u8ef8\u5927\u5c0f"}),Object(o.jsxs)(g.B,{slot:"end",value:this.props.scrollbarSize,style:{fontSize:"var(--ui-font-size)"},interface:"popover",interfaceOptions:{cssClass:"uiFont"},onIonChange:function(e){var n=e.detail.value;t.props.scrollbarSize!==n&&(t.props.dispatch({type:"SET_KEY_VAL",key:"scrollbarSize",val:n}),X.updateCssVars(t.props.settings))},children:[Object(o.jsx)(g.C,{className:"uiFont",value:0,children:"\u7121"}),Object(o.jsx)(g.C,{className:"uiFont",value:1,children:"\u4e2d"}),Object(o.jsx)(g.C,{className:"uiFont",value:2,children:"\u5927"})]})]}),Object(o.jsxs)(g.k,{children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.q,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:X.appSettings.showComments}),Object(o.jsx)(g.I,{slot:"end",checked:this.props.showComments,onIonChange:function(e){var n=e.detail.checked;t.props.showComments!==n&&t.props.dispatch({type:"SET_KEY_VAL",key:"showComments",val:n})}})]}),Object(o.jsxs)(g.k,{children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.M,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:X.appSettings.useFontKai}),Object(o.jsx)(g.I,{slot:"end",checked:this.props.useFontKai,onIonChange:function(e){var n=e.detail.checked;t.props.useFontKai!==n&&(t.props.dispatch({type:"SET_KEY_VAL",key:"useFontKai",val:n}),X.updateCssVars(t.props.settings))}})]}),Object(o.jsxs)(g.k,{children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.M,slot:"start"}),Object(o.jsx)("div",{className:"contentBlock",children:Object(o.jsxs)("div",{style:{flexDirection:"column"},children:[Object(o.jsxs)(g.o,{className:"ion-text-wrap uiFont",children:[X.appSettings.uiFontSize,": ",this.props.uiFontSize]}),Object(o.jsx)(g.v,{min:10,max:128,pin:!0,snaps:!0,value:this.props.uiFontSize,onIonChange:function(e){t.props.dispatch({type:"SET_KEY_VAL",key:"uiFontSize",val:e.detail.value}),X.updateCssVars(t.props.settings)}})]})})]}),Object(o.jsxs)(g.k,{children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.M,slot:"start"}),Object(o.jsxs)("div",{className:"contentBlock",children:[Object(o.jsxs)(g.o,{className:"ion-text-wrap uiFont",children:[X.appSettings.fontSize,": ",Object(o.jsx)("span",{className:"textFont",children:this.props.settings.fontSize})]}),Object(o.jsx)(g.v,{min:10,max:128,pin:!0,snaps:!0,value:this.props.settings.fontSize,onIonChange:function(e){t.props.dispatch({type:"SET_KEY_VAL",key:"fontSize",val:e.detail.value}),X.updateCssVars(t.props.settings)}})]})]}),Object(o.jsxs)(g.k,{children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.B,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:X.appSettings.printStyle}),Object(o.jsxs)(g.B,{slot:"end",value:this.props.printStyle,style:{fontSize:"var(--ui-font-size)"},interface:"popover",interfaceOptions:{cssClass:"cbetar2themes"},onIonChange:function(e){var n=e.detail.value;t.props.printStyle!==n&&t.props.dispatch({type:"SET_KEY_VAL",key:"printStyle",val:n})},children:[Object(o.jsx)(g.C,{className:"uiFont blackWhite printVar",value:0,children:"\u767d\u5e95\u9ed1\u5b57"}),Object(o.jsx)(g.C,{className:"uiFont manuscript printVar",value:1,children:"\u6284\u7d93\u672c"})]})]}),Object(o.jsxs)(g.k,{children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.B,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u5408\u6210\u8a9e\u97f3"}),Object(o.jsx)(g.B,{slot:"end",value:this.props.voiceURI,style:{fontSize:"var(--ui-font-size)"},interface:"action-sheet",cancelText:"\u53d6\u6d88",onIonChange:function(e){var n=e.detail.value;t.props.voiceURI!==n&&t.props.dispatch({type:"SET_KEY_VAL",key:"voiceURI",val:n})},children:X.zhVoices().map((function(t,e){return Object(o.jsx)(g.C,{className:"uiFont blackWhite printVar",value:t.voiceURI,children:t.name},e)}))})]}),Object(o.jsxs)(g.k,{children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.A,slot:"start"}),Object(o.jsx)("div",{className:"contentBlock",children:Object(o.jsxs)("div",{style:{flexDirection:"column"},children:[Object(o.jsxs)(g.o,{className:"ion-text-wrap uiFont",children:[Object(o.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2#text2speech",target:"_new",children:"\u5408\u6210\u8a9e\u97f3\u8a9e\u901f"}),": ",this.props.speechRate]}),Object(o.jsx)(g.v,{min:.1,max:1.5,step:.1,snaps:!0,value:this.props.speechRate,onIonChange:function(e){t.props.dispatch({type:"SET_KEY_VAL",key:"speechRate",val:e.detail.value.toFixed(1)})}})]})})]}),Object(o.jsxs)(g.k,{children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.u,slot:"start"}),Object(o.jsxs)("div",{style:{fontSize:"var(--ui-font-size)"},children:[Object(o.jsx)("div",{children:"\u95dc\u65bc"}),Object(o.jsx)("div",{children:Object(o.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2#web-app",target:"_new",children:"\u7a0b\u5f0f\u5b89\u88dd\u8aaa\u660e"})}),Object(o.jsx)("div",{children:Object(o.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2",target:"_new",children:"\u64cd\u4f5c\u8aaa\u660e\u8207\u958b\u653e\u539f\u59cb\u78bc"})}),Object(o.jsxs)("div",{children:["CBETA API\u7248\u672c: ",X.apiVersion]}),Object(o.jsx)("div",{children:Object(o.jsx)("a",{href:"http://cbdata.dila.edu.tw/v1.2/",target:"_new",children:"CBETA API\u53c3\u8003\u6587\u4ef6"})}),Object(o.jsx)("div",{children:Object(o.jsx)("a",{href:"http://glossaries.dila.edu.tw/?locale=zh-TW",target:"_new",children:"DILA \u4f5b\u5b78\u8853\u8a9e\u5b57\u8fad\u5178"})}),Object(o.jsx)("div",{children:"\u4f5c\u8005: Meng-Yuan Huang"}),Object(o.jsx)("div",{children:Object(o.jsx)("a",{href:"mailto:myh@live.com",target:"_new",children:"myh@live.com"})}),Object(o.jsx)("div",{children:Object(o.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2#contributors",target:"_new",children:"App\u76f8\u95dc\u8ca2\u737b\u8005"})}),Object(o.jsx)("div",{children:Object(o.jsx)("a",{href:"/",onClick:function(e){e.preventDefault(),t.setState({showFontLicense:!0})},children:"\u5168\u5b57\u5eab\u5b57\u578b\u7248\u6b0a\u8072\u660e"})})]})]}),Object(o.jsx)(g.a,{cssClass:"uiFont",isOpen:this.state.showFontLicense,backdropDismiss:!1,message:"\u6b64app\u4f7f\u7528\u7684\u5168\u5b57\u5eab\u5b57\u578b(2020-08-18\u7248)\u7531\u570b\u5bb6\u767c\u5c55\u59d4\u54e1\u6703\u63d0\u4f9b\u3002\u6b64\u958b\u653e\u8cc7\u6599\u4f9d\u653f\u5e9c\u8cc7\u6599\u958b\u653e\u6388\u6b0a\u689d\u6b3e (Open Government Data License) \u9032\u884c\u516c\u773e\u91cb\u51fa\uff0c\u4f7f\u7528\u8005\u65bc\u9075\u5b88\u672c\u689d\u6b3e\u5404\u9805\u898f\u5b9a\u4e4b\u524d\u63d0\u4e0b\uff0c\u5f97\u5229\u7528\u4e4b\u3002\u653f\u5e9c\u8cc7\u6599\u958b\u653e\u6388\u6b0a\u689d\u6b3e\uff1ahttps://data.gov.tw/license",buttons:[{text:"\u95dc\u9589",cssClass:"primary uiFont",handler:function(e){t.setState({showFontLicense:!1})}},{text:"\u958b\u555f\u6388\u6b0a",cssClass:"secondary uiFont",handler:function(e){t.setState({showFontLicense:!1}),window.open("https://data.gov.tw/license")}}]})]}),Object(o.jsx)(g.H,{cssClass:"uiFont",isOpen:this.state.showToast,onDidDismiss:function(){return t.setState({showToast:!1})},message:this.state.toastMessage,duration:2e3})]})]})}}]),n}(a.a.Component),St=Object(g.U)(Ot),Tt=Object(k.b)((function(t){return{settings:t.settings,hasAppLog:t.settings.hasAppLog,theme:t.settings.theme,showComments:t.settings.showComments,paginated:t.settings.paginated,rtlVerticalLayout:t.settings.rtlVerticalLayout,scrollbarSize:t.settings.scrollbarSize,useFontKai:t.settings.useFontKai,uiFontSize:t.settings.uiFontSize,printStyle:t.settings.printStyle,speechRate:t.settings.speechRate,bookmarks:t.settings.bookmarks,voiceURI:t.settings.voiceURI}}))(St),Ct=Object(o.jsxs)(o.Fragment,{children:[Object(o.jsxs)("div",{style:{fontSize:"var(--ui-font-size)",textAlign:"center"},children:["\u53ef\u96e2\u7dda\u700f\u89bd\u5716\u793a ",Object(o.jsx)(g.h,{icon:tt.r})]}),Object(o.jsx)("div",{style:{fontSize:"var(--ui-font-size)",textAlign:"center"},children:Object(o.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2#web-app",target:"_new",children:"\u7a0b\u5f0f\u5b89\u88dd\u8aaa\u660e"})}),Object(o.jsx)("div",{style:{fontSize:"var(--ui-font-size)",textAlign:"center"},children:Object(o.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2#shortcuts",target:"_new",children:"\u7a0b\u5f0f\u6377\u5f91"})})]}),At=function(t){Object(f.a)(n,t);var e=Object(v.a)(n);function n(t){var s;return Object(b.a)(this,n),(s=e.call(this,t)).bookmarkListRef=void 0,s.state={reorder:!1,showToast:!1,toastMessage:""},s.bookmarkListRef=a.a.createRef(),s}return Object(j.a)(n,[{key:"ionViewWillEnter",value:function(){var t=w.a.parse(this.props.location.search);if(t.item&&t.item<this.props.bookmarks.length){var e,n,s=this.props.bookmarks[t.item];this.props.history.push("/catalog/juan/".concat(null===(e=s.work)||void 0===e?void 0:e.work,"/").concat(null===(n=s.work)||void 0===n?void 0:n.juan))}else this.hasBookmark||(this.setState({showToast:!0,toastMessage:"\u7121\u66f8\u7c64\uff01\u8acb\u5f9e\u76ee\u9304\u9801\u65b0\u589e\u66f8\u7c64\u3002"}),this.props.history.push("/catalog/famous"))}},{key:"delBookmarkHandler",value:function(t){this.props.dispatch({type:"DEL_BOOKMARK",uuid:t}),this.hasBookmark||this.props.history.push("/catalog/famous")}},{key:"reorderBookmarks",value:function(t){var e=t.detail.complete(this.props.bookmarks);this.props.dispatch({type:"UPDATE_BOOKMARKS",bookmarks:e})}},{key:"getBookmarkRows",value:function(){var t=this,e=this.props.bookmarks,n=Array();return e.forEach((function(e,s){var r,a,i,c,l,u,d="",b="".concat(e.selectedText),j=!1;switch(e.type){case q.CATALOG:d="/catalog/catalog/".concat(e.uuid);break;case q.WORK:d="/catalog/work/".concat(e.uuid);break;case q.JUAN:d="/catalog/juan/".concat(null===(r=e.work)||void 0===r?void 0:r.work,"/").concat(null===(a=e.work)||void 0===a?void 0:a.juan),b="".concat(null===(i=e.work)||void 0===i?void 0:i.title,"\u7b2c").concat(null===(c=e.work)||void 0===c?void 0:c.juan,"\u5377 - ").concat(b);break;case q.HTML:j=!0,d="/catalog/juan/".concat(null===(l=e.work)||void 0===l?void 0:l.work,"/1"),b="".concat(null===(u=e.work)||void 0===u?void 0:u.title," - ").concat(b)}n.push(Object(o.jsxs)(g.n,{children:[Object(o.jsxs)(g.k,{button:!0,onClick:function(){var n=Object(p.a)(h.a.mark((function n(s){var o;return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.state.reorder){n.next=3;break}return t.setState({showToast:!0,toastMessage:"\u8acb\u5148\u95dc\u9589\u6392\u5217\u529f\u80fd\uff0c\u624d\u53ef\u9ede\u64ca\u66f8\u7c64\uff01"}),n.abrupt("return");case 3:s.preventDefault(),t.props.history.push({pathname:d,state:{uuid:e.uuid},search:w.a.stringify(j?{file:e.fileName,title:null===(o=e.work)||void 0===o?void 0:o.title}:{})});case 5:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}(),children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:b},"bookmarkItemLabel_"+s),e.type===q.CATALOG?"":Object(o.jsx)(g.h,{icon:tt.r,slot:"end"}),Object(o.jsx)(g.w,{slot:"end"})]},"bookmarkItem_"+s),Object(o.jsx)(g.m,{side:"end",children:Object(o.jsx)(g.l,{style:{fontSize:"var(--ui-font-size)"},color:"danger",onClick:function(n){var s;t.delBookmarkHandler(e.uuid),null===(s=t.bookmarkListRef.current)||void 0===s||s.closeSlidingItems()},children:"\u522a\u9664"})})]},"bookmarkItemSliding_"+s))})),n}},{key:"render",value:function(){var t=this,e=this.getBookmarkRows();return Object(o.jsxs)(g.s,{children:[Object(o.jsx)(g.g,{children:Object(o.jsxs)(g.J,{children:[Object(o.jsx)(g.G,{style:{fontSize:"var(--ui-font-size)"},children:"\u66f8\u7c64"}),Object(o.jsx)(g.c,{fill:this.state.reorder?"solid":"clear",slot:"end",onClick:function(e){return t.setState({reorder:!t.state.reorder})},children:Object(o.jsx)(g.h,{icon:tt.L,slot:"icon-only"})})]})}),Object(o.jsxs)(g.d,{children:[this.hasBookmark?Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(g.p,{ref:this.bookmarkListRef,children:Object(o.jsx)(g.x,{disabled:!this.state.reorder,onIonItemReorder:function(e){t.reorderBookmarks(e)},children:e})},"bookmarkList0"),Ct]}):Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(g.p,{children:e},"bookmarkList1"),Ct]}),Object(o.jsx)(g.H,{cssClass:"uiFont",isOpen:this.state.showToast,onDidDismiss:function(){return t.setState({showToast:!1})},message:this.state.toastMessage,duration:2e3})]})]},"bookmarksPage".concat(this.isFamousPage))}},{key:"hasBookmark",get:function(){return this.props.bookmarks.length>0}},{key:"isFamousPage",get:function(){return"/catalog/famous"===this.props.match.url}}]),n}(a.a.Component),It=Object(g.U)(At),Et=Object(k.b)((function(t){return{bookmarks:t.settings.bookmarks}}))(It),Ft=function t(e){var n;Object(b.a)(this,t),this.type=void 0,this.n=void 0,this.label=void 0,this.work=void 0,this.title=void 0,this.creators=void 0,this.type=e.type,this.n=e.n,this.label=e.label,this.work=e.work,this.title=e.title,this.creators=null!==(n=e.creators)&&void 0!==n?n:"\u7121"},Lt=function(t){Object(f.a)(n,t);var e=Object(v.a)(n);function n(t){var s;return Object(b.a)(this,n),(s=e.call(this,t)).state={fetchError:!1,showSearchAlert:!1,searches:[],isLoading:!1},s}return Object(j.a)(n,[{key:"ionViewWillEnter",value:function(){}},{key:"componentDidMount",value:function(){this.search(this.props.match.params.keyword)}},{key:"search",value:function(){var t=Object(p.a)(h.a.mark((function t(e){var n,s,o;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.setState({isLoading:!0}),t.prev=1,t.next=4,X.axiosInstance.get("/toc?q=".concat(e),{responseType:"arraybuffer"});case 4:return n=t.sent,s=JSON.parse((new TextDecoder).decode(n.data)).results,o=s.map((function(t){return new Ft(t)})),this.setState({fetchError:!1,isLoading:!1,searches:o}),t.abrupt("return",!0);case 11:return t.prev=11,t.t0=t.catch(1),console.error(t.t0),console.error((new Error).stack),this.setState({fetchError:!0,isLoading:!1}),t.abrupt("return",!1);case 17:case"end":return t.stop()}}),t,this,[[1,11]])})));return function(e){return t.apply(this,arguments)}}()},{key:"getRows",value:function(){var t=this,e=Array();return this.state.searches.forEach((function(n,s){var r="catalog"===n.type,a=r?n.label:"".concat(n.title,"\n\u4f5c\u8005:").concat(n.creators),i="/".concat(t.props.match.params.tab)+(r?"/catalog/".concat(n.n):"/work/".concat(n.work));e.push(Object(o.jsxs)(g.k,{button:!0,onClick:function(){var e=Object(p.a)(h.a.mark((function e(n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.preventDefault(),t.props.history.push({pathname:i});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:a},"searchLabel_"+s)]},"searchItem_"+s))})),e}},{key:"render",value:function(){var t=this,e=this.getRows();return Object(o.jsxs)(g.s,{children:[Object(o.jsx)(g.g,{children:Object(o.jsxs)(g.J,{children:[Object(o.jsxs)(g.G,{style:{fontSize:"var(--ui-font-size)"},children:["\u641c\u5c0b - ",this.props.match.params.keyword]}),Object(o.jsx)(g.c,{hidden:this.isTopPage,fill:"clear",slot:"start",onClick:function(e){return t.props.history.goBack()},children:Object(o.jsx)(g.h,{icon:tt.a,slot:"icon-only"})}),Object(o.jsx)(g.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(e){return t.search(t.props.match.params.keyword)},children:Object(o.jsx)(g.h,{icon:tt.C,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"clear",slot:"end",onClick:function(e){return t.props.history.push("/".concat(t.props.match.params.tab))},children:Object(o.jsx)(g.h,{icon:tt.v,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"clear",slot:"end",onClick:function(e){return t.setState({showSearchAlert:!0})},children:Object(o.jsx)(g.h,{icon:tt.F,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"clear",slot:"end",onClick:function(e){t.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})},children:Object(o.jsx)(g.h,{icon:tt.J,slot:"icon-only"})})]})}),Object(o.jsxs)(g.d,{children:[this.state.fetchError?X.fetchErrorContent:Object(o.jsx)(g.p,{children:e}),Object(o.jsx)(g.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return t.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."}),Object(o.jsx)(nt,Object(d.a)({},Object(d.a)({showSearchAlert:this.state.showSearchAlert,finish:function(){t.setState({showSearchAlert:!1})}},this.props)))]})]})}},{key:"isTopPage",get:function(){return"/catalog"===this.props.match.url}}]),n}(a.a.Component),Nt=Object(g.U)(Lt),Pt=Object(k.b)((function(t){return{}}))(Nt),Dt=function(t){Object(f.a)(n,t);var e=Object(v.a)(n);function n(t){var s;return Object(b.a)(this,n),(s=e.call(this,t)).searchBarRef=void 0,s.selectedTextBeforeIonPopover="",s.state={keyword:"",searches:[],showNoSelectedTextAlert:!1,popover:{show:!1,event:null},isLoading:!1,fetchError:!1,showToast:!1,toastMessage:""},s.searchBarRef=a.a.createRef(),s}return Object(j.a)(n,[{key:"ionViewWillEnter",value:function(){this.setState({keyword:this.props.match.params.keyword}),this.props.match.params.keyword?this.lookupDict(this.props.match.params.keyword):this.setState({searches:[]})}},{key:"lookupDict",value:function(){var t=Object(p.a)(h.a.mark((function t(e){var n;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.setState({isLoading:!0}),t.prev=1,t.next=4,X.axiosInstance.get("".concat(X.dilaDictApiUrl,"/?type=match&dicts=dila&term=").concat(e),{responseType:"json"});case 4:n=t.sent,this.props.dictionaryHistory.unshift(e),this.props.dictionaryHistory.splice(10),this.props.dispatch({type:"SET_KEY_VAL",key:"dictionaryHistory",val:this.props.dictionaryHistory}),this.setState({fetchError:!1,isLoading:!1,searches:n.data}),t.next=17;break;case 11:return t.prev=11,t.t0=t.catch(1),console.error(t.t0),console.error((new Error).stack),this.setState({fetchError:!0,isLoading:!1}),t.abrupt("return",!1);case 17:case"end":return t.stop()}}),t,this,[[1,11]])})));return function(e){return t.apply(this,arguments)}}()},{key:"getSelectedString",value:function(){var t=document.getSelection();return((null===t||void 0===t?void 0:t.rangeCount)||0)>0&&t.getRangeAt(0).toString().length>0?t.getRangeAt(0).toString():""}},{key:"getRows",value:function(){var t=this.state.searches,e=Array();return t.forEach((function(t,n){e.push(Object(o.jsx)("div",{style:{display:"table-row"},children:Object(o.jsxs)("div",{className:"tableCell",children:[Object(o.jsx)("div",{className:"textFont",style:{color:"var(--ion-color-primary)",paddingBottom:"18pt"},dangerouslySetInnerHTML:{__html:t.dict_name_zh}}),Object(o.jsx)("div",{className:"textFont",style:{padding:"0 5px",textAlign:"justify",overflowWrap:"normal"},dangerouslySetInnerHTML:{__html:t.desc}},"dictItemLabel"+n)]})},"dictItem"+n))})),e}},{key:"render",value:function(){var t=this;return Object(o.jsxs)(g.s,{children:[Object(o.jsx)(g.g,{children:Object(o.jsxs)(g.J,{children:[Object(o.jsx)(g.c,{hidden:this.isTopPage,fill:"clear",slot:"start",onClick:function(e){return t.props.history.goBack()},children:Object(o.jsx)(g.h,{icon:tt.a,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"outline",shape:"round",slot:"start",onClick:function(e){t.props.history.push("/dictionary/searchWord")},children:Object(o.jsx)("span",{className:"uiFont",style:{color:"var(--color)"},children:"\u4f5b\u5b78\u8a5e\u5178"})}),Object(o.jsx)(g.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(e){return t.lookupDict(t.props.match.params.keyword)},children:Object(o.jsx)(g.h,{icon:tt.C,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"clear",slot:"end",onClick:function(e){t.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})},children:Object(o.jsx)(g.h,{icon:tt.J,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"clear",slot:"end",onPointerDown:function(e){t.selectedTextBeforeIonPopover=t.getSelectedString()},onClick:function(e){t.setState({popover:{show:!0,event:e.nativeEvent}})},children:Object(o.jsx)(g.h,{ios:tt.s,md:tt.t,slot:"icon-only"})}),Object(o.jsx)(g.t,{isOpen:this.state.popover.show,event:this.state.popover.event,onDidDismiss:function(e){t.selectedTextBeforeIonPopover="",t.setState({popover:{show:!1,event:null}})},children:Object(o.jsxs)(g.p,{children:[Object(o.jsxs)(g.k,{button:!0,onClick:function(e){t.props.history.push("/".concat(t.props.match.params.tab,"/search")),t.setState({popover:{show:!1,event:null}})},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.v,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u56de\u9996\u9801"})]}),Object(o.jsxs)(g.k,{button:!0,onClick:function(e){t.setState({popover:{show:!1,event:null}}),X.copyToClipboard(t.selectedTextBeforeIonPopover),t.setState({showToast:!0,toastMessage:"\u8907\u88fd\u6587\u5b57\u6210\u529f"})},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.p,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u8907\u88fd\u6587\u5b57"})]}),Object(o.jsxs)(g.k,{button:!0,onClick:function(e){t.setState({popover:{show:!1,event:null}}),""!==t.selectedTextBeforeIonPopover?t.props.history.push({pathname:"/dictionary/search/".concat(t.selectedTextBeforeIonPopover)}):t.setState({showNoSelectedTextAlert:!0})},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.f,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u67e5\u8a5e\u5178"})]}),Object(o.jsxs)(g.k,{button:!0,onClick:function(e){t.setState({popover:{show:!1,event:null}}),""!==t.selectedTextBeforeIonPopover?t.props.history.push({pathname:"/dictionary/searchWord/".concat(t.selectedTextBeforeIonPopover)}):t.setState({showNoSelectedTextAlert:!0})},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.f,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u67e5\u5b57\u5178"})]})]})})]})}),Object(o.jsxs)(g.d,{children:[Object(o.jsx)(g.A,{ref:this.searchBarRef,placeholder:"\u8acb\u8f38\u5165\u5b57\u8a5e\uff0c\u518d\u6309\u9375\u76e4Enter\u9375",value:this.state.keyword,onIonClear:function(e){t.setState({searches:[]})},onKeyUp:function(e){var n=e.target.value;t.setState({keyword:n}),""===n?t.setState({searches:[]}):"Enter"===e.key&&(n===t.props.match.params.keyword?(t.setState({keyword:n}),t.lookupDict(n)):t.props.history.push("/dictionary/search/".concat(n)))}}),this.state.fetchError?X.fetchErrorContent:this.state.searches.length<1||this.props.dictionaryHistory.length>0&&(""===this.state.keyword||void 0===this.state.keyword)?Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)("div",{className:"uiFont",style:{color:"var(--ion-color-primary)"},children:"\u641c\u5c0b\u6b77\u53f2"}),Object(o.jsx)(g.p,{children:this.props.dictionaryHistory.map((function(e,n){return Object(o.jsx)(g.k,{button:!0,onClick:function(){var n=Object(p.a)(h.a.mark((function n(s){return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e===t.props.match.params.keyword?(t.setState({keyword:e}),t.lookupDict(e)):t.props.history.push("/dictionary/search/".concat(e));case 1:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}(),children:Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:e},"dictHistoryLabel_"+n)},"dictHistoryItem_".concat(n))}))}),Object(o.jsx)("div",{style:{textAlign:"center"},children:Object(o.jsx)(g.c,{fill:"outline",shape:"round",size:"large",onClick:function(e){t.setState({keyword:""}),t.props.dispatch({type:"SET_KEY_VAL",key:"dictionaryHistory",val:[]})},children:"\u6e05\u9664\u6b77\u53f2"})})]}):Object(o.jsx)("div",{style:{display:"table",tableLayout:"fixed",width:"100%"},children:this.getRows()}),Object(o.jsx)("div",{style:{fontSize:"var(--ui-font-size)",textAlign:"center"},children:Object(o.jsx)("a",{href:"https://github.com/MrMYHuang/cbetar2#dictionary",target:"_new",children:"\u4f5b\u5b78\u8a5e\u5178\u8aaa\u660e"})}),Object(o.jsx)(g.a,{cssClass:"uiFont",isOpen:this.state.showNoSelectedTextAlert,backdropDismiss:!1,header:"\u5931\u6557",message:"\u8acb\u78ba\u8a8d\u662f\u5426\u5df2\u9078\u64c7\u4e00\u6bb5\u6587\u5b57\uff0c\u7136\u5f8c\u518d\u57f7\u884c\u6240\u9078\u7684\u529f\u80fd!",buttons:[{text:"\u78ba\u5b9a",cssClass:"primary uiFont",handler:function(e){t.setState({showNoSelectedTextAlert:!1})}}]}),Object(o.jsx)(g.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return t.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."}),Object(o.jsx)(g.H,{cssClass:"uiFont",isOpen:this.state.showToast,onDidDismiss:function(){return t.setState({showToast:!1})},message:this.state.toastMessage,duration:2e3})]})]})}},{key:"isTopPage",get:function(){return void 0===this.props.match.params.keyword}}]),n}(a.a.Component),Bt=Object(g.U)(Dt),_t=Object(k.b)((function(t){return{dictionaryHistory:t.settings.dictionaryHistory}}))(Bt),Rt=function t(e){Object(b.a)(this,t),this.id=void 0,this.term_hits=void 0,this.work=void 0,this.juan=void 0,this.title=void 0,this.creators=void 0,this.id=e.id,this.term_hits=e.term_hits,this.work=e.work,this.juan=e.juan,this.title=e.title,this.creators=e.creators},Vt=function(t){Object(f.a)(n,t);var e=Object(v.a)(n);function n(t){var s;return Object(b.a)(this,n),(s=e.call(this,t)).page=0,s.rows=20,s.state={showSearchAlert:!1,searches:[],isScrollOn:!1,isLoading:!1,fetchError:!1},s}return Object(j.a)(n,[{key:"ionViewWillEnter",value:function(){}},{key:"componentDidMount",value:function(){this.search(this.props.match.params.keyword)}},{key:"search",value:function(){var t=Object(p.a)(h.a.mark((function t(e){var n,s,o;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.setState({isLoading:!0}),t.prev=1,console.log("Loading page ".concat(this.page)),t.next=5,X.axiosInstance.get("/sphinx?q=".concat(e,"&start=").concat(this.page*this.rows,"&rows=").concat(this.rows),{responseType:"arraybuffer"});case 5:return n=t.sent,s=JSON.parse((new TextDecoder).decode(n.data)).results,o=s.map((function(t){return new Rt(t)})),this.setState({fetchError:!1,isLoading:!1,searches:[].concat(Object(S.a)(this.state.searches),Object(S.a)(o)),isScrollOn:o.length===this.rows}),this.page+=1,t.abrupt("return",!0);case 13:return t.prev=13,t.t0=t.catch(1),console.error(t.t0),console.error((new Error).stack),this.setState({fetchError:!0,isLoading:!1,isScrollOn:!1}),t.abrupt("return",!1);case 19:case"end":return t.stop()}}),t,this,[[1,13]])})));return function(e){return t.apply(this,arguments)}}()},{key:"getRows",value:function(){var t=this,e=Array();return this.state.searches.forEach((function(n,s){var r="".concat(n.title,"\u5377").concat(n.juan,"\n\u4f5c\u8005:").concat(n.creators),a="/catalog/juan/".concat(n.work,"/").concat(n.juan);e.push(Object(o.jsxs)(g.k,{button:!0,onClick:function(){var e=Object(p.a)(h.a.mark((function e(n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.preventDefault(),t.props.history.push({pathname:a});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:r},"searchLabel_"+s)]},"searchItem_"+s))})),e}},{key:"render",value:function(){var t=this,e=this.getRows();return Object(o.jsxs)(g.s,{children:[Object(o.jsx)(g.g,{children:Object(o.jsxs)(g.J,{children:[Object(o.jsxs)(g.G,{style:{fontSize:"var(--ui-font-size)"},children:["\u5168\u6587\u6aa2\u7d22 - ",this.props.match.params.keyword]}),Object(o.jsx)(g.c,{hidden:this.isTopPage,fill:"clear",slot:"start",onClick:function(e){return t.props.history.goBack()},children:Object(o.jsx)(g.h,{icon:tt.a,slot:"icon-only"})}),Object(o.jsx)(g.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(e){return t.search(t.props.match.params.keyword)},children:Object(o.jsx)(g.h,{icon:tt.C,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"clear",slot:"end",onClick:function(e){return t.props.history.push("/".concat(t.props.match.params.tab))},children:Object(o.jsx)(g.h,{icon:tt.v,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"clear",slot:"end",onClick:function(e){return t.setState({showSearchAlert:!0})},children:Object(o.jsx)(g.h,{icon:tt.F,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"clear",slot:"end",onClick:function(e){t.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})},children:Object(o.jsx)(g.h,{icon:tt.J,slot:"icon-only"})})]})}),Object(o.jsxs)(g.d,{children:[this.state.fetchError?X.fetchErrorContent:Object(o.jsxs)(g.p,{children:[e,Object(o.jsx)(g.i,{threshold:"100px",disabled:!this.state.isScrollOn,onIonInfinite:function(e){t.search(t.props.match.params.keyword),e.target.complete()},children:Object(o.jsx)(g.j,{loadingText:"\u8f09\u5165\u4e2d..."})})]}),Object(o.jsx)(g.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return t.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."}),Object(o.jsx)(nt,Object(d.a)({},Object(d.a)({showSearchAlert:this.state.showSearchAlert,finish:function(){t.setState({showSearchAlert:!1})}},this.props)))]})]})}},{key:"isTopPage",get:function(){return"/catalog"===this.props.match.url}}]),n}(a.a.Component),Mt=Object(g.U)(Vt),zt=Object(k.b)((function(t){return{}}))(Mt),Ut=n(220),Kt=function(t){Object(f.a)(n,t);var e=Object(v.a)(n);function n(t){var s;return Object(b.a)(this,n),(s=e.call(this,t)).state={isAppSettingsExport:Array(Object.keys(X.appSettings).length)},s}return Object(j.a)(n,[{key:"updateQrCode",value:function(){var t=this,e=Object.keys(X.appSettings).filter((function(e,n){return t.state.isAppSettingsExport[n]})).map((function(e,n){return{key:e,val:t.props.settings[e]}})).map((function(t){return"".concat(t.key,"=").concat(+t.val)})).join(",");e=""!==e?"settings=".concat(e):null;var n=this.props.text,s=/\?/.test(n);e&&(n+=s?"&".concat(e):"?".concat(e)),X.copyToClipboard(n);var o=document.getElementById("qrcCanvas");return Ut.toCanvas(o,n),o}},{key:"render",value:function(){var t=this;return Object(o.jsx)(g.r,{isOpen:this.props.showModal,cssClass:"uiFont",swipeToClose:!0,onWillPresent:function(){for(var e=[],n=0;n<t.state.isAppSettingsExport.length;n++)e.push(!1);t.setState({isAppSettingsExport:e}),t.updateQrCode()},onDidDismiss:function(){return t.props.finish()},children:Object(o.jsx)(g.d,{children:Object(o.jsxs)("div",{style:{display:"flex",flexDirection:"column",height:"100%",alignItems:"center"},children:[Object(o.jsx)("div",{children:Object(o.jsx)(g.o,{className:"uiFont",children:"\u6b64\u9801app\u9023\u7d50\u5df2\u8907\u88fd\u81f3\u526a\u8cbc\u7c3f\uff01"})}),Object(o.jsx)("div",{children:Object(o.jsx)(g.o,{className:"uiFont",children:"\u4e5f\u53ef\u4ee5\u4f7f\u7528QR Code\u5206\u4eab:"})}),Object(o.jsx)("div",{style:{flexGrow:1,flexShrink:0,display:"flex",alignItems:"center",margin:10},children:Object(o.jsx)("canvas",{id:"qrcCanvas",width:"500",height:"500",style:{margin:"0px auto"}})}),Object(o.jsxs)("div",{children:[Object(o.jsx)(g.o,{className:"uiFont",children:"\u5305\u62ecapp\u8a2d\u5b9a:"}),Object(o.jsx)(g.p,{children:Object.keys(X.appSettings).map((function(e,n){return Object(o.jsxs)(g.k,{children:[Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:X.appSettings[e]}),Object(o.jsx)(g.I,{slot:"end",onIonChange:function(e){var s=t.state.isAppSettingsExport;s[n]=e.detail.checked,t.setState({isAppSettingsExport:s}),t.updateQrCode()}})]},"appSettingExportItem_".concat(n))}))})]}),Object(o.jsx)("div",{children:Object(o.jsx)(g.c,{fill:"outline",shape:"round",size:"large",onClick:function(){return t.props.finish()},children:"\u95dc\u9589"})})]})})})}}]),n}(a.a.Component),Ht=Object(k.b)((function(t){return{settings:t.settings}}))(Kt);!function(t){t.NOUN="\u540d",t.VERB="\u52d5"}(xt||(xt={}));var Jt=function(t){Object(f.a)(n,t);var e=Object(v.a)(n);function n(t){var s;return Object(b.a)(this,n),(s=e.call(this,t)).searchBarRef=void 0,s.selectedTextBeforeIonPopover="",s.state={keyword:"",search:null,showNoSelectedTextAlert:!1,popover:{show:!1,event:null},isLoading:!1,fetchError:!1,showToast:!1,toastMessage:""},s.searchBarRef=a.a.createRef(),s}return Object(j.a)(n,[{key:"ionViewWillEnter",value:function(){this.props.match.params.keyword&&(this.setState({keyword:this.props.match.params.keyword}),this.lookupDict(this.props.match.params.keyword))}},{key:"componentDidMount",value:function(){}},{key:"ionViewWillLeave",value:function(){}},{key:"lookupDict",value:function(){var t=Object(p.a)(h.a.mark((function t(e){var n,s,o;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.setState({isLoading:!0}),t.prev=1,t.next=4,X.axiosInstance.get("https://www.moedict.tw/uni/".concat(e.substring(0,1)),{responseType:"json"});case 4:n=t.sent,this.props.wordDictionaryHistory.unshift(e),this.props.wordDictionaryHistory.splice(10),this.props.dispatch({type:"SET_KEY_VAL",key:"wordDictionaryHistory",val:this.props.wordDictionaryHistory}),this.setState({fetchError:!1,isLoading:!1,search:n.data.heteronyms}),t.next=16;break;case 11:return t.prev=11,t.t0=t.catch(1),o=t.t0,404===(null===(s=o.response)||void 0===s?void 0:s.status)?this.setState({fetchError:!1,isLoading:!1,search:[]}):(console.error(t.t0),console.error((new Error).stack),this.setState({fetchError:!0,isLoading:!1})),t.abrupt("return",!1);case 16:case"end":return t.stop()}}),t,this,[[1,11]])})));return function(e){return t.apply(this,arguments)}}()},{key:"getSelectedString",value:function(){var t=document.getSelection();return((null===t||void 0===t?void 0:t.rangeCount)||0)>0&&t.getRangeAt(0).toString().length>0?t.getRangeAt(0).toString():""}},{key:"defToView",value:function(t,e){return void 0!==t&&t.length>0?Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)("div",{style:{color:"var(--ion-color-primary)"},children:e},ht.a()),Object(o.jsx)("ol",{children:null===t||void 0===t?void 0:t.map((function(t){var e,n,s;return Object(o.jsxs)("li",{children:[Object(o.jsx)("div",{children:t.def},ht.a()),null===(e=t.quote)||void 0===e?void 0:e.map((function(t){return Object(o.jsx)("div",{children:t},ht.a())})),null===(n=t.example)||void 0===n?void 0:n.map((function(t){return Object(o.jsx)("div",{children:t},ht.a())})),null===(s=t.link)||void 0===s?void 0:s.map((function(t){return Object(o.jsx)("div",{children:t},ht.a())}))]},ht.a())}))},ht.a())]}):Object(o.jsx)(o.Fragment,{})}},{key:"render",value:function(){var t,e,n=this,s=[];this.props.match.params.keyword&&(null===(e=this.state.search)||void 0===e||e.forEach((function(t){var e=null===t||void 0===t?void 0:t.definitions.filter((function(t){return t.type===xt.NOUN})),r=null===t||void 0===t?void 0:t.definitions.filter((function(t){return t.type===xt.VERB})),a=null===t||void 0===t?void 0:t.definitions.filter((function(t){return void 0===t.type})),i=n.defToView(e,"\u540d\u8a5e"),c=n.defToView(r,"\u52d5\u8a5e"),l=n.defToView(a,"");s.push(Object(o.jsxs)("div",{className:"textFont textSelectable",style:{padding:"0 5px"},children:[Object(o.jsx)("div",{className:"textFontX3",children:n.props.match.params.keyword.substring(0,1)},ht.a()),(null===t||void 0===t?void 0:t.bopomofo)?Object(o.jsxs)("div",{children:["\u6ce8\u97f3\uff1a",null===t||void 0===t?void 0:t.bopomofo]}):null,(null===t||void 0===t?void 0:t.pinyin)?Object(o.jsxs)("div",{children:["\u62fc\u97f3\uff1a",null===t||void 0===t?void 0:t.pinyin]}):null,i,c,l]},ht.a()))})));return Object(o.jsxs)(g.s,{children:[Object(o.jsx)(g.g,{children:Object(o.jsxs)(g.J,{children:[Object(o.jsx)(g.c,{fill:"clear",slot:"start",onClick:function(t){return n.props.history.goBack()},children:Object(o.jsx)(g.h,{icon:tt.a,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"outline",shape:"round",slot:"start",onClick:function(t){n.props.history.push("/dictionary/search")},children:Object(o.jsx)("span",{className:"uiFont",children:"\u840c\u5178\u5b57\u5178"})}),Object(o.jsx)(g.c,{hidden:!this.state.fetchError,fill:"clear",slot:"end",onClick:function(t){return n.lookupDict(n.props.match.params.keyword)},children:Object(o.jsx)(g.h,{icon:tt.C,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"clear",slot:"end",onClick:function(t){n.props.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!0,text:decodeURIComponent(window.location.href)}})},children:Object(o.jsx)(g.h,{icon:tt.J,slot:"icon-only"})}),Object(o.jsx)(g.c,{fill:"clear",slot:"end",onPointerDown:function(t){n.selectedTextBeforeIonPopover=n.getSelectedString()},onClick:function(t){n.setState({popover:{show:!0,event:t.nativeEvent}})},children:Object(o.jsx)(g.h,{ios:tt.s,md:tt.t,slot:"icon-only"})}),Object(o.jsx)(g.t,{isOpen:this.state.popover.show,event:this.state.popover.event,onDidDismiss:function(t){n.setState({popover:{show:!1,event:null}}),n.selectedTextBeforeIonPopover=""},children:Object(o.jsxs)(g.p,{children:[Object(o.jsxs)(g.k,{button:!0,onClick:function(t){n.props.history.push("/".concat(n.props.match.params.tab,"/searchWord")),n.setState({popover:{show:!1,event:null}})},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.v,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u56de\u9996\u9801"})]}),Object(o.jsxs)(g.k,{button:!0,onClick:function(t){n.setState({popover:{show:!1,event:null}}),X.copyToClipboard(n.selectedTextBeforeIonPopover),n.setState({showToast:!0,toastMessage:"\u8907\u88fd\u6587\u5b57\u6210\u529f"})},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.p,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u8907\u88fd\u6587\u5b57"})]}),Object(o.jsxs)(g.k,{button:!0,onClick:function(t){n.setState({popover:{show:!1,event:null}}),""!==n.selectedTextBeforeIonPopover?n.props.history.push("/dictionary/search/".concat(n.selectedTextBeforeIonPopover)):n.setState({showNoSelectedTextAlert:!0})},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.f,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u67e5\u8a5e\u5178"})]}),Object(o.jsxs)(g.k,{button:!0,onClick:function(t){n.setState({popover:{show:!1,event:null}}),""!==n.selectedTextBeforeIonPopover?n.props.history.push({pathname:"/dictionary/searchWord/".concat(n.selectedTextBeforeIonPopover)}):n.setState({showNoSelectedTextAlert:!0})},children:[Object(o.jsx)("div",{tabIndex:0}),Object(o.jsx)(g.h,{icon:tt.f,slot:"start"}),Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:"\u67e5\u5b57\u5178"})]})]})})]})}),Object(o.jsx)(g.d,{children:Object(o.jsxs)("div",{style:{display:"flex",flexFlow:"column",height:"100%"},children:[Object(o.jsx)(g.A,{ref:this.searchBarRef,placeholder:"\u8acb\u8f38\u5165\u5b57\uff0c\u518d\u6309\u9375\u76e4Enter\u9375",value:this.state.keyword,onIonClear:function(t){n.setState({search:null})},onKeyUp:function(t){var e=t.target.value;n.setState({keyword:e}),""===e?n.setState({search:null}):"Enter"===t.key&&(e===n.props.match.params.keyword?(n.setState({keyword:e}),n.lookupDict(e)):n.props.history.push("/dictionary/searchWord/".concat(e)))}}),this.state.fetchError?X.fetchErrorContent:((null===(t=this.state.search)||void 0===t?void 0:t.length)||0)<1||this.props.wordDictionaryHistory.length>0&&(""===this.state.keyword||void 0===this.state.keyword)?Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)("div",{className:"uiFont",style:{color:"var(--ion-color-primary)"},children:"\u641c\u5c0b\u6b77\u53f2"}),Object(o.jsx)(g.p,{children:this.props.wordDictionaryHistory.map((function(t,e){return Object(o.jsx)(g.k,{button:!0,onClick:function(){var e=Object(p.a)(h.a.mark((function e(s){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t===n.props.match.params.keyword?(n.setState({keyword:t}),n.lookupDict(t)):n.props.history.push("/dictionary/searchWord/".concat(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:Object(o.jsx)(g.o,{className:"ion-text-wrap uiFont",children:t},"wordDictHistoryLabel_"+e)},"wordDictHistoryItem_".concat(e))}))}),Object(o.jsx)("div",{style:{textAlign:"center"},children:Object(o.jsx)(g.c,{fill:"outline",shape:"round",size:"large",style:{fontSize:"var(--ui-font-size)"},onClick:function(t){n.setState({keyword:""}),n.props.dispatch({type:"SET_KEY_VAL",key:"wordDictionaryHistory",val:[]})},children:"\u6e05\u9664\u6b77\u53f2"})})]}):s,Object(o.jsx)(g.a,{cssClass:"uiFont",isOpen:this.state.showNoSelectedTextAlert,backdropDismiss:!1,header:"\u5931\u6557",message:"\u8acb\u78ba\u8a8d\u662f\u5426\u5df2\u9078\u64c7\u4e00\u6bb5\u6587\u5b57\uff0c\u7136\u5f8c\u518d\u57f7\u884c\u6240\u9078\u7684\u529f\u80fd!",buttons:[{text:"\u78ba\u5b9a",cssClass:"primary uiFont",handler:function(t){n.setState({showNoSelectedTextAlert:!1})}}]}),Object(o.jsx)(g.q,{cssClass:"uiFont",isOpen:this.state.isLoading,onDidDismiss:function(){return n.setState({isLoading:!1})},message:"\u8f09\u5165\u4e2d..."}),Object(o.jsx)(g.H,{cssClass:"uiFont",isOpen:this.state.showToast,onDidDismiss:function(){return n.setState({showToast:!1})},message:this.state.toastMessage,duration:2e3})]})})]})}},{key:"isTopPage",get:function(){return this.props.match.url==="/".concat(this.props.match.params.tab)}}]),n}(a.a.Component),Wt=Object(g.U)(Jt),Yt=Object(k.b)((function(t){return{wordDictionaryHistory:t.settings.wordDictionaryHistory}}))(Wt),Gt=function(){var t=localStorage.getItem(X.storeFile);return null!=t?Object(O.c)(Z,JSON.parse(t)):Object(O.c)(Z)}();Object(g.T)({mode:"md",swipeBackEnabled:!1});var qt={onSuccess:function(t){},onUpdate:function(t){}},Xt=function(t){Object(f.a)(n,t);var e=Object(v.a)(n);function n(){return Object(b.a)(this,n),e.apply(this,arguments)}return Object(j.a)(n,[{key:"render",value:function(){return Object(o.jsx)(k.a,{store:Gt,children:Object(o.jsx)(Zt,Object(d.a)({},this.props))})}}]),n}(a.a.Component),Qt=function(t){Object(f.a)(n,t);var e=Object(v.a)(n);function n(t){var s;for(Object(b.a)(this,n),(s=e.call(this,t)).registrationNew=void 0,s.originalAppSettingsStr=void 0,s.wakeLock=void 0,s.props.settings.hasAppLog||X.disableAppLog(),s.registrationNew=null,Object(g.S)("android")?window.oncontextmenu=X.disableAndroidChromeCallout:Object(g.S)("ios")&&(document.ontouchend=X.disableIosSafariCallout.bind(window)),X.isTouchDevice()&&(window.onorientationchange=function(t){setTimeout((function(){s.forceUpdate()}),500)});document.body.classList.length>0;)document.body.classList.remove(document.body.classList.item(0));document.body.classList.toggle("theme".concat(s.props.settings.theme),!0),document.body.classList.toggle("print".concat(s.props.settings.printStyle),!0);var o=w.a.parse(s.props.location.search);return o.settings&&(s.originalAppSettingsStr=localStorage.getItem("Settings.json"),o.settings.split(",").forEach((function(t){var e=t.split("=");s.props.dispatch({type:"SET_KEY_VAL",key:e[0],val:+e[1]})}))),X.updateCssVars(s.props.settings),s.state={showUpdateAlert:!1,showRestoreAppSettingsToast:null!=o.settings&&null!=s.originalAppSettingsStr||!1},qt.onUpdate=function(t){s.registrationNew=t,s.setState({showUpdateAlert:!0})},qt.onSuccess=function(t){},"undefined"!==typeof speechSynthesis&&(speechSynthesis.getVoices(),speechSynthesis.cancel()),navigator.wakeLock&&(s.wakeLockScreen(),document.addEventListener("visibilitychange",Object(p.a)(h.a.mark((function t(){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:"visible"===document.visibilityState?s.wakeLockScreen():s.wakeLockScreenRelease();case 1:case"end":return t.stop()}}),t)}))))),indexedDB.open(X.cbetardb).onupgradeneeded=function(t){t.target.result.createObjectStore("store")},s.loadTwKaiFont(),s}return Object(j.a)(n,[{key:"restoreAppSettings",value:function(){for(localStorage.setItem(X.storeFile,this.originalAppSettingsStr),this.props.dispatch({type:"LOAD_SETTINGS"});document.body.classList.length>0;)document.body.classList.remove(document.body.classList.item(0));document.body.classList.toggle("theme".concat(this.props.settings.theme),!0),document.body.classList.toggle("print".concat(this.props.settings.printStyle),!0),X.updateCssVars(this.props.settings)}},{key:"loadTwKaiFont",value:function(){var t=Object(p.a)(h.a.mark((function t(){var e,n,s;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,X.getFileFromIndexedDB(X.twKaiFontKey);case 3:e=t.sent,t.next=13;break;case 6:return t.prev=6,t.t0=t.catch(0),t.next=10,X.axiosInstance.get("".concat(window.location.origin,"/").concat(X.twKaiFontPath),{responseType:"arraybuffer",timeout:0});case 10:n=t.sent,e=n.data,X.saveFileToIndexedDB(X.twKaiFontKey,e);case 13:return s=new window.FontFace("Kai",e),t.next=16,s.load();case 16:document.fonts.add(s),console.log("[Main] TW-Kai font loading success!");case 18:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(){return t.apply(this,arguments)}}()},{key:"wakeLockScreen",value:function(){var t=Object(p.a)(h.a.mark((function t(){var e;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,null==(e=navigator.wakeLock)){t.next=9;break}return t.next=5,e.request("screen");case 5:this.wakeLock=t.sent,console.log("Screen wake lock is requested."),t.next=10;break;case 9:console.error("navigator.wakeLock is undefined.");case 10:t.next=16;break;case 12:t.prev=12,t.t0=t.catch(0),console.log("".concat(t.t0.name,", ").concat(t.t0.message)),console.log((new Error).stack);case 16:case"end":return t.stop()}}),t,this,[[0,12]])})));return function(){return t.apply(this,arguments)}}()},{key:"wakeLockScreenRelease",value:function(){var t=Object(p.a)(h.a.mark((function t(){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null==this.wakeLock){t.next=5;break}return t.next=3,this.wakeLock.release();case 3:this.wakeLock=null,console.log("Screen wake lock is released.");case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"routeByQueryString",value:function(){console.log(window.location.search);var t=/route=([^&]*)/.exec(window.location.search),e=/query=([^&]*)/.exec(window.location.search);if(null!==t){var n="";return null!==e&&(n=decodeURIComponent(e[1])),Object(o.jsx)(x.a,{to:t[1]+n})}if("/"===window.location.pathname)return Object(o.jsx)(x.a,{to:"/bookmarks"})}},{key:"render",value:function(){var t,e,n=this;return Object(o.jsxs)(g.b,{style:X.isTouchDevice()?{height:"".concat(window.innerHeight,"px")}:{},children:[Object(o.jsx)(m.a,{children:Object(o.jsxs)(g.F,{children:[Object(o.jsxs)(g.z,{animated:!1,children:[Object(o.jsx)(x.b,{path:"/:tab(catalog)/webview/:work/:path/:label",render:function(t){return Object(o.jsx)(kt,Object(d.a)({},t))},exact:!0}),Object(o.jsx)(x.b,{path:"/:tab(catalog)/juan/:work/:path/",render:function(t){return Object(o.jsx)(kt,Object(d.a)({},t))},exact:!0}),Object(o.jsx)(x.b,{path:"/:tab(catalog)/work/:path/:label",render:function(t){return Object(o.jsx)(lt,Object(d.a)({},t))},exact:!0}),Object(o.jsx)(x.b,{path:"/:tab(catalog)/work/:path",render:function(t){return Object(o.jsx)(lt,Object(d.a)({},t))},exact:!0}),Object(o.jsx)(x.b,{path:"/:tab(catalog)/search/:keyword",render:function(t){return Object(o.jsx)(Pt,Object(d.a)({},t))},exact:!0}),Object(o.jsx)(x.b,{path:"/:tab(catalog)/fulltextsearch/:keyword",render:function(t){return Object(o.jsx)(zt,Object(d.a)({},t))},exact:!0}),Object(o.jsx)(x.b,{path:"/:tab(catalog)/catalog/:path/:label",render:function(t){return Object(o.jsx)(at,Object(d.a)({},t))},exact:!0}),Object(o.jsx)(x.b,{path:"/:tab(catalog)/:type(catalog|volumes|famous)?/:path?",render:function(t){return Object(o.jsx)(at,Object(d.a)({},t))},exact:!0}),Object(o.jsx)(x.b,{path:"/:tab(bookmarks)",render:function(t){return Object(o.jsx)(Et,Object(d.a)({},t))},exact:!0}),Object(o.jsx)(x.b,{path:"/:tab(dictionary)/search/:keyword?",render:function(t){return Object(o.jsx)(_t,Object(d.a)({},t))},exact:!0}),Object(o.jsx)(x.b,{path:"/:tab(dictionary)/searchWord/:keyword?",render:function(t){return Object(o.jsx)(Yt,Object(d.a)({},t))},exact:!0}),Object(o.jsx)(x.b,{path:"/settings",render:function(t){return Object(o.jsx)(Tt,Object(d.a)({},t))}}),Object(o.jsx)(x.b,{path:"/",render:function(){return n.routeByQueryString()},exact:!0})]}),Object(o.jsxs)(g.D,{slot:"bottom",children:[Object(o.jsx)(g.E,{tab:"bookmarks",href:"/bookmarks",children:Object(o.jsx)(g.h,{icon:tt.g})}),Object(o.jsx)(g.E,{tab:"catalog",href:"/catalog",children:Object(o.jsx)(g.h,{icon:tt.x})}),Object(o.jsx)(g.E,{tab:"dictionay",href:"/dictionary/search",children:Object(o.jsx)(g.h,{icon:tt.f})}),Object(o.jsx)(g.E,{tab:"settings",href:"/settings",children:Object(o.jsx)(g.h,{icon:tt.I})})]})]})}),Object(o.jsx)(g.a,{cssClass:"uiFont",isOpen:this.state.showUpdateAlert,backdropDismiss:!1,onDidPresent:function(t){var e,s,o,r;null===(e=n.registrationNew)||void 0===e||null===(s=e.installing)||void 0===s||s.postMessage({type:"SKIP_WAITING"}),null===(o=n.registrationNew)||void 0===o||null===(r=o.waiting)||void 0===r||r.postMessage({type:"SKIP_WAITING"})},header:"\u767c\u73feapp\u66f4\u65b0\uff0c\u907f\u514d\u904b\u4f5c\u7570\u5e38\uff0c\u8acb\u91cd\u555fapp\u6216\u95dc\u9589\u76f8\u95dc\u5206\u9801!\u7136\u5f8c\u53ef\u81f3\u8a2d\u5b9a\u9801\u6aa2\u67e5\u7248\u672c\u865f\u3002",buttons:[{text:"\u95dc\u9589",cssClass:"primary uiFont",handler:function(t){n.setState({showUpdateAlert:!1})}},{text:"\u986f\u793a\u7248\u672c\u6b77\u53f2",cssClass:"secondary uiFont",handler:function(t){window.open("https://github.com/MrMYHuang/cbetar2#history")}}]}),Object(o.jsx)(Ht,Object(d.a)({},Object(d.a)({text:null===(t=this.props.shareTextModal)||void 0===t?void 0:t.text,showModal:(null===(e=this.props.shareTextModal)||void 0===e?void 0:e.show)||!1,finish:function(){Gt.dispatch({type:"TMP_SET_KEY_VAL",key:"shareTextModal",val:{show:!1}})}},this.props))),Object(o.jsx)(g.H,{cssClass:"uiFont",isOpen:this.state.showRestoreAppSettingsToast,onDidDismiss:function(){return n.setState({showRestoreAppSettingsToast:!1})},message:"\u5df2\u5957\u7528app\u9023\u7d50\u4e2d\u7684\u8a2d\u5b9a\uff0c\u662f\u5426\u9084\u539f\u8a2d\u5b9a\uff1f",buttons:[{text:"\u53d6\u6d88",role:"cancel",handler:function(){return n.setState({showRestoreAppSettingsToast:!1})}},{text:"\u9084\u539f",handler:function(){return n.restoreAppSettings()}}]})]})}}]),n}(a.a.Component),Zt=Object(k.b)((function(t){return{shareTextModal:t.tmpSettings.shareTextModal,settings:t.settings}}))(Qt),$t=Object(x.f)(Xt),te=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ee(t,e){navigator.serviceWorker.register(t).then((function(t){t.onupdatefound=function(){var n=t.installing;null!=n&&(n.onstatechange=function(){console.log("installingWorker stage changed: ".concat(n.state)),"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),e&&e.onUpdate&&e.onUpdate(t)):(console.log("Content is cached for offline use."),e&&e.onSuccess&&e.onSuccess(t)))})}})).catch((function(t){console.error("Error during service worker registration:",t)}))}X.enableAppLog(),c.a.render(Object(o.jsx)(l.a,{children:Object(o.jsx)($t,{})}),document.getElementById("root")),function(t){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("","/service-worker.js");te?(!function(t,e){fetch(t,{headers:{"Service-Worker":"script"}}).then((function(n){var s=n.headers.get("content-type");404===n.status||null!=s&&-1===s.indexOf("javascript")?navigator.serviceWorker.ready.then((function(t){t.unregister().then((function(){window.location.reload()}))})):ee(t,e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e,t),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):ee(e,t)}))}}({onSuccess:function(t){console.log("Precache app loaded!"),qt.onSuccess(t)},onUpdate:function(t){console.log("Found app updated!"),qt.onUpdate(t)}})}},[[443,3,4]]]);
//# sourceMappingURL=main.b7f64722.chunk.js.map