{"version":3,"sources":["../node_modules/@ionic/core/dist/esm-es5 lazy /^/.*/.entry/.js$/ include: /.entry/.js$/ exclude: /.system/.entry/.js$/ groupOptions: {} namespace object","../node_modules/ionicons/dist/esm-es5 lazy /^/.*/.entry/.js$/ include: /.entry/.js$/ exclude: /.system/.entry/.js$/ groupOptions: {} namespace object","models/Work.tsx","Globals.tsx","models/Bookmark.tsx","redux/reducers/index.tsx","redux/reducers/setReducer.tsx","redux/reducers/tmpSetReducer.tsx","pages/EPubViewPage.tsx","models/Catalog.tsx","components/SearchAlert.tsx","pages/CatalogPage.tsx","pages/WorkPage.tsx","models/DictWordItem.tsx","pages/SettingsPage.tsx","pages/BookmarkPage.tsx","models/Search.tsx","pages/SearchPage.tsx","pages/DictionaryPage.tsx","models/FullTextSearch.tsx","pages/FullTextSearchPage.tsx","components/ShareTextModal.tsx","pages/WordDictionaryPage.tsx","App.tsx","redux/store.tsx","serviceWorker.ts","index.tsx"],"names":["map","webpackAsyncContext","req","__webpack_require__","o","Promise","resolve","then","e","Error","code","ids","id","keys","Object","module","exports","WorkListType","WorkChapter","json","title","juan","this","Work","juan_list","mulu","work","vol","cbetaApiUrl","log","axiosInstance","axios","create","baseURL","timeout","scrollbarSizeIdToValue","getFileName","getFileFromIndexedDB","fileName","a","dbOpenReq","indexedDB","open","ok","fail","onsuccess","ev","db","result","trans","transaction","objectStore","get","_ev","data","console","error","transWrite","put","delete","htmlFile","update","htmlStr","workInfo","bookmarks","JSON","parse","localStorage","getItem","settings","find","b","uuid","responseType","res","tryDecoder","TextDecoder","tryDecodeHtmlStr","decode","includes","results","work_info","doc","document","implementation","createHTMLDocument","body","innerHTML","XMLSerializer","serializeToString","replace","consoleLog","bind","consoleError","BookmarkType","storeFile","fontSizeNorm","fontSizeLarge","getLog","enableAppLog","Array","from","arguments","apply","disableAppLog","cbetardb","apiVersion","dilaDictApiUrl","twKaiFontKey","twKaiFontPath","topCatalogsByCat","topCatalogsByVol","fetchErrorContent","className","style","fontSize","paddingTop","href","target","updateApp","navigator","serviceWorker","getRegistrations","regs","all","reg","updateCssVars","scrollbarSize","documentElement","cssText","useFontKai","uiFontSize","isTouchDevice","isPlatform","fetchJuan","saveFileToIndexedDB","removeFileFromIndexedDB","removeElementsByClassName","elements","getElementsByClassName","length","parentNode","removeChild","Bookmark","type","CATALOG","selectedText","epubcfi","combineReducers","state","action","newSettings","key","val","setItem","Globals","stringify","oldBookmarks","bookmark","some","bookmarksTemp","idxToDel","findIndex","deletedBookmarks","splice","deletedBookmark","noJuanBookmarkUseTheFile","JUAN","noWorkBookmarkUseTheFile","WORK","juans","split","i","vals","k","undefined","tmpSettings","newState","SpeechState","Catalog","n","nodeType","label","file","node_type","SearchAlert","cssClass","isOpen","props","showSearchAlert","header","subHeader","inputs","name","placeholder","buttons","text","role","handler","finish","value","history","push","name0","React","Component","_CatalogPage","fetchError","catalogs","pathLabel","match","url","fetchData","params","path","fetchTopCatalogs","topCatalogsType","obj","parentPath","topCatalogsByCatLabel","setState","stack","topCatalogs","forEach","catalog","paths","pop","join","dispatch","rows","index","routeLink","isHtmlNode","button","onClick","event","preventDefault","pathname","search","queryString","tabIndex","list","getRows","hidden","isTopCatalog","fill","slot","goBack","icon","arrowBack","newTopCatalogsType","color","hasBookmark","delBookmarkHandler","addBookmarkHandler","tab","home","show","decodeURIComponent","window","location","shareSocial","textAlign","CatalogPage","withIonLifeCycle","connect","_WorkPage","showAddBookmarkDone","fetchWork","works","resToc","wc","saveJuans","workListType","BY_CHAPTER","getRowsByChapter","getRowsByJuan","isTopPage","newWorkListType","BY_JUAN","onDidDismiss","message","duration","WorkPage","WordType","_EPubViewPage","htmlTitle","book","rendition","epub","displayed","cfiRange","speechSynthesisUtterance","uuidStr","epubcfiFromUrl","epubcfiFromSelectedString","bookCreated","ePubIframe","maxCharsPerUtterance","workTexts","workTextsIndex","isLoading","currentPage","pageCount","showJumpPageAlert","showNoSelectedTextAlert","showAddBookmarkSuccess","showsCopyToClipboardSuccess","showsCitationFail","popover","lookupDictPopover","speechState","UNINITIAL","SpeechSynthesisUtterance","lang","onend","speechSynthesis","speak","addEventListener","keyListener","logoArray","Uint8Array","origin","logoStr","require","writeFileSync","queryParams","loadEpubCoverToMemFs","getSelectedString","HTML","assign","cancel","destroy","paginated","prev","next","page","isNaN","Math","max","min","step","diff","abs","pageNext","pagePrev","keyCode","which","rtlVerticalLayout","nodepub","series","sequence","author","fileAs","genre","tags","copyright","publisher","published","language","description","contents","source","images","htmlStrModifiedStyles","htmlStrWithCssJs","addSection","addCSS","getComputedStyle","getPropertyValue","showComments","writeEPUB","fs","tempEpubBuffer","readFileSync","ePub","buffer","openAs","renderTo","width","height","spread","flow","scrollbarWidth","defaultDirection","on","EVENTS","RENDITION","DISPLAYED","updatePageInfos","display","annotations","highlight","locations","generate","iframes","getElementsByTagName","contentDocument","alert","currentLocation","start","total","sel","getSelection","rangeCount","getRangeAt","toString","removeAllRanges","remainingWorkText","selection","contentWindow","back","getElementById","s","setEnd","docFragment","cloneContents","Document","docHtml","createElement","appendChild","innerText","voices","getVoices","zhTwVoice","voice","indexOf","workText","getRemainingWorkTextFromSelectedRange","ceil","substring","rate","speechRate","SPEAKING","PAUSE","resume","stopCircle","musicalNotes","nativeEvent","ios","ellipsisHorizontal","md","ellipsisVertical","snaps","pin","onIonChange","ratio","detail","sharedUrl","range","startLine","startContainer","parentElement","getAttribute","endLine","endContainer","exec","lineInfo","citation","clipboard","writeText","navButtons","vertical","horizontal","opacity","onTouchStart","currentTarget","setProperty","onMouseOver","onTouchEnd","onMouseLeave","arrowForward","html2Epub","userSelect","WebkitUserSelect","dangerouslySetInnerHTML","__html","v","checked","jumpToPage","backdropDismiss","EPubViewPage","SettingsPage","showFontLicense","juansDownloadedRatio","showUpdateAllJuansDone","newBookmarks","newBookmark","updateIndex","workBookmarksWithHtml","filter","juanBookmarksWithHtml","juanBookmarksNotInWorkBookmarksWithHtml","wb","juansToDownload","juansDownloaded","bookmarkWithHtml","j","updateBookmark","PackageInfos","version","size","refreshCircle","bug","hasAppLog","isChecked","encodeURIComponent","userAgent","updateAllJuans","colorPalette","theme","interface","interfaceOptions","classList","remove","toggle","documentText","flexDirection","toFixed","helpCircle","helpDoc","download","_BookmarkPage","bookmarkListRef","createRef","side","current","closeSlidingItems","ref","paddingBottom","BookmarkPage","Search","creators","_SearchPage","searches","keyword","isCatalog","SearchPage","_DictionaryPage","searchBarRef","lookupDict","item","dict_name_zh","desc","onIonClear","onKeyUp","DictionaryPage","FullTextSearch","term_hits","ShareTextModal","qrcCanvas","qrcode","showModal","swipeToClose","onWillPresent","updateQrCode","alignItems","flexGrow","margin","_WordDictionaryPage","heteronyms","defs","d","def","quote","q","example","link","l","dictView","nouns","definitions","NOUN","verbs","VERB","others","nounsView","defToView","verbsView","othersView","bopomofo","pinyin","WordDictionaryPage","store","savedSettingsStr","createStore","reducer","getSavedStore","getState","setupConfig","mode","swipeBackEnabled","serviceWorkCallbacks","onSuccess","registration","onUpdate","_App","AppOrig","_AppOrig","registrationNew","wakeLock","showUpdateAlert","wakeLockScreen","loadTwKaiFont","onupgradeneeded","createObjectStore","fontData","fontFace","FontFace","load","fonts","add","request","routeMatches","to","animated","render","exact","component","FullTextSearchPage","routeByQueryString","library","onDidPresent","installing","postMessage","waiting","shareTextModal","App","withRouter","isLocalhost","Boolean","hostname","registerValidSW","swUrl","config","register","onupdatefound","installingWorker","onstatechange","controller","catch","ReactDOM","URL","process","fetch","headers","response","contentType","status","ready","unregister","reload","checkValidServiceWorker"],"mappings":"8lDAAA,IAAIA,EAAM,CACT,8BAA+B,CAC9B,IACA,GAED,uBAAwB,CACvB,IACA,GAED,uBAAwB,CACvB,IACA,GAED,0BAA2B,CAC1B,IACA,IAED,6BAA8B,CAC7B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,wBAAyB,CACxB,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,sBAAuB,CACtB,IACA,IAED,uBAAwB,CACvB,IACA,IAED,4BAA6B,CAC5B,IACA,IAED,uBAAwB,CACvB,IACA,IAED,qBAAsB,CACrB,IACA,IAED,mCAAoC,CACnC,IACA,IAED,uBAAwB,CACvB,IACA,IAED,+BAAgC,CAC/B,IACA,IAED,wBAAyB,CACxB,IACA,IAED,yBAA0B,CACzB,IACA,IAED,wBAAyB,CACxB,IACA,IAED,uBAAwB,CACvB,IACA,GAED,uBAAwB,CACvB,IACA,IAED,yBAA0B,CACzB,IACA,GAED,8BAA+B,CAC9B,IACA,IAED,yBAA0B,CACzB,IACA,IAED,uBAAwB,CACvB,IACA,IAED,6BAA8B,CAC7B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,+BAAgC,CAC/B,IACA,IAED,yBAA0B,CACzB,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,yBAA0B,CACzB,IACA,IAED,yBAA0B,CACzB,IACA,IAED,4BAA6B,CAC5B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,uBAAwB,CACvB,IACA,IAED,sBAAuB,CACtB,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,uBAAwB,CACvB,IACA,IAED,wBAAyB,CACxB,IACA,IAED,gCAAiC,CAChC,IACA,KAGF,SAASC,EAAoBC,GAC5B,IAAIC,EAAoBC,EAAEJ,EAAKE,GAC9B,OAAOG,QAAQC,UAAUC,MAAK,WAC7B,IAAIC,EAAI,IAAIC,MAAM,uBAAyBP,EAAM,KAEjD,MADAM,EAAEE,KAAO,mBACHF,KAIR,IAAIG,EAAMX,EAAIE,GAAMU,EAAKD,EAAI,GAC7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","file":"static/js/main.da96b9fe.chunk.js","sourcesContent":["var map = {\n\t\"./ion-action-sheet.entry.js\": [\n\t\t431,\n\t\t5\n\t],\n\t\"./ion-alert.entry.js\": [\n\t\t432,\n\t\t6\n\t],\n\t\"./ion-app_8.entry.js\": [\n\t\t433,\n\t\t7\n\t],\n\t\"./ion-avatar_3.entry.js\": [\n\t\t434,\n\t\t18\n\t],\n\t\"./ion-back-button.entry.js\": [\n\t\t435,\n\t\t19\n\t],\n\t\"./ion-backdrop.entry.js\": [\n\t\t436,\n\t\t43\n\t],\n\t\"./ion-button_2.entry.js\": [\n\t\t437,\n\t\t20\n\t],\n\t\"./ion-card_5.entry.js\": [\n\t\t438,\n\t\t21\n\t],\n\t\"./ion-checkbox.entry.js\": [\n\t\t439,\n\t\t22\n\t],\n\t\"./ion-chip.entry.js\": [\n\t\t440,\n\t\t23\n\t],\n\t\"./ion-col_3.entry.js\": [\n\t\t441,\n\t\t44\n\t],\n\t\"./ion-datetime_3.entry.js\": [\n\t\t442,\n\t\t10\n\t],\n\t\"./ion-fab_3.entry.js\": [\n\t\t443,\n\t\t24\n\t],\n\t\"./ion-img.entry.js\": [\n\t\t444,\n\t\t45\n\t],\n\t\"./ion-infinite-scroll_2.entry.js\": [\n\t\t445,\n\t\t46\n\t],\n\t\"./ion-input.entry.js\": [\n\t\t446,\n\t\t25\n\t],\n\t\"./ion-item-option_3.entry.js\": [\n\t\t447,\n\t\t26\n\t],\n\t\"./ion-item_8.entry.js\": [\n\t\t448,\n\t\t27\n\t],\n\t\"./ion-loading.entry.js\": [\n\t\t449,\n\t\t28\n\t],\n\t\"./ion-menu_3.entry.js\": [\n\t\t450,\n\t\t29\n\t],\n\t\"./ion-modal.entry.js\": [\n\t\t451,\n\t\t8\n\t],\n\t\"./ion-nav_2.entry.js\": [\n\t\t452,\n\t\t15\n\t],\n\t\"./ion-popover.entry.js\": [\n\t\t453,\n\t\t9\n\t],\n\t\"./ion-progress-bar.entry.js\": [\n\t\t454,\n\t\t30\n\t],\n\t\"./ion-radio_2.entry.js\": [\n\t\t455,\n\t\t31\n\t],\n\t\"./ion-range.entry.js\": [\n\t\t456,\n\t\t32\n\t],\n\t\"./ion-refresher_2.entry.js\": [\n\t\t457,\n\t\t11\n\t],\n\t\"./ion-reorder_2.entry.js\": [\n\t\t458,\n\t\t17\n\t],\n\t\"./ion-ripple-effect.entry.js\": [\n\t\t459,\n\t\t47\n\t],\n\t\"./ion-route_4.entry.js\": [\n\t\t460,\n\t\t33\n\t],\n\t\"./ion-searchbar.entry.js\": [\n\t\t461,\n\t\t34\n\t],\n\t\"./ion-segment_2.entry.js\": [\n\t\t462,\n\t\t35\n\t],\n\t\"./ion-select_3.entry.js\": [\n\t\t463,\n\t\t36\n\t],\n\t\"./ion-slide_2.entry.js\": [\n\t\t464,\n\t\t48\n\t],\n\t\"./ion-spinner.entry.js\": [\n\t\t465,\n\t\t13\n\t],\n\t\"./ion-split-pane.entry.js\": [\n\t\t466,\n\t\t49\n\t],\n\t\"./ion-tab-bar_2.entry.js\": [\n\t\t467,\n\t\t37\n\t],\n\t\"./ion-tab_2.entry.js\": [\n\t\t468,\n\t\t16\n\t],\n\t\"./ion-text.entry.js\": [\n\t\t469,\n\t\t38\n\t],\n\t\"./ion-textarea.entry.js\": [\n\t\t470,\n\t\t39\n\t],\n\t\"./ion-toast.entry.js\": [\n\t\t471,\n\t\t40\n\t],\n\t\"./ion-toggle.entry.js\": [\n\t\t472,\n\t\t12\n\t],\n\t\"./ion-virtual-scroll.entry.js\": [\n\t\t473,\n\t\t50\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 217;\nmodule.exports = webpackAsyncContext;","var map = {\n\t\"./ion-icon.entry.js\": [\n\t\t477,\n\t\t57\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 219;\nmodule.exports = webpackAsyncContext;","export enum WorkListType {\n    // Don't change the order! Otherwise, it breaks file compatibility!\n    BY_CHAPTER,\n    BY_JUAN,\n}\n\nexport class WorkChapter {\n    title: string;\n    juan: number;\n\n    constructor(json: any) {\n        this.title = json.title;\n        this.juan = json.juan;\n    }\n}\n\nexport class Work {\n    title: string;\n    juan: number;\n    juan_list: string;\n    mulu: WorkChapter[];\n    work: string;\n    vol: string;\n\n    constructor(json: any) {\n        this.title = json.title;\n        this.juan = json.juan;\n        this.juan_list = json.juan_list;\n        this.mulu = json.mulu;\n        this.work = json.work;\n        this.vol = json.vol;\n    }\n}\n","import axios from 'axios';\nimport { isPlatform, IonLabel } from '@ionic/react';\nimport React from 'react';\nimport { Work } from './models/Work';\nimport { Bookmark } from './models/Bookmark';\n\nconst apiVersion = 'v1.2';\nconst cbetaApiUrl = `https://cbdata.dila.edu.tw/${apiVersion}`;\nconst dilaDictApiUrl = `https://glossaries.dila.edu.tw/search.json`;\nconst cbetardb = 'cbetardb';\nconst twKaiFontKey = 'twKaoFont';\n/* Font source: https://data.gov.tw/dataset/5961 */\nconst twKaiFontPath = '/assets/TW-Kai-98_1.woff';\nlet log = '';\n\nconst axiosInstance = axios.create({\n  baseURL: cbetaApiUrl,\n  timeout: 3000,\n});\n\nfunction scrollbarSizeIdToValue(id: number) {\n  switch (id) {\n    case 0: return 0;\n    case 1: return 20;\n    case 2: return 40;\n  }\n}\n\nfunction getFileName(work: string, juan: string) {\n  return `${work}_juan${juan}.html`;\n}\n\nasync function getFileFromIndexedDB(fileName: string) {\n  const dbOpenReq = indexedDB.open(cbetardb);\n\n  return new Promise(function (ok, fail) {\n    dbOpenReq.onsuccess = async function (ev) {\n      const db = dbOpenReq.result;\n\n      const trans = db.transaction([\"store\"], 'readwrite');\n      let req = trans.objectStore('store').get(fileName);\n      req.onsuccess = async function (_ev) {\n        const data = req.result;\n        if (!data) {\n          console.error(`${fileName} loading failed!`);\n          return fail();\n        }\n        return ok(data);\n      };\n    };\n  });\n}\n\nasync function saveFileToIndexedDB(fileName: string, data: any) {\n  const dbOpenReq = indexedDB.open(cbetardb);\n  return new Promise((ok, fail) => {\n    dbOpenReq.onsuccess = async (ev: Event) => {\n      const db = dbOpenReq.result;\n\n      const transWrite = db.transaction([\"store\"], 'readwrite')\n      const reqWrite = transWrite.objectStore('store').put(data, fileName);\n      reqWrite.onsuccess = (_ev: any) => {\n        return ok();\n      };\n    };\n  });\n}\n\nasync function removeFileFromIndexedDB(fileName: string) {\n  const dbOpenReq = indexedDB.open(cbetardb);\n  return new Promise((ok, fail) => {\n    dbOpenReq.onsuccess = async (ev: Event) => {\n      const db = dbOpenReq.result;\n\n      const transWrite = db.transaction([\"store\"], 'readwrite')\n      const reqWrite = transWrite.objectStore('store').delete(fileName);\n      reqWrite.onsuccess = (_ev: any) => {\n        return ok();\n      };\n    };\n  });\n}\n\n// Fetch juan or HTML file.\nasync function fetchJuan(work: string, juan: string, htmlFile: string | null, update: boolean = false) {\n  const fileName = htmlFile || getFileName(work, juan);\n  let htmlStr: string | null = null;\n  try {\n    htmlStr = await getFileFromIndexedDB(fileName) as string;\n  } catch {\n    // Ignore file not found.\n  }\n\n  let workInfo = new Work({});\n  if (htmlStr !== null && !update) {\n    const bookmarks = (JSON.parse(localStorage.getItem('Settings.json')!) as any).settings.bookmarks as Bookmark[];\n    workInfo = bookmarks.find((b) => b.fileName === fileName || b.uuid === work)!.work!;\n  } else {\n    if (htmlFile) {\n      const res = await axiosInstance.get(`/${htmlFile}`, {\n        responseType: 'arraybuffer',\n      });\n      let tryDecoder = new TextDecoder();\n      let tryDecodeHtmlStr = tryDecoder.decode(res.data);\n      if (tryDecodeHtmlStr.includes('charset=big5')) {\n        htmlStr = new TextDecoder('big5').decode(res.data);\n      } else {\n        htmlStr = tryDecodeHtmlStr;\n      }\n    } else {\n      const res = await axiosInstance.get(`/juans?edition=CBETA&work_info=1&work=${work}&juan=${juan}`, {\n        responseType: 'arraybuffer',\n      });\n      let data = JSON.parse(new TextDecoder().decode(res.data));\n      htmlStr = data.results[0];\n      workInfo = data.work_info;\n    }\n\n    // Convert HTML to XML, because ePub requires XHTML.\n    // Bad structured HTML will cause DOMParser parse error on some browsers!\n    let doc = document.implementation.createHTMLDocument(\"\");\n    doc.body.innerHTML = htmlStr!;\n    htmlStr = new XMLSerializer().serializeToString(doc.body);\n    // Remove body tag.\n    htmlStr = htmlStr.replace('<body', '<div');\n    htmlStr = htmlStr.replace('/body>', '/div>');\n  }\n  return { htmlStr, workInfo };\n}\n\nfunction removeElementsByClassName(doc: Document, className: string) {\n  let elements = doc.getElementsByClassName(className);\n  while (elements.length > 0) {\n    elements[0].parentNode?.removeChild(elements[0]);\n  }\n}\n\nconst consoleLog = console.log.bind(console);\nconst consoleError = console.error.bind(console);\n\nfunction getLog() {\n  return log;\n}\n\nfunction enableAppLog() {\n  console.log = function () {\n    log += '----- Info ----\\n';\n    log += (Array.from(arguments)) + '\\n';\n    consoleLog.apply(console, arguments as any);\n  };\n\n  console.error = function () {\n    log += '----- Error ----\\n';\n    log += (Array.from(arguments)) + '\\n';\n    consoleError.apply(console, arguments as any);\n  };\n}\n\nfunction disableAppLog() {\n  log = '';\n  console.log = consoleLog;\n  console.error = consoleError;\n}\n\nexport default {\n  storeFile: 'Settings.json',\n  fontSizeNorm: 24,\n  fontSizeLarge: 48,\n  getLog,\n  enableAppLog,\n  disableAppLog,\n  cbetardb,\n  apiVersion,\n  cbetaApiUrl,\n  dilaDictApiUrl,\n  twKaiFontKey,\n  twKaiFontPath,\n  axiosInstance,\n  topCatalogsByCat: {\n    \"CBETA\": \"CBETA \",\n    \"Cat-T\": \"\",\n    \"Cat-X\": \"\",\n    \"Cat-N\": \"\",\n    \"others\": \"\",\n    \"modern\": \"\",\n  } as Record<string, string>,\n  topCatalogsByVol: {\n    \"Vol-T\": \"T \",\n    \"Vol-X\": \"X \",\n    \"Vol-A\": \"A \",\n    \"Vol-K\": \"K -\",\n    \"Vol-S\": \"S -\",\n    \"Vol-F\": \"F \",\n    \"Vol-C\": \"C -\",\n    \"Vol-U\": \"U \",\n    \"Vol-P\": \"P \",\n    \"Vol-J\": \"J \",\n    \"Vol-L\": \"L -\",\n    \"Vol-G\": \"G \",\n    \"Vol-M\": \"M -\",\n    \"Vol-D\": \"D \",\n    \"Vol-N\": \"N ()\",\n    \"Vol-ZS\": \"ZS \",\n    \"Vol-I\": \"I \",\n    \"Vol-ZW\": \"ZW \",\n    \"Vol-B\": \"B \",\n    \"Vol-GA\": \"GA \",\n    \"Vol-GB\": \"GB \",\n    \"Vol-Y\": \"Y \",\n    \"Vol-LC\": \"LC \",\n  } as Record<string, string>,\n  fetchErrorContent: (\n    <IonLabel className='contentCenter'>\n      <div>\n        <div>!</div>\n        <div style={{ fontSize: 'var(--ui-font-size)', paddingTop: 24 }}><a href=\"/settings\" target=\"_self\"></a>app</div>\n      </div>\n    </IonLabel>),\n  updateApp: () => {\n    navigator.serviceWorker.getRegistrations().then(regs => {\n      return Promise.all(regs.map(reg => reg.update()));\n    });\n  },\n  scrollbarSizeIdToValue,\n  updateCssVars: (settings: any) => {\n    let scrollbarSize = scrollbarSizeIdToValue(settings.scrollbarSize);\n    document.documentElement.style.cssText = `--ion-font-family: ${settings.useFontKai ? 'Heiti, Times, Kai' : 'Times, Heiti'};\n        --scrollbar-size: ${scrollbarSize}px; --ui-font-size: ${settings.uiFontSize}px; --text-font-size: ${settings.fontSize}px`\n  },\n  isTouchDevice: () => {\n    return isPlatform('ios') || isPlatform('android');\n  },\n  fetchJuan,\n  getFileName,\n  getFileFromIndexedDB,\n  saveFileToIndexedDB,\n  removeFileFromIndexedDB,\n  removeElementsByClassName,\n};\n","import { Work } from \"./Work\";\r\n\r\nexport enum BookmarkType {\r\n    // Don't change the order! Otherwise, it breaks file compatibility!\r\n    CATALOG,\r\n    WORK,\r\n    JUAN,\r\n    HTML,\r\n}\r\n\r\nexport class Bookmark {\r\n    type: BookmarkType = BookmarkType.CATALOG;\r\n    uuid: string = '';\r\n    work: Work | null | undefined = null;\r\n    selectedText: string = '';\r\n    epubcfi: string = '';\r\n    fileName: string = '';\r\n\r\n    constructor(json: Bookmark) {\r\n        this.type = json.type;\r\n        this.uuid = json.uuid;\r\n        this.work = json.work;\r\n        this.selectedText = json.selectedText;\r\n        this.epubcfi = json.epubcfi;\r\n        this.fileName = json.fileName;\r\n    }\r\n}\r\n","import { combineReducers } from \"redux\"\r\n\r\nimport settings from \"./setReducer\"\r\nimport tmpSettings from \"./tmpSetReducer\"\r\n\r\nexport default combineReducers({\r\n  settings, tmpSettings\r\n})\r\n","import Globals from '../../Globals';\nimport { Bookmark, BookmarkType } from '../../models/Bookmark';\n\n// Used to store settings. They will be saved to file.\nexport default function reducer(state = {\n}, action: any) {\n  var newSettings = { ...state } as any;\n  switch (action.type) {\n    case \"SET_KEY_VAL\":\n      var key = action.key;\n      var val = action.val;\n      newSettings[key] = val;\n      localStorage.setItem(Globals.storeFile, JSON.stringify({ settings: newSettings }));\n      break;\n    case \"ADD_BOOKMARK\":\n      const oldBookmarks = newSettings.bookmarks as [Bookmark];\n      let fileName = action.bookmark.fileName;\n      if (fileName !== null && fileName !== '' &&\n        !oldBookmarks.some((bookmark: Bookmark) => bookmark.fileName === fileName)\n      ) {\n        Globals.saveFileToIndexedDB(fileName, action.htmlStr);\n      }\n      newSettings.bookmarks = [...newSettings.bookmarks, action.bookmark];\n      localStorage.setItem(Globals.storeFile, JSON.stringify({ settings: newSettings }));\n      break;\n    case \"DEL_BOOKMARK\":\n      let bookmarksTemp = newSettings.bookmarks as [Bookmark];\n      const idxToDel = bookmarksTemp.findIndex((b) => { return b.uuid === action.uuid });\n      if (idxToDel !== -1) {\n        let deletedBookmarks = bookmarksTemp.splice(idxToDel, 1);\n\n        if (deletedBookmarks.length === 1) {\n          // Remove the HTML file from localStorage if all its bookmarks are deleted.\n          const deletedBookmark = deletedBookmarks[0];\n          let fileName = deletedBookmark.fileName;\n          let noJuanBookmarkUseTheFile = bookmarksTemp.find((b) => b.type === BookmarkType.JUAN && b.uuid === deletedBookmark.uuid) == null;\n          let noWorkBookmarkUseTheFile = bookmarksTemp.find((b) => b.type === BookmarkType.WORK && b.work?.work === deletedBookmark.work?.work) == null;\n          if (noWorkBookmarkUseTheFile) {\n            switch (deletedBookmark.type) {\n              case BookmarkType.WORK:\n                const work = deletedBookmark.work!;\n                // For back compatibility.\n                if (work == null) {\n                  break;\n                }\n                const juans = work.juan_list.split(',');\n                for (let i = 0; i < juans.length; i++) {\n                  const fileName = Globals.getFileName(work.work, juans[i]);\n                  noJuanBookmarkUseTheFile = bookmarksTemp.find((b) => b.type === BookmarkType.JUAN && b.fileName === fileName) == null;\n                  if (noJuanBookmarkUseTheFile) {\n                    Globals.removeFileFromIndexedDB(fileName);\n                  }\n                }\n                break;\n              case BookmarkType.JUAN:\n                if (noJuanBookmarkUseTheFile)\n                  Globals.removeFileFromIndexedDB(fileName);\n                break;\n            }\n          }\n        }\n      }\n      newSettings.bookmarks = [...bookmarksTemp];\n      localStorage.setItem(Globals.storeFile, JSON.stringify({ settings: newSettings }));\n      break;\n    case \"UPDATE_BOOKMARKS\": {\n      newSettings.bookmarks = action.bookmarks;\n      localStorage.setItem(Globals.storeFile, JSON.stringify({ settings: newSettings }));\n      break;\n    }\n    default:\n      if (Object.keys(newSettings).length === 0) {\n        newSettings = {};\n      }\n      // Setting default values.\n      var keys = ['topCatalogsType', 'hasAppLog', 'theme', 'paginated', 'rtlVerticalLayout', 'scrollbarSize', 'useFontKai', 'fontSize', 'uiFontSize', 'showComments', 'speechRate', 'bookmarks'];\n      var vals = [0, 1, 0, 1, 1, 2, 1, 32, 24, 0, 0.8, []];\n      for (let k = 0; k < keys.length; k++) {\n        if (newSettings[keys[k]] === undefined) {\n          newSettings[keys[k]] = vals[k];\n        }\n      }\n  }\n  return newSettings;\n}\n","// Used to store temp settings in RAM. They will not be saved to file.\r\nexport default function reducer(state = {\r\n}, action: any) {\r\n  var newState = { ...state } as any;\r\n  var key = action.key;\r\n  var val = action.val;\r\n  newState[key] = val;\r\n  switch (action.type) {\r\n    case \"TMP_SET_KEY_VAL\": {\r\n      return newState;\r\n    }\r\n    default:\r\n      break;\r\n  }\r\n  return state;\r\n}\r\n","//import * as fs from 'fs';\nimport React from 'react';\nimport { IonContent, IonHeader, IonPage, IonTitle, IonToolbar, IonButton, withIonLifeCycle, IonIcon, IonAlert, IonPopover, IonList, IonItem, IonLabel, IonRange, IonFab, IonFabButton, IonToast, IonLoading } from '@ionic/react';\nimport { RouteComponentProps } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport * as uuid from 'uuid';\nimport queryString from 'query-string';\nimport './EPubViewPage.css';\nimport Globals from '../Globals';\nimport { bookmark, arrowBack, home, search, ellipsisHorizontal, ellipsisVertical, arrowForward, musicalNotes, stopCircle, book, shareSocial } from 'ionicons/icons';\nimport { Bookmark, BookmarkType } from '../models/Bookmark';\nimport { Work } from '../models/Work';\nimport SearchAlert from '../components/SearchAlert';\nimport ePub, { Book, Rendition, EVENTS } from 'epubjs-myh';\nimport * as nodepub from 'nodepub';\n\ninterface Props {\n  dispatch: Function;\n  bookmarks: [Bookmark];\n  fontSize: number;\n  scrollbarSize: number;\n  settings: any;\n  showComments: boolean;\n  paginated: Boolean;\n  rtlVerticalLayout: boolean;\n  useFontKai: boolean;\n  speechRate: number;\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n  tab: string;\n  work: string;\n  path: string;\n  label: string;\n}> { }\n\nenum SpeechState {\n  UNINITIAL,\n  SPEAKING,\n  PAUSE\n}\n\ninterface State {\n  isLoading: boolean;\n  fetchError: boolean;\n  workInfo: Work;\n  htmlStr: string | null;\n  currentPage: number;\n  pageCount: number;\n  showJumpPageAlert: boolean;\n  showNoSelectedTextAlert: boolean;\n  showAddBookmarkSuccess: boolean;\n  showsCopyToClipboardSuccess: boolean;\n  showsCitationFail: boolean;\n  showSearchAlert: boolean;\n  popover: any;\n  lookupDictPopover: any;\n  speechState: SpeechState;\n}\n\nclass _EPubViewPage extends React.Component<PageProps, State> {\n  htmlFile: string;\n  htmlTitle: string;\n  book: Book | null;\n  rendition: Rendition | null;\n  epub: any;\n  displayed: any;\n  cfiRange: string;\n  speechSynthesisUtterance: SpeechSynthesisUtterance;\n\n  constructor(props: any) {\n    super(props);\n    this.state = {\n      isLoading: true,\n      fetchError: false,\n      workInfo: new Work({}),\n      htmlStr: null,\n      currentPage: 1,\n      pageCount: 1,\n      showJumpPageAlert: false,\n      showNoSelectedTextAlert: false,\n      showAddBookmarkSuccess: false,\n      showsCopyToClipboardSuccess: false,\n      showsCitationFail: false,\n      showSearchAlert: false,\n      popover: {\n        show: false,\n        event: null,\n      },\n      lookupDictPopover: {\n        show: false,\n        data: [],\n      },\n      speechState: SpeechState.UNINITIAL,\n    }\n    this.htmlFile = '';\n    this.htmlTitle = '';\n    this.book = null;\n    this.rendition = null;\n    this.cfiRange = '';\n    this.speechSynthesisUtterance = new SpeechSynthesisUtterance();\n    this.speechSynthesisUtterance.lang = 'zh-TW';\n    this.speechSynthesisUtterance.onend = (ev: SpeechSynthesisEvent) => {\n      if (this.state.speechState === SpeechState.UNINITIAL) {\n        return;\n      }\n\n      if (this.workTextsIndex < this.workTexts.length - 1) {\n        this.workTextsIndex += 1;\n        this.speechSynthesisUtterance.text = this.workTexts[this.workTextsIndex];\n        speechSynthesis.speak(this.speechSynthesisUtterance);\n        console.log(`Play work text to speech part: ${this.workTextsIndex}`);\n      } else {\n        this.setState({ speechState: SpeechState.UNINITIAL });\n        console.log(`Stop work text to speech.`);\n      }\n    };\n    document.addEventListener(\"keyup\", this.keyListener.bind(this), false);\n  }\n\n  async loadEpubCoverToMemFs() {\n    let logoArray = new Uint8Array(JSON.parse(localStorage.getItem('logo.png') || '[]'));\n\n    if (logoArray.length === 0) {\n      // Download book logo.\n      const res = await Globals.axiosInstance.get(`${window.location.origin}/assets/icon/icon.png`, {\n        responseType: 'arraybuffer',\n      });\n      logoArray = new Uint8Array(res.data);\n      let logoStr = JSON.stringify(Array.from(logoArray));\n      localStorage.setItem('logo.png', logoStr);\n    }\n    let fs = require('fs');\n    fs.writeFileSync('logo.png', logoArray);\n  }\n\n  uuidStr = '';\n  epubcfiFromUrl = '';\n  ionViewWillEnter() {\n    this.setState({ isLoading: true });\n    let queryParams = queryString.parse(this.props.location.search) as any;\n    this.htmlFile = queryParams.file;\n    this.htmlTitle = queryParams.title;\n    this.epubcfiFromUrl = queryParams.bookmark || '';\n    let state = this.props.location.state as any;\n    this.uuidStr = state ? state.uuid : '';\n    //console.log( 'view will enter' );\n    this.fetchData();\n  }\n\n  ionViewDidEnter() {\n  }\n\n  get fileName() {\n    return Globals.getFileName(\n      this.props.match.params.work,\n      this.props.match.params.path\n    );\n  }\n\n  async fetchData() {\n    try {\n      const res = await Globals.fetchJuan(\n        this.props.match.params.work,\n        this.props.match.params.path,\n        this.htmlFile,\n      );\n\n      await this.loadEpubCoverToMemFs();\n\n      this.setState({ workInfo: res.workInfo, htmlStr: res.htmlStr });\n    } catch (e) {\n      console.error(e);\n      this.setState({ isLoading: false, fetchError: true });\n    }\n  }\n\n  epubcfiFromSelectedString = '';\n  addBookmarkHandler() {\n    const selectedText = this.getSelectedString();\n    if (selectedText === '') {\n      this.setState({ showNoSelectedTextAlert: true });\n      return;\n    }\n\n    let uuidStr = uuid.v4();\n    this.props.dispatch({\n      type: \"ADD_BOOKMARK\",\n      // IMPORTANT!!! Don't arbitrarily change the HTML structure of htmlStr.\n      // Otherwise, saved epubcfi bookmarks will become invalid!\n      htmlStr: this.state.htmlStr,\n      bookmark: new Bookmark({\n        type: this.htmlFile ? BookmarkType.HTML : BookmarkType.JUAN,\n        uuid: uuidStr,\n        selectedText: selectedText,\n        epubcfi: this.epubcfiFromSelectedString,\n        fileName: this.htmlFile || `${this.props.match.params.work}_juan${this.props.match.params.path}.html`,\n        work: Object.assign(this.state.workInfo, {\n          title: this.htmlFile ? this.htmlTitle : this.state.workInfo.title,\n          juan: this.props.match.params.path,}\n          ),\n      }),\n    });\n    this.setState({ showAddBookmarkSuccess: true });\n    return;\n  }\n\n  get isTopPage() {\n    return this.props.match.url === '/catalog';\n  }\n\n  get bookmark() {\n    return this.props.bookmarks.find(\n      (e) => e.type === BookmarkType.JUAN && e.uuid === this.uuidStr);\n  }\n\n  get hasBookmark() {\n    return this.epubcfiFromUrl !== '' || this.bookmark != null;\n  }\n\n  get epubcfi() {\n    return this.epubcfiFromUrl !== '' ? this.epubcfiFromUrl : this.bookmark != null ? this.bookmark!.epubcfi : 'epubcfi(/6/6[s1]!/4/4/2/6[body]/6,/1:0,/1:1)';\n  }\n\n  ionViewWillLeave() {\n    speechSynthesis.cancel();\n    this.setState({ htmlStr: null, currentPage: 1, speechState: SpeechState.UNINITIAL });\n    this.book?.destroy();\n    this.book = null;\n    this.bookCreated = false;\n  }\n\n  pagePrev(n: number = 1) {\n    if (this.props.paginated && this.state.currentPage > 1) {\n      this.rendition?.prev(n);\n      this.setState({ currentPage: this.state.currentPage - n });\n    }\n  }\n\n  pageNext(n: number = 1) {\n    if (this.props.paginated && this.state.currentPage < this.state.pageCount) {\n      this.rendition?.next(n);\n      this.setState({ currentPage: this.state.currentPage + n });\n    }\n  }\n\n  jumpToPage(page: number) {\n    if (page === 0) {\n      return;\n    }\n    page = isNaN(page) ? 1 : Math.max(Math.min(this.state.pageCount, page), 1);\n    const currentPage = this.state.currentPage;\n    let step = currentPage < page ? 1 : -1;\n    let diff = Math.abs(page - currentPage);\n    if (step === 1) {\n      this.pageNext(diff);\n    } else {\n      this.pagePrev(diff);\n    }\n  }\n\n  keyListener(e: KeyboardEvent) {\n    let key = e.keyCode || e.which;\n\n    console.log(e.type)\n\n    // Left/down Key\n    if (key === (this.props.rtlVerticalLayout ? 37 : 40)) {\n      this.pageNext()\n    }\n\n    // Right/top Key\n    if (key === (this.props.rtlVerticalLayout ? 39 : 38)) {\n      this.pagePrev();\n    }\n  };\n\n  bookCreated = false;\n  ePubIframe: HTMLIFrameElement | null = null;\n  async html2Epub() {\n    this.bookCreated = true;\n    this.epub = nodepub.document({\n      id: '123-123456789',\n      title: 'Title',\n      series: '',\n      sequence: 1,\n      author: 'Author',\n      fileAs: '',\n      genre: 'genre',\n      tags: '',\n      copyright: '',\n      publisher: '',\n      published: '',\n      language: 'en',\n      description: 'A temp book.',\n      contents: this.state.workInfo.title,\n      source: '',\n      images: ['logo.png'],\n    }, 'logo.png');\n\n    let htmlStrModifiedStyles = this.state.htmlStr!;\n    if (this.props.rtlVerticalLayout) {\n      htmlStrModifiedStyles = htmlStrModifiedStyles.replace(/margin-left/g, 'margin-top');\n    }\n    /* else {\n      htmlStrModifiedStyles = htmlStrModifiedStyles.replace(/margin-top/g, 'margin-left');\n    }*/\n\n    const htmlStrWithCssJs = htmlStrModifiedStyles + `\n    <script>\n    async function loadTwKaiFont() {\n      const dbOpenReq = indexedDB.open('${Globals.cbetardb}');\n      dbOpenReq.onupgradeneeded = function (event) {\n        var db = event.target.result;\n        db.createObjectStore('store');\n      };\n  \n      let fontData;\n      await new Promise(function(ok, fail) {\n        dbOpenReq.onsuccess = async function (ev) {\n          const db = dbOpenReq.result;\n  \n          const trans = db.transaction([\"store\"], 'readwrite');\n          let req = trans.objectStore('store').get('${Globals.twKaiFontKey}');\n          req.onsuccess = async function (_ev) {\n            fontData = req.result;\n            if (!fontData) {\n              console.error('[iframe] TW-Kai font loading failed!');\n              return ok();\n            }\n            console.log('[iframe] TW-Kai font loading success!');\n            return ok();\n          };\n        };\n      });\n      const fontFace = new window.FontFace('Kai', fontData);\n      await fontFace.load();\n      document.fonts.add(fontFace);\n    }\n    loadTwKaiFont();\n    </script>\n    `;\n\n    this.epub.addSection('', htmlStrWithCssJs, true, false);\n\n    let rtlVerticalStyles = `\n    html {\n      writing-mode: vertical-rl;\n      direction: ltr;\n    }\n    `;\n\n    this.epub.addCSS(`\n    html {\n      background: ${getComputedStyle(document.body).getPropertyValue('--ion-background-color')};\n      /*\n      Because different fonts have different line heights with 'line-height: normal,'\n      the content size of epubjs iframe changes after the fallback font is swapped with the web font.\n      Unfortunately, epubjs can't detect the size change and update the iframe.\n      This problem causes the total page count is incorrect.\n      Fortunately, we can set the line height based on the same font size as below.\n      */\n      line-height: 1.2;\n    }\n\n    @font-face {\n        font-family: 'Times';\n        src: local('Times New Roman');\n        unicode-range: U+0-007F;\n    }\n\n    /* Workaround parenthesis orientation problem of TW-Kai-98_1 on iOS Safari. */\n    @font-face {\n        font-family: 'Heiti';\n        src: local('Heiti TC');\n        unicode-range: U+3008-301B, U+FF01-FF60;\n    }\n\n    .lb {\n      display: none\n    }\n\n    /* In-HTML anchor jumps don't update this.state.currentPage.\n    Thus, we disable thems. */\n    .noteAnchor {\n      pointer-events: none;\n      text-decoration: inherit;\n      color: inherit;\n      cursor: auto;\n    }\n\n    .doube-line-note, .doube-line-note .t {\n      font-size: ${this.props.fontSize * 0.8}px;\n    }\n\n    .doube-line-note::before {\n      content: \"\";\n    }\n\n    .doube-line-note::after {\n      content: \"\";\n    }\n\n    .bip-table {\n      display: table;\n    }\n\n    .bip-table-row {\n      display: table-row;\n    }\n\n    .bip-table-cell {\n      display: table-cell;\n      border: 1px solid ${getComputedStyle(document.body).getPropertyValue('--ion-text-color')};\n      text-align: center;\n    }\n  \n    ${this.props.rtlVerticalLayout ? rtlVerticalStyles : ''}\n\n    .t, p, div {\n      color: ${getComputedStyle(document.body).getPropertyValue('--ion-text-color')};\n      font-family: ${getComputedStyle(document.body).getPropertyValue('--ion-font-family')};\n      font-size: ${this.props.fontSize}px;\n    }\n    \n    /* Disable this to workaround epubjs page counting problem.\n    #back, #cbeta-copyright {\n      display: ${this.props.showComments ? \"block\" : \"none\"};\n    }*/\n    `);\n    //await new Promise((ok, fail) => {\n    this.epub.writeEPUB(\n      (e: any) => {\n        console.log(`Error: ${e}`);\n      },\n      '.', 'temp',\n      async () => {\n        let fs = require('fs');\n        let tempEpubBuffer = fs.readFileSync('temp.epub');\n        this.book = ePub(tempEpubBuffer.buffer, {\n          openAs: 'binary',\n        });\n        this.rendition = this.book.renderTo('cbetarEPubView', {\n          width: \"100%\", height: \"100%\",\n          spread: 'none',\n          flow: this.props.paginated ? 'paginated' : 'scrolled',\n          scrollbarWidth: Globals.scrollbarSizeIdToValue(this.props.scrollbarSize),\n          defaultDirection: this.props.rtlVerticalLayout ? 'rtl' : 'ltr',\n        });\n        //this.rendition.on(\"keyup\", this.keyListener.bind(this));\n\n        this.rendition.on(\"selected\", (cfiRange: any, contents: any) => {\n          this.epubcfiFromSelectedString = cfiRange;\n          /*\n          this.rendition?.annotations.highlight(cfiRange, {}, (e: any) => {\n            console.log(\"highlight clicked\", e.target);\n          });*/\n          //contents.window.getSelection().removeAllRanges();\n        });\n\n        this.rendition.on(EVENTS.RENDITION.DISPLAYED, () => {\n          this.updatePageInfos();\n        });\n\n        await this.rendition.display(this.props.paginated ? this.epubcfi : undefined);\n        // Navigate to the first work page.\n        if (!this.props.paginated) {\n          // Skip cover page.\n          await this.rendition?.next();\n          // Skip TOC page.\n          await this.rendition?.next();\n        }\n        this.setState({ isLoading: false });\n\n        if (this.hasBookmark) {\n          try {\n            this.rendition?.annotations.highlight(this.epubcfi);\n          } catch (e) {\n            console.error(e);\n          }\n        }\n\n        this.book?.locations.generate(150);\n\n        const iframes = document.getElementsByTagName('iframe');\n        if (iframes.length === 1) {\n          this.ePubIframe = iframes[0];\n          this.ePubIframe.contentDocument?.addEventListener(\"keyup\", this.keyListener.bind(this), false);\n        } else {\n          alert('Error! This component locates ePub iframe by the only iframe.');\n        }\n      }\n    );\n  }\n\n  updatePageInfos() {\n    const displayed = (this.rendition?.currentLocation() as any).start.displayed;\n    this.setState({ currentPage: displayed.page, pageCount: displayed.total });\n  }\n\n  getSelectedString() {\n    let selectedText = '';\n    const sel = this.ePubIframe?.contentDocument?.getSelection();\n    if ((sel?.rangeCount || 0) > 0 && sel!.getRangeAt(0).toString().length > 0) {\n      selectedText = sel!.toString();\n      sel?.removeAllRanges();\n    }\n    return selectedText;\n  }\n\n  getRemainingWorkTextFromSelectedRange() {\n    let selection = this.ePubIframe!.contentWindow!.getSelection();\n    let remainingWorkText;\n\n    if (selection!.type === 'Range') {\n      const back = this.ePubIframe!.contentDocument!.getElementById('back')!;\n      let s = selection!.getRangeAt(0);\n      // Get a range from selected texts to end of id='body' (start of id='back').\n      s.setEnd(back, 0);\n      // Get document fragment containing the range.\n      let docFragment = s.cloneContents();\n      selection?.removeAllRanges();\n\n      // For manipulate content of docFragment laterly.\n      let doc = new Document();\n      let docHtml = doc.createElement('html')\n      doc.appendChild(docHtml);\n      docHtml.appendChild(docFragment);\n\n      // Remove texts being not part of speech including line number and note texts in work texts.\n      Globals.removeElementsByClassName(doc, 'lb');\n      Globals.removeElementsByClassName(doc, 'doube-line-note');\n      remainingWorkText = doc.getElementById('body')!.innerText;\n    }\n\n    return remainingWorkText;\n  }\n\n  // There is a max characters per utterance limit on Android Chrome.\n  // This max value is obtained by try and error.\n  maxCharsPerUtterance = 1000;\n  workTexts: Array<string> = [];\n  workTextsIndex = 0;\n  render() {\n    let epubjsScrollRtlModeVerticalScrollbarBugWokaroundCss = `\n    <style>\n    .epub-view {\n      height: 100% !important;\n    }\n    </style>\n    `;\n\n    let header = (\n      <IonHeader>\n        <IonToolbar>\n          <IonTitle style={{ fontSize: 'var(--ui-font-size)' }}></IonTitle>\n\n          <IonButton hidden={this.isTopPage} fill=\"clear\" slot='start' onClick={e => this.props.history.goBack()}>\n            <IonIcon icon={arrowBack} slot='icon-only' />\n          </IonButton>\n\n          <IonButton slot='end' onClick={ev => {\n            this.setState({ showJumpPageAlert: true });\n          }}>\n            <span className='uiFont' style={{ color: 'var(--color)' }}>{this.state.currentPage}/{this.state.pageCount}</span>\n          </IonButton>\n\n          <IonButton fill=\"clear\" slot='end' onClick={e => {\n            const voices = speechSynthesis.getVoices();\n            if (voices.length === 0) {\n              return;\n            }\n\n            switch (this.state.speechState) {\n              case SpeechState.UNINITIAL:\n                const zhTwVoice = voices.find((voice: SpeechSynthesisVoice) => {\n                  return voice.lang.indexOf('zh-TW') > -1 || voice.lang.indexOf('zh_TW') > -1\n                })\n                if (zhTwVoice !== undefined) {\n                  this.speechSynthesisUtterance.voice = zhTwVoice;\n                }\n\n                const remainingWorkText = this.getRemainingWorkTextFromSelectedRange();\n                const workText = remainingWorkText || this.ePubIframe?.contentDocument?.getElementById('body')?.innerText || '';\n\n                this.workTexts = [];\n                for (let i = 0; i < Math.ceil(workText.length / this.maxCharsPerUtterance); i++) {\n                  this.workTexts.push(workText.substring(i * this.maxCharsPerUtterance, (i + 1) * this.maxCharsPerUtterance));\n                }\n\n                this.workTextsIndex = 0;\n                this.speechSynthesisUtterance.text = this.workTexts[this.workTextsIndex];\n                this.speechSynthesisUtterance.rate = this.props.speechRate;\n                // Improve reliability by cancel first.\n                speechSynthesis.cancel();\n                speechSynthesis.speak(this.speechSynthesisUtterance);\n                this.setState({ speechState: SpeechState.SPEAKING });\n                break;\n              case SpeechState.SPEAKING:\n                // Unfortunately, pause() doesn't work on most Chrome browser.\n                // Instead, we support stop.\n                /*\n                speechSynthesis.pause();\n                this.setState({speechState: SpeechState.PAUSE});\n                */\n                speechSynthesis.cancel();\n                this.setState({ speechState: SpeechState.UNINITIAL });\n                break;\n              case SpeechState.PAUSE:\n                speechSynthesis.resume();\n                this.setState({ speechState: SpeechState.SPEAKING });\n                break;\n            }\n          }}>\n            <IonIcon icon={this.state.speechState === SpeechState.SPEAKING ? stopCircle : musicalNotes} slot='icon-only' />\n          </IonButton>\n\n          <IonButton fill=\"clear\" slot='end' onClick={e => this.setState({ popover: { show: true, event: e.nativeEvent } })}>\n            <IonIcon ios={ellipsisHorizontal} md={ellipsisVertical} slot='icon-only' />\n          </IonButton>\n\n          <IonPopover\n            isOpen={this.state.popover.show}\n            event={this.state.popover.event}\n            onDidDismiss={e => { this.setState({ popover: { show: false, event: null } }) }}\n          >\n            <IonList>\n              <IonItem button onClick={e => {\n                this.props.history.push(`/${this.props.match.params.tab}`);\n                this.setState({ popover: { show: false, event: null } });\n              }}>\n                <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                <IonIcon icon={home} slot='start' />\n                <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }}></IonLabel>\n              </IonItem>\n              <IonItem button onClick={e => {\n                this.setState({ popover: { show: false, event: null } });\n                this.setState({ showSearchAlert: true });\n              }}>\n                <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                <IonIcon icon={search} slot='start' />\n                <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }}></IonLabel>\n              </IonItem>\n              <IonItem>\n                <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                <IonIcon icon={book} slot='start' />\n                <div style={{ width: '100%' }}>\n                  <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }}>(%)</IonLabel>\n                  <IonRange min={0} max={100} step={10} snaps pin onIonChange={e => {\n                    let percent = e.detail.value as number;\n                    let ratio = percent / 100 + '';\n                    ratio = (ratio === '0' || ratio === '1') ? `${ratio}.0` : ratio;\n                    this.rendition?.display(ratio);\n                  }} />\n                </div>\n              </IonItem>\n\n              <IonItem button onClick={e => {\n                this.setState({ popover: { show: false, event: null } });\n                this.addBookmarkHandler();\n              }}>\n                <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                <IonIcon icon={bookmark} slot='start' />\n                <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }}></IonLabel>\n              </IonItem>\n\n              <IonItem button onClick={e => {\n                this.setState({ popover: { show: false, event: null } });\n                const selectedText = this.getSelectedString();\n                if (selectedText === '') {\n                  this.setState({ showNoSelectedTextAlert: true });\n                  return;\n                }\n\n                this.props.history.push({\n                  pathname: `/dictionary/search/${selectedText}`,\n                });\n              }}>\n                <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                <IonIcon icon={book} slot='start' />\n                <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }}></IonLabel>\n              </IonItem>\n\n              <IonItem button onClick={e => {\n                this.setState({ popover: { show: false, event: null } });\n                const selectedText = this.getSelectedString();\n                if (selectedText === '') {\n                  this.setState({ showNoSelectedTextAlert: true });\n                  return;\n                }\n\n                this.props.history.push({\n                  pathname: `/dictionary/searchWord/${selectedText}`,\n                });\n              }}>\n                <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                <IonIcon icon={book} slot='start' />\n                <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }}></IonLabel>\n              </IonItem>\n\n              <IonItem button onClick={ev => {\n                let sharedUrl = window.location.href.split('?')[0];\n                const selectedText = this.getSelectedString();\n                if (selectedText !== '') {\n                  sharedUrl += `?bookmark=${this.epubcfiFromSelectedString}`;\n                }\n\n                this.props.dispatch({\n                  type: \"TMP_SET_KEY_VAL\",\n                  key: 'shareTextModal',\n                  val: {\n                    show: true,\n                    text: decodeURIComponent(sharedUrl),\n                  },\n                });\n              }}>\n                <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                <IonIcon icon={shareSocial} slot='start' />\n                <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }}></IonLabel>\n              </IonItem>\n\n              <IonItem button onClick={ev => {\n                this.setState({ popover: { show: false, event: null } });\n                const sel = this.ePubIframe?.contentDocument?.getSelection()!;\n                if ((sel.rangeCount || 0) > 0 && sel.getRangeAt(0).toString().length > 0) {\n                  const selectedText = sel!.toString();\n                  const range = sel.getRangeAt(0);\n                  let startLine = range.startContainer.parentElement?.getAttribute('l');\n                  let endLine = range.endContainer.parentElement?.getAttribute('l');\n                  sel?.removeAllRanges();\n                  if (startLine == null || endLine == null) {\n                    this.setState({ showsCitationFail: true });\n                    return;\n                  }\n                  startLine = /0*(.*)/.exec(startLine!)![1];\n                  endLine = /0*(.*)/.exec(endLine!)![1];\n\n                  let lineInfo = `${startLine}`;\n                  if (startLine !== endLine) {\n                    lineInfo += `-${/.*a(.*)/.exec(endLine)![1]}`;\n                  }\n                  const citation =`${this.state.workInfo.title}${this.props.match.params.path}${selectedText}(CBETA, ${this.state.workInfo.vol}, no. ${/[^0-9]*(.*)/.exec(this.state.workInfo.work)![1]}, p. ${lineInfo})`;\n                  navigator.clipboard && navigator.clipboard.writeText(citation);\n                  this.setState({ showsCopyToClipboardSuccess: true });\n                } else {\n                  this.setState({ showNoSelectedTextAlert: true });\n                }\n              }}>\n                <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                <IonIcon icon={shareSocial} slot='start' />\n                <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }}></IonLabel>\n              </IonItem>\n            </IonList>\n          </IonPopover>\n        </IonToolbar>\n      </IonHeader>\n    );\n\n    const fabButtonOpacity = 0.2;\n    let navButtons = (<>\n      <IonFab vertical='center' horizontal='start' slot='fixed'>\n        <IonFabButton style={{ opacity: fabButtonOpacity }} onClick={e => this.props.rtlVerticalLayout ? this.pageNext() : this.pagePrev()}\n          onTouchStart={e => {\n            e.currentTarget.style.setProperty('opacity', '1');\n          }}\n          onMouseOver={e => {\n            // Disable mouse events for iOS. Because a touch stat gesture can trigger onMouseOver, but a touch-end gesture can't trigger onMouseLeave.\n            if (Globals.isTouchDevice()) {\n              return;\n            }\n            e.currentTarget.style.setProperty('opacity', '1');\n          }}\n          onTouchEnd={e => {\n            e.currentTarget.style.setProperty('opacity', `${fabButtonOpacity}`);\n          }}\n          onMouseLeave={e => {\n            if (Globals.isTouchDevice()) {\n              return;\n            }\n            e.currentTarget.style.setProperty('opacity', `${fabButtonOpacity}`);\n          }}>\n          <IonIcon icon={arrowBack} />\n        </IonFabButton>\n      </IonFab>\n      <IonFab vertical='center' horizontal='end' slot='fixed'>\n        <IonFabButton style={{ opacity: fabButtonOpacity }} onClick={e => this.props.rtlVerticalLayout ? this.pagePrev() : this.pageNext()} onTouchStart={e => {\n          e.currentTarget.style.setProperty('opacity', '1');\n        }}\n          onMouseOver={e => {\n            if (Globals.isTouchDevice()) {\n              return;\n            }\n            e.currentTarget.style.setProperty('opacity', '1');\n          }}\n          onTouchEnd={e => {\n            e.currentTarget.style.setProperty('opacity', `${fabButtonOpacity}`);\n          }}\n          onMouseLeave={e => {\n            if (Globals.isTouchDevice()) {\n              return;\n            }\n            e.currentTarget.style.setProperty('opacity', `${fabButtonOpacity}`);\n          }}>\n          <IonIcon icon={arrowForward} />\n        </IonFabButton>\n      </IonFab>\n    </>);\n\n    if (!this.bookCreated && this.state.htmlStr != null) {\n      this.html2Epub();\n    }\n\n    return (\n      <IonPage>\n        {header}\n        <IonContent>\n          {this.props.paginated ? navButtons : <></>}\n\n          <IonLoading\n            cssClass='uiFont'\n            isOpen={this.state.isLoading}\n            onDidDismiss={() => this.setState({ isLoading: false })}\n            message={'...'}\n          />\n\n          {this.state.fetchError ? Globals.fetchErrorContent : <></>}\n\n          <div id='cbetarEPubView' style={{ width: '100%', height: '100%', userSelect: \"text\", WebkitUserSelect: \"text\" }} dangerouslySetInnerHTML={{\n            __html: `\n            ${this.props.rtlVerticalLayout && !this.props.paginated ? epubjsScrollRtlModeVerticalScrollbarBugWokaroundCss : ''}\n            `\n          }}>\n          </div>\n\n          <IonAlert\n            cssClass='uiFont'\n            isOpen={this.state.showJumpPageAlert}\n            header={''}\n            subHeader=''\n            inputs={\n              Array(this.state.pageCount).fill(0).map((v, i) => {\n                return {\n                  name: `radio${i + 1}`,\n                  type: 'radio',\n                  label: `${i + 1}`,\n                  value: `${i + 1}`,\n                  checked: this.state.currentPage === (i + 1)\n                };\n              }\n              )\n            }\n            buttons={[\n              {\n                text: '',\n                role: 'cancel',\n                cssClass: 'secondary uiFont',\n                handler: () => this.setState({ showJumpPageAlert: false }),\n              },\n              {\n                text: '',\n                cssClass: 'primary uiFont',\n                handler: (value) => {\n                  this.setState({ showJumpPageAlert: false });\n                  this.jumpToPage(+value);\n                },\n              }\n            ]}\n          />\n\n          <SearchAlert\n            {...{\n              showSearchAlert: (this.state as any).showSearchAlert,\n              finish: () => { this.setState({ showSearchAlert: false }) }, ...this.props\n            }}\n          />\n\n          <IonAlert\n            cssClass='uiFont'\n            isOpen={this.state.showNoSelectedTextAlert}\n            backdropDismiss={false}\n            header=''\n            message='!'\n            buttons={[\n              {\n                text: '',\n                cssClass: 'primary uiFont',\n                handler: (value) => {\n                  this.setState({\n                    showNoSelectedTextAlert: false,\n                  });\n                },\n              }\n            ]}\n          />\n\n          <IonToast\n            cssClass='uiFont'\n            isOpen={this.state.showAddBookmarkSuccess}\n            onDidDismiss={() => this.setState({ showAddBookmarkSuccess: false })}\n            message=\"\"\n            duration={2000}\n          />\n\n          <IonToast\n            cssClass='uiFont'\n            isOpen={this.state.showsCopyToClipboardSuccess}\n            onDidDismiss={() => this.setState({ showsCopyToClipboardSuccess: false })}\n            message=\"\"\n            duration={2000}\n          />\n\n          <IonToast\n            cssClass='uiFont'\n            isOpen={this.state.showsCitationFail}\n            onDidDismiss={() => this.setState({ showsCitationFail: false })}\n            message=\"\"\n            duration={2000}\n          />\n        </IonContent>\n      </IonPage>\n    );\n  }\n};\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n    bookmarks: state.settings.bookmarks,\n    fontSize: state.settings.fontSize,\n    showComments: state.settings.showComments,\n    paginated: state.settings.paginated,\n    rtlVerticalLayout: state.settings.rtlVerticalLayout,\n    settings: state.settings,\n    scrollbarSize: state.settings.scrollbarSize,\n    speechRate: state.settings.speechRate,\n  }\n};\n\nconst EPubViewPage = withIonLifeCycle(_EPubViewPage);\n\nexport default connect(\n  mapStateToProps,\n)(EPubViewPage);\n","export class Catalog {\r\n    n: string;\r\n    nodeType: string | null | undefined;\r\n    label: string;\r\n    work: string | null | undefined;\r\n    file: string | null | undefined;\r\n\r\n    constructor(json: any) {\r\n        this.n = json.n;\r\n        this.nodeType = json.node_type;\r\n        this.label = json.label;\r\n        this.work = json.work;\r\n        this.file = json.file;\r\n    }\r\n}\r\n","import React from 'react';\r\nimport { IonAlert } from '@ionic/react';\r\nimport { RouteComponentProps } from 'react-router-dom';\r\n\r\ninterface Props {\r\n  showSearchAlert: boolean;\r\n  finish: Function;\r\n}\r\n\r\ninterface PageProps extends Props, RouteComponentProps<{\r\n  tab: string;\r\n  path: string;\r\n  label: string;\r\n}> { }\r\n\r\nclass SearchAlert extends React.Component<PageProps> {\r\n  /*constructor(props: any) {\r\n    super(props);\r\n  }*/\r\n\r\n  render() {\r\n    return (\r\n      <IonAlert\r\n        cssClass='uiFont'\r\n        isOpen={this.props.showSearchAlert}\r\n        header={''}\r\n        subHeader=''\r\n        inputs={[\r\n          {\r\n            name: 'name0',\r\n            type: 'search',\r\n            placeholder: ':'\r\n          },\r\n        ]}\r\n        buttons={[\r\n          {\r\n            text: '',\r\n            role: 'cancel',\r\n            cssClass: 'secondary uiFont',\r\n            handler: () => this.props.finish(),\r\n          },\r\n          {\r\n            text: '',\r\n            cssClass: 'primary uiFont',\r\n            handler: (value) => {\r\n              this.props.finish();\r\n              this.props.history.push(`/catalog/search/${value.name0}`);\r\n            },\r\n          },\r\n          {\r\n            text: '',\r\n            cssClass: 'primary uiFont',\r\n            handler: (value) => {\r\n              this.props.finish();\r\n              this.props.history.push(`/catalog/fulltextsearch/${value.name0}`);\r\n            },\r\n          }\r\n        ]}\r\n      />\r\n    );\r\n  }\r\n};\r\n\r\nexport default SearchAlert;\r\n","import React from 'react';\r\nimport { IonContent, IonHeader, IonPage, IonTitle, IonToolbar, IonList, IonItem, IonLabel, IonButton, IonIcon, withIonLifeCycle } from '@ionic/react';\r\nimport { RouteComponentProps } from 'react-router-dom';\r\nimport { connect } from 'react-redux';\r\nimport './CatalogPage.css';\r\nimport { Catalog } from '../models/Catalog';\r\nimport Globals from '../Globals';\r\nimport { Bookmark, BookmarkType } from '../models/Bookmark';\r\nimport { bookmark, arrowBack, home, search, shareSocial } from 'ionicons/icons';\r\nimport SearchAlert from '../components/SearchAlert';\r\nimport queryString from 'query-string';\r\n\r\ninterface Props {\r\n  dispatch: Function;\r\n  bookmarks: [Bookmark];\r\n  topCatalogsType: number;\r\n}\r\n\r\ninterface PageProps extends Props, RouteComponentProps<{\r\n  tab: string;\r\n  path: string;\r\n  label: string;\r\n}> { }\r\n\r\ninterface State {\r\n  showSearchAlert: boolean;\r\n  fetchError: boolean;\r\n  catalogs: Array<Catalog>;\r\n  pathLabel: string;\r\n}\r\n\r\nclass _CatalogPage extends React.Component<PageProps, State> {\r\n  constructor(props: any) {\r\n    super(props);\r\n    this.state = {\r\n      fetchError: false,\r\n      catalogs: [],\r\n      pathLabel: '',\r\n      showSearchAlert: false,\r\n    };\r\n  }\r\n\r\n  ionViewWillEnter() {\r\n    console.log(`view will enter: ${this.props.match.url}`);\r\n  }\r\n\r\n  /*\r\n  componentWillReceiveProps(nextProps){\r\n    console.log(`route changed: ${nextProps.match.url}`)\r\n }*/\r\n\r\n  componentDidMount() {\r\n    console.log(`did mount: ${this.props.match.url}`);\r\n    this.fetchData(this.props.match.params.path);\r\n  }\r\n\r\n  /*\r\n  componentWillUnmount() {\r\n  }*/\r\n\r\n  async fetchData(path: string) {\r\n    //console.log('fetch');\r\n    let catalogs = new Array<Catalog>();\r\n    let pathLabel = '';\r\n\r\n    if (path == null) {\r\n      return this.fetchTopCatalogs(this.props.topCatalogsType);\r\n    } else {\r\n      try {\r\n        const res = await Globals.axiosInstance.get(`/catalog_entry?q=${path}`, {\r\n          responseType: 'arraybuffer',\r\n        });\r\n        const obj = JSON.parse(new TextDecoder().decode(res.data)) as any;\r\n        const data = obj.results as [any];\r\n        catalogs = data.map((json) => new Catalog(json));\r\n\r\n        const parentPath = this.parentPath(path);\r\n        // path is not a top catalog.\r\n        if (parentPath !== '') {\r\n          pathLabel = obj.label;\r\n        } else {\r\n          const topCatalogsByCatLabel = Globals.topCatalogsByCat[path];\r\n          pathLabel = (topCatalogsByCatLabel !== undefined) ? topCatalogsByCatLabel : Globals.topCatalogsByVol[path];\r\n        }\r\n\r\n        this.setState({ catalogs: catalogs, pathLabel });\r\n        return true;\r\n      } catch (e) {\r\n        console.error(e);\r\n        console.error(new Error().stack);\r\n        this.setState({ fetchError: true });\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n\r\n  fetchTopCatalogs(topCatalogsType: number) {\r\n    let catalogs = Array<Catalog>();\r\n\r\n    const topCatalogs = topCatalogsType ? Globals.topCatalogsByVol : Globals.topCatalogsByCat;\r\n\r\n    Object.keys(topCatalogs).forEach((key) => {\r\n      const catalog: Catalog = {\r\n        n: key,\r\n        nodeType: null,\r\n        work: null,\r\n        label: topCatalogs[key],\r\n        file: null,\r\n      };\r\n      catalogs.push(catalog);\r\n    });\r\n    this.setState({ catalogs: catalogs });\r\n    return true;\r\n  }\r\n\r\n  get isTopCatalog() {\r\n    return this.props.match.url === '/catalog';\r\n  }\r\n\r\n  parentPath(path: string) {\r\n    let paths = path.split('.');\r\n    paths.pop();\r\n    return paths.join('.');\r\n  }\r\n\r\n  addBookmarkHandler() {\r\n    this.props.dispatch({\r\n      type: \"ADD_BOOKMARK\",\r\n      bookmark: new Bookmark({\r\n        type: BookmarkType.CATALOG,\r\n        uuid: this.props.match.params.path,\r\n        selectedText: this.state.pathLabel,\r\n        epubcfi: '',\r\n        fileName: '',\r\n        work: null,\r\n      }),\r\n    });\r\n  }\r\n\r\n  delBookmarkHandler() {\r\n    this.props.dispatch({\r\n      type: \"DEL_BOOKMARK\",\r\n      uuid: this.props.match.params.path,\r\n    });\r\n  }\r\n\r\n  get hasBookmark() {\r\n    return this.props.bookmarks.find(\r\n      (e) => e.type === BookmarkType.CATALOG && e.uuid === this.props.match.params.path) != null;\r\n  }\r\n\r\n  getRows() {\r\n    let rows = Array<object>();\r\n    this.state.catalogs.forEach((catalog: Catalog, index: number) => {\r\n      let routeLink = '';\r\n      const isHtmlNode = catalog.nodeType === 'html';\r\n      if (isHtmlNode) {\r\n        routeLink = `/catalog/juan/${catalog.n}/1`;\r\n      } else if (catalog.work == null) {\r\n        routeLink = `/catalog/catalog/${catalog.n}`;\r\n      } else {\r\n        routeLink = `/catalog/work/${catalog.work}`;\r\n      }\r\n      rows.push(\r\n        <IonItem key={`${catalog.n}item` + index} button={true} onClick={async event => {\r\n          event.preventDefault();\r\n          this.props.history.push({\r\n            pathname: routeLink,\r\n            search: queryString.stringify(isHtmlNode ? { file: catalog.file!, title: catalog.label } : {}),\r\n          });\r\n        }}>\r\n          <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\r\n          <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }} key={`${catalog.n}label` + index}>\r\n            {catalog.label}\r\n          </IonLabel>\r\n        </IonItem>\r\n      );\r\n    });\r\n    return rows;\r\n  }\r\n\r\n  render() {\r\n    //console.log(`${this.props.match.url} render`)\r\n\r\n    let list = <IonList>\r\n      {this.getRows()}\r\n    </IonList>\r\n\r\n    return (\r\n      <IonPage>\r\n        <IonHeader>\r\n          <IonToolbar>\r\n            <IonTitle style={{ fontSize: 'var(--ui-font-size)' }}></IonTitle>\r\n\r\n            <IonButton hidden={this.isTopCatalog} fill=\"clear\" slot='start' onClick={e => this.props.history.goBack()}>\r\n              <IonIcon icon={arrowBack} slot='icon-only' />\r\n            </IonButton>\r\n\r\n            <IonButton hidden={!this.isTopCatalog} slot='end' onClick={ev => {\r\n              const newTopCatalogsType = (this.props.topCatalogsType + 1) % 2\r\n              this.fetchTopCatalogs(newTopCatalogsType);\r\n              this.props.dispatch({\r\n                type: \"SET_KEY_VAL\",\r\n                key: 'topCatalogsType',\r\n                val: newTopCatalogsType\r\n              });\r\n            }}>\r\n              <span className='uiFont' style={{ color: 'var(--color)' }}>{this.props.topCatalogsType ? '' : ''}</span>\r\n            </IonButton>\r\n\r\n            <IonButton hidden={this.isTopCatalog} fill=\"clear\" color={this.hasBookmark ? 'warning' : 'primary'} slot='end' onClick={e => this.hasBookmark ? this.delBookmarkHandler() : this.addBookmarkHandler()}>\r\n              <IonIcon icon={bookmark} slot='icon-only' />\r\n            </IonButton>\r\n\r\n            <IonButton hidden={this.isTopCatalog} fill=\"clear\" slot='end' onClick={e => this.props.history.push(`/${this.props.match.params.tab}`)}>\r\n              <IonIcon icon={home} slot='icon-only' />\r\n            </IonButton>\r\n\r\n            <IonButton fill=\"clear\" slot='end' onClick={e => this.setState({ showSearchAlert: true })}>\r\n              <IonIcon icon={search} slot='icon-only' />\r\n            </IonButton>\r\n\r\n            <IonButton fill=\"clear\" slot='end' onClick={e => {\r\n              this.props.dispatch({\r\n                type: \"TMP_SET_KEY_VAL\",\r\n                key: 'shareTextModal',\r\n                val: {\r\n                  show: true,\r\n                  text: decodeURIComponent(window.location.href),\r\n                },\r\n              });\r\n            }}>\r\n              <IonIcon icon={shareSocial} slot='icon-only' />\r\n            </IonButton>\r\n          </IonToolbar>\r\n        </IonHeader>\r\n        <IonContent>\r\n          {this.state.fetchError ? Globals.fetchErrorContent : list}\r\n\r\n          <SearchAlert\r\n            {...{\r\n              showSearchAlert: this.state.showSearchAlert,\r\n              finish: () => { this.setState({ showSearchAlert: false }) }, ...this.props\r\n            }}\r\n          />\r\n\r\n          <div style={{ fontSize: 'var(--ui-font-size)', textAlign: 'center' }}><a href=\"https://github.com/MrMYHuang/cbetar2#search\" target=\"_new\"></a></div>\r\n        </IonContent>\r\n      </IonPage>\r\n    );\r\n  }\r\n};\r\n\r\nconst mapStateToProps = (state: any /*, ownProps*/) => {\r\n  return {\r\n    bookmarks: state.settings.bookmarks,\r\n    topCatalogsType: state.settings.topCatalogsType,\r\n    state: state,\r\n  }\r\n};\r\n\r\n//const mapDispatchToProps = {};\r\n\r\nconst CatalogPage = withIonLifeCycle(_CatalogPage);\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n)(CatalogPage);\r\n","import React from 'react';\r\nimport { IonContent, IonHeader, IonPage, IonTitle, IonToolbar, IonList, IonItem, IonLabel, withIonLifeCycle, IonButton, IonIcon, IonToast } from '@ionic/react';\r\nimport { RouteComponentProps } from 'react-router-dom';\r\nimport { connect } from 'react-redux';\r\nimport './WorkPage.css';\r\nimport { Work, WorkChapter, WorkListType } from '../models/Work';\r\nimport Globals from '../Globals';\r\nimport { bookmark, arrowBack, home, search, shareSocial } from 'ionicons/icons';\r\nimport { Bookmark, BookmarkType } from '../models/Bookmark';\r\nimport SearchAlert from '../components/SearchAlert';\r\n\r\ninterface Props {\r\n  dispatch: Function;\r\n  bookmarks: [Bookmark];\r\n  workListType: WorkListType;\r\n}\r\n\r\ninterface PageProps extends Props, RouteComponentProps<{\r\n  tab: string;\r\n  path: string;\r\n  label: string;\r\n}> { }\r\n\r\ninterface State {\r\n  work: Work | null;\r\n  showSearchAlert: boolean;\r\n  showAddBookmarkDone: boolean;\r\n}\r\n\r\nclass _WorkPage extends React.Component<PageProps, State> {\r\n  constructor(props: any) {\r\n    super(props);\r\n    this.state = {\r\n      work: null,\r\n      showSearchAlert: false,\r\n      showAddBookmarkDone: false,\r\n    }\r\n  }\r\n\r\n  ionViewWillEnter() {\r\n    //console.log( 'view will enter' );\r\n    this.fetchWork(this.props.match.params.path);\r\n  }\r\n\r\n  async fetchWork(path: string) {\r\n    let work: Work | null;\r\n    if (this.hasBookmark) {\r\n      work = this.bookmark!.work!;\r\n    } else {\r\n      try {\r\n        const res = await Globals.axiosInstance.get(`/works?work=${path}`, {\r\n          responseType: 'arraybuffer',\r\n        });\r\n        const data = JSON.parse(new TextDecoder().decode(res.data));\r\n        const works = data.results as [Work];\r\n        work = works[0];\r\n\r\n        const resToc = await Globals.axiosInstance.get(`/toc?work=${path}`) as any;\r\n        work.mulu = (resToc.data.results[0].mulu as WorkChapter[]).map((wc) => new WorkChapter(wc));\r\n\r\n      } catch (err) {\r\n        console.error(err);\r\n        return false;\r\n      }\r\n    }\r\n\r\n    this.setState({ work: work });\r\n    return true;\r\n  }\r\n\r\n  fetchJuan = '';\r\n  async saveJuans() {\r\n    let work = this.state.work!;\r\n    let juans = work.juan_list.split(',');\r\n    for (let i = 0; i < juans.length; i++) {\r\n      this.fetchJuan = juans[i];\r\n      try {\r\n        const res = await Globals.fetchJuan(work.work, this.fetchJuan, null);\r\n        Globals.saveFileToIndexedDB(Globals.getFileName(work.work, this.fetchJuan), res.htmlStr);\r\n      } catch(err) {\r\n        console.error(`Fetching juan ${i} failed! ${err}`);\r\n      }\r\n    }\r\n    this.setState({ showAddBookmarkDone: true });\r\n  }\r\n\r\n  async addBookmarkHandler() {\r\n    await this.saveJuans();\r\n    this.props.dispatch({\r\n      type: \"ADD_BOOKMARK\",\r\n      bookmark: new Bookmark({\r\n        type: BookmarkType.WORK,\r\n        uuid: this.props.match.params.path,\r\n        selectedText: this.state.work!.title,\r\n        epubcfi: '',\r\n        fileName: '',\r\n        work: this.state.work!,\r\n      }),\r\n    });\r\n  }\r\n\r\n  delBookmarkHandler() {\r\n    this.props.dispatch({\r\n      type: \"DEL_BOOKMARK\",\r\n      uuid: this.props.match.params.path,\r\n    });\r\n  }\r\n\r\n  get isTopPage() {\r\n    return this.props.match.url === '/catalog';\r\n  }\r\n\r\n  get bookmark() {\r\n    return this.props.bookmarks.find(\r\n      (e) => e.type === BookmarkType.WORK && e.uuid === this.props.match.params.path);\r\n  }\r\n\r\n  get hasBookmark() {\r\n    return this.bookmark != null;\r\n  }\r\n\r\n  getRowsByChapter() {\r\n    let work = this.state.work!;\r\n    const mulu = work.mulu;\r\n    let rows = Array<object>();\r\n    for (let i = 0; i < mulu.length; i++) {\r\n      let routeLink = `/catalog/juan/${work.work}/${mulu[i].juan}`;\r\n      rows.push(\r\n        <IonItem key={`chapterItem` + i} button={true} onClick={async event => {\r\n          event.preventDefault();\r\n          this.props.history.push({\r\n            pathname: routeLink,\r\n          });\r\n        }}>\r\n          <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\r\n          <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }} key={`chapterLabel` + i}>\r\n            {mulu[i].title}\r\n          </IonLabel>\r\n        </IonItem>\r\n      );\r\n    }\r\n    return rows;\r\n  }\r\n\r\n  getRowsByJuan() {\r\n    let work = this.state.work!;\r\n    let rows = Array<object>();\r\n    let juans = work.juan_list.split(',');\r\n    for (let i = 0; i < juans.length; i++) {\r\n      //if (work.nodeType == 'html')\r\n      let routeLink = `/catalog/juan/${work.work}/${juans[i]}`;\r\n      rows.push(\r\n        <IonItem key={`juanItem` + i} button={true} onClick={async event => {\r\n          event.preventDefault();\r\n          this.props.history.push({\r\n            pathname: routeLink,\r\n          });\r\n        }}>\r\n          <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\r\n          <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }} key={`juanLabel` + i}>\r\n            {juans[i]}\r\n          </IonLabel>\r\n        </IonItem>\r\n      );\r\n    }\r\n    return rows;\r\n  }\r\n\r\n  //work = this.works[0] as Work;\r\n  render() {\r\n    let work = this.state.work;\r\n    if (work == null) {\r\n      return <IonPage></IonPage>\r\n    }\r\n\r\n    let rows = this.props.workListType === WorkListType.BY_CHAPTER ? this.getRowsByChapter() : this.getRowsByJuan();\r\n    return (\r\n      <IonPage>\r\n        <IonHeader>\r\n          <IonToolbar>\r\n            <IonTitle style={{ fontSize: 'var(--ui-font-size)' }}>{this.state.work?.title}</IonTitle>\r\n            <IonButton hidden={this.isTopPage} fill=\"clear\" slot='start' onClick={e => this.props.history.goBack()}>\r\n              <IonIcon icon={arrowBack} slot='icon-only' />\r\n            </IonButton>\r\n\r\n            <IonButton slot='end' onClick={ev => {\r\n              const newWorkListType = this.props.workListType === WorkListType.BY_CHAPTER ? WorkListType.BY_JUAN : WorkListType.BY_CHAPTER;\r\n              this.props.dispatch({\r\n                type: \"TMP_SET_KEY_VAL\",\r\n                key: 'workListType',\r\n                val: newWorkListType\r\n              });\r\n            }}>\r\n              <span className='uiFont' style={{ color: 'var(--color)' }}>{this.props.workListType === WorkListType.BY_CHAPTER ? '' : ''}</span>\r\n            </IonButton>\r\n\r\n            <IonButton fill=\"clear\" color={this.hasBookmark ? 'warning' : 'primary'} slot='end' onClick={e => this.hasBookmark ? this.delBookmarkHandler() : this.addBookmarkHandler()}>\r\n              <IonIcon icon={bookmark} slot='icon-only' />\r\n            </IonButton>\r\n\r\n            <IonButton fill=\"clear\" slot='end' onClick={e => this.props.history.push(`/${this.props.match.params.tab}`)}>\r\n              <IonIcon icon={home} slot='icon-only' />\r\n            </IonButton>\r\n\r\n            <IonButton fill=\"clear\" slot='end' onClick={e => {\r\n              this.props.dispatch({\r\n                type: \"TMP_SET_KEY_VAL\",\r\n                key: 'shareTextModal',\r\n                val: {\r\n                  show: true,\r\n                  text: decodeURIComponent(window.location.href),\r\n                },\r\n              });\r\n            }}>\r\n              <IonIcon icon={shareSocial} slot='icon-only' />\r\n            </IonButton>\r\n\r\n            <IonButton fill=\"clear\" slot='end' onClick={e => this.setState({ showSearchAlert: true })}>\r\n              <IonIcon icon={search} slot='icon-only' />\r\n            </IonButton>\r\n          </IonToolbar>\r\n        </IonHeader>\r\n        <IonContent>\r\n          <IonList>\r\n            {rows}\r\n          </IonList>\r\n\r\n          <SearchAlert\r\n            {...{\r\n              showSearchAlert: (this.state as any).showSearchAlert,\r\n              finish: () => { this.setState({ showSearchAlert: false }) }, ...this.props\r\n            }}\r\n          />\r\n\r\n          <IonToast\r\n            cssClass='uiFont'\r\n            isOpen={this.state.showAddBookmarkDone}\r\n            onDidDismiss={() => this.setState({ showAddBookmarkDone: false })}\r\n            message={``}\r\n            duration={2000}\r\n          />\r\n        </IonContent>\r\n      </IonPage>\r\n    );\r\n  }\r\n};\r\n\r\nconst WorkPage = withIonLifeCycle(_WorkPage);\r\n\r\nconst mapStateToProps = (state: any /*, ownProps*/) => {\r\n  return {\r\n    bookmarks: state.settings.bookmarks,\r\n    // Default to WorkListType.BY_JUAN, because work list by chapter might be empty.\r\n    workListType: state.tmpSettings.workListType !== undefined ? state.tmpSettings.workListType : WorkListType.BY_JUAN,\r\n  }\r\n};\r\n\r\n//const mapDispatchToProps = {};\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n)(WorkPage);\r\n","export enum WordType {\n    NOUN = '',\n    VERB = ''\n}\n\nexport class DictWordDefItem {\n    def: string;\n    quote: Array<string> | null;\n    example: Array<string> | null;\n    link: Array<string> | null;\n    type: WordType | undefined;\n\n    constructor(json: DictWordDefItem) {\n        this.def = json.def;\n        this.quote = json.quote;\n        this.example = json.example;\n        this.link = json.link;\n        this.type = json.type;\n    }\n}\n\nexport class DictWordItem {\n    bopomofo: string;\n    bopomofo2: string;\n    pinyin: string;\n    definitions: Array<DictWordDefItem>;\n\n    constructor(json: any) {\n        this.bopomofo = json.bopomofo;\n        this.bopomofo2 = json.bopomofo2;\n        this.pinyin = json.pinyin;\n        this.definitions = json.definitions;\n    }\n}\n","import React from 'react';\nimport { IonContent, IonHeader, IonPage, IonTitle, IonToolbar, IonList, IonItem, IonRange, IonIcon, IonLabel, IonToggle, IonButton, IonAlert, IonSelect, IonSelectOption, IonProgressBar, IonToast } from '@ionic/react';\nimport { connect } from 'react-redux';\nimport { RouteComponentProps } from 'react-router-dom';\nimport Globals from '../Globals';\nimport { helpCircle, text, documentText, refreshCircle, musicalNotes, colorPalette, shareSocial, bug } from 'ionicons/icons';\nimport './SettingsPage.css';\nimport PackageInfos from '../../package.json';\nimport { Bookmark, BookmarkType } from '../models/Bookmark';\n\ninterface StateProps {\n  showFontLicense: boolean;\n  juansDownloadedRatio: number;\n  showUpdateAllJuansDone: boolean;\n}\n\ninterface Props {\n  dispatch: Function;\n  hasAppLog: boolean;\n  theme: number;\n  uiFontSize: number;\n  scrollbarSize: number;\n  settings: any;\n  showComments: boolean;\n  paginated: boolean;\n  rtlVerticalLayout: boolean;\n  useFontKai: boolean;\n  speechRate: number;\n  bookmarks: [Bookmark];\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n  tab: string;\n  path: string;\n  label: string;\n}> { }\n\nclass SettingsPage extends React.Component<PageProps, StateProps> {\n  constructor(props: any) {\n    super(props);\n\n    this.state = {\n      showFontLicense: false,\n      juansDownloadedRatio: 0,\n      showUpdateAllJuansDone: false,\n    }\n  }\n\n  updateBookmark(newBookmarks: Array<Bookmark>, newBookmark: Bookmark) {\n    const updateIndex = newBookmarks.findIndex((b: Bookmark) => b.uuid === newBookmark.uuid);\n    if (updateIndex === -1) {\n      console.error(`Update bookmark fails! Can't find the original bookmark with UUID: ${newBookmark.uuid}`);\n    } else {\n      newBookmarks[updateIndex] = newBookmark;\n    }\n    return;\n  }\n\n  async updateAllJuans() {\n    this.setState({ juansDownloadedRatio: 0 });\n    const workBookmarksWithHtml = this.props.bookmarks.filter((b) => b.type === BookmarkType.WORK);\n    const juanBookmarksWithHtml = this.props.bookmarks.filter((b) => b.type === BookmarkType.JUAN);\n    const juanBookmarksNotInWorkBookmarksWithHtml = juanBookmarksWithHtml.filter((b) => workBookmarksWithHtml.findIndex((wb) => wb.work?.work === b.work?.work) === -1);\n\n    // Total juans to download.\n    let juansToDownload = juanBookmarksNotInWorkBookmarksWithHtml.length;\n    for (let i = 0; i < workBookmarksWithHtml.length; i++) {\n      const work = workBookmarksWithHtml[i].work!;\n      juansToDownload += work.juan_list.split(',').length;\n    }\n\n    let juansDownloaded = 0;\n    for (let i = 0; i < workBookmarksWithHtml.length; i++) {\n      const bookmarkWithHtml = workBookmarksWithHtml[i];\n      const work = bookmarkWithHtml.work!;\n      const juans = work.juan_list.split(',');\n      for (let j = 0; j < juans.length; j++) {\n        const fetchJuan = juans[j];\n        juansDownloaded += 1;\n        this.setState({ juansDownloadedRatio: juansDownloaded / juansToDownload });\n        const res = await Globals.fetchJuan(work.work, fetchJuan, null, true);\n        const fileName = Globals.getFileName(work.work, fetchJuan);\n        // Update HTML.\n        Globals.saveFileToIndexedDB(fileName, res.htmlStr);\n        if (j === 0) {\n          // Update bookmarks for once.\n          this.updateBookmark(this.props.bookmarks, Object.assign(bookmarkWithHtml, { work: res.workInfo }));\n        }\n        console.log(`File saved: ${fileName}`);\n      }\n    }\n    for (let i = 0; i < juanBookmarksNotInWorkBookmarksWithHtml.length; i++) {\n      juansDownloaded += 1;\n      this.setState({ juansDownloadedRatio: juansDownloaded / juansToDownload });\n      const bookmarkWithHtml = juanBookmarksNotInWorkBookmarksWithHtml[i];\n      const work = bookmarkWithHtml.work!;\n      const res = await Globals.fetchJuan(work.work, `${work.juan}`, null, true);\n      const fileName = Globals.getFileName(work.work, `${work.juan}`);\n      // Update HTML.\n      Globals.saveFileToIndexedDB(fileName, res.htmlStr);\n      // Update bookmarks\n      this.updateBookmark(this.props.bookmarks, Object.assign(bookmarkWithHtml, { work: res.workInfo }));\n      console.log(`File saved: ${fileName}`);\n    }\n\n    this.props.dispatch({\n      type: \"UPDATE_BOOKMARKS\",\n      bookmarks: this.props.bookmarks,\n    });\n    this.setState({ showUpdateAllJuansDone: true });\n  }\n\n  render() {\n    return (\n      <IonPage>\n        <IonHeader>\n          <IonToolbar>\n            <IonTitle style={{ fontSize: 'var(--ui-font-size)' }}></IonTitle>\n          </IonToolbar>\n        </IonHeader>\n        <IonContent>\n          <IonList>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={shareSocial} slot='start' />\n              <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }}>app: {PackageInfos.version}</IonLabel>\n              <IonButton slot='end' size='large' style={{ fontSize: 'var(--ui-font-size)' }} onClick={e => {\n                this.props.dispatch({\n                  type: \"TMP_SET_KEY_VAL\",\n                  key: 'shareTextModal',\n                  val: {\n                    show: true,\n                    text: window.location.origin,\n                  },\n                });\n              }}></IonButton>\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={refreshCircle} slot='start' />\n              <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }}>app ()</IonLabel>\n              <IonButton slot='end' size='large' style={{ fontSize: 'var(--ui-font-size)' }} onClick={e => {\n                Globals.updateApp();\n              }}></IonButton>\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={bug} slot='start' />\n              <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }}>app</IonLabel>\n              <IonToggle slot='end' checked={this.props.hasAppLog} onIonChange={e => {\n                const isChecked = e.detail.checked;\n                isChecked ? Globals.enableAppLog() : Globals.disableAppLog();\n                this.props.dispatch({\n                  type: \"SET_KEY_VAL\",\n                  key: 'hasAppLog',\n                  val: isChecked\n                });\n              }} />\n            </IonItem>\n            <IonItem hidden={!this.props.hasAppLog}>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={bug} slot='start' />\n              <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }}>app</IonLabel>\n              <IonButton slot='end' size='large' style={{ fontSize: 'var(--ui-font-size)' }} onClick={e => {\n                window.open(`mailto:myh@live.com?subject=&body=${encodeURIComponent(\"()\\n\\n\" + navigator.userAgent + \"\\n\\nApp\" + PackageInfos.version + \"\\n\\nApp\" + JSON.stringify(this.props.settings) + \"\\n\\nLog\\n\" + Globals.getLog())}`);\n              }}></IonButton>\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={refreshCircle} slot='start' />\n              <div style={{ width: '100%' }}>\n                <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }}></IonLabel>\n                <IonProgressBar value={this.state.juansDownloadedRatio} />\n              </div>\n              <IonButton slot='end' size='large' style={{ fontSize: 'var(--ui-font-size)' }} onClick={async (e) => this.updateAllJuans()}></IonButton>\n              <IonToast\n                cssClass='uiFont'\n                isOpen={this.state.showUpdateAllJuansDone}\n                onDidDismiss={() => this.setState({ showUpdateAllJuansDone: false })}\n                message={``}\n                duration={2000}\n              />\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={colorPalette} slot='start' />\n              <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }}></IonLabel>\n              <IonSelect slot='end'\n                value={this.props.theme}\n                style={{ fontSize: 'var(--ui-font-size)' }}\n                interface='popover'\n                interfaceOptions={{ cssClass: 'cbetar2themes' }}\n                onIonChange={e => {\n                  const value = e.detail.value;\n                  this.props.dispatch({\n                    type: \"SET_KEY_VAL\",\n                    key: 'theme',\n                    val: value,\n                  });\n                  document.body.classList.forEach((val) => document.body.classList.remove(val));\n                  document.body.classList.toggle(`theme${value}`, true);\n                }}>\n                <IonSelectOption className='cbeta' value={0}>CBETA</IonSelectOption>\n                <IonSelectOption className='dark' value={1}></IonSelectOption>\n                <IonSelectOption className='light' value={2}></IonSelectOption>\n                <IonSelectOption className='oldPaper' value={3}></IonSelectOption>\n                <IonSelectOption className='marble' value={4}></IonSelectOption>\n              </IonSelect>\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={documentText} slot='start' />\n              <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }}></IonLabel>\n              <IonToggle slot='end' checked={this.props.rtlVerticalLayout} onIonChange={e => {\n                const isChecked = e.detail.checked;\n                this.props.dispatch({\n                  type: \"SET_KEY_VAL\",\n                  key: 'rtlVerticalLayout',\n                  val: isChecked\n                });\n              }} />\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={documentText} slot='start' />\n              <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }}>/</IonLabel>\n              <IonToggle slot='end' checked={this.props.paginated} onIonChange={e => {\n                const isChecked = e.detail.checked;\n                this.props.dispatch({\n                  type: \"SET_KEY_VAL\",\n                  key: 'paginated',\n                  val: isChecked\n                });\n              }} />\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={documentText} slot='start' />\n              <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }}></IonLabel>\n              <IonSelect slot='end'\n                value={this.props.scrollbarSize}\n                style={{ fontSize: 'var(--ui-font-size)' }}\n                interface='popover'\n                interfaceOptions={{ cssClass: 'uiFont' }}\n                onIonChange={e => {\n                  const value = e.detail.value;\n                  this.props.dispatch({\n                    type: \"SET_KEY_VAL\",\n                    key: 'scrollbarSize',\n                    val: value,\n                  });\n                  Globals.updateCssVars(this.props.settings);\n                }}>\n                <IonSelectOption value={0}></IonSelectOption>\n                <IonSelectOption value={1}></IonSelectOption>\n                <IonSelectOption value={2}></IonSelectOption>\n              </IonSelect>\n            </IonItem>\n            {/*\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. * /}\n              <IonIcon icon={documentText} slot='start' />\n              <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }}></IonLabel>\n              <IonToggle slot='end' checked={this.props.showComments} onIonChange={e => {\n                const isChecked = e.detail.checked;\n                (this.props as any).dispatch({\n                  type: \"SET_KEY_VAL\",\n                  key: 'showComments',\n                  val: isChecked\n                });\n              }} />\n            </IonItem>\n            */}\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={text} slot='start' />\n              <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }}>/()</IonLabel>\n              <IonToggle slot='end' checked={this.props.useFontKai} onIonChange={e => {\n                const isChecked = e.detail.checked;\n                (this.props as any).dispatch({\n                  type: \"SET_KEY_VAL\",\n                  key: 'useFontKai',\n                  val: isChecked\n                });\n                Globals.updateCssVars(this.props.settings);\n              }} />\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={text} slot='start' />\n              <div className=\"contentBlock\">\n                <div style={{ flexDirection: \"column\" }}>\n                  <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }}>UI: {this.props.uiFontSize}</IonLabel>\n                  <IonRange min={10} max={64} value={this.props.uiFontSize} onIonChange={e => {\n                    this.props.dispatch({\n                      type: \"SET_KEY_VAL\",\n                      key: 'uiFontSize',\n                      val: e.detail.value,\n                    });\n                    Globals.updateCssVars(this.props.settings);\n                  }} />\n                </div>\n              </div>\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={text} slot='start' />\n              <div className=\"contentBlock\">\n                <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }}>: {this.props.settings.fontSize}</IonLabel>\n                <IonRange min={10} max={64} value={this.props.settings.fontSize} onIonChange={e => {\n                  this.props.dispatch({\n                    type: \"SET_KEY_VAL\",\n                    key: 'fontSize',\n                    val: e.detail.value,\n                  });\n                }} />\n              </div>\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={musicalNotes} slot='start' />\n              <div className=\"contentBlock\">\n                <div style={{ flexDirection: \"column\" }}>\n                  <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }}>: {this.props.speechRate}</IonLabel>\n                  <IonRange min={0.1} max={1.5} step={0.1} value={this.props.speechRate} onIonChange={e => {\n                    this.props.dispatch({\n                      type: \"SET_KEY_VAL\",\n                      key: 'speechRate',\n                      val: (e.detail.value as number).toFixed(1),\n                    });\n                  }} />\n                </div>\n              </div>\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={helpCircle} slot='start' />\n              <div style={{ fontSize: 'var(--ui-font-size)' }}>\n                <div></div>\n                <div><a href=\"https://github.com/MrMYHuang/cbetar2#web-app\" target=\"_new\"></a></div>\n                <div><a href=\"https://github.com/MrMYHuang/cbetar2\" target=\"_new\"></a></div>\n                <div>CBETA API: {Globals.apiVersion}</div>\n                <div><a href=\"http://cbdata.dila.edu.tw/v1.2/\" target=\"_new\">CBETA API</a></div>\n                <div><a href=\"http://glossaries.dila.edu.tw/?locale=zh-TW\" target=\"_new\">DILA </a></div>\n                <div>: Meng-Yuan Huang</div>\n                <div><a href=\"mailto:myh@live.com\" target=\"_new\">myh@live.com</a></div>\n                <div><a href=\"https://github.com/MrMYHuang/cbetar2#contributors\" target=\"_new\">App</a></div>\n                <div><a href='/' onClick={e => {\n                  e.preventDefault();\n                  this.setState({ showFontLicense: true });\n                }}></a></div>\n              </div>\n            </IonItem>\n            <IonAlert\n              cssClass='uiFont'\n              isOpen={this.state.showFontLicense}\n              backdropDismiss={false}\n              message=\"app(2020-08-18) (Open Government Data License) https://data.gov.tw/license\"\n              buttons={[\n                {\n                  text: '',\n                  cssClass: 'primary uiFont',\n                  handler: (value) => {\n                    this.setState({\n                      showFontLicense: false,\n                    });\n                  },\n                },\n                {\n                  text: '',\n                  cssClass: 'secondary uiFont',\n                  handler: (value) => {\n                    this.setState({\n                      showFontLicense: false,\n                    });\n                    window.open('https://data.gov.tw/license');\n                  },\n                }\n              ]}\n            />\n          </IonList>\n        </IonContent>\n      </IonPage >\n    );\n  }\n};\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n    settings: state.settings,\n    hasAppLog: state.settings.hasAppLog,\n    theme: state.settings.theme,\n    showComments: state.settings.showComments,\n    paginated: state.settings.paginated,\n    rtlVerticalLayout: state.settings.rtlVerticalLayout,\n    scrollbarSize: state.settings.scrollbarSize,\n    useFontKai: state.settings.useFontKai,\n    uiFontSize: state.settings.uiFontSize,\n    speechRate: state.settings.speechRate,\n    bookmarks: state.settings.bookmarks,\n  }\n};\n\nexport default connect(\n  mapStateToProps,\n)(SettingsPage);\n","import React from 'react';\r\nimport { IonContent, IonHeader, IonPage, IonTitle, IonToolbar, IonList, IonItem, IonLabel, withIonLifeCycle, IonItemSliding, IonItemOptions, IonItemOption, IonIcon } from '@ionic/react';\r\nimport { RouteComponentProps } from 'react-router-dom';\r\nimport { connect } from 'react-redux';\r\nimport './WorkPage.css';\r\nimport { Bookmark, BookmarkType } from '../models/Bookmark';\r\nimport { download } from 'ionicons/icons';\r\nimport queryString from 'query-string';\r\n\r\ninterface Props {\r\n  dispatch: Function;\r\n  bookmarks: [Bookmark];\r\n  fontSize: number;\r\n}\r\n\r\ninterface PageProps extends Props, RouteComponentProps<{\r\n  tab: string;\r\n  path: string;\r\n}> { }\r\n\r\nconst helpDoc = <>\r\n  <div style={{ fontSize: 'var(--ui-font-size)', textAlign: 'center' }}> <IonIcon icon={download} /></div>\r\n  <div style={{ fontSize: 'var(--ui-font-size)', textAlign: 'center' }}><a href=\"https://github.com/MrMYHuang/cbetar2#bookmark\" target=\"_new\"></a></div>\r\n  <div style={{ fontSize: 'var(--ui-font-size)', textAlign: 'center' }}><a href=\"https://github.com/MrMYHuang/cbetar2#web-app\" target=\"_new\"></a></div>\r\n</>;\r\n\r\nclass _BookmarkPage extends React.Component<PageProps> {\r\n  bookmarkListRef: React.RefObject<HTMLIonListElement>;\r\n  constructor(props: any) {\r\n    super(props);\r\n    this.state = {\r\n      work: null,\r\n    }\r\n    this.bookmarkListRef = React.createRef<HTMLIonListElement>();\r\n  }\r\n\r\n  ionViewWillEnter() {\r\n    //console.log( 'view will enter' );\r\n  }\r\n\r\n  get hasBookmark() {\r\n    return ((this.props as any).bookmarks as [Bookmark]).length > 0;\r\n  }\r\n\r\n  delBookmarkHandler(uuidStr: string) {\r\n    this.props.dispatch({\r\n      type: \"DEL_BOOKMARK\",\r\n      uuid: uuidStr,\r\n    });\r\n  }\r\n\r\n  render() {\r\n    let bookmarks = this.props.bookmarks;\r\n    let rows = Array<object>();\r\n    bookmarks.forEach((bookmark, i) => {\r\n      let routeLink = ``;\r\n      let label = `${bookmark.selectedText}`;\r\n      let isHtmlNode = false;\r\n      switch (bookmark.type) {\r\n        case BookmarkType.CATALOG:\r\n          routeLink = `/catalog/catalog/${bookmark.uuid}`; break;\r\n        case BookmarkType.WORK:\r\n          routeLink = `/catalog/work/${bookmark.uuid}`; break;\r\n        case BookmarkType.JUAN:\r\n          routeLink = `/catalog/juan/${bookmark.work?.work}/${bookmark.work?.juan}`;\r\n          label = `${bookmark.work?.title}${bookmark.work?.juan} - ${label}`; break;\r\n        case BookmarkType.HTML:\r\n          isHtmlNode = true;\r\n          routeLink = `/catalog/juan/${bookmark.work?.work}/1`;\r\n          label = `${bookmark.work?.title} - ${label}`; break;\r\n      }\r\n      rows.push(\r\n        <IonItemSliding key={`bookmarkItemSliding_` + i}>\r\n          <IonItem key={`bookmarkItem_` + i} button={true} onClick={async event => {\r\n            event.preventDefault();\r\n            this.props.history.push({\r\n              pathname: routeLink,\r\n              state: {\r\n                uuid: bookmark.uuid,\r\n              },\r\n              search: queryString.stringify(isHtmlNode ? { file: bookmark.fileName, title: bookmark.work?.title } : {}),\r\n            });\r\n          }}>\r\n            <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\r\n            <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }} key={`bookmarkItemLabel_` + i}>\r\n              {label}\r\n            </IonLabel>\r\n            {bookmark.type === BookmarkType.CATALOG ? '' : <IonIcon icon={download} slot='end' />}\r\n          </IonItem>\r\n\r\n          <IonItemOptions side=\"end\">\r\n            <IonItemOption style={{ fontSize: 'var(--ui-font-size)' }} color='danger' onClick={(e) => {\r\n              this.delBookmarkHandler(bookmark.uuid);\r\n              this.bookmarkListRef.current?.closeSlidingItems();\r\n            }}></IonItemOption>\r\n          </IonItemOptions>\r\n        </IonItemSliding>\r\n      );\r\n    });\r\n    return (\r\n      <IonPage>\r\n        <IonHeader>\r\n          <IonToolbar>\r\n            <IonTitle style={{ fontSize: 'var(--ui-font-size)' }}></IonTitle>\r\n          </IonToolbar>\r\n        </IonHeader>\r\n        <IonContent>\r\n          {this.hasBookmark ?\r\n            <>\r\n              <IonList ref={this.bookmarkListRef}>{rows}</IonList>\r\n              {helpDoc}\r\n            </> :\r\n            <IonLabel className='contentCenter'>\r\n              <div>\r\n                <div></div>\r\n                <div style={{ fontSize: 'var(--ui-font-size)', paddingTop: 24, paddingBottom: 24 }}><a href=\"/catalog\" target=\"_self\"></a></div>\r\n                {helpDoc}\r\n              </div>\r\n            </IonLabel>\r\n          }\r\n        </IonContent>\r\n      </IonPage>\r\n    );\r\n  }\r\n};\r\n\r\nconst mapStateToProps = (state: any /*, ownProps*/) => {\r\n  return {\r\n    bookmarks: state.settings.bookmarks,\r\n  }\r\n};\r\n\r\n//const mapDispatchToProps = {};\r\n\r\nconst BookmarkPage = withIonLifeCycle(_BookmarkPage);\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n)(BookmarkPage);\r\n","export class Search {\r\n    type: string;\r\n    n: string;\r\n    label: string;\r\n    work: string;\r\n    title: string;\r\n    creators: string;\r\n\r\n    constructor(json: any) {\r\n        this.type = json[\"type\"];\r\n        this.n = json[\"n\"];\r\n        this.label = json[\"label\"];\r\n        this.work = json[\"work\"];\r\n        this.title = json[\"title\"];\r\n        this.creators = json[\"creators\"] ?? '';\r\n    }\r\n}\r\n","import React from 'react';\r\nimport { IonContent, IonHeader, IonPage, IonTitle, IonToolbar, IonList, IonItem, IonLabel, withIonLifeCycle, IonButton, IonIcon } from '@ionic/react';\r\nimport { RouteComponentProps } from 'react-router-dom';\r\nimport { connect } from 'react-redux';\r\nimport Globals from '../Globals';\r\nimport { Search } from '../models/Search';\r\nimport SearchAlert from '../components/SearchAlert';\r\nimport { home, search, arrowBack, shareSocial } from 'ionicons/icons';\r\n\r\ninterface Props {\r\n  dispatch: Function;\r\n}\r\n\r\ninterface PageProps extends Props, RouteComponentProps<{\r\n  tab: string;\r\n  path: string;\r\n  label: string;\r\n  keyword: string;\r\n}> { }\r\n\r\ninterface State {\r\n  fetchError: boolean;\r\n  showSearchAlert: boolean;\r\n  searches: Array<Search>;\r\n}\r\n\r\nclass _SearchPage extends React.Component<PageProps, State> {\r\n  constructor(props: any) {\r\n    super(props);\r\n    this.state = {\r\n      fetchError: false,\r\n      showSearchAlert: false,\r\n      searches: [],\r\n    }\r\n  }\r\n\r\n  ionViewWillEnter() {\r\n    //console.log( 'view will enter' );\r\n    this.search(this.props.match.params.keyword);\r\n  }\r\n\r\n  async search(keyword: string) {\r\n    try {\r\n      const res = await Globals.axiosInstance.get(`/toc?q=${keyword}`, {\r\n        responseType: 'arraybuffer',\r\n      });\r\n      const data = JSON.parse(new TextDecoder().decode(res.data)).results as [any];\r\n      const searches = data.map((json) => new Search(json));\r\n\r\n      this.setState({ searches: searches });\r\n      return true;\r\n    } catch (e) {\r\n      console.error(e);\r\n      console.error(new Error().stack);\r\n      this.setState({ fetchError: true });\r\n      return false;\r\n    }\r\n  }\r\n\r\n  get isTopPage() {\r\n    return this.props.match.url === '/catalog';\r\n  }\r\n\r\n  getRows() {\r\n    let rows = Array<object>();\r\n    const searches = this.state.searches;\r\n    searches.forEach((search, i) => {\r\n      const isCatalog = search.type === 'catalog';\r\n      let label = isCatalog ? search.label : `${search.title}\\n:${search.creators}`;\r\n      let routeLink = `/${this.props.match.params.tab}` + (isCatalog ? `/catalog/${search.n}` : `/work/${search.work}`);\r\n      rows.push(\r\n        <IonItem key={`searchItem_` + i} button={true} onClick={async event => {\r\n          event.preventDefault();\r\n          this.props.history.push({\r\n            pathname: routeLink,\r\n          });\r\n        }}>\r\n          <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\r\n          <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }} key={`searchLabel_` + i}>\r\n            {label}\r\n          </IonLabel>\r\n        </IonItem>\r\n      );\r\n    });\r\n    return rows;\r\n  }\r\n\r\n  render() {\r\n    let rows = this.getRows();\r\n    return (\r\n      <IonPage>\r\n        <IonHeader>\r\n          <IonToolbar>\r\n            <IonTitle style={{ fontSize: 'var(--ui-font-size)' }}> - {this.props.match.params.keyword}</IonTitle>\r\n            <IonButton hidden={this.isTopPage} fill=\"clear\" slot='start' onClick={e => this.props.history.goBack()}>\r\n              <IonIcon icon={arrowBack} slot='icon-only' />\r\n            </IonButton>\r\n            <IonButton fill=\"clear\" slot='end' onClick={e => this.props.history.push(`/${this.props.match.params.tab}`)}>\r\n              <IonIcon icon={home} slot='icon-only' />\r\n            </IonButton>\r\n            <IonButton fill=\"clear\" slot='end' onClick={e => this.setState({ showSearchAlert: true })}>\r\n              <IonIcon icon={search} slot='icon-only' />\r\n            </IonButton>\r\n\r\n            <IonButton fill=\"clear\" slot='end' onClick={e => {\r\n              this.props.dispatch({\r\n                type: \"TMP_SET_KEY_VAL\",\r\n                key: 'shareTextModal',\r\n                val: {\r\n                  show: true,\r\n                  text: decodeURIComponent(window.location.href),\r\n                },\r\n              });\r\n            }}>\r\n              <IonIcon icon={shareSocial} slot='icon-only' />\r\n            </IonButton>\r\n          </IonToolbar>\r\n        </IonHeader>\r\n        <IonContent>\r\n          {\r\n            this.state.fetchError ?\r\n              Globals.fetchErrorContent :\r\n              <IonList>\r\n                {rows}\r\n              </IonList>\r\n          }\r\n\r\n          <SearchAlert\r\n            {...{\r\n              showSearchAlert: this.state.showSearchAlert,\r\n              finish: () => { this.setState({ showSearchAlert: false }) }, ...this.props\r\n            }}\r\n          />\r\n        </IonContent>\r\n      </IonPage>\r\n    );\r\n  }\r\n};\r\n\r\nconst SearchPage = withIonLifeCycle(_SearchPage);\r\n\r\nconst mapStateToProps = (state: any /*, ownProps*/) => {\r\n  return {\r\n  }\r\n};\r\n\r\n//const mapDispatchToProps = {};\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n)(SearchPage);\r\n","import React from 'react';\nimport { IonContent, IonHeader, IonPage, IonToolbar, withIonLifeCycle, IonButton, IonIcon, IonSearchbar, IonAlert, IonPopover, IonList, IonItem, IonLabel } from '@ionic/react';\nimport { RouteComponentProps } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport Globals from '../Globals';\nimport { home, arrowBack, shareSocial, book, ellipsisHorizontal, ellipsisVertical } from 'ionicons/icons';\nimport { DictItem } from '../models/DictItem';\n\ninterface Props {\n  dispatch: Function;\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n  tab: string;\n  path: string;\n  keyword: string;\n}> { }\n\ninterface State {\n  keyword: string;\n  fetchError: boolean;\n  searches: Array<DictItem>;\n  showNoSelectedTextAlert: boolean;\n  popover: any;\n}\n\nclass _DictionaryPage extends React.Component<PageProps, State> {\n  searchBarRef: React.RefObject<HTMLIonSearchbarElement>;\n  constructor(props: any) {\n    super(props);\n    this.state = {\n      keyword: '',\n      fetchError: false,\n      searches: [],\n      showNoSelectedTextAlert: false,\n      popover: {\n        show: false,\n        event: null,\n      },\n    }\n    this.searchBarRef = React.createRef<HTMLIonSearchbarElement>();\n  }\n\n  ionViewWillEnter() {\n    //console.log( 'view will enter' );\n    if (this.props.match.params.keyword) {\n      this.setState({ keyword: this.props.match.params.keyword });\n      this.lookupDict(this.props.match.params.keyword);\n    }\n  }\n\n  ionViewWillLeave() {\n  }\n\n  get isTopPage() {\n    return this.props.match.url === `/${this.props.match.params.tab}`;\n  }\n\n  async lookupDict(keyword: string) {\n    try {\n      const res = await Globals.axiosInstance.get(\n        `${Globals.dilaDictApiUrl}/?type=match&dicts=dila&term=${keyword}`,\n        {\n          responseType: 'json',\n        });\n      this.setState({ searches: res.data });\n    } catch (e) {\n      console.error(e);\n      console.error(new Error().stack);\n      this.setState({ fetchError: true });\n      return false;\n    }\n  }\n\n  getSelectedString() {\n    const sel = document.getSelection();\n    if ((sel?.rangeCount || 0) > 0 && sel!.getRangeAt(0).toString().length > 0) {\n      return sel!.getRangeAt(0).toString();\n    } else {\n      return '';\n    }\n  }\n\n  getRows() {\n    const data = this.state.searches as [DictItem];\n    let rows = Array<object>();\n    data.forEach((item: DictItem, index: number) => {\n      rows.push(\n        <div style={{ display: 'table-row' }} key={`dictItem` + index}>\n          <div className='tableCell'>\n            <div className='ion-text-wrap textFont' style={{ color: 'var(--ion-color-primary)', paddingBottom: '18pt' }} dangerouslySetInnerHTML={{ __html: item.dict_name_zh }}></div>\n            <div className='ion-text-wrap textFont' key={`dictItemLabel` + index} dangerouslySetInnerHTML={{ __html: item.desc }}>\n            </div>\n          </div>\n        </div>\n      );\n    });\n    return rows;\n  }\n\n  render() {\n    return (\n      <IonPage>\n        <IonHeader>\n          <IonToolbar>\n            <IonButton hidden={this.isTopPage} fill=\"clear\" slot='start' onClick={e => this.props.history.goBack()}>\n              <IonIcon icon={arrowBack} slot='icon-only' />\n            </IonButton>\n\n            <IonButton slot='start' onClick={ev => {\n              this.props.history.push({\n                pathname: `/dictionary/searchWord/`,\n              });\n            }}>\n              <span className='uiFont' style={{ color: 'var(--color)' }}></span>\n            </IonButton>\n\n            <IonButton fill=\"clear\" slot='end' onClick={e => {\n              this.props.dispatch({\n                type: \"TMP_SET_KEY_VAL\",\n                key: 'shareTextModal',\n                val: {\n                  show: true,\n                  text: decodeURIComponent(window.location.href),\n                },\n              });\n            }}>\n              <IonIcon icon={shareSocial} slot='icon-only' />\n            </IonButton>\n\n            <IonButton fill=\"clear\" slot='end' onClick={e => this.setState({ popover: { show: true, event: e.nativeEvent } })}>\n              <IonIcon ios={ellipsisHorizontal} md={ellipsisVertical} slot='icon-only' />\n            </IonButton>\n\n            <IonPopover\n              isOpen={this.state.popover.show}\n              event={this.state.popover.event}\n              onDidDismiss={e => { this.setState({ popover: { show: false, event: null } }) }}\n            >\n              <IonList>\n                <IonItem button onClick={e => {\n                  this.props.history.push(`/${this.props.match.params.tab}`);\n                  this.setState({ popover: { show: false, event: null } });\n                }}>\n                  <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                  <IonIcon icon={home} slot='start' />\n                  <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }}></IonLabel>\n                </IonItem>\n\n                <IonItem button onClick={e => {\n                  this.setState({ popover: { show: false, event: null } });\n                  const selectedText = this.getSelectedString();\n                  if (selectedText === '') {\n                    this.setState({ showNoSelectedTextAlert: true });\n                    return;\n                  }\n\n                  this.props.history.push({\n                    pathname: `/dictionary/search/${selectedText}`,\n                  });\n                }}>\n                  <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                  <IonIcon icon={book} slot='start' />\n                  <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }}></IonLabel>\n                </IonItem>\n\n                <IonItem button onClick={e => {\n                  this.setState({ popover: { show: false, event: null } });\n                  const selectedText = this.getSelectedString();\n                  if (selectedText === '') {\n                    this.setState({ showNoSelectedTextAlert: true });\n                    return;\n                  }\n\n                  this.props.history.push({\n                    pathname: `/dictionary/searchWord/${selectedText}`,\n                  });\n                }}>\n                  <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                  <IonIcon icon={book} slot='start' />\n                  <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }}></IonLabel>\n                </IonItem>\n              </IonList>\n            </IonPopover>\n          </IonToolbar>\n        </IonHeader>\n        <IonContent>\n          <IonSearchbar ref={this.searchBarRef} placeholder='Enter' value={this.state.keyword}\n            onIonChange={ev => {\n              this.setState({ keyword: ev.detail.value! })\n            }}\n            onIonClear={ev => {\n              this.setState({ searches: [] });\n            }}\n            onKeyUp={ev => {\n              if (ev.key === 'Enter') {\n                this.props.history.push({\n                  pathname: `/dictionary/search/${this.state.keyword}`,\n                });\n              }\n            }} />\n          {/*\n              <IonButton slot='end' size='large' style={{ fontSize: 'var(--ui-font-size)' }} onClick={e => {\n                this.lookupDict(this.state.keyword);\n              }}></IonButton>*/}\n\n          {this.state.fetchError ?\n            Globals.fetchErrorContent :\n            <div style={{ display: 'table' }}>\n              {this.getRows()}\n            </div>\n          }\n\n          <div style={{ fontSize: 'var(--ui-font-size)', textAlign: 'center' }}><a href=\"https://github.com/MrMYHuang/cbetar2#dictionary\" target=\"_new\"></a></div>\n\n          <IonAlert\n            cssClass='uiFont'\n            isOpen={this.state.showNoSelectedTextAlert}\n            backdropDismiss={false}\n            header=''\n            message='!'\n            buttons={[\n              {\n                text: '',\n                cssClass: 'primary uiFont',\n                handler: (value) => {\n                  this.setState({\n                    showNoSelectedTextAlert: false,\n                  });\n                },\n              }\n            ]}\n          />\n        </IonContent>\n      </IonPage>\n    );\n  }\n};\n\nconst DictionaryPage = withIonLifeCycle(_DictionaryPage);\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n  }\n};\n\n//const mapDispatchToProps = {};\n\nexport default connect(\n  mapStateToProps,\n)(DictionaryPage);\n","export class FullTextSearch {\r\n    id: number;\r\n    term_hits: number;\r\n    work: string;\r\n    title: string;\r\n    creators: string;\r\n\r\n    constructor(json: any) {\r\n        this.id = json.id;\r\n        this.term_hits = json.term_hits;\r\n        this.work = json.work;\r\n        this.title = json.title;\r\n        this.creators = json.creators;\r\n    }\r\n}\r\n","import React from 'react';\r\nimport { IonContent, IonHeader, IonPage, IonTitle, IonToolbar, IonList, IonItem, IonLabel, withIonLifeCycle, IonButton, IonIcon } from '@ionic/react';\r\nimport { RouteComponentProps } from 'react-router-dom';\r\nimport { connect } from 'react-redux';\r\nimport Globals from '../Globals';\r\nimport SearchAlert from '../components/SearchAlert';\r\nimport { home, search, arrowBack, shareSocial } from 'ionicons/icons';\r\nimport { FullTextSearch } from '../models/FullTextSearch';\r\n\r\ninterface Props {\r\n  dispatch: Function;\r\n}\r\n\r\ninterface PageProps extends Props, RouteComponentProps<{\r\n  tab: string;\r\n  path: string;\r\n  label: string;\r\n  keyword: string;\r\n}> { }\r\n\r\ninterface State {\r\n  fetchError: boolean;\r\n  showSearchAlert: boolean;\r\n  searches: Array<FullTextSearch>;\r\n}\r\n\r\nclass _SearchPage extends React.Component<PageProps, State> {\r\n  constructor(props: any) {\r\n    super(props);\r\n    this.state = {\r\n      fetchError: false,\r\n      showSearchAlert: false,\r\n      searches: [],\r\n    }\r\n  }\r\n\r\n  ionViewWillEnter() {\r\n    //console.log( 'view will enter' );\r\n    this.search(this.props.match.params.keyword);\r\n  }\r\n\r\n  async search(keyword: string) {\r\n    try {\r\n      const res = await Globals.axiosInstance.get(`/sphinx?q=${keyword}`, {\r\n        responseType: 'arraybuffer',\r\n      });\r\n      const data = JSON.parse(new TextDecoder().decode(res.data)).results as [any];\r\n      const searches = data.map((json) => new FullTextSearch(json));\r\n\r\n      this.setState({ searches: searches });\r\n      return true;\r\n    } catch (e) {\r\n      console.error(e);\r\n      console.error(new Error().stack);\r\n      this.setState({ fetchError: true });\r\n      return false;\r\n    }\r\n  }\r\n\r\n  get isTopPage() {\r\n    return this.props.match.url === '/catalog';\r\n  }\r\n\r\n  getRows() {\r\n    let rows = Array<object>();\r\n    const searches = (this.state as any).searches as [FullTextSearch];\r\n    searches.forEach((search, i) => {\r\n      let label = `${search.title}\\n:${search.creators}`;\r\n      let routeLink = `/catalog/work/${search.work}`;\r\n      rows.push(\r\n        <IonItem key={`searchItem_` + i} button={true} onClick={async event => {\r\n          event.preventDefault();\r\n          this.props.history.push({\r\n            pathname: routeLink,\r\n          });\r\n        }}>\r\n          <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\r\n          <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }} key={`searchLabel_` + i}>\r\n            {label}\r\n          </IonLabel>\r\n        </IonItem>\r\n      );\r\n    });\r\n    return rows;\r\n  }\r\n\r\n  render() {\r\n    let rows = this.getRows();\r\n    return (\r\n      <IonPage>\r\n        <IonHeader>\r\n          <IonToolbar>\r\n            <IonTitle style={{ fontSize: 'var(--ui-font-size)' }}> - {this.props.match.params.keyword}</IonTitle>\r\n            <IonButton hidden={this.isTopPage} fill=\"clear\" slot='start' onClick={e => this.props.history.goBack()}>\r\n              <IonIcon icon={arrowBack} slot='icon-only' />\r\n            </IonButton>\r\n            <IonButton fill=\"clear\" slot='end' onClick={e => this.props.history.push(`/${this.props.match.params.tab}`)}>\r\n              <IonIcon icon={home} slot='icon-only' />\r\n            </IonButton>\r\n            <IonButton fill=\"clear\" slot='end' onClick={e => this.setState({ showSearchAlert: true })}>\r\n              <IonIcon icon={search} slot='icon-only' />\r\n            </IonButton>\r\n\r\n            <IonButton fill=\"clear\" slot='end' onClick={e => {\r\n              this.props.dispatch({\r\n                type: \"TMP_SET_KEY_VAL\",\r\n                key: 'shareTextModal',\r\n                val: {\r\n                  show: true,\r\n                  text: decodeURIComponent(window.location.href),\r\n                },\r\n              });\r\n            }}>\r\n              <IonIcon icon={shareSocial} slot='icon-only' />\r\n            </IonButton>\r\n          </IonToolbar>\r\n        </IonHeader>\r\n        <IonContent>\r\n          {\r\n            this.state.fetchError ?\r\n              Globals.fetchErrorContent :\r\n              <IonList>\r\n                {rows}\r\n              </IonList>\r\n          }\r\n\r\n          <SearchAlert\r\n            {...{\r\n              showSearchAlert: (this.state as any).showSearchAlert,\r\n              finish: () => { this.setState({ showSearchAlert: false }) }, ...this.props\r\n            }}\r\n          />\r\n        </IonContent>\r\n      </IonPage>\r\n    );\r\n  }\r\n};\r\n\r\nconst SearchPage = withIonLifeCycle(_SearchPage);\r\n\r\nconst mapStateToProps = (state: any /*, ownProps*/) => {\r\n  return {\r\n  }\r\n};\r\n\r\n//const mapDispatchToProps = {};\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n)(SearchPage);\r\n","import React from 'react';\r\nimport { IonButton, IonContent, IonLabel, IonModal } from '@ionic/react';\r\nimport { RouteComponentProps } from 'react-router-dom';\r\nimport * as qrcode from 'qrcode';\r\n\r\ninterface Props {\r\n  showModal: boolean;\r\n  text: string;\r\n  finish: Function;\r\n}\r\n\r\ninterface PageProps extends Props, RouteComponentProps<{\r\n  tab: string;\r\n  path: string;\r\n}> { }\r\n\r\nclass _ShareTextModal extends React.Component<PageProps> {\r\n  /*constructor(props: any) {\r\n    super(props);\r\n  }*/\r\n\r\n  updateQrCode() {\r\n    navigator.clipboard && navigator.clipboard.writeText(this.props.text);\r\n    const qrcCanvas = document.getElementById('qrcCanvas');\r\n    qrcode.toCanvas(qrcCanvas, this.props.text);\r\n    return qrcCanvas;\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <IonModal\r\n        isOpen={this.props.showModal}\r\n        cssClass='uiFont'\r\n        swipeToClose={true}\r\n        //presentingElement={router || undefined}\r\n        onWillPresent={() => this.updateQrCode()}\r\n        onDidDismiss={() => this.props.finish()}>\r\n        <IonContent>\r\n          <div style={{display: 'flex', flexDirection: 'column', height: '100%', alignItems: 'center'}}>\r\n            <div>\r\n              <IonLabel className='uiFont'>app</IonLabel>\r\n            </div>\r\n            <div>\r\n              <IonLabel className='uiFont'>QR Code:</IonLabel>\r\n            </div>\r\n            <div style={{flexGrow: 1, display: 'flex', alignItems: 'center'}}>\r\n              <canvas id='qrcCanvas' width='500' height='500' style={{margin: '0px auto'}} />\r\n            </div>\r\n            <div>\r\n              <IonButton size='large' onClick={() => this.props.finish()}></IonButton>\r\n            </div>\r\n          </div>\r\n        </IonContent>\r\n      </IonModal>\r\n    );\r\n  }\r\n};\r\n\r\nconst ShareTextModal = (_ShareTextModal);\r\nexport default ShareTextModal;\r\n","import React from 'react';\nimport { IonContent, IonHeader, IonPage, IonToolbar, withIonLifeCycle, IonButton, IonIcon, IonSearchbar, IonAlert, IonPopover, IonList, IonItem, IonLabel } from '@ionic/react';\nimport { RouteComponentProps } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport * as uuid from 'uuid';\nimport Globals from '../Globals';\nimport { home, arrowBack, shareSocial, book, ellipsisHorizontal, ellipsisVertical } from 'ionicons/icons';\nimport { DictWordDefItem, DictWordItem, WordType } from '../models/DictWordItem';\n\ninterface Props {\n  dispatch: Function;\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n  tab: string;\n  path: string;\n  keyword: string;\n}> { }\n\ninterface State {\n  keyword: string;\n  search: [DictWordItem] | null;\n  fetchError: boolean;\n  showNoSelectedTextAlert: boolean;\n  popover: any;\n}\n\nclass _WordDictionaryPage extends React.Component<PageProps, State> {\n  searchBarRef: React.RefObject<HTMLIonSearchbarElement>;\n  constructor(props: any) {\n    super(props);\n    this.state = {\n      keyword: '',\n      search: null,\n      fetchError: false,\n      showNoSelectedTextAlert: false,\n      popover: {\n        show: false,\n        event: null,\n      },\n    }\n    this.searchBarRef = React.createRef<HTMLIonSearchbarElement>();\n  }\n\n  ionViewWillEnter() {\n    //console.log( 'view will enter' );\n    if (this.props.match.params.keyword) {\n      this.setState({ keyword: this.props.match.params.keyword });\n      this.lookupDict(this.props.match.params.keyword);\n    }\n  }\n\n  ionViewWillLeave() {\n  }\n\n  get isTopPage() {\n    return this.props.match.url === `/${this.props.match.params.tab}`;\n  }\n\n  async lookupDict(keyword: string) {\n    try {\n      const res = await Globals.axiosInstance.get(\n        `https://www.moedict.tw/uni/${keyword.substring(0, 1)}`,\n        {\n          responseType: 'json',\n        });\n      this.setState({ search: res.data.heteronyms });\n    } catch (e) {\n      console.error(e);\n      console.error(new Error().stack);\n      this.setState({ fetchError: true });\n      return false;\n    }\n  }\n\n  getSelectedString() {\n    const sel = document.getSelection();\n    if ((sel?.rangeCount || 0) > 0 && sel!.getRangeAt(0).toString().length > 0) {\n      return sel!.getRangeAt(0).toString();\n    } else {\n      return '';\n    }\n  }\n\n  defToView(defs: Array<DictWordDefItem> | undefined, title: string) {\n    return defs !== undefined && defs.length > 0 ? <>\n      <div key={uuid.v4()} style={{ color: 'var(--ion-color-primary)' }}>{title}</div>\n      <ol key={uuid.v4()}>{\n        defs?.map((d) =>\n          <li key={uuid.v4()}>\n            <div key={uuid.v4()}>{d.def}</div>\n            {d.quote?.map((q) => <div key={uuid.v4()}>{q}</div>)}\n            {d.example?.map((e) => <div key={uuid.v4()}>{e}</div>)}\n            {d.link?.map((l) => <div key={uuid.v4()}>{l}</div>)}\n          </li>\n        )}\n      </ol>\n    </> : <></>;\n  }\n\n  render() {\n    let dictView: any = [];\n    if (this.props.match.params.keyword) {\n      this.state.search?.forEach((data) => {\n        const nouns = data?.definitions.filter((d) => d.type === WordType.NOUN);\n        const verbs = data?.definitions.filter((d) => d.type === WordType.VERB);\n        const others = data?.definitions.filter((d) => d.type === undefined);\n\n        const nounsView = this.defToView(nouns, '');\n        const verbsView = this.defToView(verbs, '');\n        const othersView = this.defToView(others, '');\n\n        dictView.push(\n          <div key={uuid.v4()} className='textFont textSelectable'>\n            <div key={uuid.v4()} className='textFontX3'>{this.props.match.params.keyword.substring(0, 1)}</div>\n            {data?.bopomofo ? <div>{data?.bopomofo}</div> : null}\n            {data?.pinyin ? <div>{data?.pinyin}</div> : null}\n            {nounsView}\n            {verbsView}\n            {othersView}\n          </div>);\n      });\n    }\n\n    return (\n      <IonPage>\n        <IonHeader>\n          <IonToolbar>\n            <IonButton hidden={this.isTopPage} fill=\"clear\" slot='start' onClick={e => this.props.history.goBack()}>\n              <IonIcon icon={arrowBack} slot='icon-only' />\n            </IonButton>\n\n            <IonButton slot='start' onClick={ev => {\n              this.props.history.push({\n                pathname: `/dictionary/`,\n              });\n            }}>\n              <span className='uiFont' style={{ color: 'var(--color)' }}></span>\n            </IonButton>\n\n            <IonButton fill=\"clear\" slot='end' onClick={e => {\n              this.props.dispatch({\n                type: \"TMP_SET_KEY_VAL\",\n                key: 'shareTextModal',\n                val: {\n                  show: true,\n                  text: decodeURIComponent(window.location.href),\n                },\n              });\n            }}>\n              <IonIcon icon={shareSocial} slot='icon-only' />\n            </IonButton>\n\n            <IonButton fill=\"clear\" slot='end' onClick={e => this.setState({ popover: { show: true, event: e.nativeEvent } })}>\n              <IonIcon ios={ellipsisHorizontal} md={ellipsisVertical} slot='icon-only' />\n            </IonButton>\n\n            <IonPopover\n              isOpen={this.state.popover.show}\n              event={this.state.popover.event}\n              onDidDismiss={e => { this.setState({ popover: { show: false, event: null } }) }}\n            >\n              <IonList>\n                <IonItem button onClick={e => {\n                  this.props.history.push(`/${this.props.match.params.tab}`);\n                  this.setState({ popover: { show: false, event: null } });\n                }}>\n                  <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                  <IonIcon icon={home} slot='start' />\n                  <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }}></IonLabel>\n                </IonItem>\n\n                <IonItem button onClick={e => {\n                  this.setState({ popover: { show: false, event: null } });\n                  const selectedText = this.getSelectedString();\n                  if (selectedText === '') {\n                    this.setState({ showNoSelectedTextAlert: true });\n                    return;\n                  }\n\n                  this.props.history.push({\n                    pathname: `/dictionary/search/${selectedText}`,\n                  });\n                }}>\n                  <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                  <IonIcon icon={book} slot='start' />\n                  <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }}></IonLabel>\n                </IonItem>\n\n                <IonItem button onClick={e => {\n                  this.setState({ popover: { show: false, event: null } });\n                  const selectedText = this.getSelectedString();\n                  if (selectedText === '') {\n                    this.setState({ showNoSelectedTextAlert: true });\n                    return;\n                  }\n\n                  this.props.history.push({\n                    pathname: `/dictionary/searchWord/${selectedText}`,\n                  });\n                }}>\n                  <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n                  <IonIcon icon={book} slot='start' />\n                  <IonLabel className='ion-text-wrap' style={{ fontSize: 'var(--ui-font-size)' }}></IonLabel>\n                </IonItem>\n              </IonList>\n            </IonPopover>\n          </IonToolbar>\n        </IonHeader>\n        <IonContent>\n          <IonSearchbar ref={this.searchBarRef} placeholder='Enter' value={this.state.keyword}\n            onIonChange={ev => {\n              this.setState({ keyword: ev.detail.value! })\n            }}\n            onIonClear={ev => {\n              this.setState({ search: null });\n            }}\n            onKeyUp={ev => {\n              if (ev.key === 'Enter') {\n                this.props.history.push({\n                  pathname: `/dictionary/searchWord/${this.state.keyword}`,\n                });\n              }\n            }} />\n          {/*\n              <IonButton slot='end' size='large' style={{ fontSize: 'var(--ui-font-size)' }} onClick={e => {\n                this.lookupDict(this.state.keyword);\n              }}></IonButton>*/}\n\n          {this.state.fetchError ? Globals.fetchErrorContent : dictView}\n\n          {/*\n          <div style={{ fontSize: 'var(--ui-font-size)', textAlign: 'center' }}><a href=\"https://github.com/MrMYHuang/cbetar2#WordDictionary\" target=\"_new\"></a></div>\n          */}\n\n          <IonAlert\n            cssClass='uiFont'\n            isOpen={this.state.showNoSelectedTextAlert}\n            backdropDismiss={false}\n            header=''\n            message='!'\n            buttons={[\n              {\n                text: '',\n                cssClass: 'primary uiFont',\n                handler: (value) => {\n                  this.setState({\n                    showNoSelectedTextAlert: false,\n                  });\n                },\n              }\n            ]}\n          />\n        </IonContent>\n      </IonPage>\n    );\n  }\n};\n\nconst WordDictionaryPage = withIonLifeCycle(_WordDictionaryPage);\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n  }\n};\n\n//const mapDispatchToProps = {};\n\nexport default connect(\n  mapStateToProps,\n)(WordDictionaryPage);\n","import React from 'react';\nimport { Redirect, Route, RouteComponentProps, withRouter } from 'react-router-dom';\nimport {\n  setupConfig,\n  IonApp,\n  IonIcon,\n  IonRouterOutlet,\n  IonTabBar,\n  IonTabButton,\n  IonTabs,\n  IonAlert,\n} from '@ionic/react';\nimport { IonReactRouter } from '@ionic/react-router';\nimport { connect, Provider } from 'react-redux';\nimport getSavedStore from './redux/store';\nimport { bookmark, settings, library, book } from 'ionicons/icons';\nimport CatalogPage from './pages/CatalogPage';\nimport WorkPage from './pages/WorkPage';\nimport EPubViewPage from './pages/EPubViewPage';\n\n/* Core CSS required for Ionic components to work properly */\nimport '@ionic/react/css/core.css';\n\n/* Basic CSS for apps built with Ionic */\nimport '@ionic/react/css/normalize.css';\nimport '@ionic/react/css/structure.css';\nimport '@ionic/react/css/typography.css';\n\n/* Optional CSS utils that can be commented out */\nimport '@ionic/react/css/padding.css';\nimport '@ionic/react/css/float-elements.css';\nimport '@ionic/react/css/text-alignment.css';\nimport '@ionic/react/css/text-transformation.css';\nimport '@ionic/react/css/flex-utils.css';\nimport '@ionic/react/css/display.css';\n\n/* Theme variables */\nimport './theme/variables.css';\nimport SettingsPage from './pages/SettingsPage';\nimport BookmarkPage from './pages/BookmarkPage';\nimport SearchPage from './pages/SearchPage';\nimport Globals from './Globals';\nimport DictionaryPage from './pages/DictionaryPage';\nimport FullTextSearchPage from './pages/FullTextSearchPage';\nimport ShareTextModal from './components/ShareTextModal';\nimport WordDictionaryPage from './pages/WordDictionaryPage';\n\nlet store = getSavedStore();\n/*\nclass DebugRouter extends IonReactRouter {\n  constructor(props: any) {\n    super(props);\n    console.log('initial history is: ', JSON.stringify(this.history, null, 2))\n    this.history.listen((location, action) => {\n      console.log(\n        `The current URL is ${location.pathname}${location.search}${location.hash}`\n      )\n      console.log(`The last navigation action was ${action}`, JSON.stringify(this.history, null, 2));\n    });\n  }\n}\n*/\n\nconst state = store.getState();\n\nif (!state.settings.hasAppLog) {\n  Globals.disableAppLog();\n}\n\nsetupConfig({\n  mode: 'md',\n  swipeBackEnabled: false,\n});\n\nexport var serviceWorkCallbacks = {\n  onSuccess: function (registration: ServiceWorkerRegistration) { },\n  onUpdate: function (registration: ServiceWorkerRegistration) { },\n};\n\ninterface Props {\n  shareTextModal: any;\n}\n\ninterface PageProps extends RouteComponentProps<{\n  tab: string;\n  path: string;\n}> { }\n\ninterface AppOrigProps extends Props, RouteComponentProps<{\n  tab: string;\n  path: string;\n}> { }\n\ninterface State {\n  showUpdateAlert: boolean;\n}\n\nclass _App extends React.Component<PageProps, State> {\n  render() {\n    return (\n      <Provider store={store}>\n        <AppOrig {...this.props} />\n      </Provider>\n    );\n  }\n}\n\nclass _AppOrig extends React.Component<AppOrigProps, State> {\n  registrationNew: ServiceWorkerRegistration | null;\n\n  constructor(props: any) {\n    super(props);\n    this.registrationNew = null;\n    // ----- Initializing UI settings -----\n    // Apply the theme setting.\n    document.body.classList.forEach((val) => document.body.classList.remove(val));\n    document.body.classList.toggle(`theme${state.settings.theme}`, true);\n    Globals.updateCssVars(state.settings);\n\n    this.state = {\n      showUpdateAlert: false,\n    };\n\n    serviceWorkCallbacks.onUpdate = (registration: ServiceWorkerRegistration) => {\n      this.registrationNew = registration;\n      this.setState({ showUpdateAlert: true });\n    };\n\n    serviceWorkCallbacks.onSuccess = (registration: ServiceWorkerRegistration) => {\n    };\n\n    // Preload speechSynthesis.\n    speechSynthesis.getVoices();\n    speechSynthesis.cancel();\n\n    this.wakeLockScreen();\n    this.loadTwKaiFont();\n  }\n\n  async loadTwKaiFont() {\n    const dbOpenReq = indexedDB.open(Globals.cbetardb);\n    dbOpenReq.onupgradeneeded = function (event: IDBVersionChangeEvent) {\n      var db = (event.target as any).result;\n      db.createObjectStore('store');\n    };\n\n    let fontData: any;\n    await new Promise((ok, fail) => {\n      dbOpenReq.onsuccess = async (ev: Event) => {\n        const db = dbOpenReq.result;\n\n        const trans = db.transaction([\"store\"], 'readwrite');\n        let req = trans.objectStore('store').get(Globals.twKaiFontKey);\n        req.onsuccess = async (_ev: any) => {\n          fontData = req.result;\n          if (!fontData) {\n            const res = await Globals.axiosInstance.get(`${window.location.origin}/${Globals.twKaiFontPath}`, {\n              responseType: 'arraybuffer',\n            });\n            const transWrite = db.transaction([\"store\"], 'readwrite');\n            fontData = res.data;\n            const reqWrite = transWrite.objectStore('store').put(fontData, Globals.twKaiFontKey);\n            reqWrite.onsuccess = (_ev: any) => {\n              return ok();\n            };\n          }\n          return ok();\n        };\n      };\n    });\n    const fontFace = new (window as any).FontFace('Kai', fontData);\n    await fontFace.load();\n    (document as any).fonts.add(fontFace);\n    console.log('[Main] TW-Kai font loading success!');\n  }\n\n  // Prevent from device sleeping.\n  wakeLock: any;\n  async wakeLockScreen() {\n    try {\n      const wakeLock = (navigator as any).wakeLock;\n      if (wakeLock !== undefined) {\n        this.wakeLock = await wakeLock.request('screen');\n        console.log('Auto screen lock is disabled.');\n      }\n    } catch (err) {\n      // the wake lock request fails - usually system related, such low as battery\n      console.error(`${err.name}, ${err.message}`);\n    }\n  }\n\n  routeByQueryString() {\n    // This app uses client side routing. \n    // Without the first loading of this app,\n    // any client side route becomes a server side route!\n    // These invalid server side routings cause 404 errors.\n    // To workaround these errors, we can use GitHub 404.html redirection\n    // to pass the client side routes to this app by using query string.\n    // After this app loads, it can use the query string to correctly redirect to\n    // a client side route!\n    const routeMatches = /\\?route=(.*)/.exec(window.location.search);\n    if (routeMatches !== null) {\n      return <Redirect to={routeMatches[1]} />;\n    } else if (window.location.pathname === '/') {\n      return <Redirect to=\"/bookmarks\" />;\n    }\n  }\n\n  render() {\n    return (\n      <IonApp>\n        <IonReactRouter>\n          <IonTabs>\n            <IonRouterOutlet animated={false}>\n              {/* The following route is for backward compatibility. */}\n              <Route path=\"/:tab(catalog)/webview/:work/:path/:label\" render={(props: any) => <EPubViewPage {...props} />} exact={true} />\n              <Route path=\"/:tab(catalog)/juan/:work/:path/\" render={(props: any) => <EPubViewPage {...props} />} exact={true} />\n              {/* The following route is for backward compatibility. */}\n              <Route path=\"/:tab(catalog)/work/:path/:label\" component={(props: any) => <WorkPage {...props} />} exact={true} />\n              <Route path=\"/:tab(catalog)/work/:path\" component={(props: any) => <WorkPage {...props} />} exact={true} />\n              <Route path=\"/:tab(catalog)/search/:keyword\" render={props => <SearchPage {...props} />} exact={true} />\n              <Route path=\"/:tab(catalog)/fulltextsearch/:keyword\" render={props => <FullTextSearchPage {...props} />} exact={true} />\n              {/* The following route is for backward compatibility. */}\n              <Route path=\"/:tab(catalog)/catalog/:path/:label\" component={(props: any) => <CatalogPage {...props} />} exact={true} />\n              <Route path=\"/:tab(catalog)/catalog/:path\" component={(props: any) => <CatalogPage key={props.match.url} {...props} />} exact={true} />\n              <Route path=\"/:tab(catalog)\" component={(props: any) => <CatalogPage {...props} />} exact={true} />\n              <Route path=\"/:tab(bookmarks)\" component={BookmarkPage} exact={true} />\n              <Route path={`/:tab(bookmarks)/search/:keyword`} render={props => <SearchPage {...props} />} exact={true} />\n              <Route path={`/:tab(dictionary)`} render={props => <DictionaryPage {...props} />} exact={true} />\n              <Route path={`/:tab(dictionary)/search/:keyword`} render={props => <DictionaryPage key={props.match.url} {...props} />} exact={true} />\n              <Route path={`/:tab(dictionary)/searchWord`} render={props => <WordDictionaryPage key={props.match.url} {...props} />} exact={true} />\n              <Route path={`/:tab(dictionary)/searchWord/:keyword`} render={props => <WordDictionaryPage key={props.match.url} {...props} />} exact={true} />\n              <Route path=\"/settings\" component={SettingsPage} />\n              <Route path=\"/\" render={() => { return this.routeByQueryString(); }} exact={true} />\n            </IonRouterOutlet>\n            <IonTabBar slot=\"bottom\">\n              <IonTabButton tab=\"bookmarks\" href=\"/bookmarks\">\n                <IonIcon icon={bookmark} />\n              </IonTabButton>\n              <IonTabButton tab=\"catalog\" href=\"/catalog\">\n                <IonIcon icon={library} />\n              </IonTabButton>\n              <IonTabButton tab=\"dictionay\" href=\"/dictionary\">\n                <IonIcon icon={book} />\n              </IonTabButton>\n              <IonTabButton tab=\"settings\" href=\"/settings\">\n                <IonIcon icon={settings} />\n              </IonTabButton>\n            </IonTabBar>\n          </IonTabs>\n        </IonReactRouter>\n        <IonAlert\n          cssClass='uiFont'\n          isOpen={this.state.showUpdateAlert}\n          backdropDismiss={false}\n          onDidPresent={(ev) => {\n            // Run SKIP_WAITING at onDidPresent event to avoid a race condition of\n            // an old page fetching old JS chunks with a new service worker!\n            this.registrationNew?.installing?.postMessage({ type: 'SKIP_WAITING' });\n            this.registrationNew?.waiting?.postMessage({ type: 'SKIP_WAITING' });\n          }}\n          header={'appapp!'}\n          buttons={[\n            {\n              text: '',\n              cssClass: 'primary uiFont',\n              handler: (value) => {\n                this.setState({\n                  showUpdateAlert: false,\n                });\n              },\n            },\n            {\n              text: '',\n              cssClass: 'secondary uiFont',\n              handler: (value) => {\n                window.open('https://github.com/MrMYHuang/cbetar2#history');\n              },\n            }\n          ]}\n        />\n\n        <ShareTextModal\n          {...{\n            text: this.props.shareTextModal?.text,\n            showModal: this.props.shareTextModal?.show || false,\n            finish: () => {\n              store.dispatch({\n                type: \"TMP_SET_KEY_VAL\",\n                key: 'shareTextModal',\n                val: { show: false },\n              });\n            }, ...this.props\n          }}\n        />\n      </IonApp>\n    );\n  }\n}\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n    shareTextModal: state.tmpSettings.shareTextModal,\n  }\n};\n\nconst AppOrig = connect(\n  mapStateToProps,\n)(_AppOrig);\n\n\nconst App = withRouter(_App);\n\nexport default App;\n","import { /*applyMiddleware,*/ createStore, Store } from \"redux\";\r\n\r\n//import { logger } from \"redux-logger\"\r\n//import thunk from \"redux-thunk\"\r\n//import promise from \"redux-promise-middleware\"\r\n\r\nimport reducer from \"./reducers\";\r\nimport Globals from \"../Globals\";\r\n\r\n//const middleware = applyMiddleware(promise(), thunk, logger)\r\n\r\nvar savedStore: Store;\r\n\r\nexport default function getSavedStore() {\r\n    var savedSettingsStr = localStorage.getItem(Globals.storeFile);\r\n    if (savedSettingsStr != null) {\r\n        savedStore = createStore(reducer, JSON.parse(savedSettingsStr));//, middleware)\r\n    }\r\n    else {\r\n        savedStore = createStore(reducer);//, middleware)\r\n    }\r\n\r\n    return savedStore;\r\n}\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\ntype Config = {\r\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\r\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\r\n};\r\n\r\nexport function register(config?: Config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(\r\n      process.env.PUBLIC_URL,\r\n      window.location.href\r\n    );\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl: string, config?: Config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      /*\r\n      if(registration.waiting) {\r\n        const reg = registration.waiting;\r\n        reg.postMessage({ type: 'SKIP_WAITING' });\r\n        alert('Skip waiting.');\r\n      }*/\r\n\r\n      registration.onupdatefound = () => {\r\n        //alert('onupdatefound.');\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          console.log(`installingWorker stage changed: ${installingWorker.state}`);\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' }\r\n  })\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport { BrowserRouter } from \"react-router-dom\";\r\nimport App, {serviceWorkCallbacks} from './App';\r\nimport Globals from './Globals';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\n// Enable at the very start for logging most messages.\r\nGlobals.enableAppLog();\r\n\r\nReactDOM.render(<BrowserRouter><App /></BrowserRouter>, document.getElementById('root'));\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.register({\r\n    onSuccess: (registration: ServiceWorkerRegistration) => { console.log('Precache app loaded!'); serviceWorkCallbacks.onSuccess(registration); },\r\n    onUpdate: (registration: ServiceWorkerRegistration) => { console.log('Found app updated!'); serviceWorkCallbacks.onUpdate(registration); },\r\n});\r\n"],"sourceRoot":""}